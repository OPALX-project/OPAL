<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OPAL (Object Oriented Parallel Accelerator Library): ippl/src/Utility/DiscField.h Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "AMSmath.js", "AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OPAL (Object Oriented Parallel Accelerator Library)
   &#160;<span id="projectnumber">2021.1.0</span>
   </div>
   <div id="projectbrief">OPAL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_c1cedd6e400148ca9661db8ab466fdca.html">ippl</a></li><li class="navelem"><a class="el" href="../../dir_288a95d165deb49da1bdf061b4c8c849.html">src</a></li><li class="navelem"><a class="el" href="../../dir_0266894d607384bf5f055ea5d631f490.html">Utility</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DiscField.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dc/dd8/a03755.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// -*- C++ -*-</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * The IPPL Framework</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * </span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Visit http://people.web.psi.ch/adelmann/ for more details</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#ifndef DISC_FIELD_H</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#define DISC_FIELD_H</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// include files</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/dfe/a03425.html">Index/NDIndex.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d00/a03323.html">Field/BrickExpression.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d4f/a03746.html">Utility/DiscBuffer.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dbc/a03752.html">Utility/DiscConfig.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d1a/a03803.html">Utility/Inform.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d9d/a03917.html">Utility/vmap.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d51/a03842.html">Utility/IpplTimings.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;cstdlib&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// forward declarations</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> Dim, <span class="keyword">class</span> T&gt; <span class="keyword">class </span><a class="code" href="../../da/d57/a08212.html">UniformCartesian</a>;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keywordtype">unsigned</span> Dim, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt; <span class="keyword">class </span><a class="code" href="../../d7/dfe/a07936.html">Field</a>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> Dim&gt;                            <span class="keyword">class </span><a class="code" href="../../d3/d6d/a08204.html">FieldLayout</a>;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// This helper class is used to represent a record for I/O of the .offset file.</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// It is only used for reads and writes.  See the notes below for</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// the reason the vnodedata is a set of ints instead of an NDIndex.</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">unsigned</span> Dim, <span class="keyword">class</span> T&gt;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="../../d7/d74/a11752.html">   40</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d7/d74/a11752.html">DFOffsetData</a> {</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="../../d7/d74/a11752.html#aae8a75db07a205304616ef5384a02bb1">   41</a></span>&#160;  <span class="keywordtype">int</span>           <a class="code" href="../../d7/d74/a11752.html#aae8a75db07a205304616ef5384a02bb1">vnodedata</a>[6*<a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a>];</div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="../../d7/d74/a11752.html#aba19c2cadc3eb0eaaddcf6d9cdc80546">   42</a></span>&#160;  <span class="keywordtype">bool</span>          <a class="code" href="../../d7/d74/a11752.html#aba19c2cadc3eb0eaaddcf6d9cdc80546">isCompressed</a>;</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="../../d7/d74/a11752.html#a45e48747bbee52ba23c4d66b1bb80fb4">   43</a></span>&#160;  <span class="keywordtype">long</span> <span class="keywordtype">long</span>     <a class="code" href="../../d7/d74/a11752.html#a45e48747bbee52ba23c4d66b1bb80fb4">offset</a>;</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="../../d7/d74/a11752.html#aaecae539de1b3c593610122ff7c42f89">   44</a></span>&#160;  <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>             <a class="code" href="../../d7/d74/a11752.html#aaecae539de1b3c593610122ff7c42f89">compressedVal</a>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;};</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">unsigned</span> Dim&gt;</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html">   49</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d5/dc5/a11756.html">DiscField</a> {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">// Constructor: make a DiscField for writing only</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">// fname = name of file (without extensions</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// config = name of configuration file</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// numFields = number of Fields which will be written to the file</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// typestr = string describing the &#39;type&#39; of the Field to be written (this</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">//           is ignored if the Field is being read).  The string should be</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">//           the same as the statement used to declare the Field object</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">//           e.g., for a field of the form Field&lt;double,2&gt; the string</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">//           should be &quot;Field&lt;double,2&gt;&quot;.  The string should be such that</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">//           if read later into a variable F, you can use the string in</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="comment">//           a source code line as  &#39;F A&#39; to create an instance of the</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">//           same type of data as is stored in the file.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <a class="code" href="../../d5/dc5/a11756.html#a293d5f15ec0c13a523a62e142c05dac9">DiscField</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* fname, <span class="keyword">const</span> <span class="keywordtype">char</span>* config, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numFields,</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span>* typestr = 0);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// Constructor: same as above, but without a config file specified.  The</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// default config file entry that will be used is &quot;*  .&quot;, which means, for</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// each SMP machine, assume the directory to put data files in is &quot;.&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="../../d5/dc5/a11756.html#a293d5f15ec0c13a523a62e142c05dac9">DiscField</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* fname, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numFields,</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span>* typestr = 0);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">// Constructor: make a DiscField for reading only.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">// fname = name of file (without extensions</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="comment">// config = name of configuration file</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="../../d5/dc5/a11756.html#a293d5f15ec0c13a523a62e142c05dac9">DiscField</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* fname, <span class="keyword">const</span> <span class="keywordtype">char</span>* config);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// Constructor: same as above, but without a config file specified.  The</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// default config file entry that will be used is &quot;*  .&quot;, which means, for</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">// each SMP machine, assume the directory to put data files in is &quot;.&quot;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="../../d5/dc5/a11756.html#a293d5f15ec0c13a523a62e142c05dac9">DiscField</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* fname);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// Destructor.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <a class="code" href="../../d5/dc5/a11756.html#a44e63ee2b178c9d4548f5df50256a107">~DiscField</a>();</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">// accessor functions</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// Obtain all the information about the file, including the number</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">// of records, fields, and number of vnodes stored in each record.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/dc5/a11756.html#a21b4a2aede922190ea70206529c574de">query</a>(<span class="keywordtype">int</span>&amp; numRecords, <span class="keywordtype">int</span>&amp; numFields, std::vector&lt;int&gt;&amp; size) <span class="keyword">const</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">// Query for the number of records (e.g., timesteps) in the file.</span></div><div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a3c99d824517ecd5b62e74933039d3ed0">   95</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a3c99d824517ecd5b62e74933039d3ed0">get_NumRecords</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a>; }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// Query for the number of Fields stored in the file.</span></div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#af7559c32c127e0ad60a14f2d28c12262">   98</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#af7559c32c127e0ad60a14f2d28c12262">get_NumFields</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a>; }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="comment">// Query for the total domain of the system.</span></div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#aa58595abad4cb3c996fb5fb04d2214e5">  101</a></span>&#160;  <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> <a class="code" href="../../d5/dc5/a11756.html#aa58595abad4cb3c996fb5fb04d2214e5">get_Domain</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a556bc43d3bda3c1aeac5a1d3516fd174">Size</a>; }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="comment">// Query for the dimension of the data in the file.  This is useful</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// mainly if you are checking for dimension by contructing a DiscField</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="comment">// and then trying to check it&#39;s dimension later.  If the dimension is</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="comment">// not correctly matched with the Dim template parameter, you will get</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">// an error if you try to read or write.</span></div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a19a8da5958ad57f7ecf40114cc761f43">  108</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a19a8da5958ad57f7ecf40114cc761f43">get_Dimension</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#aae80a93157189f2fb474673bbb02b20b">DataDimension</a>; }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">// Query for the type string</span></div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ad8d86aad21a49576293e31d55d20be88">  111</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/dc5/a11756.html#ad8d86aad21a49576293e31d55d20be88">get_TypeString</a>() { <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a20ce03294864203a32e24276f1a87432">TypeString</a>.c_str(); }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// Query for the disctype string</span></div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a0baa52e26c5a1a48f4ef355eee5e787d">  114</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/dc5/a11756.html#a0baa52e26c5a1a48f4ef355eee5e787d">get_DiscType</a>() {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/da2/a11776.html">DiscType</a>.length() &gt; 0)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da2/a11776.html">DiscType</a>.c_str();</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="comment">// read/write methods</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="comment">// read the selected record in the file into the given Field object.</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// readDomain = the portion of the field on disk that should actually be </span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">//              read in, and placed in the same location in the</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">//              provided field.  All of readDomain must be contained</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">//              within the data on disk, and in the field in memory,</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">//              although the domain on disk and in memory do not themselves</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">//              have to be the same.</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// varID = index for which field is being read ... this should be from</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">//         0 ... (numFields-1), for the case where the file contains</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">//         more than one Field.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">// record = which record to read.  DiscField does not keep a &#39;current</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">//          file position&#39; pointer, instead you explicitly request which</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">//          record you wish to read.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// Return success of operation.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt;</div><div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">  140</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">read</a>(<a class="code" href="../../d7/dfe/a07936.html">Field&lt;T,Dim,M,C&gt;</a>&amp; f, <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;readDomain,</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> varID, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// sanity checking for input arguments and state of this object</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">bool</span> canread = <span class="keyword">false</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dc5/a11756.html#ac37f34fb25c7a2f49c038d1443ba464f">ConfigOK</a>) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Cannot read in DiscField::read - config file error.&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/dc5/a11756.html#aae80a93157189f2fb474673bbb02b20b">DataDimension</a> != <a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a>) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Bad dimension &quot;</span>&lt;&lt; <a class="code" href="../../d5/dc5/a11756.html#aae80a93157189f2fb474673bbb02b20b">DataDimension</a> &lt;&lt;<span class="stringliteral">&quot; in DiscField::read&quot;</span>&lt;&lt;<a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;(&quot;</span> &lt;&lt; <a class="code" href="../../d5/dc5/a11756.html#aae80a93157189f2fb474673bbb02b20b">DataDimension</a> &lt;&lt; <span class="stringliteral">&quot; != &quot;</span> &lt;&lt; <a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/dc5/a11756.html#aef3f6576e6130429308bf880cf6c6de3">WritingFile</a>) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;DiscField::read called for DiscField opened for write.&quot;</span>&lt;&lt;<a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (varID &gt;= <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a>) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(varID &lt;&lt; <span class="stringliteral">&quot; is a bad Field ID in DiscField::read.&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;(&quot;</span> &lt;&lt; varID &lt;&lt; <span class="stringliteral">&quot; is &gt;= &quot;</span> &lt;&lt; <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (record &gt;= <a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a>) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(record &lt;&lt; <span class="stringliteral">&quot; is a bad record number in DiscField::read.&quot;</span>&lt;&lt;<a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;(&quot;</span> &lt;&lt; record &lt;&lt; <span class="stringliteral">&quot; is &gt;= &quot;</span> &lt;&lt; <a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(f.<a class="code" href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">getLayout</a>().<a class="code" href="../../d3/d6d/a08204.html#a145fb07dd8ce69c94cc355f263fc22ef">getDomain</a>().contains(readDomain))) {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;DiscField::read - the total field domain &quot;</span>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(f.<a class="code" href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">getLayout</a>().<a class="code" href="../../d3/d6d/a08204.html#a145fb07dd8ce69c94cc355f263fc22ef">getDomain</a>() &lt;&lt; <span class="stringliteral">&quot; must contain the requested &quot;</span>);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;read domain &quot;</span> &lt;&lt; readDomain &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(<a class="code" href="../../d5/dc5/a11756.html#aa58595abad4cb3c996fb5fb04d2214e5">get_Domain</a>().contains(readDomain))) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;DiscField::read - the DiscField domain &quot;</span>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<a class="code" href="../../d5/dc5/a11756.html#aa58595abad4cb3c996fb5fb04d2214e5">get_Domain</a>() &lt;&lt; <span class="stringliteral">&quot; must contain the requested &quot;</span>);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;read domain &quot;</span> &lt;&lt; readDomain &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      canread = <span class="keyword">true</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// If there was an error, we will abort</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (!canread) {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// A typedef used later</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="../../d9/d37/a07940.html">LField&lt;T,Dim&gt;::iterator</a> LFI;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="../../d1/d2f/a08404.html">BrickExpression&lt;Dim,LFI,LFI,OpAssign&gt;</a> <a class="code" href="../../d2/dc7/a04303.html#a45b11d8daf90ce2a666257dba64d3114">Expr_t</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// Start timer for just the read portion</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keyword">static</span> <a class="code" href="../../d0/d38/a11896.html#a06ab8330445cb281b26fa12dbfa2b72c">IpplTimings::TimerRef</a> readtimer =</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <a class="code" href="../../d0/d38/a11896.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a>(<span class="stringliteral">&quot;DiscField read&quot;</span>);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="../../d0/d38/a11896.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(readtimer);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// Get a new tag value for this read operation, used for all sends</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// to other nodes with data.</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">int</span> tag = <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d1/d51/a09544.html#aec355d9c01194461adbba236ffbd7b21">next_tag</a>(<a class="code" href="../../dd/d25/a03545.html#a14ad11ad74c33d5001e5831101105ba6">DF_READ_TAG</a>, <a class="code" href="../../dd/d25/a03545.html#a913eb02f7935f8df3324d5fce5934a8c">DF_TAG_CYCLE</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// At the start of a new record, determine how many elements of the</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// Field should be stored into this node&#39;s vnodes.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">int</span> expected = <a class="code" href="../../d5/dc5/a11756.html#a1c40653c5efa9da51af75b28bca15d54">compute_expected</a>(f.<a class="code" href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">getLayout</a>(), readDomain);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// On all nodes, loop through all the file sets, and:</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">//   1. box0: Get the number of vnodes stored there, from the layout file</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">//   2. box0: Get offset information for all the vnodes, and</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">//      assign other nodes on the same SMP selected vnodes to read.</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">//   2. For each vnode assigned to a processor to read:</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">//       - read data (if necessary)</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">//       - distribute data to interested parties, or yourself</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// On all nodes, when you get some data from another node:</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">//       - copy it into the relevant vnode</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">//       - decrement your expected value.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// When expected hits zero, we&#39;re done with reading on that node.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sf=0; sf &lt; <a class="code" href="../../d5/dc5/a11756.html#aa200b6d45c51e9ad046784326329fd35">numFiles</a>(); ++sf) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="comment">// Create the data file handle, but don&#39;t yet open it ... only open</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="comment">// it if we need to later (if we run into any uncompressed blocks).</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordtype">int</span> outputDatafd = (-1);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="comment">// offset data read in from file or obtained from the box0 node</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      std::vector&lt;DFOffsetData&lt;Dim,T&gt; &gt; offdata;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="comment">// the number of vnodes we&#39;ll be working on on this node</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordtype">int</span> vnodes = 0;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="comment">// the maximum number of elements we&#39;ll need to have buffer space for</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <span class="keywordtype">int</span> maxsize = 0;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="comment">// on box0 nodes, read in the layout and offest info</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>() == <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>()) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">// Get the number of vnodes in this file.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        vnodes = <a class="code" href="../../d5/dc5/a11756.html#aa2b16267f9c24426e9b164fbf897c638">read_layout</a>(record, sf);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment">// Get the offset data for this field and record.</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="../../d5/dc5/a11756.html#a0266a4f1bd61f1b84eb39fc2525c9862">read_offset</a>(varID, record, sf, offdata, vnodes);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="comment">// On all nodes, either send out or receive in offset information.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="comment">// Some nodes will not get any, and will not have to do any reading.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="comment">// But those that do, will read in data for the vnodes they are</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="comment">// assigned.  &#39;vnodes&#39; will be set to the number of vnodes assigned</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="comment">// for reading from this node, and  &#39;maxsize&#39; will be set</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="comment">// to the maximum size of the vnodes in this file, for use in</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="comment">// preparing the buffer that will be used to read those vnodes.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <a class="code" href="../../d5/dc5/a11756.html#ad4466e6c26a44ea458fd2a9ad1601d57">distribute_offsets</a>(offdata, vnodes, maxsize, readDomain);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="comment">// Loop through all the vnodes now; they will appear in any</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="comment">// order, which is fine, we just read them and and see where they</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="comment">// go.  The info in the offset struct includes the domain for that</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="comment">// block and whether it was written compressed or not.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> vn=0; vn &lt; vnodes; ++vn) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">// Create an NDIndex object storing the vnode domain for this vnode.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> vnodeblock;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <a class="code" href="../../d5/dc5/a11756.html#a3909c5fc495836702913f727e986ddac">offset_data_to_domain</a>(offdata[vn], vnodeblock);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment">// If there is no intersection of this vnode and the read-domain,</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="comment">// we can just skip it entirely.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">if</span> (! vnodeblock.<a class="code" href="../../d4/d8b/a07944.html#a2917bb719ec865512e42401b55284d7d">touches</a>(readDomain)) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">// Compute the size of a block to add to the base of this block,</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">// based on the chunk size.  If the data is compressed, this won&#39;t</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="comment">// matter.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordtype">int</span> msdim = (<a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a>-1);    <span class="comment">// this will be zero-based</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordtype">int</span> chunkelems = <a class="code" href="../../d5/d16/a11864.html#a3af4c27c54dc01bea7aece3230ea95cd">Ippl::chunkSize</a>() / <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> chunkblock = <a class="code" href="../../d5/dc5/a11756.html#a705aefde97387f54f0a7b455827a2f41">chunk_domain</a>(vnodeblock, chunkelems, msdim,</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                               offdata[vn].isCompressed);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">// Initialize the NDIndex we&#39;ll use to indicate what portion of the</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">// domain we&#39;re reading and processing.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> currblock = vnodeblock;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        currblock[msdim] = <a class="code" href="../../d1/d28/a08524.html">Index</a>(vnodeblock[msdim].first() - 1,</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                                 vnodeblock[msdim].first() - 1);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> md = (msdim+1); md &lt; <a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a>; ++md)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;          currblock[md] = <a class="code" href="../../d1/d28/a08524.html">Index</a>(vnodeblock[md].first(),vnodeblock[md].first());</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">// Initialize the offset value for this vnode.  The seek position</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="comment">// is stored as a byte offset, although it is read from disk as</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="comment">// a number of elements offset from the beginning.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a> seekpos = (-1);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="comment">// Loop through the chunks, reading and processing each one.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordtype">int</span> unread = vnodeblock.<a class="code" href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">size</a>();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">while</span> (unread &gt; 0) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          <span class="comment">// Compute the domain of the chunk we&#39;ll work on now, and store</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;          <span class="comment">// this in currblock.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;          <span class="comment">// First determine if we&#39;re at the end of our current incr dimension,</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;          <span class="comment">// and determine new bounds</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          <span class="keywordtype">bool</span> incrhigher=(currblock[msdim].last()==vnodeblock[msdim].last());</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;          <span class="keywordtype">int</span> <a class="code" href="../../d0/d1e/a03674.html#a0fe983ce29b295378e5d2fd09dc57337">a</a> = (incrhigher ?</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                   vnodeblock[msdim].first() :</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                   currblock[msdim].last() + 1);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          <span class="keywordtype">int</span> b = <a class="code" href="../../d0/d1e/a03674.html#a0fe983ce29b295378e5d2fd09dc57337">a</a> + chunkblock[msdim].length() - 1;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          <span class="keywordflow">if</span> (b &gt; vnodeblock[msdim].last())</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            b = vnodeblock[msdim].last();</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          <span class="comment">// Increment this dimension</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          currblock[msdim] = <a class="code" href="../../d1/d28/a08524.html">Index</a>(<a class="code" href="../../d0/d1e/a03674.html#a0fe983ce29b295378e5d2fd09dc57337">a</a>, b);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          <span class="comment">// Increment higher dimensions, if necessary</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;          <span class="keywordflow">if</span> (incrhigher) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cd = (msdim+1); cd &lt; <a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a>; ++cd) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;              <span class="keywordflow">if</span> (currblock[cd].last() &lt; vnodeblock[cd].last()) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="comment">// This dim is not at end, so just inc by 1</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                currblock[cd] = <a class="code" href="../../d1/d28/a08524.html">Index</a>(currblock[cd].first() + 1,</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                      currblock[cd].last() + 1);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;              } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                <span class="comment">// Move this dimension back to start, and go on to next one</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                currblock[cd] = <a class="code" href="../../d1/d28/a08524.html">Index</a>(vnodeblock[cd].first(),</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                                      vnodeblock[cd].first());</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;              }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          <span class="comment">// Decrement our unread count, since we&#39;ll process this block</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          <span class="comment">// either by actually reading it or getting its compressed value</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          <span class="comment">// from the offset file, if we have to read it at all.</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          <span class="keywordtype">int</span> nelems = currblock.<a class="code" href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">size</a>();</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;          unread -= nelems;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;          <span class="comment">// Set the seek position now, if necessary</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;          <span class="keywordflow">if</span> (!offdata[vn].isCompressed &amp;&amp; seekpos &lt; 0) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            seekpos = offdata[vn].offset * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;          <span class="comment">// At this point, we might be able to skip a lot of work if this</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;          <span class="comment">// particular chunk does not intersect with our read domain any.</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;          <span class="keywordflow">if</span> (! currblock.<a class="code" href="../../d4/d8b/a07944.html#a2917bb719ec865512e42401b55284d7d">touches</a>(readDomain)) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">// Before we skip the rest, we must update the offset</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a> readbytes  = nelems * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            seekpos += readbytes;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="comment">// Then, we&#39;re done with this chunk, move on to the next.</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;          }</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;          <span class="comment">// Put the intersecting domain in readDomainSection.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> readDomainSection = currblock.<a class="code" href="../../d4/d8b/a07944.html#ad175b56cd8ec95f78a201cac4feb8931">intersect</a>(readDomain);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;          <span class="comment">// if it is not compressed, read in the data.  If it is,</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          <span class="comment">// just keep the buffer pointer at zero.</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> *buffer = 0;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;          <span class="keywordflow">if</span> (!offdata[vn].isCompressed) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="comment">// If we have not yet done so, open the data file.</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">if</span> (outputDatafd &lt; 0) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;              outputDatafd = <a class="code" href="../../d5/dc5/a11756.html#aad797405fccbdf02814a6f2c75df5e55">open_df_file_fd</a>(<a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a05bd58e90fa26c847ef382a8c306196d">getFilename</a>(sf), <span class="stringliteral">&quot;.data&quot;</span>,</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                                             O_RDONLY);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="comment">// Resize the read buffer in case it is not large enough.</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="comment">// We use the max size for all the vnodes here, to avoid doing</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="comment">// this more than once per file set.  This also returns the</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="comment">// pointer to the buffer to use, as a void *, which we cast</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="comment">// to the proper type.  For direct-io, we might need to make</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="comment">// this a little bigger to match the device block size.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="keywordtype">long</span> nbytes = maxsize*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            buffer = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> *<span class="keyword">&gt;</span>(<a class="code" href="../../d2/d10/a11736.html#ac5a7e89e6600571b0ed4078e242640af">DiscBuffer::resize</a>(nbytes));</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="comment">// Create some initial values for what and where to read.</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="comment">// We might adjust these if we&#39;re doing direct-io.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> *      readbuffer = buffer;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a> readbytes  = nelems * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a> readoffset = seekpos;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="comment">// seekpos was only used to set readoffset, so we can update</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <span class="comment">// seekpos now.  Add in the extra amount we&#39;ll be reading.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            seekpos += readbytes;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="comment">// Read data in a way that might do direct-io</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <a class="code" href="../../d5/dc5/a11756.html#ab44d74480220b446935be44e94eb2d70">read_data</a>(outputDatafd, readbuffer, readbytes, readoffset);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;          }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;          <span class="comment">// we have the data block now; find out where the data should</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          <span class="comment">// go, and either send the destination node a message, or copy</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;          <span class="comment">// the data into the destination lfield.</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;          <span class="comment">// Set up to loop over the touching remote vnodes, and send out</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;          <span class="comment">// messages</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          <span class="keyword">typename</span> <a class="code" href="../../da/d7e/a08004.html">FieldLayout&lt;Dim&gt;::touch_iterator_dv</a> rv_i;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          <span class="comment">//      int remaining = nelems;</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          <span class="keywordtype">int</span> remaining = readDomainSection.<a class="code" href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">size</a>();</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          <span class="comment">// compute what remote vnodes touch this block&#39;s domain, and</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          <span class="comment">// iterate over them.</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          <span class="comment">//      typename FieldLayout&lt;Dim&gt;::touch_range_dv</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;          <span class="comment">//        range(f.getLayout().touch_range_rdv(currblock));</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;          <span class="keyword">typename</span> <a class="code" href="../../d3/d6d/a08204.html#a96b38e185c137f83885e10d16e5643f4">FieldLayout&lt;Dim&gt;::touch_range_dv</a></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            range(f.<a class="code" href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">getLayout</a>().<a class="code" href="../../d3/d6d/a08204.html#a1441fa1f8ea7a62aba2abc47ff8065bd">touch_range_rdv</a>(readDomainSection));</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;          <span class="keywordflow">for</span> (rv_i = range.first; rv_i != range.second; ++rv_i) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="comment">// Compute the intersection of our domain and the remote vnode</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <span class="comment">//      NDIndex&lt;Dim&gt; ri = currblock.intersect((*rv_i).first);</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> ri = readDomainSection.<a class="code" href="../../d4/d8b/a07944.html#ad175b56cd8ec95f78a201cac4feb8931">intersect</a>((*rv_i).first);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            </div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="comment">// Find out who will be sending this data</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="keywordtype">int</span> rnode = (*rv_i).second-&gt;getNode();</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="comment">// Send this data to that remote node, by preparing a</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="comment">// CompressedBrickIterator and putting in the proper data.</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <a class="code" href="../../dc/dd6/a09360.html">Message</a> *msg = <span class="keyword">new</span> <a class="code" href="../../dc/dd6/a09360.html">Message</a>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            ri.<a class="code" href="../../d4/d8b/a07944.html#a6ebe77298883352ee93598a9e91d98a0">putMessage</a>(*msg);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            LFI cbi(buffer, ri, currblock, offdata[vn].compressedVal);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            cbi.TryCompress();</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            cbi.putMessage(*msg, <span class="keyword">false</span>);  <span class="comment">// &#39;false&#39; = avoid copy if possible</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d7/d31/a08956.html#a5c519594f60faadd9202606f1ba0bbc3">send</a>(msg, rnode, tag);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="comment">// Decrement the remaining count</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            remaining -= ri.<a class="code" href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">size</a>();</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          }</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <span class="comment">// loop over touching local vnodes, and copy in data, if there</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          <span class="comment">// is anything left</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          <span class="keyword">typename</span> <a class="code" href="../../dd/d54/a08008.html#a8708a405938d97966b20f420d67b4fa7">BareField&lt;T,Dim&gt;::iterator_if</a> lf_i = f.<a class="code" href="../../dd/d54/a08008.html#a762004cbc1ac304271ea609fc8abe501">begin_if</a>();</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          <span class="keywordflow">for</span> (; remaining &gt; 0 &amp;&amp; lf_i != f.<a class="code" href="../../dd/d54/a08008.html#ab436e2eb992a9a87449757517ab60b68">end_if</a>(); ++lf_i) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <span class="comment">// Get the current LField and LField domain, and make an alias</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <span class="comment">// for the domain of the block we&#39;ve read from disk</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <a class="code" href="../../d3/d4c/a08012.html">LField&lt;T,Dim&gt;</a> &amp;lf = *(*lf_i).second;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a>&amp; lo = lf.<a class="code" href="../../d3/d4c/a08012.html#a621e7e0f4520838b2507ab3ad2442318">getOwned</a>();</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="comment">//      const NDIndex&lt;Dim&gt;&amp; ro = currblock;</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a>&amp; ro = readDomainSection;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="comment">// See if it touches the domain of the recently read block.</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">if</span> (lo.<a class="code" href="../../d4/d8b/a07944.html#a2917bb719ec865512e42401b55284d7d">touches</a>(ro)) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;              <span class="comment">// Find the intersection.</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;              <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> ri = lo.<a class="code" href="../../d4/d8b/a07944.html#ad175b56cd8ec95f78a201cac4feb8931">intersect</a>(ro);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;              <span class="comment">// If these are compressed we might not have to do any work.</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;              <span class="keywordflow">if</span> (lf.<a class="code" href="../../d3/d4c/a08012.html#a5bf55eca1a2d772944a15f1e4361efed">IsCompressed</a>() &amp;&amp;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                  offdata[vn].isCompressed &amp;&amp;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                  ro.<a class="code" href="../../d4/d8b/a07944.html#a39248b9764246ad6635862dd52cf7ea8">contains</a>(lo)) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <a class="code" href="../../db/d69/a03320.html#af01b9b0c367940525ea2a7fffa7b3bf7">PETE_apply</a>(<a class="code" href="../../d1/d83/a11548.html">OpAssign</a>(),*lf.<a class="code" href="../../d3/d4c/a08012.html#ac785783b40bde6497da0587503f1f846">begin</a>(),offdata[vn].compressedVal);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;              } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                <span class="comment">// Build an iterator for the read-data block</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                <span class="comment">// LFI rhs_i(buffer, ri, ro, offdata[vn].compressedVal);</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                LFI rhs_i(buffer, ri, currblock, offdata[vn].compressedVal);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                <span class="comment">// Could we compress that rhs iterator?</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                <span class="keywordflow">if</span> (rhs_i.CanCompress(*rhs_i) &amp;&amp; f.<a class="code" href="../../dd/d54/a08008.html#aab4b994ffccabe14ba5c18255615b897">compressible</a>() &amp;&amp;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    ri.<a class="code" href="../../d4/d8b/a07944.html#a39248b9764246ad6635862dd52cf7ea8">contains</a>(lf.<a class="code" href="../../d3/d4c/a08012.html#aba07081c0381e7e0f25d214db7613164">getAllocated</a>())) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                  <span class="comment">// Compress the whole LField to the value on the right</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                  lf.<a class="code" href="../../d3/d4c/a08012.html#a0a5b76a0133a6c0ab73b4874096a08cb">Compress</a>(*rhs_i);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                } <span class="keywordflow">else</span> { <span class="comment">// Assigning only part of LField on the left</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                  <span class="comment">// Must uncompress lhs, if not already uncompressed</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                  lf.<a class="code" href="../../d3/d4c/a08012.html#ac8d1d4505ca5562f4feee551089c1276">Uncompress</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                  <span class="comment">// Get the iterator for it.</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                  LFI lhs_i = lf.<a class="code" href="../../d3/d4c/a08012.html#ac785783b40bde6497da0587503f1f846">begin</a>(ri);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                  <span class="comment">// And do the assignment.</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                  <a class="code" href="../../d2/dc7/a04303.html#a45b11d8daf90ce2a666257dba64d3114">Expr_t</a>(lhs_i,rhs_i).apply();</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;              }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;              <span class="comment">// Decrement the expected count and the remaining count.</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;              <span class="comment">// Remaining is how many cells are left of the current block.</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;              <span class="comment">// Expected is how many cells this node expects to get copied</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;              <span class="comment">// into its blocks.</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;              <span class="keywordtype">int</span> bsize = ri.<a class="code" href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">size</a>();</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;              remaining -= bsize;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;              expected -= bsize;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;          }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;          <span class="comment">// If we&#39;re here and still have remaining elements, we&#39;re screwed.</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;          <span class="keywordflow">if</span> (remaining &gt; 0)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;remaining &gt; 0 at end of box0 vnode read!!!&quot;</span>);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <span class="comment">// Close the data file now</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      </div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">if</span> (outputDatafd &gt;= 0)</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        close(outputDatafd);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// On all nodes, now, keep receiving messages until our expected count</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// goes to zero.</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">while</span> (expected &gt; 0) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="comment">// Receive the next message from any node with the current read tag</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keywordtype">int</span> node = <a class="code" href="../../d8/d63/a03500.html#a8fd7c2717593266e2ebbaaf1c23d2d01">COMM_ANY_TAG</a>;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <a class="code" href="../../dc/dd6/a09360.html">Message</a> *msg = <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d7/d31/a08956.html#ac0e671485db61cd6fdf8961504250b2b">receive_block</a>(node, tag);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="comment">// Extract the domain from the message</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> ro;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      ro.<a class="code" href="../../d4/d8b/a07944.html#a131a7ae47e0fa32176fa8220bf7cc78f">getMessage</a>(*msg);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="comment">// Extract the data from the message</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> rhs_compressed_data;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      LFI rhs_i(rhs_compressed_data);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      rhs_i.getMessage(*msg);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="comment">// Find what local LField contains this domain</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keyword">typename</span> <a class="code" href="../../dd/d54/a08008.html#a8708a405938d97966b20f420d67b4fa7">BareField&lt;T,Dim&gt;::iterator_if</a> lf_i = f.<a class="code" href="../../dd/d54/a08008.html#a762004cbc1ac304271ea609fc8abe501">begin_if</a>();</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordtype">bool</span> foundlf = <span class="keyword">false</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keywordflow">for</span> (; lf_i != f.<a class="code" href="../../dd/d54/a08008.html#ab436e2eb992a9a87449757517ab60b68">end_if</a>(); ++lf_i) {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="comment">// Get the current LField and LField domain</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <a class="code" href="../../d3/d4c/a08012.html">LField&lt;T,Dim&gt;</a> &amp;lf = *(*lf_i).second;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a>&amp; lo = lf.<a class="code" href="../../d3/d4c/a08012.html#a621e7e0f4520838b2507ab3ad2442318">getOwned</a>();</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment">// See if it contains the domain of the recently received block.</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment">// If so, assign the block to this LField</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordflow">if</span> (lo.<a class="code" href="../../d4/d8b/a07944.html#a39248b9764246ad6635862dd52cf7ea8">contains</a>(ro)) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          <span class="comment">// Check and see if we really have to do this.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          <span class="keywordflow">if</span> ( !(rhs_i.IsCompressed() &amp;&amp; lf.<a class="code" href="../../d3/d4c/a08012.html#a5bf55eca1a2d772944a15f1e4361efed">IsCompressed</a>() &amp;&amp;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                 (*rhs_i == *lf.<a class="code" href="../../d3/d4c/a08012.html#ac785783b40bde6497da0587503f1f846">begin</a>())) ) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <span class="comment">// Yep. gotta do it, since something is uncompressed or</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="comment">// the values are different.</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="comment">// Uncompress the LField first, if necessary.  It&#39;s necessary</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="comment">// if the received block size is smaller than the LField&#39;s.</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            lf.<a class="code" href="../../d3/d4c/a08012.html#ac8d1d4505ca5562f4feee551089c1276">Uncompress</a>(!ro.<a class="code" href="../../d4/d8b/a07944.html#a39248b9764246ad6635862dd52cf7ea8">contains</a>(lo));</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            <span class="comment">// Make an iterator over the received block&#39;s portion of the</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="comment">// LField</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            LFI lhs_i = lf.<a class="code" href="../../d3/d4c/a08012.html#ac785783b40bde6497da0587503f1f846">begin</a>(ro);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <span class="comment">// Do the assignment.</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <a class="code" href="../../d2/dc7/a04303.html#a45b11d8daf90ce2a666257dba64d3114">Expr_t</a>(lhs_i,rhs_i).apply();</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;          <span class="comment">// Update our expected value</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;          expected -= ro.<a class="code" href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">size</a>();</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;          <span class="comment">// Indicate we&#39;re done, since the block we received is</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;          <span class="comment">// guaranteed to be within only one of our LFields.</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;          foundlf = <span class="keyword">true</span>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="comment">// Make sure we found what vnode this message is for; if we don&#39;t</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="comment">// we&#39;re screwed</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">if</span> (!foundlf) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Did not find destination local vnode for received domain &quot;</span>);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(ro &lt;&lt; <span class="stringliteral">&quot; from node &quot;</span> &lt;&lt; node &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;DID NOT FIND DESINATION LOCAL VNODE IN DISCFIELD::READ&quot;</span>);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="comment">// Now we are done with the message</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keyword">delete</span> msg;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">// We&#39;re all done reading, so clean up</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="../../d0/d38/a11896.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(readtimer);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">// This is just like an assign, so set dirty flags, fill guard cells,</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">// and try to compress the result.</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    f.<a class="code" href="../../dd/d54/a08008.html#a1429ce5f39542b388dab4aefa7f19062">setDirtyFlag</a>();</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    f.<a class="code" href="../../dd/d54/a08008.html#a1726674af15c63f514b9b4ff09767641">fillGuardCellsIfNotDirty</a>();</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    f.<a class="code" href="../../dd/d54/a08008.html#a89416ffa0503a40311538a1fcd4dab92">Compress</a>();</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">// Let everything catch up</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d7/d31/a08956.html#ac4593203c34f26c625bd51c7502c297e">barrier</a>();</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">// print out malloc info at end of read</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">//     Inform memmsg(&quot;DiscField::read::mallinfo&quot;);</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="comment">//     struct mallinfo mdata;</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">//     mdata = mallinfo();</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">//     memmsg &lt;&lt; &quot;After read, new malloc info:&quot; &lt;&lt; endl;</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">//     memmsg &lt;&lt; &quot;----------------------------&quot; &lt;&lt; endl;</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">//     memmsg &lt;&lt; &quot;  total arena space = &quot; &lt;&lt; mdata.arena &lt;&lt; endl;</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">//     memmsg &lt;&lt; &quot;    ordinary blocks = &quot; &lt;&lt; mdata.ordblks &lt;&lt; endl;</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">//     memmsg &lt;&lt; &quot;       small blocks = &quot; &lt;&lt; mdata.smblks &lt;&lt; endl;</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">//     memmsg &lt;&lt; &quot;    user-held space = &quot; &lt;&lt; mdata.usmblks+mdata.uordblks;</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">//     memmsg &lt;&lt; endl;</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">//     memmsg &lt;&lt; &quot;         free space = &quot; &lt;&lt; mdata.fsmblks+mdata.fordblks;</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">//     memmsg &lt;&lt; endl;</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="comment">// versions of read that provide default values for the arguments</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt;</div><div class="line"><a name="l00572"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a0bbc6596c0c035430cecf64ed00a5e3d">  572</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a0bbc6596c0c035430cecf64ed00a5e3d">read</a>(<a class="code" href="../../d7/dfe/a07936.html">Field&lt;T,Dim,M,C&gt;</a>&amp; f, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> varID, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record) {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">read</a>(f, f.<a class="code" href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">getLayout</a>().<a class="code" href="../../d3/d6d/a08204.html#a145fb07dd8ce69c94cc355f263fc22ef">getDomain</a>(), varID, record);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt;</div><div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a50a8f522d9e3d968247e24ff1bd9718c">  577</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a50a8f522d9e3d968247e24ff1bd9718c">read</a>(<a class="code" href="../../d7/dfe/a07936.html">Field&lt;T,Dim,M,C&gt;</a>&amp; f, <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;readDomain,</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> varID) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">read</a>(f, readDomain, varID, 0);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt;</div><div class="line"><a name="l00583"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a694b8f7ee918239eada8f4514b5a81a6">  583</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a694b8f7ee918239eada8f4514b5a81a6">read</a>(<a class="code" href="../../d7/dfe/a07936.html">Field&lt;T,Dim,M,C&gt;</a>&amp; f, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> varID) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">read</a>(f, f.<a class="code" href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">getLayout</a>().<a class="code" href="../../d3/d6d/a08204.html#a145fb07dd8ce69c94cc355f263fc22ef">getDomain</a>(), varID, 0);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt;</div><div class="line"><a name="l00588"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ade1546f29a6b8031bdb5fe0d4c9edf78">  588</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#ade1546f29a6b8031bdb5fe0d4c9edf78">read</a>(<a class="code" href="../../d7/dfe/a07936.html">Field&lt;T,Dim,M,C&gt;</a>&amp; f, <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;readDomain) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">read</a>(f, readDomain, 0, 0);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt;</div><div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#aad6ce7ef888f630e250f2f2286812d8f">  593</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#aad6ce7ef888f630e250f2f2286812d8f">read</a>(<a class="code" href="../../d7/dfe/a07936.html">Field&lt;T,Dim,M,C&gt;</a>&amp; f) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">read</a>(f, f.<a class="code" href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">getLayout</a>().<a class="code" href="../../d3/d6d/a08204.html#a145fb07dd8ce69c94cc355f263fc22ef">getDomain</a>(), 0, 0);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="comment">// write the data from the given Field into the file.  This can be used</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">// to either append new records, or to overwrite an existing record.</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="comment">// varID = index for which field is being written ... this should be from</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="comment">//         0 ... (numFields-1), for the case where the file contains</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="comment">//         more than one Field.  Writing continues for the current record</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="comment">//         until all numField fields have been written; then during the</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">//         next write, the record number is incremented.</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// notes for documentation:</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="comment">// - for now, you can not overwrite Field data on succesive writes</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="comment">//   (this can easily be added when needed - some restrictions will apply)</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="comment">// - when writing, all the Fields in a record must have the same layout</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">// - layouts (and vnodes) can vary between records, however</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">// - separate DiscField objects need to be opened for reading and writing</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt;</div><div class="line"><a name="l00615"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a078b6c2b3efe23b52458033b1ebae389">  615</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a078b6c2b3efe23b52458033b1ebae389">write</a>(<a class="code" href="../../d7/dfe/a07936.html">Field&lt;T,Dim,M,C&gt;</a>&amp; f, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> varID) {</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="comment">// sanity checking for input arguments and state of this object</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dc5/a11756.html#ac37f34fb25c7a2f49c038d1443ba464f">ConfigOK</a>) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Cannot write in DiscField::write - config file error.&quot;</span>&lt;&lt;<a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dc5/a11756.html#aef3f6576e6130429308bf880cf6c6de3">WritingFile</a>) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;DiscField::write called for DiscField opened for read.&quot;</span>&lt;&lt;<a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (varID &gt;= <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a>) {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(varID &lt;&lt; <span class="stringliteral">&quot; is a bad variable ID in DiscField::write.&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/dc5/a11756.html#ab265d13c12a250189fcc0b36a2466587">NeedStartRecord</a> == 0 &amp;&amp; <a class="code" href="../../d5/dc5/a11756.html#a4ea3b74ee81b3aece7736dfa076a29af">ValidField</a>[varID]) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;DiscField:write - attempt to overwrite Field &quot;</span> &lt;&lt; varID);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot; at record &quot;</span> &lt;&lt; <a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a> - 1 &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">//    INCIPPLSTAT(incDiscWrites);</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// useful typedefs for later</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="../../d9/d37/a07940.html">LField&lt;T,Dim&gt;::iterator</a> LFI;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">// Get a new tag value for this write operation, used for all sends</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">// to other nodes with data.</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordtype">int</span> tag = <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d1/d51/a09544.html#aec355d9c01194461adbba236ffbd7b21">next_tag</a>(<a class="code" href="../../dd/d25/a03545.html#ac1ba8db11c328fa03dfb59fc7156ddc0">FB_WRITE_TAG</a>, <a class="code" href="../../dd/d25/a03545.html#a1aaf7fb71bd584f8ecfe0c9678450043">FB_TAG_CYCLE</a>);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">// Get the layout reference, and set up an iterator over lfields</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="../../d3/d6d/a08204.html">FieldLayout&lt;Dim&gt;</a>&amp; layout = f.<a class="code" href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">getLayout</a>();</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keyword">typename</span> <a class="code" href="../../dd/d54/a08008.html#a8708a405938d97966b20f420d67b4fa7">Field&lt;T,Dim,M,C&gt;::iterator_if</a> local;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// do we need to start a new record?  If so, extend data structures and</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">// file storage</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/dc5/a11756.html#ab265d13c12a250189fcc0b36a2466587">NeedStartRecord</a> != 0) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="comment">// convert the layout information for the field into internal storage,</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="comment">// represented as a map from NDIndex --&gt; owner node</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dc5/a11756.html#a19941b5e5fc5170757a044e15fa276f0">make_globalID</a>(layout)) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;DiscField::write - all Field&#39;s must have the same &quot;</span>);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;global domain in a single DiscField.\n&quot;</span>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;The original domain is &quot;</span> &lt;&lt; <a class="code" href="../../d5/dc5/a11756.html#aa58595abad4cb3c996fb5fb04d2214e5">get_Domain</a>() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;the attempted new domain is &quot;</span> &lt;&lt; layout.<a class="code" href="../../d3/d6d/a08204.html#a145fb07dd8ce69c94cc355f263fc22ef">getDomain</a>() &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="comment">// update vnode and valid field information for new record</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/dc5/a11756.html#aa200b6d45c51e9ad046784326329fd35">numFiles</a>() &gt; 0 &amp;&amp; <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>() == (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>()) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordtype">int</span> nvtally = 0;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <a class="code" href="../../d5/dc5/a11756.html#a4155576007acb2164434a4e43984dac3">NumVnodes</a>[0].push_back(<a class="code" href="../../d5/dc5/a11756.html#ade754a87d6e1046f83911824139ad64f">globalID</a>.<a class="code" href="../../d2/d1c/a11968.html#a46039b2af8cb9d9550155bdfa5fa477a">size</a>());</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a> &gt; 0)</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;          nvtally = <a class="code" href="../../d5/dc5/a11756.html#aabba5490aff2d910d6910032bb4a2e9c">VnodeTally</a>[0][<a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a>-1] + <a class="code" href="../../d5/dc5/a11756.html#a4155576007acb2164434a4e43984dac3">NumVnodes</a>[0][<a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a>-1];</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <a class="code" href="../../d5/dc5/a11756.html#aabba5490aff2d910d6910032bb4a2e9c">VnodeTally</a>[0].push_back(nvtally);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      }</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="comment">// indicate we have not written out data for any fields for this record</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a>; ++i)</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <a class="code" href="../../d5/dc5/a11756.html#a4ea3b74ee81b3aece7736dfa076a29af">ValidField</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">// increment total record number</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a>++;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <a class="code" href="../../d5/dc5/a11756.html#a52347e63bac3e5bcac27ec93c2470866">NumWritten</a> = 0;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="comment">// update necessary data files at the start of a new record</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>() == <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>()) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="comment">// Update the meta information ... this can be changed to be only</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="comment">// written out during destruction.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dc5/a11756.html#af73bc011b36aa9c69303becca9aebdbf">write_meta</a>()) {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Could not write .meta file on node &quot;</span> &lt;&lt; <a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>());</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        }</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="comment">// write out the NDIndex objects from the FieldLayout to the</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="comment">// .layout file</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d5/dc5/a11756.html#a14561ec30d59b89d93efe82b316bf869">write_layout</a>()) {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Could not update .layout file on node &quot;</span>&lt;&lt;<a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>());</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="comment">// On box0 nodes, do most of the work ... other nodes forward data</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// to box0 nodes.</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>() == <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>()) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="comment">// Open the offset data file, and write the Field number.</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="comment">// This precedes all the OffsetData structs for vnodes in the Field,</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="comment">// which are in random order for the given Field.  The OffsetData</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="comment">// structs contains a field &#39;vnode&#39; which tells which vnode the data is</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="comment">// for (0 ... numVnodes - 1).</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      FILE *outputOffset = <a class="code" href="../../d5/dc5/a11756.html#adea1eab5d37e0559636433d06aca23aa">open_df_file</a>(<a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a05bd58e90fa26c847ef382a8c306196d">getFilename</a>(0),</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                                        <span class="stringliteral">&quot;.offset&quot;</span>, std::string(<span class="stringliteral">&quot;a&quot;</span>));</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="keywordtype">int</span> wVarID = (int)varID;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">if</span> (fwrite(&amp;wVarID, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1, outputOffset) != 1) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;DiscField::write - cannot write field number to .offset &quot;</span>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;file&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        fclose(outputOffset);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="comment">// Initialize output file handle ... we might never write anything to</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="comment">// it if the field is completely compressed.</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordtype">int</span> outputDatafd = <a class="code" href="../../d5/dc5/a11756.html#aad797405fccbdf02814a6f2c75df5e55">open_df_file_fd</a>(<a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a05bd58e90fa26c847ef382a8c306196d">getFilename</a>(0), <span class="stringliteral">&quot;.data&quot;</span>,</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                         O_RDWR|O_CREAT);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="comment">// Later we will receive message from other nodes.  This is the</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="comment">// number of blocks we should receive.  We&#39;ll decrease this by</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="comment">// the number of vnodes we already have on this processor, however.</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordtype">int</span> unreceived = <a class="code" href="../../d5/dc5/a11756.html#ade754a87d6e1046f83911824139ad64f">globalID</a>.<a class="code" href="../../d2/d1c/a11968.html#a46039b2af8cb9d9550155bdfa5fa477a">size</a>();</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordtype">int</span> fromothers = unreceived - layout.<a class="code" href="../../d3/d6d/a08204.html#aa936d2daaaaefa91f9783019a2ceacf8">size_iv</a>();</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">// Now we start processing blocks.  We have &#39;unreceived&#39; total to</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="comment">// write, either from ourselves or others.  We first check for</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="comment">// messages, if there are any to receive, get one and process it,</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">// otherwise write out one of our local blocks.</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      local = f.<a class="code" href="../../dd/d54/a08008.html#a762004cbc1ac304271ea609fc8abe501">begin_if</a>();</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">while</span> (unreceived &gt; 0) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="comment">// Keep processing remote blocks until we don&#39;t see one available</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="comment">// or we&#39;ve received them all</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordtype">bool</span> checkremote = (fromothers &gt; 0);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">while</span> (checkremote) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          <span class="comment">// Get a message</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          <span class="keywordtype">int</span> any_node = <a class="code" href="../../d8/d63/a03500.html#a2ecfb905230e85a1a2cadf2c1aa65ced">COMM_ANY_NODE</a>;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          <a class="code" href="../../dc/dd6/a09360.html">Message</a> *msg = <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d7/d31/a08956.html#a59757c3d732e56c61cfdf4710a09a3d6">receive</a>(any_node, tag);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          <span class="comment">// If we found one, process it</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          <span class="keywordflow">if</span> (msg != 0) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="comment">// Extract the domain from the message</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> ro;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            ro.<a class="code" href="../../d4/d8b/a07944.html#a131a7ae47e0fa32176fa8220bf7cc78f">getMessage</a>(*msg);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            </div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <span class="comment">// Extract the data from the message</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> rhs_compressed_data;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            LFI cbi(rhs_compressed_data);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            cbi.getMessage(*msg);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="comment">// Write this data out</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <a class="code" href="../../d5/dc5/a11756.html#a4e3110330cd29caaabf95ec5aa8f6373">write_offset_and_data</a>(outputOffset, outputDatafd, cbi, ro);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="comment">// finish with this message</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <span class="keyword">delete</span> msg;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <span class="comment">// Update counters</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            unreceived -= 1;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            fromothers -= 1;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="comment">// We didn&#39;t see one, so stop checking for now</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            checkremote = <span class="keyword">false</span>;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;          }</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="comment">// Process a local block if any are left</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">if</span> (local != f.<a class="code" href="../../dd/d54/a08008.html#ab436e2eb992a9a87449757517ab60b68">end_if</a>()) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;          <span class="comment">// Cache some information about this local field.</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;          <a class="code" href="../../d3/d4c/a08012.html">LField&lt;T,Dim&gt;</a>&amp; l = *(*local).second.get();</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;          LFI cbi = l.<a class="code" href="../../d3/d4c/a08012.html#ac785783b40bde6497da0587503f1f846">begin</a>();</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;          </div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;          <span class="comment">// Write this data out</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          <a class="code" href="../../d5/dc5/a11756.html#a4e3110330cd29caaabf95ec5aa8f6373">write_offset_and_data</a>(outputOffset, outputDatafd, cbi, l.<a class="code" href="../../d3/d4c/a08012.html#a621e7e0f4520838b2507ab3ad2442318">getOwned</a>());</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;          <span class="comment">// Update counters</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;          ++local;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          unreceived -= 1;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        }</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="comment">// Close the output data file</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">if</span> (outputDatafd &gt;= 0)</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        close(outputDatafd);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      <span class="comment">// Close the output offset file</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      <span class="keywordflow">if</span> (outputOffset != 0)</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        fclose(outputOffset);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <span class="comment">// On other nodes, just send out our LField blocks.</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="keywordflow">for</span> (local = f.<a class="code" href="../../dd/d54/a08008.html#a762004cbc1ac304271ea609fc8abe501">begin_if</a>(); local != f.<a class="code" href="../../dd/d54/a08008.html#ab436e2eb992a9a87449757517ab60b68">end_if</a>(); ++local) {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="comment">// Cache some information about this local field.</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <a class="code" href="../../d3/d4c/a08012.html">LField&lt;T,Dim&gt;</a>&amp; l = *(*local).second.get();</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;ro = l.<a class="code" href="../../d3/d4c/a08012.html#a621e7e0f4520838b2507ab3ad2442318">getOwned</a>();</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        LFI cbi = l.<a class="code" href="../../d3/d4c/a08012.html#ac785783b40bde6497da0587503f1f846">begin</a>();</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="comment">// Create a message to send to box0</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <a class="code" href="../../dc/dd6/a09360.html">Message</a> *msg = <span class="keyword">new</span> <a class="code" href="../../dc/dd6/a09360.html">Message</a>;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="comment">// Put in the domain and data</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        ro.<a class="code" href="../../d4/d8b/a07944.html#a6ebe77298883352ee93598a9e91d98a0">putMessage</a>(*msg);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        cbi.putMessage(*msg, <span class="keyword">false</span>);  <span class="comment">// &#39;false&#39; = avoid copy if possible</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <span class="comment">// Send this message to the box0 node.</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordtype">int</span> node = <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>();</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d7/d31/a08956.html#a5c519594f60faadd9202606f1ba0bbc3">send</a>(msg, node, tag);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    }</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="comment">// indicate we&#39;ve written one more field</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <a class="code" href="../../d5/dc5/a11756.html#a4ea3b74ee81b3aece7736dfa076a29af">ValidField</a>[varID] = <span class="keyword">true</span>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <a class="code" href="../../d5/dc5/a11756.html#ab265d13c12a250189fcc0b36a2466587">NeedStartRecord</a> = (++<a class="code" href="../../d5/dc5/a11756.html#a52347e63bac3e5bcac27ec93c2470866">NumWritten</a> == <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a>);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="comment">// Let everything catch up</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d7/d31/a08956.html#ac4593203c34f26c625bd51c7502c297e">barrier</a>();</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="comment">// if we actually make it down to here, we were successful in writing</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="comment">// version of write that provides default value for varID</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> M, <span class="keyword">class</span> C&gt;</div><div class="line"><a name="l00833"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a8f5184e5a60820643279ca7f40e37013">  833</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a8f5184e5a60820643279ca7f40e37013">write</a>(<a class="code" href="../../d7/dfe/a07936.html">Field&lt;T,Dim,M,C&gt;</a>&amp; f) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#a078b6c2b3efe23b52458033b1ebae389">write</a>(f, 0);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="comment">// console printing methods</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// print out debugging info to the given stream</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/dc5/a11756.html#a979472827d7cff2726c562fdc73ff5e3">printDebug</a>(std::ostream&amp;);</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/dc5/a11756.html#a979472827d7cff2726c562fdc73ff5e3">printDebug</a>();</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">// private typedefs</span></div><div class="line"><a name="l00848"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a73478d531217bd1711a1338dfb928291">  848</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="../../d2/d1c/a11968.html">vmap&lt;NDIndex&lt;Dim&gt;</a>, <span class="keywordtype">int</span>&gt;  <a class="code" href="../../d5/dc5/a11756.html#a73478d531217bd1711a1338dfb928291">GlobalIDList_t</a>;</div><div class="line"><a name="l00849"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">  849</a></span>&#160;  <span class="keyword">typedef</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>  <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a>; </div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="comment">// meta data (static info for the file which does not change)</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="comment">// the configuration file mechanism</span></div><div class="line"><a name="l00856"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">  856</a></span>&#160;  <a class="code" href="../../d2/d0a/a11740.html">DiscConfig</a> *<a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>;</div><div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ac37f34fb25c7a2f49c038d1443ba464f">  857</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#ac37f34fb25c7a2f49c038d1443ba464f">ConfigOK</a>;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="comment">// flag which is true if we&#39;re writing, false if reading</span></div><div class="line"><a name="l00860"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#aef3f6576e6130429308bf880cf6c6de3">  860</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#aef3f6576e6130429308bf880cf6c6de3">WritingFile</a>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="comment">// the base name for the output file, and the descriptive type string</span></div><div class="line"><a name="l00863"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a3c5de0fac13297a30dbf1b7ff3ed9eb8">  863</a></span>&#160;  std::string <a class="code" href="../../d5/dc5/a11756.html#a3c5de0fac13297a30dbf1b7ff3ed9eb8">BaseFile</a>;</div><div class="line"><a name="l00864"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a20ce03294864203a32e24276f1a87432">  864</a></span>&#160;  std::string <a class="code" href="../../d5/dc5/a11756.html#a20ce03294864203a32e24276f1a87432">TypeString</a>;</div><div class="line"><a name="l00865"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a8772c046361c3f67250791c37523dab0">  865</a></span>&#160;  std::string <a class="code" href="../../d5/dc5/a11756.html#a8772c046361c3f67250791c37523dab0">DiscType</a>;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">// dimension of data in file ... this may not match the template dimension.</span></div><div class="line"><a name="l00868"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#aae80a93157189f2fb474673bbb02b20b">  868</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#aae80a93157189f2fb474673bbb02b20b">DataDimension</a>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="comment">// dynamic data (varies as records are written or read)</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="comment">// do we need to start a new record during the next write?  Or, if reading,</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="comment">// which record have we current read into our Size and globalID variables?</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="comment">// If this is &lt; 0, we have not read in any yet.</span></div><div class="line"><a name="l00877"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ab265d13c12a250189fcc0b36a2466587">  877</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#ab265d13c12a250189fcc0b36a2466587">NeedStartRecord</a>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">// the number of fields and records in the file, and the number of Fields</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">// written to the current record</span></div><div class="line"><a name="l00881"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">  881</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a>;</div><div class="line"><a name="l00882"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">  882</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">NumRecords</a>;</div><div class="line"><a name="l00883"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a52347e63bac3e5bcac27ec93c2470866">  883</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a52347e63bac3e5bcac27ec93c2470866">NumWritten</a>;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <span class="comment">// this keeps track of where in the .data file writing is occuring</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="comment">// it is correlated with a given Field and record through the .offset file</span></div><div class="line"><a name="l00887"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a92672d9fd2bf21fbc0f714c6ec049947">  887</a></span>&#160;  <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a> <a class="code" href="../../d5/dc5/a11756.html#a92672d9fd2bf21fbc0f714c6ec049947">CurrentOffset</a>;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="comment">// the global domain of the Fields in this DiscField object</span></div><div class="line"><a name="l00890"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a556bc43d3bda3c1aeac5a1d3516fd174">  890</a></span>&#160;  <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> <a class="code" href="../../d5/dc5/a11756.html#a556bc43d3bda3c1aeac5a1d3516fd174">Size</a>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="comment">// keep track of which Fields have been written to the current record</span></div><div class="line"><a name="l00893"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a4ea3b74ee81b3aece7736dfa076a29af">  893</a></span>&#160;  std::vector&lt;bool&gt; <a class="code" href="../../d5/dc5/a11756.html#a4ea3b74ee81b3aece7736dfa076a29af">ValidField</a>;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="comment">// the running tally of vnodes ON THIS SMP for each record, for each file.</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="comment">// VnodeTally[n] = number of vnodes written out total in prev records.</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="comment">// NOTE: this is not the number of vnodes TOTAL, it is the number of</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="comment">// vnodes on all the processors which are on this same SMP machine.</span></div><div class="line"><a name="l00899"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#aabba5490aff2d910d6910032bb4a2e9c">  899</a></span>&#160;  std::vector&lt;int&gt; *<a class="code" href="../../d5/dc5/a11756.html#aabba5490aff2d910d6910032bb4a2e9c">VnodeTally</a>;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  <span class="comment">// the number of vnodes ON THIS SMP in each record, for each file.</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// NumVnodes[n] = number of vnodes in record n.</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// NOTE: this is not the number of vnodes TOTAL, it is the number of</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">// vnodes on all the processors which are on this same SMP machine.</span></div><div class="line"><a name="l00905"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a4155576007acb2164434a4e43984dac3">  905</a></span>&#160;  std::vector&lt;int&gt; *<a class="code" href="../../d5/dc5/a11756.html#a4155576007acb2164434a4e43984dac3">NumVnodes</a>;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  <span class="comment">// store a mapping from an NDIndex to the physical node it resides on.</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <span class="comment">// These values are stored only for those vnodes on processors which are</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="comment">// on our same SMP.  This must be remade when the layout changes</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="comment">// (e.g., every time we write a record for a Field,</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="comment">// since each Field can have a different layout and each Field&#39;s layout</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="comment">// can change from record to record).</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="comment">// key: local NDIndex, value: node</span></div><div class="line"><a name="l00914"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ade754a87d6e1046f83911824139ad64f">  914</a></span>&#160;  <a class="code" href="../../d2/d1c/a11968.html">GlobalIDList_t</a> <a class="code" href="../../d5/dc5/a11756.html#ade754a87d6e1046f83911824139ad64f">globalID</a>;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">// functions used to build/query information about the processors, etc.</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  <span class="comment">// perform initialization based on the constuctor arguments</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/dc5/a11756.html#a4e1cfaa4a55c1e287905a017f6df6fc0">initialize</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* base, <span class="keyword">const</span> <span class="keywordtype">char</span>* config,</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                  <span class="keyword">const</span> <span class="keywordtype">char</span>* typestr, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numFields);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="comment">// open a file in the given mode.  If an error occurs, print a message (but</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="comment">// only if the last argument is true).</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="comment">// fnm = complete name of file (can include a path)</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="comment">// mode = open method (&quot;r&quot; == read, &quot;rw&quot; == read/write, etc.</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  FILE *<a class="code" href="../../d5/dc5/a11756.html#adea1eab5d37e0559636433d06aca23aa">open_df_file</a>(<span class="keyword">const</span> std::string&amp; fnm, <span class="keyword">const</span> std::string&amp; mode);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  FILE *<a class="code" href="../../d5/dc5/a11756.html#adea1eab5d37e0559636433d06aca23aa">open_df_file</a>(<span class="keyword">const</span> std::string&amp; fnm, <span class="keyword">const</span> std::string&amp; suffix,</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                     <span class="keyword">const</span> std::string&amp; mode);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="comment">// Open a file using direct IO, if possible, otherwise without.  This</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="comment">// returns a file descriptor, not a FILE handle.  If the file was opened</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="comment">// using direct-io, also initialize the dioinfo member data.</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="comment">// The last argument indicates whether to init (create)</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">// the file or just open for general read-write.</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#aad797405fccbdf02814a6f2c75df5e55">open_df_file_fd</a>(<span class="keyword">const</span> std::string&amp; fnm, <span class="keyword">const</span> std::string&amp; suf, <span class="keywordtype">int</span> flags);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="comment">// create the data files used to store Field data.  Return success.</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#af3f1c90d7e9e5ca5c0c488de9be932f6">create_files</a>();</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="comment">// return the total number of SMP&#39;s in the system</span></div><div class="line"><a name="l00943"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a3cc9324c74039190e5cde0cc48a5f0ca">  943</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a3cc9324c74039190e5cde0cc48a5f0ca">numSMPs</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a6d440776c8348853b5464fe36292273e">numSMPs</a>();</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">// return the total number of files which are being read or written</span></div><div class="line"><a name="l00948"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a3f738688be28a85454e0e15d538145df">  948</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a3f738688be28a85454e0e15d538145df">fileSMPs</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a456d1782e486580c3aa621e0099a1779">fileSMPs</a>();</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="comment">// return the index of our SMP</span></div><div class="line"><a name="l00953"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a8172992143ac6f24e23bbfcef8e4162e">  953</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a8172992143ac6f24e23bbfcef8e4162e">mySMP</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#aae53239b53d352ec9d8d9c4198575093">mySMP</a>();</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  }</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="comment">// return the Box0 node for this SMP</span></div><div class="line"><a name="l00958"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">  958</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a38f228dd52b8a7369f80e16a6cd15874">getSMPBox0</a>();</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  }</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="comment">// return the number of files on our SMP (if no arg given) or the</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <span class="comment">// given SMP</span></div><div class="line"><a name="l00964"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#aa200b6d45c51e9ad046784326329fd35">  964</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#aa200b6d45c51e9ad046784326329fd35">numFiles</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#ae9a5164ef7fec7fd70d7d9a83ffe404a">getNumFiles</a>();</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  }</div><div class="line"><a name="l00967"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a504ccdf43d2b8e886f1f662c366bf377">  967</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a504ccdf43d2b8e886f1f662c366bf377">numFiles</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> s)<span class="keyword"> const </span>{</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#ae9a5164ef7fec7fd70d7d9a83ffe404a">getNumFiles</a>(s);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  }</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="comment">// compute how many physical nodes there are on the same SMP as the given</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  <span class="comment">// pnode.</span></div><div class="line"><a name="l00973"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ae43ff35ef506653ef4b0b77341246f0b">  973</a></span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#ae43ff35ef506653ef4b0b77341246f0b">pNodesPerSMP</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node)<span class="keyword"> const </span>{</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#af6510046f0ffbea82dbeb80254c76c27">pNodesPerSMP</a>(node);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  <span class="comment">// parse the IO configuration file and store the information.</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="comment">// arguments = name of config file, and if we&#39;re writing a file (true) or</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">// reading (false)</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#aa5505cfca8a8cb8cbc769661f30a5002">parse_config</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">bool</span>);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="comment">// Compute how many elements we should expect to store into the local</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="comment">// node for the given FieldLayout.  Just loop through the local vnodes</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="comment">// and accumulate the sizes of the owned domains.  This is modified</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="comment">// by the second &quot;read domain&quot; argument, which might be a subset of</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="comment">// the total domain.</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#a1c40653c5efa9da51af75b28bca15d54">compute_expected</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d6d/a08204.html">FieldLayout&lt;Dim&gt;</a> &amp;, <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="comment">// Since the layout can be different every time write</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="comment">// is called, the globalID container needs to be recalculated.  The total</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="comment">// domain of the Field should not change, though, just the layout.  Return</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  <span class="comment">// success.</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a19941b5e5fc5170757a044e15fa276f0">make_globalID</a>(<a class="code" href="../../d3/d6d/a08204.html">FieldLayout&lt;Dim&gt;</a> &amp;);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="comment">// Compute the size of a domain, zero-based, that has a total</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <span class="comment">// size &lt;= chunkelems and has evenly chunked slices.</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> <a class="code" href="../../d5/dc5/a11756.html#a705aefde97387f54f0a7b455827a2f41">chunk_domain</a>(<span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;currblock,</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                            <span class="keywordtype">int</span> chunkelems,</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                            <span class="keywordtype">int</span> &amp;msdim,</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                            <span class="keywordtype">bool</span> iscompressed);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  <span class="comment">// read/write functions for individual components</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// read or write .meta data file information.  Return success.</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#af73bc011b36aa9c69303becca9aebdbf">write_meta</a>();</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#aa22c5d7c450b4550aae6eb5ac31d10b1">read_meta</a>();</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="comment">// read or write NDIndex values for a file.  Return success.</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#ad27401098b7602545ada8a25c905d28f">read_NDIndex</a>(FILE *, <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#aa671623e2e613ad503e0822c5e728232">write_NDIndex</a>(FILE *, <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="comment">// Write .layout data file information.  Return success.</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a14561ec30d59b89d93efe82b316bf869">write_layout</a>();</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="comment">// Read layout info for one file set in the given record.</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d5/dc5/a11756.html#aa2b16267f9c24426e9b164fbf897c638">read_layout</a>(<span class="keywordtype">int</span> record, <span class="keywordtype">int</span> sf);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="comment">// Write out the data in a provided brick iterator with given owned</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  <span class="comment">// domain, updating both the offset file and the data file.  The .offset file</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  <span class="comment">// contains info  on where in the main data file each vnode&#39;s data can be</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="comment">// found.  The .offset file&#39;s structure looks like this:</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  <span class="comment">//   |--Record n----------------------------|</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="comment">//   | Field ID a                           |</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="comment">//   | VNa | VNb | VNc | VNd | .... | VNx   |</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <span class="comment">//   | Field ID b                           |</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="comment">//   | VNa | VNb | VNc | VNd | .... | VNx   |</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="comment">//   | Field ID c                           |</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="comment">//   | VNa | VNb | VNc | VNd | .... | VNx   |</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <span class="comment">//   |--------------------------------------|</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="comment">// where</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="comment">//   VNn is the data for a single Offset struct.  The sets of Offset structs</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  <span class="comment">//   for the Fields can appear in any order in a record, and the Offsets</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="comment">//   structs within a specific Field can also appear in any order.</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><a name="l01039"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a4e3110330cd29caaabf95ec5aa8f6373"> 1039</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/dc5/a11756.html#a4e3110330cd29caaabf95ec5aa8f6373">write_offset_and_data</a>(FILE *outputOffset, <span class="keywordtype">int</span> outputDatafd,</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                             <a class="code" href="../../d9/d37/a07940.html">CompressedBrickIterator&lt;T,Dim&gt;</a> &amp;cbi,</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                             <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;owned) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// Create an offset output file struct, and initialize what we can.</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="comment">// We must take care to first zero out the offset struct.</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a> offset;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    memset(static_cast&lt;void *&gt;(&amp;offset), 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a>));</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <a class="code" href="../../d5/dc5/a11756.html#af8aea9346253c30633a32b9849ea7763">domain_to_offset_data</a>(owned, offset);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    offset.<a class="code" href="../../d7/d74/a11752.html#aba19c2cadc3eb0eaaddcf6d9cdc80546">isCompressed</a> = cbi.<a class="code" href="../../d9/d37/a07940.html#af9e9275cc7aee1d4289b3965dd74b991">IsCompressed</a>();</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    offset.<a class="code" href="../../d7/d74/a11752.html#a45e48747bbee52ba23c4d66b1bb80fb4">offset</a>       = <a class="code" href="../../d5/dc5/a11756.html#a92672d9fd2bf21fbc0f714c6ec049947">CurrentOffset</a>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="comment">// Set the compressed or uncompressed data in the offset struct</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keywordflow">if</span> (offset.<a class="code" href="../../d7/d74/a11752.html#aba19c2cadc3eb0eaaddcf6d9cdc80546">isCompressed</a>) {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <span class="comment">// For compressed data, we just need to write out the entry to the</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <span class="comment">// offset file ... that will contain the single compressed value.</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      offset.<a class="code" href="../../d7/d74/a11752.html#aaecae539de1b3c593610122ff7c42f89">compressedVal</a> = *cbi;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="comment">// This is not compressed, so we must write to the data file.  The</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="comment">// main question now is whether we can use existing buffers, or write</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="comment">// things out in chunks, or what.</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <span class="comment">// First, calculate how many elements to write out at a time.  The</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <span class="comment">// &#39;chunkbytes&#39; might be adjusted to match the maximum amount of data</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      <span class="comment">// that can be written out in a single direct-io call.  This is</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="comment">// true only if we are actually using direct-io, of course.</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <span class="keywordtype">long</span> elems = owned.<a class="code" href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">size</a>();</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keywordtype">long</span> chunkbytes = <a class="code" href="../../d5/d16/a11864.html#a3af4c27c54dc01bea7aece3230ea95cd">Ippl::chunkSize</a>();</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keywordtype">long</span> chunksize = chunkbytes / <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="keywordflow">if</span> (chunksize &lt; 1 || chunksize &gt; elems)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        chunksize = elems;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="comment">// If cbi is iterating over its whole domain, we can just use the block</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="comment">// there as-is to write out data.  So if cbiptr is set to an non-zero</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <span class="comment">// address, we&#39;ll just use that for the data, otherwise we&#39;ll have</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      <span class="comment">// to copy to a buffer.</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> *cbiptr = 0;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      <span class="keywordflow">if</span> (cbi.<a class="code" href="../../d1/d54/a08428.html#a50149305e6d870b07b8c237b79f03000">whole</a>())</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        cbiptr = &amp;(*cbi);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="comment">// Loop through the data, writing out chunks.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      <span class="keywordtype">int</span> needwrite = elems;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="keywordflow">while</span> (needwrite &gt; 0) {</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        <span class="comment">// Find out how many elements we&#39;ll write this time.</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <span class="keywordtype">int</span> amount = chunksize;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <span class="keywordflow">if</span> (amount &gt; needwrite)</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;          amount = needwrite;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="comment">// Find the size of a buffer of at least large enough size.  We</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="comment">// might need a slighly larger buffer if we are using direct-io,</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="comment">// where data must be written out in blocks with sizes that</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="comment">// match the device block size.</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="keywordtype">size_t</span> nbytes = amount*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <span class="comment">// Get a pointer to the next data, or copy more data into a buffer</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="comment">// Initially start with the vnode pointer</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> *buffer = cbiptr;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <span class="comment">// If necessary, make a copy of the data</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="keywordflow">if</span> (buffer == 0) {</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;          buffer = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> *<span class="keyword">&gt;</span>(<a class="code" href="../../d2/d10/a11736.html#ac5a7e89e6600571b0ed4078e242640af">DiscBuffer::resize</a>(nbytes));</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;          <span class="comment">// Copy data into this buffer from the iterator.</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;          <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> *bufptr = buffer;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;          <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a> *bufend = buffer + amount;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;          <span class="keywordflow">for</span> ( ; bufptr != bufend; ++bufptr, ++cbi)</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            <span class="keyword">new</span> (bufptr) <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>(*cbi);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        }</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="comment">// Write the data now</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        off_t seekoffset = <a class="code" href="../../d5/dc5/a11756.html#a92672d9fd2bf21fbc0f714c6ec049947">CurrentOffset</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="keywordtype">bool</span> seekok = <span class="keyword">true</span>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <a class="code" href="../../d0/d4d/a11944.html">Timer</a> wtimer;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        wtimer.<a class="code" href="../../d0/d4d/a11944.html#a6a69c5013bf0718850825e647619f62d">clear</a>();</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        wtimer.<a class="code" href="../../d0/d4d/a11944.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <span class="keywordtype">size_t</span> nout = 0;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <span class="keywordflow">if</span> (::lseek(outputDatafd, seekoffset, SEEK_SET) == seekoffset) {</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;          <span class="keywordtype">char</span> *wbuf = (<span class="keywordtype">char</span> *)buffer;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;          nout = <a class="code" href="../../d5/dc5/a11756.html#a078b6c2b3efe23b52458033b1ebae389">::write</a>(outputDatafd, wbuf, nbytes);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;          seekok = <span class="keyword">false</span>;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        }</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        wtimer.<a class="code" href="../../d0/d4d/a11944.html#a63f0eb44b27402196590a03781515dba">stop</a>();</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <a class="code" href="../../d2/d10/a11736.html#a308b4e9941ce509ec25d387f0e5ba515">DiscBuffer::writetime</a> += wtimer.<a class="code" href="../../d0/d4d/a11944.html#a81590170136304a4cee588088b8e1f8a">clock_time</a>();</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        <a class="code" href="../../d2/d10/a11736.html#a1410d6aaeb813eae7d766368021d5ba0">DiscBuffer::writebytes</a> += nbytes;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <span class="keywordflow">if</span> (!seekok) {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Seek error in DiscField::write_offset_and_data&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Could not seek to position &quot;</span> &lt;&lt; seekoffset &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;          <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="keywordflow">if</span> (nout != nbytes) {</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Write error in DiscField::write_offset_and_data&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Could not write &quot;</span> &lt;&lt; nbytes &lt;&lt; <span class="stringliteral">&quot; bytes.&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;          <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        }</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <span class="comment">// Update pointers and counts</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        needwrite -= amount;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keywordflow">if</span> (cbiptr != 0)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;          cbiptr += amount;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="comment">// update the offset and stats</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <a class="code" href="../../d5/dc5/a11756.html#a92672d9fd2bf21fbc0f714c6ec049947">CurrentOffset</a> += (nbytes / <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>));</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    }</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="comment">// write to offset file now</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">if</span> (fwrite(&amp;offset, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a>), 1, outputOffset) != 1) {</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Write error in DiscField::write_offset_and_data&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    }</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">// seek to the beginning of the vnode data for field &#39;varID&#39; in record</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="comment">// &#39;record&#39;, for file &#39;sf&#39;.  If not found, close the file and return false.</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="comment">// If it is found, read in all the offset records, and return them</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  <span class="comment">// in the provided vector.</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div><div class="line"><a name="l01166"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a0266a4f1bd61f1b84eb39fc2525c9862"> 1166</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#a0266a4f1bd61f1b84eb39fc2525c9862">read_offset</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> varID,</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> record,</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sf,</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                   std::vector&lt;<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a> &gt; &amp;offdata,</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                   <span class="keywordtype">int</span> vnodes) {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="comment">// Open the offset file</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    FILE *outputOffset = <a class="code" href="../../d5/dc5/a11756.html#adea1eab5d37e0559636433d06aca23aa">open_df_file</a>(<a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a05bd58e90fa26c847ef382a8c306196d">getFilename</a>(sf),</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                                      <span class="stringliteral">&quot;.offset&quot;</span>, std::string(<span class="stringliteral">&quot;r&quot;</span>));</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">// seek to the start of this record</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a> seekpos = <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a> * (record * <span class="keyword">sizeof</span>(int) +</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                                    <a class="code" href="../../d5/dc5/a11756.html#aabba5490aff2d910d6910032bb4a2e9c">VnodeTally</a>[sf][record] *</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                                    <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a>));</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">if</span> (fseek(outputOffset, seekpos, SEEK_SET) != 0) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Error seeking to position &quot;</span> &lt;&lt; static_cast&lt;long&gt;(seekpos));</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot; in .offset file &quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      fclose(outputOffset);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    }</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="comment">// now keep looking at the Field ID in this record until we find the one</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="comment">// we want</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> checked = 0;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordflow">while</span> (checked &lt; <a class="code" href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">NumFields</a>) {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <span class="comment">// read the next field ID number</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="keywordtype">int</span> rVarID;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="keywordflow">if</span> (fread(&amp;rVarID, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1, outputOffset) != 1) {</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Error reading field ID from .offset file&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        fclose(outputOffset);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      }</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="comment">// is it what we want?</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) rVarID == varID) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <span class="comment">// Yes it is, so read in the offset record data.  First resize</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <span class="comment">// the offset data vector.</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        offdata.resize(vnodes);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="keywordtype">size_t</span> result = fread(&amp;(offdata[0]), <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a>),</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                              offdata.size(), outputOffset);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        <span class="keywordflow">if</span> (result != offdata.size()) {</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Read error in DiscField::find_file_in_offset&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Results is &quot;</span> &lt;&lt; result &lt;&lt; <span class="stringliteral">&quot;, should be &quot;</span>);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(offdata.size() &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;          <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;outputOffset is &quot;</span> &lt;&lt; (<span class="keywordtype">void</span> *)outputOffset &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;          <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;          fclose(outputOffset);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        }</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="comment">// And return success.</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        fclose(outputOffset);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <span class="comment">// it was not, so move on to the next one</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      checked++;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      seekpos += (<a class="code" href="../../d5/dc5/a11756.html#a4155576007acb2164434a4e43984dac3">NumVnodes</a>[sf][record] * <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a>) +</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                  <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      <span class="keywordflow">if</span> (fseek(outputOffset, seekpos, SEEK_SET) != 0) {</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Error seeking to position &quot;</span> &lt;&lt; static_cast&lt;long&gt;(seekpos));</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot; in .offset file &quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        fclose(outputOffset);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      }</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="comment">// if we&#39;re here, we did not find the Field ID anywhere in the .offset file</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Could not find data for field &quot;</span> &lt;&lt; varID &lt;&lt; <span class="stringliteral">&quot; of record &quot;</span>);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(record &lt;&lt; <span class="stringliteral">&quot; in .offset file.&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    fclose(outputOffset);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;  }</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="comment">// On all nodes, either send out or receive in offset information.</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="comment">// Some nodes will not get any, and will not have to do any reading.</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;  <span class="comment">// But those that do, will read in data for the vnodes they are</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="comment">// assigned.  &#39;vnodes&#39; will be set to the number of vnodes assigned</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="comment">// for reading from this node, and  &#39;maxsize&#39; will be set</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="comment">// to the maximum size of the vnodes in this file, for use in</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;  <span class="comment">// preparing the buffer that will be used to read those vnodes.</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div><div class="line"><a name="l01253"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ad4466e6c26a44ea458fd2a9ad1601d57"> 1253</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/dc5/a11756.html#ad4466e6c26a44ea458fd2a9ad1601d57">distribute_offsets</a>(std::vector&lt;<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a> &gt; &amp;offdata,</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                          <span class="keywordtype">int</span> &amp;vnodes, <span class="keywordtype">int</span> &amp;maxsize,</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                          <span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;readDomain) {</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="comment">// Initialize the vnode and maxsize values.</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    vnodes = 0;</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    maxsize = 0;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="comment">// If parallel reads are turned off, just box0 nodes will read</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d16/a11864.html#a3a6b4cb706505026d436313690f6222c">Ippl::perSMPParallelIO</a>()) {</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>() == <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>())</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        vnodes = offdata.size();</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <span class="comment">// Generate the tag to use</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="keywordtype">int</span> tag = <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d1/d51/a09544.html#aec355d9c01194461adbba236ffbd7b21">next_tag</a>(<a class="code" href="../../dd/d25/a03545.html#a96d35d3e7dedbed301a4cf69be060d07">DF_OFFSET_TAG</a>, <a class="code" href="../../dd/d25/a03545.html#a913eb02f7935f8df3324d5fce5934a8c">DF_TAG_CYCLE</a>);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      <span class="comment">// Nodes that do not have their box0 process on the same SMP should</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="comment">// not receive anything</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a0a7cd22059b52b4603c948441f4c85cd">getNodeSMPIndex</a>(<a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>()) != <a class="code" href="../../d5/dc5/a11756.html#a8172992143ac6f24e23bbfcef8e4162e">mySMP</a>()) {</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      }</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      <span class="comment">// All box0 nodes will (possibly) send out offset data.  Others will</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      <span class="comment">// receive it, even if it just says &quot;you don&#39;t get any vnodes.&quot;</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>() == <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>()) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="comment">// How many offset blocks per processor</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="keywordtype">int</span> pernode = offdata.size() / <a class="code" href="../../d5/dc5/a11756.html#ae43ff35ef506653ef4b0b77341246f0b">pNodesPerSMP</a>(<a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>());</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="comment">// Extra vnodes we might have to give to others</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <span class="keywordtype">int</span> extra = offdata.size() % <a class="code" href="../../d5/dc5/a11756.html#ae43ff35ef506653ef4b0b77341246f0b">pNodesPerSMP</a>(<a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>());</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        <span class="comment">// The next vnode to assign; box0 will always get an extra one if</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <span class="comment">// necessary.</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <span class="keywordtype">int</span> nextvnode = pernode;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="keywordflow">if</span> (extra &gt; 0) {</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;          nextvnode += 1;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;          extra -= 1;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        }</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="comment">// box0 nodes get the first &#39;nextvnode&#39; vnodes.</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        vnodes = nextvnode;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        <span class="comment">// Loop through the nodes on this vnode; nodes other than box0 will</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="comment">// get sent a message.</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/d21/a04401.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a>=0; <a class="code" href="../../d6/d21/a04401.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a> &lt; <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a7dca42bd389ca5558b8414de59d00400">getNumSMPNodes</a>(); ++<a class="code" href="../../d6/d21/a04401.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a>) {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;          <span class="keywordtype">int</span> node = <a class="code" href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">Config</a>-&gt;<a class="code" href="../../d2/d0a/a11740.html#a71f3137cc74f994f101b411c7df77d40">getSMPNode</a>(<a class="code" href="../../d5/dc5/a11756.html#a8172992143ac6f24e23bbfcef8e4162e">mySMP</a>(), <a class="code" href="../../d6/d21/a04401.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a>);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          <span class="keywordflow">if</span> (node != <a class="code" href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">Ippl::myNode</a>()) {</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <span class="comment">// How many vnodes to assign?</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keywordtype">int</span> numvnodes = pernode;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            <span class="keywordflow">if</span> (extra &gt; 0) {</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;              numvnodes += 1;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;              extra -= 1;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            }</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            <span class="comment">// Create a message for this other node, storing:</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <span class="comment">//   - number of vnodes (int)</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            <span class="comment">//   - list of vnode offset structs (list)</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            <a class="code" href="../../dc/dd6/a09360.html">Message</a> *msg = <span class="keyword">new</span> <a class="code" href="../../dc/dd6/a09360.html">Message</a>;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            msg-&gt;<a class="code" href="../../dc/dd6/a09360.html#a3fc943d7af8a5f88178faeab977802c0">put</a>(numvnodes);</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            <span class="keywordflow">if</span> (numvnodes &gt; 0) {</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;              msg-&gt;<a class="code" href="../../dc/dd6/a09360.html#adc2879b32cc3bc025e931e6219d0582e">setCopy</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;              msg-&gt;<a class="code" href="../../dc/dd6/a09360.html#a22e02c53be8f84943784624cd35b8414">setDelete</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;              msg-&gt;<a class="code" href="../../dc/dd6/a09360.html#a4586e2ea141a20fe0c65cff03e54638e">putmsg</a>(static_cast&lt;void *&gt;(&amp;(offdata[nextvnode])),</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                          <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a>),</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                          numvnodes);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            }</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            <span class="comment">// Send this message to the other node</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d7/d31/a08956.html#a5c519594f60faadd9202606f1ba0bbc3">send</a>(msg, node, tag);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <span class="comment">// Update what the next vnode info to send is</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            nextvnode += numvnodes;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;          }</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        }</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <span class="comment">// At the end, we should have no vnodes left to send</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) nextvnode != offdata.size())</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;          <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;ERROR: Could not give away all my vnodes!&quot;</span>);</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="comment">// On non-box0 nodes, receive offset info</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        <span class="keywordtype">int</span> node = <a class="code" href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">myBox0</a>();</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <a class="code" href="../../dc/dd6/a09360.html">Message</a> *msg = <a class="code" href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d7/d31/a08956.html#ac0e671485db61cd6fdf8961504250b2b">receive_block</a>(node, tag);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="comment">// Get the number of vnodes to store here</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        msg-&gt;<a class="code" href="../../dc/dd6/a09360.html#aeb7c0c5d1f49f8fd1b78eae709216da9">get</a>(vnodes);</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        <span class="comment">// If this is &gt; 0, copy out vnode info</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        <span class="keywordflow">if</span> (vnodes &gt; 0) {</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;          <span class="comment">// resize the vector to make some storage</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;          offdata.resize(vnodes);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;          <span class="comment">// get offset data from the message</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;          <a class="code" href="../../dc/d98/a03524.html#aa611d67b8eebe08e9e82e9b72521cb20">::getMessage_iter</a>(*msg, &amp;(offdata[0]));</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        }</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="comment">// Done with the message now.</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="keyword">delete</span> msg;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      }</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    }</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="comment">// Now, finally, on all nodes we scan the vnodes to find out the maximum</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="comment">// size of the buffer needed to read this data in.</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> v=0; v &lt; vnodes; ++v) {</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      <span class="comment">// Convert data to NDIndex</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> dom;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <a class="code" href="../../d5/dc5/a11756.html#a3909c5fc495836702913f727e986ddac">offset_data_to_domain</a>(offdata[v], dom);</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="keywordflow">if</span> (dom.<a class="code" href="../../d4/d8b/a07944.html#a2917bb719ec865512e42401b55284d7d">touches</a>(readDomain)) {</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        <span class="comment">// Compute chunk block size</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="keywordtype">int</span> msdim = (<a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a>-1);    <span class="comment">// this will be zero-based</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="keywordtype">int</span> chunkelems = <a class="code" href="../../d5/d16/a11864.html#a3af4c27c54dc01bea7aece3230ea95cd">Ippl::chunkSize</a>() / <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> chunkblock = <a class="code" href="../../d5/dc5/a11756.html#a705aefde97387f54f0a7b455827a2f41">chunk_domain</a>(dom, chunkelems, msdim,</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                                               offdata[v].isCompressed);</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="comment">// Now compare the size</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="keywordtype">int</span> dsize = chunkblock.<a class="code" href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">size</a>();</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <span class="keywordflow">if</span> (dsize &gt; maxsize) {</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;          maxsize = dsize;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        }</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      }</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    }</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  }</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="comment">// read the data for a block of values of type T from the given data file.</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <span class="comment">// Return success of read.</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="comment">// The size and seekpos values are in bytes.</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div><div class="line"><a name="l01383"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#ab44d74480220b446935be44e94eb2d70"> 1383</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="../../d5/dc5/a11756.html#ab44d74480220b446935be44e94eb2d70">read_data</a>(<span class="keywordtype">int</span> outputDatafd, <a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>* buffer, <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a> readsize,</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                 <a class="code" href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">Offset_t</a> seekpos) {</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <a class="code" href="../../db/d06/a03866.html#a8c59f50b59309423544d0c48c99db3fa">PAssert_GE</a>(seekpos, 0);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    <a class="code" href="../../db/d06/a03866.html#ad843cda1683d6b4bdf7a6412ab31386c">PAssert_GT</a>(readsize, 0);</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <a class="code" href="../../db/d06/a03866.html#a718e6f44fb7a5898928459b897eee6e4">PAssert</a>(buffer);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <a class="code" href="../../db/d06/a03866.html#a8c59f50b59309423544d0c48c99db3fa">PAssert_GE</a>(outputDatafd, 0);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <a class="code" href="../../db/d06/a03866.html#a373787183a57da0c3bea1eaa0b936e89">PAssert_EQ</a>(readsize % <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">T</a>), 0);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="comment">// Now read the block of data</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    off_t seekoffset = seekpos;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordtype">size_t</span> nbytes = readsize;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keywordtype">bool</span> seekok = <span class="keyword">true</span>;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <a class="code" href="../../d0/d4d/a11944.html">Timer</a> rtimer;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    rtimer.<a class="code" href="../../d0/d4d/a11944.html#a6a69c5013bf0718850825e647619f62d">clear</a>();</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    rtimer.<a class="code" href="../../d0/d4d/a11944.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordtype">size_t</span> nout = 0;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordflow">if</span> (::lseek(outputDatafd, seekoffset, SEEK_SET) == seekoffset) {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      <span class="keywordtype">char</span> *rbuf = (<span class="keywordtype">char</span> *)buffer;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      nout = <a class="code" href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">::read</a>(outputDatafd, rbuf, nbytes);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      seekok = <span class="keyword">false</span>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    }</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    rtimer.<a class="code" href="../../d0/d4d/a11944.html#a63f0eb44b27402196590a03781515dba">stop</a>();</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <a class="code" href="../../d2/d10/a11736.html#abf4f563aa16366ac23eed652a8a8a67d">DiscBuffer::readtime</a> += rtimer.<a class="code" href="../../d0/d4d/a11944.html#a81590170136304a4cee588088b8e1f8a">clock_time</a>();</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    <a class="code" href="../../d2/d10/a11736.html#a882bc6b9c08d1888e6a6212a351fc2f1">DiscBuffer::readbytes</a> += readsize;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keywordflow">if</span> (!seekok) {</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Seek error in DiscField::read_data&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Could not seek to position &quot;</span> &lt;&lt; seekoffset &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    }</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="keywordflow">if</span> (nout != nbytes) {</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Read error in DiscField::read_data&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      <a class="code" href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Could not read &quot;</span> &lt;&lt; nbytes &lt;&lt; <span class="stringliteral">&quot; bytes.&quot;</span> &lt;&lt; <a class="code" href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <a class="code" href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">Ippl::abort</a>(<span class="stringliteral">&quot;Exiting due to DiscField error.&quot;</span>);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    }</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;  }</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="comment">// Convert data in an offset data struct to an NDIndex, and return it</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="comment">// in the second argument.</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><a name="l01432"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#a3909c5fc495836702913f727e986ddac"> 1432</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/dc5/a11756.html#a3909c5fc495836702913f727e986ddac">offset_data_to_domain</a>(<a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a> &amp;offdata,</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                             <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;domain) {</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordtype">int</span> *dptr = offdata.<a class="code" href="../../d7/d74/a11752.html#aae8a75db07a205304616ef5384a02bb1">vnodedata</a> + 1;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a>; ++i) {</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      <span class="keywordtype">int</span> first = *dptr;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      <span class="keywordtype">int</span> stride = *(dptr + 1);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="keywordtype">int</span> length = *(dptr + 2);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      domain[i] = <a class="code" href="../../d1/d28/a08524.html">Index</a>(first, first + (length - 1)*stride, stride);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      dptr += 6;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    }</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  <span class="comment">// Convert domain data to offset I/O struct data</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div><div class="line"><a name="l01447"></a><span class="lineno"><a class="line" href="../../d5/dc5/a11756.html#af8aea9346253c30633a32b9849ea7763"> 1447</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="../../d5/dc5/a11756.html#af8aea9346253c30633a32b9849ea7763">domain_to_offset_data</a>(<span class="keyword">const</span> <a class="code" href="../../d4/d8b/a07944.html">NDIndex&lt;Dim&gt;</a> &amp;domain,</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                             <a class="code" href="../../d7/d74/a11752.html">DFOffsetData&lt;Dim,T&gt;</a> &amp;offdata) {</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordtype">int</span> *dptr = offdata.<a class="code" href="../../d7/d74/a11752.html#aae8a75db07a205304616ef5384a02bb1">vnodedata</a>;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a>; ++i) {</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      *dptr++ = 0;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      *dptr++ = domain[i].first();</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      *dptr++ = domain[i].stride();</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      *dptr++ = domain[i].length();</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      *dptr++ = 0;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      *dptr++ = 0;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  }</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  <span class="comment">// don&#39;t allow copy or assign ... these are declared but never defined,</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;  <span class="comment">// if something tries to use them it will generate a missing symbol error</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  <a class="code" href="../../d5/dc5/a11756.html#a293d5f15ec0c13a523a62e142c05dac9">DiscField</a>(<span class="keyword">const</span> <a class="code" href="../../d5/dc5/a11756.html">DiscField&lt;Dim&gt;</a>&amp;);</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  <a class="code" href="../../d5/dc5/a11756.html">DiscField</a>&amp; <a class="code" href="../../d5/dc5/a11756.html#aeabe0fe0a441811ba27e4b2fc238a003">operator=</a>(<span class="keyword">const</span> <a class="code" href="../../d5/dc5/a11756.html">DiscField&lt;Dim&gt;</a>&amp;);</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;};</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d85/a03758.html">Utility/DiscField.hpp</a>&quot;</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="preprocessor">#endif // DISC_FIELD_H</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment"> * $RCSfile: DiscField.h,v $   $Author: adelmann $</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment"> * $Revision: 1.1.1.1 $   $Date: 2003/01/23 07:40:33 $</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment"> * IPPL_VERSION_ID: $Id: DiscField.h,v 1.1.1.1 2003/01/23 07:40:33 adelmann Exp $ </span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="ttc" id="a11756_html_a8f5184e5a60820643279ca7f40e37013"><div class="ttname"><a href="../../d5/dc5/a11756.html#a8f5184e5a60820643279ca7f40e37013">DiscField::write</a></div><div class="ttdeci">bool write(Field&lt; T, Dim, M, C &gt; &amp;f)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00833">DiscField.h:833</a></div></div>
<div class="ttc" id="a08956_html_a5c519594f60faadd9202606f1ba0bbc3"><div class="ttname"><a href="../../d7/d31/a08956.html#a5c519594f60faadd9202606f1ba0bbc3">Communicate::send</a></div><div class="ttdeci">bool send(Message *, int node, int tag, bool delmsg=true)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d8f/a03497_source.html#l00181">Communicate.cpp:181</a></div></div>
<div class="ttc" id="a08012_html_ac8d1d4505ca5562f4feee551089c1276"><div class="ttname"><a href="../../d3/d4c/a08012.html#ac8d1d4505ca5562f4feee551089c1276">LField::Uncompress</a></div><div class="ttdeci">void Uncompress(bool fill_domain=true)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d06/a03368_source.html#l00172">LField.h:172</a></div></div>
<div class="ttc" id="a11896_html_a8b229ce711198a6e0e190e7d9098c3eb"><div class="ttname"><a href="../../d0/d38/a11896.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a></div><div class="ttdeci">static void stopTimer(TimerRef t)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d51/a03842_source.html#l00192">IpplTimings.h:192</a></div></div>
<div class="ttc" id="a11756_html_a50a8f522d9e3d968247e24ff1bd9718c"><div class="ttname"><a href="../../d5/dc5/a11756.html#a50a8f522d9e3d968247e24ff1bd9718c">DiscField::read</a></div><div class="ttdeci">bool read(Field&lt; T, Dim, M, C &gt; &amp;f, const NDIndex&lt; Dim &gt; &amp;readDomain, unsigned int varID)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00577">DiscField.h:577</a></div></div>
<div class="ttc" id="a11756_html_a3c99d824517ecd5b62e74933039d3ed0"><div class="ttname"><a href="../../d5/dc5/a11756.html#a3c99d824517ecd5b62e74933039d3ed0">DiscField::get_NumRecords</a></div><div class="ttdeci">unsigned int get_NumRecords() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00095">DiscField.h:95</a></div></div>
<div class="ttc" id="a03866_html_a718e6f44fb7a5898928459b897eee6e4"><div class="ttname"><a href="../../db/d06/a03866.html#a718e6f44fb7a5898928459b897eee6e4">PAssert</a></div><div class="ttdeci">#define PAssert(c)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d06/a03866_source.html#l00102">PAssert.h:102</a></div></div>
<div class="ttc" id="a11756_html_af73bc011b36aa9c69303becca9aebdbf"><div class="ttname"><a href="../../d5/dc5/a11756.html#af73bc011b36aa9c69303becca9aebdbf">DiscField::write_meta</a></div><div class="ttdeci">bool write_meta()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00447">DiscField.hpp:447</a></div></div>
<div class="ttc" id="a11740_html_a38f228dd52b8a7369f80e16a6cd15874"><div class="ttname"><a href="../../d2/d0a/a11740.html#a38f228dd52b8a7369f80e16a6cd15874">DiscConfig::getSMPBox0</a></div><div class="ttdeci">unsigned int getSMPBox0() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00113">DiscConfig.h:113</a></div></div>
<div class="ttc" id="a08428_html_a50149305e6d870b07b8c237b79f03000"><div class="ttname"><a href="../../d1/d54/a08428.html#a50149305e6d870b07b8c237b79f03000">BrickIterator::whole</a></div><div class="ttdeci">bool whole() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d5d/a03329_source.html#l00076">BrickIterator.h:76</a></div></div>
<div class="ttc" id="a11864_html_aebc2813151a7229c571dc6e272d9feb6"><div class="ttname"><a href="../../d5/d16/a11864.html#aebc2813151a7229c571dc6e272d9feb6">IpplInfo::myNode</a></div><div class="ttdeci">static int myNode()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dab/a03815_source.html#l00691">IpplInfo.cpp:691</a></div></div>
<div class="ttc" id="a07944_html_a39248b9764246ad6635862dd52cf7ea8"><div class="ttname"><a href="../../d4/d8b/a07944.html#a39248b9764246ad6635862dd52cf7ea8">NDIndex::contains</a></div><div class="ttdeci">bool contains(const NDIndex&lt; Dim &gt; &amp;a) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6b/a03428_source.html#l00092">NDIndexInlines.h:92</a></div></div>
<div class="ttc" id="a07944_html_ad175b56cd8ec95f78a201cac4feb8931"><div class="ttname"><a href="../../d4/d8b/a07944.html#ad175b56cd8ec95f78a201cac4feb8931">NDIndex::intersect</a></div><div class="ttdeci">NDIndex&lt; Dim &gt; intersect(const NDIndex&lt; Dim &gt; &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6b/a03428_source.html#l00031">NDIndexInlines.h:31</a></div></div>
<div class="ttc" id="a09544_html_aec355d9c01194461adbba236ffbd7b21"><div class="ttname"><a href="../../d1/d51/a09544.html#aec355d9c01194461adbba236ffbd7b21">TagMaker::next_tag</a></div><div class="ttdeci">int next_tag(int t, int s=1000)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d5e/a03542_source.html#l00039">TagMaker.h:39</a></div></div>
<div class="ttc" id="a11740_html_a71f3137cc74f994f101b411c7df77d40"><div class="ttname"><a href="../../d2/d0a/a11740.html#a71f3137cc74f994f101b411c7df77d40">DiscConfig::getSMPNode</a></div><div class="ttdeci">unsigned int getSMPNode(unsigned int n) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00107">DiscConfig.h:107</a></div></div>
<div class="ttc" id="a11968_html_a46039b2af8cb9d9550155bdfa5fa477a"><div class="ttname"><a href="../../d2/d1c/a11968.html#a46039b2af8cb9d9550155bdfa5fa477a">vmap::size</a></div><div class="ttdeci">size_type size() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/a03917_source.html#l00120">vmap.h:120</a></div></div>
<div class="ttc" id="a11756_html_a694b8f7ee918239eada8f4514b5a81a6"><div class="ttname"><a href="../../d5/dc5/a11756.html#a694b8f7ee918239eada8f4514b5a81a6">DiscField::read</a></div><div class="ttdeci">bool read(Field&lt; T, Dim, M, C &gt; &amp;f, unsigned int varID)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00583">DiscField.h:583</a></div></div>
<div class="ttc" id="a11756_html_a3c5de0fac13297a30dbf1b7ff3ed9eb8"><div class="ttname"><a href="../../d5/dc5/a11756.html#a3c5de0fac13297a30dbf1b7ff3ed9eb8">DiscField::BaseFile</a></div><div class="ttdeci">std::string BaseFile</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00863">DiscField.h:863</a></div></div>
<div class="ttc" id="a03866_html_ad843cda1683d6b4bdf7a6412ab31386c"><div class="ttname"><a href="../../db/d06/a03866.html#ad843cda1683d6b4bdf7a6412ab31386c">PAssert_GT</a></div><div class="ttdeci">#define PAssert_GT(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d06/a03866_source.html#l00108">PAssert.h:108</a></div></div>
<div class="ttc" id="a03866_html_a8c59f50b59309423544d0c48c99db3fa"><div class="ttname"><a href="../../db/d06/a03866.html#a8c59f50b59309423544d0c48c99db3fa">PAssert_GE</a></div><div class="ttdeci">#define PAssert_GE(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d06/a03866_source.html#l00109">PAssert.h:109</a></div></div>
<div class="ttc" id="a11740_html_a7dca42bd389ca5558b8414de59d00400"><div class="ttname"><a href="../../d2/d0a/a11740.html#a7dca42bd389ca5558b8414de59d00400">DiscConfig::getNumSMPNodes</a></div><div class="ttdeci">unsigned int getNumSMPNodes() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00101">DiscConfig.h:101</a></div></div>
<div class="ttc" id="a11756_html_a2739cf360c21621d18ff8563590562ad"><div class="ttname"><a href="../../d5/dc5/a11756.html#a2739cf360c21621d18ff8563590562ad">DiscField::myBox0</a></div><div class="ttdeci">unsigned int myBox0() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00958">DiscField.h:958</a></div></div>
<div class="ttc" id="a11756_html_a4e1cfaa4a55c1e287905a017f6df6fc0"><div class="ttname"><a href="../../d5/dc5/a11756.html#a4e1cfaa4a55c1e287905a017f6df6fc0">DiscField::initialize</a></div><div class="ttdeci">void initialize(const char *base, const char *config, const char *typestr, unsigned int numFields)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00096">DiscField.hpp:96</a></div></div>
<div class="ttc" id="a11756_html_ad4466e6c26a44ea458fd2a9ad1601d57"><div class="ttname"><a href="../../d5/dc5/a11756.html#ad4466e6c26a44ea458fd2a9ad1601d57">DiscField::distribute_offsets</a></div><div class="ttdeci">void distribute_offsets(std::vector&lt; DFOffsetData&lt; Dim, T &gt; &gt; &amp;offdata, int &amp;vnodes, int &amp;maxsize, const NDIndex&lt; Dim &gt; &amp;readDomain)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l01253">DiscField.h:1253</a></div></div>
<div class="ttc" id="a08008_html_a89416ffa0503a40311538a1fcd4dab92"><div class="ttname"><a href="../../dd/d54/a08008.html#a89416ffa0503a40311538a1fcd4dab92">BareField::Compress</a></div><div class="ttdeci">void Compress() const</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d19/a03311_source.html#l00991">BareField.hpp:991</a></div></div>
<div class="ttc" id="a11756_html_ab9c78dd0b5067713587b6ebeac5f6547"><div class="ttname"><a href="../../d5/dc5/a11756.html#ab9c78dd0b5067713587b6ebeac5f6547">DiscField::Config</a></div><div class="ttdeci">DiscConfig * Config</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00856">DiscField.h:856</a></div></div>
<div class="ttc" id="a11756_html_a3f738688be28a85454e0e15d538145df"><div class="ttname"><a href="../../d5/dc5/a11756.html#a3f738688be28a85454e0e15d538145df">DiscField::fileSMPs</a></div><div class="ttdeci">unsigned int fileSMPs() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00948">DiscField.h:948</a></div></div>
<div class="ttc" id="a03545_html_a14ad11ad74c33d5001e5831101105ba6"><div class="ttname"><a href="../../dd/d25/a03545.html#a14ad11ad74c33d5001e5831101105ba6">DF_READ_TAG</a></div><div class="ttdeci">#define DF_READ_TAG</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d25/a03545_source.html#l00071">Tags.h:71</a></div></div>
<div class="ttc" id="a11756_html_a72a15149d7b9c0dd23bb204728e99547"><div class="ttname"><a href="../../d5/dc5/a11756.html#a72a15149d7b9c0dd23bb204728e99547">DiscField::NumFields</a></div><div class="ttdeci">unsigned int NumFields</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00881">DiscField.h:881</a></div></div>
<div class="ttc" id="a11756_html_af7559c32c127e0ad60a14f2d28c12262"><div class="ttname"><a href="../../d5/dc5/a11756.html#af7559c32c127e0ad60a14f2d28c12262">DiscField::get_NumFields</a></div><div class="ttdeci">unsigned int get_NumFields() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00098">DiscField.h:98</a></div></div>
<div class="ttc" id="a11752_html_aae8a75db07a205304616ef5384a02bb1"><div class="ttname"><a href="../../d7/d74/a11752.html#aae8a75db07a205304616ef5384a02bb1">DFOffsetData::vnodedata</a></div><div class="ttdeci">int vnodedata[6 *Dim]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00041">DiscField.h:41</a></div></div>
<div class="ttc" id="a11756_html_a73478d531217bd1711a1338dfb928291"><div class="ttname"><a href="../../d5/dc5/a11756.html#a73478d531217bd1711a1338dfb928291">DiscField::GlobalIDList_t</a></div><div class="ttdeci">vmap&lt; NDIndex&lt; Dim &gt;, int &gt; GlobalIDList_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00848">DiscField.h:848</a></div></div>
<div class="ttc" id="a11756_html_a4ea3b74ee81b3aece7736dfa076a29af"><div class="ttname"><a href="../../d5/dc5/a11756.html#a4ea3b74ee81b3aece7736dfa076a29af">DiscField::ValidField</a></div><div class="ttdeci">std::vector&lt; bool &gt; ValidField</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00893">DiscField.h:893</a></div></div>
<div class="ttc" id="a02852_html_ae7900f28c4b26ff2fd5cfdf3a55e02ae"><div class="ttname"><a href="../../da/de8/a02852.html#ae7900f28c4b26ff2fd5cfdf3a55e02ae">Dim</a></div><div class="ttdeci">const unsigned Dim</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de8/a02852_source.html#l00025">P3MPoissonSolver.h:25</a></div></div>
<div class="ttc" id="a11756_html_aa58595abad4cb3c996fb5fb04d2214e5"><div class="ttname"><a href="../../d5/dc5/a11756.html#aa58595abad4cb3c996fb5fb04d2214e5">DiscField::get_Domain</a></div><div class="ttdeci">NDIndex&lt; Dim &gt; get_Domain() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00101">DiscField.h:101</a></div></div>
<div class="ttc" id="a11740_html_ae9a5164ef7fec7fd70d7d9a83ffe404a"><div class="ttname"><a href="../../d2/d0a/a11740.html#ae9a5164ef7fec7fd70d7d9a83ffe404a">DiscConfig::getNumFiles</a></div><div class="ttdeci">unsigned int getNumFiles() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00119">DiscConfig.h:119</a></div></div>
<div class="ttc" id="a03842_html"><div class="ttname"><a href="../../dd/d51/a03842.html">IpplTimings.h</a></div></div>
<div class="ttc" id="a08204_html_a1441fa1f8ea7a62aba2abc47ff8065bd"><div class="ttname"><a href="../../d3/d6d/a08204.html#a1441fa1f8ea7a62aba2abc47ff8065bd">FieldLayout::touch_range_rdv</a></div><div class="ttdeci">touch_range_dv touch_range_rdv(const NDIndex&lt; Dim &gt; &amp;domain, const GuardCellSizes&lt; Dim &gt; &amp;gc=gc0()) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d21/a03392_source.html#l00780">FieldLayout.h:780</a></div></div>
<div class="ttc" id="a03803_html"><div class="ttname"><a href="../../da/d1a/a03803.html">Inform.h</a></div></div>
<div class="ttc" id="a08008_html_a1429ce5f39542b388dab4aefa7f19062"><div class="ttname"><a href="../../dd/d54/a08008.html#a1429ce5f39542b388dab4aefa7f19062">BareField::setDirtyFlag</a></div><div class="ttdeci">void setDirtyFlag()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de4/a03308_source.html#l00117">BareField.h:117</a></div></div>
<div class="ttc" id="a11756_html_a0bbc6596c0c035430cecf64ed00a5e3d"><div class="ttname"><a href="../../d5/dc5/a11756.html#a0bbc6596c0c035430cecf64ed00a5e3d">DiscField::read</a></div><div class="ttdeci">bool read(Field&lt; T, Dim, M, C &gt; &amp;f, unsigned int varID, unsigned int record)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00572">DiscField.h:572</a></div></div>
<div class="ttc" id="a11756_html_a556bc43d3bda3c1aeac5a1d3516fd174"><div class="ttname"><a href="../../d5/dc5/a11756.html#a556bc43d3bda3c1aeac5a1d3516fd174">DiscField::Size</a></div><div class="ttdeci">NDIndex&lt; Dim &gt; Size</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00890">DiscField.h:890</a></div></div>
<div class="ttc" id="a11896_html_af9d914cab7e60b310cb44c75c8bff228"><div class="ttname"><a href="../../d0/d38/a11896.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a></div><div class="ttdeci">static void startTimer(TimerRef t)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d51/a03842_source.html#l00187">IpplTimings.h:187</a></div></div>
<div class="ttc" id="a08204_html_aa936d2daaaaefa91f9783019a2ceacf8"><div class="ttname"><a href="../../d3/d6d/a08204.html#aa936d2daaaaefa91f9783019a2ceacf8">FieldLayout::size_iv</a></div><div class="ttdeci">ac_id_vnodes::size_type size_iv() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d21/a03392_source.html#l00702">FieldLayout.h:702</a></div></div>
<div class="ttc" id="a11756_html_a979472827d7cff2726c562fdc73ff5e3"><div class="ttname"><a href="../../d5/dc5/a11756.html#a979472827d7cff2726c562fdc73ff5e3">DiscField::printDebug</a></div><div class="ttdeci">void printDebug()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00414">DiscField.hpp:414</a></div></div>
<div class="ttc" id="a11756_html_ad27401098b7602545ada8a25c905d28f"><div class="ttname"><a href="../../d5/dc5/a11756.html#ad27401098b7602545ada8a25c905d28f">DiscField::read_NDIndex</a></div><div class="ttdeci">bool read_NDIndex(FILE *, NDIndex&lt; Dim &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00679">DiscField.hpp:679</a></div></div>
<div class="ttc" id="a11756_html_a92672d9fd2bf21fbc0f714c6ec049947"><div class="ttname"><a href="../../d5/dc5/a11756.html#a92672d9fd2bf21fbc0f714c6ec049947">DiscField::CurrentOffset</a></div><div class="ttdeci">Offset_t CurrentOffset</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00887">DiscField.h:887</a></div></div>
<div class="ttc" id="a11756_html_a8772c046361c3f67250791c37523dab0"><div class="ttname"><a href="../../d5/dc5/a11756.html#a8772c046361c3f67250791c37523dab0">DiscField::DiscType</a></div><div class="ttdeci">std::string DiscType</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00865">DiscField.h:865</a></div></div>
<div class="ttc" id="a09360_html_a3fc943d7af8a5f88178faeab977802c0"><div class="ttname"><a href="../../dc/dd6/a09360.html#a3fc943d7af8a5f88178faeab977802c0">Message::put</a></div><div class="ttdeci">Message &amp; put(const T &amp;val)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d98/a03524_source.html#l00406">Message.h:406</a></div></div>
<div class="ttc" id="a11756_html_a19a8da5958ad57f7ecf40114cc761f43"><div class="ttname"><a href="../../d5/dc5/a11756.html#a19a8da5958ad57f7ecf40114cc761f43">DiscField::get_Dimension</a></div><div class="ttdeci">unsigned int get_Dimension() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00108">DiscField.h:108</a></div></div>
<div class="ttc" id="a03674_html_a0fe983ce29b295378e5d2fd09dc57337"><div class="ttname"><a href="../../d0/d1e/a03674.html#a0fe983ce29b295378e5d2fd09dc57337">a</a></div><div class="ttdeci">std::complex&lt; double &gt; a</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1e/a03674_source.html#l00056">IpplExpressions.h:56</a></div></div>
<div class="ttc" id="a11756_html_aa22c5d7c450b4550aae6eb5ac31d10b1"><div class="ttname"><a href="../../d5/dc5/a11756.html#aa22c5d7c450b4550aae6eb5ac31d10b1">DiscField::read_meta</a></div><div class="ttdeci">bool read_meta()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00493">DiscField.hpp:493</a></div></div>
<div class="ttc" id="a11756_html_aeabe0fe0a441811ba27e4b2fc238a003"><div class="ttname"><a href="../../d5/dc5/a11756.html#aeabe0fe0a441811ba27e4b2fc238a003">DiscField::operator=</a></div><div class="ttdeci">DiscField &amp; operator=(const DiscField&lt; Dim &gt; &amp;)</div></div>
<div class="ttc" id="a08012_html"><div class="ttname"><a href="../../d3/d4c/a08012.html">LField</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8d/a03266_source.html#l00027">FFT.h:27</a></div></div>
<div class="ttc" id="a04362_html_a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec"><div class="ttname"><a href="../../d4/d8a/a04362.html#a128feef53dcb164cca235f6102e234a6aec62b03f01067a12e9d6c6d8312c3eec">Attrib::Legacy::Distribution::T</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d5b/a02078_source.html#l00189">Distribution.h:189</a></div></div>
<div class="ttc" id="a08212_html"><div class="ttname"><a href="../../da/d57/a08212.html">UniformCartesian</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddd/a03317_source.html#l00024">BCond.h:24</a></div></div>
<div class="ttc" id="a08012_html_a5bf55eca1a2d772944a15f1e4361efed"><div class="ttname"><a href="../../d3/d4c/a08012.html#a5bf55eca1a2d772944a15f1e4361efed">LField::IsCompressed</a></div><div class="ttdeci">bool IsCompressed() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d06/a03368_source.html#l00134">LField.h:134</a></div></div>
<div class="ttc" id="a11756_html_aef3f6576e6130429308bf880cf6c6de3"><div class="ttname"><a href="../../d5/dc5/a11756.html#aef3f6576e6130429308bf880cf6c6de3">DiscField::WritingFile</a></div><div class="ttdeci">bool WritingFile</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00860">DiscField.h:860</a></div></div>
<div class="ttc" id="a11752_html_aba19c2cadc3eb0eaaddcf6d9cdc80546"><div class="ttname"><a href="../../d7/d74/a11752.html#aba19c2cadc3eb0eaaddcf6d9cdc80546">DFOffsetData::isCompressed</a></div><div class="ttdeci">bool isCompressed</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00042">DiscField.h:42</a></div></div>
<div class="ttc" id="a03323_html"><div class="ttname"><a href="../../d4/d00/a03323.html">BrickExpression.h</a></div></div>
<div class="ttc" id="a11740_html_a0a7cd22059b52b4603c948441f4c85cd"><div class="ttname"><a href="../../d2/d0a/a11740.html#a0a7cd22059b52b4603c948441f4c85cd">DiscConfig::getNodeSMPIndex</a></div><div class="ttdeci">unsigned int getNodeSMPIndex(unsigned int n) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00157">DiscConfig.h:157</a></div></div>
<div class="ttc" id="a08008_html_a762004cbc1ac304271ea609fc8abe501"><div class="ttname"><a href="../../dd/d54/a08008.html#a762004cbc1ac304271ea609fc8abe501">BareField::begin_if</a></div><div class="ttdeci">iterator_if begin_if()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de4/a03308_source.html#l00100">BareField.h:100</a></div></div>
<div class="ttc" id="a03524_html_aa611d67b8eebe08e9e82e9b72521cb20"><div class="ttname"><a href="../../dc/d98/a03524.html#aa611d67b8eebe08e9e82e9b72521cb20">getMessage_iter</a></div><div class="ttdeci">void getMessage_iter(Message &amp;m, OutputIterator o)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d98/a03524_source.html#l00595">Message.h:595</a></div></div>
<div class="ttc" id="a04401_html_a5c17dec4af54fc8232e6bbd18a28804a"><div class="ttname"><a href="../../d6/d21/a04401.html#a5c17dec4af54fc8232e6bbd18a28804a">Hypervolume::n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dae/a04043_source.html#l00056">hypervolume.cpp:56</a></div></div>
<div class="ttc" id="a11944_html_a81590170136304a4cee588088b8e1f8a"><div class="ttname"><a href="../../d0/d4d/a11944.html#a81590170136304a4cee588088b8e1f8a">Timer::clock_time</a></div><div class="ttdeci">double clock_time()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dcf/a13225_source.html#l00050">Timer.cpp:50</a></div></div>
<div class="ttc" id="a11740_html_af6510046f0ffbea82dbeb80254c76c27"><div class="ttname"><a href="../../d2/d0a/a11740.html#af6510046f0ffbea82dbeb80254c76c27">DiscConfig::pNodesPerSMP</a></div><div class="ttdeci">unsigned int pNodesPerSMP(unsigned int node) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dd0/a03749_source.html#l00123">DiscConfig.cpp:123</a></div></div>
<div class="ttc" id="a11736_html_a308b4e9941ce509ec25d387f0e5ba515"><div class="ttname"><a href="../../d2/d10/a11736.html#a308b4e9941ce509ec25d387f0e5ba515">DiscBuffer::writetime</a></div><div class="ttdeci">static double writetime</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4f/a03746_source.html#l00083">DiscBuffer.h:83</a></div></div>
<div class="ttc" id="a07944_html_a131a7ae47e0fa32176fa8220bf7cc78f"><div class="ttname"><a href="../../d4/d8b/a07944.html#a131a7ae47e0fa32176fa8220bf7cc78f">NDIndex::getMessage</a></div><div class="ttdeci">Message &amp; getMessage(Message &amp;m)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfe/a03425_source.html#l00138">NDIndex.h:138</a></div></div>
<div class="ttc" id="a09360_html_a22e02c53be8f84943784624cd35b8414"><div class="ttname"><a href="../../dc/dd6/a09360.html#a22e02c53be8f84943784624cd35b8414">Message::setDelete</a></div><div class="ttdeci">Message &amp; setDelete(const bool c)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d98/a03524_source.html#l00331">Message.h:331</a></div></div>
<div class="ttc" id="a11756_html_aad797405fccbdf02814a6f2c75df5e55"><div class="ttname"><a href="../../d5/dc5/a11756.html#aad797405fccbdf02814a6f2c75df5e55">DiscField::open_df_file_fd</a></div><div class="ttdeci">int open_df_file_fd(const std::string &amp;fnm, const std::string &amp;suf, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00196">DiscField.hpp:196</a></div></div>
<div class="ttc" id="a03866_html_a373787183a57da0c3bea1eaa0b936e89"><div class="ttname"><a href="../../db/d06/a03866.html#a373787183a57da0c3bea1eaa0b936e89">PAssert_EQ</a></div><div class="ttdeci">#define PAssert_EQ(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d06/a03866_source.html#l00104">PAssert.h:104</a></div></div>
<div class="ttc" id="a11756_html_aa200b6d45c51e9ad046784326329fd35"><div class="ttname"><a href="../../d5/dc5/a11756.html#aa200b6d45c51e9ad046784326329fd35">DiscField::numFiles</a></div><div class="ttdeci">unsigned int numFiles() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00964">DiscField.h:964</a></div></div>
<div class="ttc" id="a11752_html"><div class="ttname"><a href="../../d7/d74/a11752.html">DFOffsetData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00040">DiscField.h:40</a></div></div>
<div class="ttc" id="a03545_html_ac1ba8db11c328fa03dfb59fc7156ddc0"><div class="ttname"><a href="../../dd/d25/a03545.html#ac1ba8db11c328fa03dfb59fc7156ddc0">FB_WRITE_TAG</a></div><div class="ttdeci">#define FB_WRITE_TAG</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d25/a03545_source.html#l00060">Tags.h:60</a></div></div>
<div class="ttc" id="a11756_html_a19941b5e5fc5170757a044e15fa276f0"><div class="ttname"><a href="../../d5/dc5/a11756.html#a19941b5e5fc5170757a044e15fa276f0">DiscField::make_globalID</a></div><div class="ttdeci">bool make_globalID(FieldLayout&lt; Dim &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00303">DiscField.hpp:303</a></div></div>
<div class="ttc" id="a03545_html_a913eb02f7935f8df3324d5fce5934a8c"><div class="ttname"><a href="../../dd/d25/a03545.html#a913eb02f7935f8df3324d5fce5934a8c">DF_TAG_CYCLE</a></div><div class="ttdeci">#define DF_TAG_CYCLE</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d25/a03545_source.html#l00074">Tags.h:74</a></div></div>
<div class="ttc" id="a11736_html_a1410d6aaeb813eae7d766368021d5ba0"><div class="ttname"><a href="../../d2/d10/a11736.html#a1410d6aaeb813eae7d766368021d5ba0">DiscBuffer::writebytes</a></div><div class="ttdeci">static long writebytes</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4f/a03746_source.html#l00085">DiscBuffer.h:85</a></div></div>
<div class="ttc" id="a11740_html"><div class="ttname"><a href="../../d2/d0a/a11740.html">DiscConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00058">DiscConfig.h:58</a></div></div>
<div class="ttc" id="a08204_html_a145fb07dd8ce69c94cc355f263fc22ef"><div class="ttname"><a href="../../d3/d6d/a08204.html#a145fb07dd8ce69c94cc355f263fc22ef">FieldLayout::getDomain</a></div><div class="ttdeci">const NDIndex&lt; Dim &gt; &amp; getDomain() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d21/a03392_source.html#l00325">FieldLayout.h:325</a></div></div>
<div class="ttc" id="a11864_html_a3a6b4cb706505026d436313690f6222c"><div class="ttname"><a href="../../d5/d16/a11864.html#a3a6b4cb706505026d436313690f6222c">IpplInfo::perSMPParallelIO</a></div><div class="ttdeci">static bool perSMPParallelIO()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d5e/a03818_source.html#l00211">IpplInfo.h:211</a></div></div>
<div class="ttc" id="a09360_html_adc2879b32cc3bc025e931e6219d0582e"><div class="ttname"><a href="../../dc/dd6/a09360.html#adc2879b32cc3bc025e931e6219d0582e">Message::setCopy</a></div><div class="ttdeci">Message &amp; setCopy(const bool c)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d98/a03524_source.html#l00319">Message.h:319</a></div></div>
<div class="ttc" id="a11740_html_aae53239b53d352ec9d8d9c4198575093"><div class="ttname"><a href="../../d2/d0a/a11740.html#aae53239b53d352ec9d8d9c4198575093">DiscConfig::mySMP</a></div><div class="ttdeci">unsigned int mySMP() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00082">DiscConfig.h:82</a></div></div>
<div class="ttc" id="a03500_html_a2ecfb905230e85a1a2cadf2c1aa65ced"><div class="ttname"><a href="../../d8/d63/a03500.html#a2ecfb905230e85a1a2cadf2c1aa65ced">COMM_ANY_NODE</a></div><div class="ttdeci">const int COMM_ANY_NODE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d63/a03500_source.html#l00040">Communicate.h:40</a></div></div>
<div class="ttc" id="a07940_html"><div class="ttname"><a href="../../d9/d37/a07940.html">CompressedBrickIterator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d65/a03215_source.html#l00039">FieldDataSource.h:39</a></div></div>
<div class="ttc" id="a11756_html_a21b4a2aede922190ea70206529c574de"><div class="ttname"><a href="../../d5/dc5/a11756.html#a21b4a2aede922190ea70206529c574de">DiscField::query</a></div><div class="ttdeci">void query(int &amp;numRecords, int &amp;numFields, std::vector&lt; int &gt; &amp;size) const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00160">DiscField.hpp:160</a></div></div>
<div class="ttc" id="a11756_html_ab265d13c12a250189fcc0b36a2466587"><div class="ttname"><a href="../../d5/dc5/a11756.html#ab265d13c12a250189fcc0b36a2466587">DiscField::NeedStartRecord</a></div><div class="ttdeci">int NeedStartRecord</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00877">DiscField.h:877</a></div></div>
<div class="ttc" id="a11756_html_a1f4490a62a9087a25e34f2deba11652c"><div class="ttname"><a href="../../d5/dc5/a11756.html#a1f4490a62a9087a25e34f2deba11652c">DiscField::read</a></div><div class="ttdeci">bool read(Field&lt; T, Dim, M, C &gt; &amp;f, const NDIndex&lt; Dim &gt; &amp;readDomain, unsigned int varID, unsigned int record)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00140">DiscField.h:140</a></div></div>
<div class="ttc" id="a11756_html_aae80a93157189f2fb474673bbb02b20b"><div class="ttname"><a href="../../d5/dc5/a11756.html#aae80a93157189f2fb474673bbb02b20b">DiscField::DataDimension</a></div><div class="ttdeci">unsigned int DataDimension</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00868">DiscField.h:868</a></div></div>
<div class="ttc" id="a09360_html_aeb7c0c5d1f49f8fd1b78eae709216da9"><div class="ttname"><a href="../../dc/dd6/a09360.html#aeb7c0c5d1f49f8fd1b78eae709216da9">Message::get</a></div><div class="ttdeci">Message &amp; get(const T &amp;cval)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d98/a03524_source.html#l00476">Message.h:476</a></div></div>
<div class="ttc" id="a11756_html_aad6ce7ef888f630e250f2f2286812d8f"><div class="ttname"><a href="../../d5/dc5/a11756.html#aad6ce7ef888f630e250f2f2286812d8f">DiscField::read</a></div><div class="ttdeci">bool read(Field&lt; T, Dim, M, C &gt; &amp;f)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00593">DiscField.h:593</a></div></div>
<div class="ttc" id="a11756_html_a52347e63bac3e5bcac27ec93c2470866"><div class="ttname"><a href="../../d5/dc5/a11756.html#a52347e63bac3e5bcac27ec93c2470866">DiscField::NumWritten</a></div><div class="ttdeci">unsigned int NumWritten</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00883">DiscField.h:883</a></div></div>
<div class="ttc" id="a11756_html_a4e3110330cd29caaabf95ec5aa8f6373"><div class="ttname"><a href="../../d5/dc5/a11756.html#a4e3110330cd29caaabf95ec5aa8f6373">DiscField::write_offset_and_data</a></div><div class="ttdeci">void write_offset_and_data(FILE *outputOffset, int outputDatafd, CompressedBrickIterator&lt; T, Dim &gt; &amp;cbi, const NDIndex&lt; Dim &gt; &amp;owned)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l01039">DiscField.h:1039</a></div></div>
<div class="ttc" id="a11756_html_a293d5f15ec0c13a523a62e142c05dac9"><div class="ttname"><a href="../../d5/dc5/a11756.html#a293d5f15ec0c13a523a62e142c05dac9">DiscField::DiscField</a></div><div class="ttdeci">DiscField(const char *fname, const char *config, unsigned int numFields, const char *typestr=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00052">DiscField.hpp:52</a></div></div>
<div class="ttc" id="a08012_html_ac785783b40bde6497da0587503f1f846"><div class="ttname"><a href="../../d3/d4c/a08012.html#ac785783b40bde6497da0587503f1f846">LField::begin</a></div><div class="ttdeci">const iterator &amp; begin() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d06/a03368_source.html#l00110">LField.h:110</a></div></div>
<div class="ttc" id="a11756_html_a1c40653c5efa9da51af75b28bca15d54"><div class="ttname"><a href="../../d5/dc5/a11756.html#a1c40653c5efa9da51af75b28bca15d54">DiscField::compute_expected</a></div><div class="ttdeci">int compute_expected(const FieldLayout&lt; Dim &gt; &amp;, const NDIndex&lt; Dim &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00849">DiscField.hpp:849</a></div></div>
<div class="ttc" id="a08008_html_aab4b994ffccabe14ba5c18255615b897"><div class="ttname"><a href="../../dd/d54/a08008.html#aab4b994ffccabe14ba5c18255615b897">BareField::compressible</a></div><div class="ttdeci">bool compressible() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de4/a03308_source.html#l00191">BareField.h:191</a></div></div>
<div class="ttc" id="a11756_html_a0266a4f1bd61f1b84eb39fc2525c9862"><div class="ttname"><a href="../../d5/dc5/a11756.html#a0266a4f1bd61f1b84eb39fc2525c9862">DiscField::read_offset</a></div><div class="ttdeci">bool read_offset(unsigned int varID, unsigned int record, unsigned int sf, std::vector&lt; DFOffsetData&lt; Dim, T &gt; &gt; &amp;offdata, int vnodes)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l01166">DiscField.h:1166</a></div></div>
<div class="ttc" id="a11944_html_a3a8b5272198d029779dc9302a54305a8"><div class="ttname"><a href="../../d0/d4d/a11944.html#a3a8b5272198d029779dc9302a54305a8">Timer::start</a></div><div class="ttdeci">void start()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dcf/a13225_source.html#l00034">Timer.cpp:34</a></div></div>
<div class="ttc" id="a03545_html_a96d35d3e7dedbed301a4cf69be060d07"><div class="ttname"><a href="../../dd/d25/a03545.html#a96d35d3e7dedbed301a4cf69be060d07">DF_OFFSET_TAG</a></div><div class="ttdeci">#define DF_OFFSET_TAG</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d25/a03545_source.html#l00072">Tags.h:72</a></div></div>
<div class="ttc" id="a03758_html"><div class="ttname"><a href="../../da/d85/a03758.html">DiscField.hpp</a></div></div>
<div class="ttc" id="a08012_html_a0a5b76a0133a6c0ab73b4874096a08cb"><div class="ttname"><a href="../../d3/d4c/a08012.html#a0a5b76a0133a6c0ab73b4874096a08cb">LField::Compress</a></div><div class="ttdeci">void Compress()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d06/a03368_source.html#l00161">LField.h:161</a></div></div>
<div class="ttc" id="a11756_html_a4155576007acb2164434a4e43984dac3"><div class="ttname"><a href="../../d5/dc5/a11756.html#a4155576007acb2164434a4e43984dac3">DiscField::NumVnodes</a></div><div class="ttdeci">std::vector&lt; int &gt; * NumVnodes</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00905">DiscField.h:905</a></div></div>
<div class="ttc" id="a11756_html_aa671623e2e613ad503e0822c5e728232"><div class="ttname"><a href="../../d5/dc5/a11756.html#aa671623e2e613ad503e0822c5e728232">DiscField::write_NDIndex</a></div><div class="ttdeci">bool write_NDIndex(FILE *, const NDIndex&lt; Dim &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00712">DiscField.hpp:712</a></div></div>
<div class="ttc" id="a11896_html_a59ffa7a04c160376d3a6593bff568fb4"><div class="ttname"><a href="../../d0/d38/a11896.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a></div><div class="ttdeci">static TimerRef getTimer(const char *nm)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d51/a03842_source.html#l00182">IpplTimings.h:182</a></div></div>
<div class="ttc" id="a03746_html"><div class="ttname"><a href="../../d7/d4f/a03746.html">DiscBuffer.h</a></div></div>
<div class="ttc" id="a11756_html_ade754a87d6e1046f83911824139ad64f"><div class="ttname"><a href="../../d5/dc5/a11756.html#ade754a87d6e1046f83911824139ad64f">DiscField::globalID</a></div><div class="ttdeci">GlobalIDList_t globalID</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00914">DiscField.h:914</a></div></div>
<div class="ttc" id="a03917_html"><div class="ttname"><a href="../../d6/d9d/a03917.html">vmap.h</a></div></div>
<div class="ttc" id="a08008_html_add48f68ff3e320645708670d9d423cbe"><div class="ttname"><a href="../../dd/d54/a08008.html#add48f68ff3e320645708670d9d423cbe">BareField::getLayout</a></div><div class="ttdeci">Layout_t &amp; getLayout() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de4/a03308_source.html#l00131">BareField.h:131</a></div></div>
<div class="ttc" id="a08012_html_aba07081c0381e7e0f25d214db7613164"><div class="ttname"><a href="../../d3/d4c/a08012.html#aba07081c0381e7e0f25d214db7613164">LField::getAllocated</a></div><div class="ttdeci">const NDIndex&lt; Dim &gt; &amp; getAllocated() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d06/a03368_source.html#l00098">LField.h:98</a></div></div>
<div class="ttc" id="a11756_html_a8172992143ac6f24e23bbfcef8e4162e"><div class="ttname"><a href="../../d5/dc5/a11756.html#a8172992143ac6f24e23bbfcef8e4162e">DiscField::mySMP</a></div><div class="ttdeci">unsigned int mySMP() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00953">DiscField.h:953</a></div></div>
<div class="ttc" id="a04303_html_a45b11d8daf90ce2a666257dba64d3114"><div class="ttname"><a href="../../d2/dc7/a04303.html#a45b11d8daf90ce2a666257dba64d3114">Expressions::Expr_t</a></div><div class="ttdeci">Expression Expr_t</div><div class="ttdoc">type of an expression </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5e/a03953_source.html#l00063">Expression.h:63</a></div></div>
<div class="ttc" id="a11548_html"><div class="ttname"><a href="../../d1/d83/a11548.html">OpAssign</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dc7/a03683_source.html#l00552">TypeComputations.h:552</a></div></div>
<div class="ttc" id="a08004_html"><div class="ttname"><a href="../../da/d7e/a08004.html">DomainMap::touch_iterator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dda/a03260_source.html#l00378">DomainMap.h:378</a></div></div>
<div class="ttc" id="a03800_html_a3479363bc276c3798e3f3656c66d93ed"><div class="ttname"><a href="../../dd/dbc/a03800.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="ttdeci">Inform &amp; endl(Inform &amp;inf)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dbc/a03800_source.html#l00042">Inform.cpp:42</a></div></div>
<div class="ttc" id="a07940_html_af9e9275cc7aee1d4289b3965dd74b991"><div class="ttname"><a href="../../d9/d37/a07940.html#af9e9275cc7aee1d4289b3965dd74b991">CompressedBrickIterator::IsCompressed</a></div><div class="ttdeci">bool IsCompressed() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db1/a03335_source.html#l00100">CompressedBrickIterator.h:100</a></div></div>
<div class="ttc" id="a08404_html"><div class="ttname"><a href="../../d1/d2f/a08404.html">BrickExpression</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d00/a03323_source.html#l00017">BrickExpression.h:17</a></div></div>
<div class="ttc" id="a08204_html"><div class="ttname"><a href="../../d3/d6d/a08204.html">FieldLayout</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de4/a03308_source.html#l00046">BareField.h:46</a></div></div>
<div class="ttc" id="a09360_html"><div class="ttname"><a href="../../dc/dd6/a09360.html">Message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d98/a03524_source.html#l00142">Message.h:142</a></div></div>
<div class="ttc" id="a11756_html_acac7e5db6f431d7fedc34f4e387f3e72"><div class="ttname"><a href="../../d5/dc5/a11756.html#acac7e5db6f431d7fedc34f4e387f3e72">DiscField::Offset_t</a></div><div class="ttdeci">long long Offset_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00849">DiscField.h:849</a></div></div>
<div class="ttc" id="a11756_html_ae43ff35ef506653ef4b0b77341246f0b"><div class="ttname"><a href="../../d5/dc5/a11756.html#ae43ff35ef506653ef4b0b77341246f0b">DiscField::pNodesPerSMP</a></div><div class="ttdeci">unsigned int pNodesPerSMP(unsigned int node) const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00973">DiscField.h:973</a></div></div>
<div class="ttc" id="a08008_html_a8708a405938d97966b20f420d67b4fa7"><div class="ttname"><a href="../../dd/d54/a08008.html#a8708a405938d97966b20f420d67b4fa7">BareField::iterator_if</a></div><div class="ttdeci">ac_id_larray::iterator iterator_if</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de4/a03308_source.html#l00092">BareField.h:92</a></div></div>
<div class="ttc" id="a07944_html_a6ebe77298883352ee93598a9e91d98a0"><div class="ttname"><a href="../../d4/d8b/a07944.html#a6ebe77298883352ee93598a9e91d98a0">NDIndex::putMessage</a></div><div class="ttdeci">Message &amp; putMessage(Message &amp;m) const</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfe/a03425_source.html#l00130">NDIndex.h:130</a></div></div>
<div class="ttc" id="a03425_html"><div class="ttname"><a href="../../dd/dfe/a03425.html">NDIndex.h</a></div></div>
<div class="ttc" id="a03500_html_a8fd7c2717593266e2ebbaaf1c23d2d01"><div class="ttname"><a href="../../d8/d63/a03500.html#a8fd7c2717593266e2ebbaaf1c23d2d01">COMM_ANY_TAG</a></div><div class="ttdeci">const int COMM_ANY_TAG</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d63/a03500_source.html#l00041">Communicate.h:41</a></div></div>
<div class="ttc" id="a11756_html_a14561ec30d59b89d93efe82b316bf869"><div class="ttname"><a href="../../d5/dc5/a11756.html#a14561ec30d59b89d93efe82b316bf869">DiscField::write_layout</a></div><div class="ttdeci">bool write_layout()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00760">DiscField.hpp:760</a></div></div>
<div class="ttc" id="a11756_html_ade1546f29a6b8031bdb5fe0d4c9edf78"><div class="ttname"><a href="../../d5/dc5/a11756.html#ade1546f29a6b8031bdb5fe0d4c9edf78">DiscField::read</a></div><div class="ttdeci">bool read(Field&lt; T, Dim, M, C &gt; &amp;f, const NDIndex&lt; Dim &gt; &amp;readDomain)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00588">DiscField.h:588</a></div></div>
<div class="ttc" id="a11756_html_a3909c5fc495836702913f727e986ddac"><div class="ttname"><a href="../../d5/dc5/a11756.html#a3909c5fc495836702913f727e986ddac">DiscField::offset_data_to_domain</a></div><div class="ttdeci">void offset_data_to_domain(DFOffsetData&lt; Dim, T &gt; &amp;offdata, NDIndex&lt; Dim &gt; &amp;domain)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l01432">DiscField.h:1432</a></div></div>
<div class="ttc" id="a11756_html_aabba5490aff2d910d6910032bb4a2e9c"><div class="ttname"><a href="../../d5/dc5/a11756.html#aabba5490aff2d910d6910032bb4a2e9c">DiscField::VnodeTally</a></div><div class="ttdeci">std::vector&lt; int &gt; * VnodeTally</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00899">DiscField.h:899</a></div></div>
<div class="ttc" id="a11752_html_a45e48747bbee52ba23c4d66b1bb80fb4"><div class="ttname"><a href="../../d7/d74/a11752.html#a45e48747bbee52ba23c4d66b1bb80fb4">DFOffsetData::offset</a></div><div class="ttdeci">long long offset</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00043">DiscField.h:43</a></div></div>
<div class="ttc" id="a03752_html"><div class="ttname"><a href="../../d0/dbc/a03752.html">DiscConfig.h</a></div></div>
<div class="ttc" id="a08204_html_a96b38e185c137f83885e10d16e5643f4"><div class="ttname"><a href="../../d3/d6d/a08204.html#a96b38e185c137f83885e10d16e5643f4">FieldLayout::touch_range_dv</a></div><div class="ttdeci">std::pair&lt; touch_iterator_dv, touch_iterator_dv &gt; touch_range_dv</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d21/a03392_source.html#l00077">FieldLayout.h:77</a></div></div>
<div class="ttc" id="a07944_html_a2917bb719ec865512e42401b55284d7d"><div class="ttname"><a href="../../d4/d8b/a07944.html#a2917bb719ec865512e42401b55284d7d">NDIndex::touches</a></div><div class="ttdeci">bool touches(const NDIndex&lt; Dim &gt; &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6b/a03428_source.html#l00080">NDIndexInlines.h:80</a></div></div>
<div class="ttc" id="a11896_html_a06ab8330445cb281b26fa12dbfa2b72c"><div class="ttname"><a href="../../d0/d38/a11896.html#a06ab8330445cb281b26fa12dbfa2b72c">IpplTimings::TimerRef</a></div><div class="ttdeci">Timing::TimerRef TimerRef</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d51/a03842_source.html#l00176">IpplTimings.h:176</a></div></div>
<div class="ttc" id="a07936_html"><div class="ttname"><a href="../../d7/dfe/a07936.html">Field</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d65/a03215_source.html#l00038">FieldDataSource.h:38</a></div></div>
<div class="ttc" id="a11756_html_a504ccdf43d2b8e886f1f662c366bf377"><div class="ttname"><a href="../../d5/dc5/a11756.html#a504ccdf43d2b8e886f1f662c366bf377">DiscField::numFiles</a></div><div class="ttdeci">unsigned int numFiles(unsigned int s) const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00967">DiscField.h:967</a></div></div>
<div class="ttc" id="a07944_html_a13dd94cf2a9c224510a41c5dda2f1bbe"><div class="ttname"><a href="../../d4/d8b/a07944.html#a13dd94cf2a9c224510a41c5dda2f1bbe">NDIndex::size</a></div><div class="ttdeci">unsigned size() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d6b/a03428_source.html#l00068">NDIndexInlines.h:68</a></div></div>
<div class="ttc" id="a11864_html_a3af4c27c54dc01bea7aece3230ea95cd"><div class="ttname"><a href="../../d5/d16/a11864.html#a3af4c27c54dc01bea7aece3230ea95cd">IpplInfo::chunkSize</a></div><div class="ttdeci">static int chunkSize()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d5e/a03818_source.html#l00206">IpplInfo.h:206</a></div></div>
<div class="ttc" id="a11756_html_aa70a195db807f063c1d7b5a6e3006866"><div class="ttname"><a href="../../d5/dc5/a11756.html#aa70a195db807f063c1d7b5a6e3006866">DiscField::NumRecords</a></div><div class="ttdeci">unsigned int NumRecords</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00882">DiscField.h:882</a></div></div>
<div class="ttc" id="a11968_html"><div class="ttname"><a href="../../d2/d1c/a11968.html">vmap</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d9d/a03917_source.html#l00058">vmap.h:58</a></div></div>
<div class="ttc" id="a11756_html"><div class="ttname"><a href="../../d5/dc5/a11756.html">DiscField</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00049">DiscField.h:49</a></div></div>
<div class="ttc" id="a11756_html_af8aea9346253c30633a32b9849ea7763"><div class="ttname"><a href="../../d5/dc5/a11756.html#af8aea9346253c30633a32b9849ea7763">DiscField::domain_to_offset_data</a></div><div class="ttdeci">void domain_to_offset_data(const NDIndex&lt; Dim &gt; &amp;domain, DFOffsetData&lt; Dim, T &gt; &amp;offdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l01447">DiscField.h:1447</a></div></div>
<div class="ttc" id="a08524_html"><div class="ttname"><a href="../../d1/d28/a08524.html">Index</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/daa/a03413_source.html#l00236">Index.h:236</a></div></div>
<div class="ttc" id="a11756_html_aa5505cfca8a8cb8cbc769661f30a5002"><div class="ttname"><a href="../../d5/dc5/a11756.html#aa5505cfca8a8cb8cbc769661f30a5002">DiscField::parse_config</a></div><div class="ttdeci">bool parse_config(const char *, bool)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00373">DiscField.hpp:373</a></div></div>
<div class="ttc" id="a11740_html_a6d440776c8348853b5464fe36292273e"><div class="ttname"><a href="../../d2/d0a/a11740.html#a6d440776c8348853b5464fe36292273e">DiscConfig::numSMPs</a></div><div class="ttdeci">unsigned int numSMPs() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00080">DiscConfig.h:80</a></div></div>
<div class="ttc" id="a08956_html_ac0e671485db61cd6fdf8961504250b2b"><div class="ttname"><a href="../../d7/d31/a08956.html#ac0e671485db61cd6fdf8961504250b2b">Communicate::receive_block</a></div><div class="ttdeci">Message * receive_block(int &amp;node, int &amp;tag)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d8f/a03497_source.html#l00300">Communicate.cpp:300</a></div></div>
<div class="ttc" id="a11944_html_a63f0eb44b27402196590a03781515dba"><div class="ttname"><a href="../../d0/d4d/a11944.html#a63f0eb44b27402196590a03781515dba">Timer::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dcf/a13225_source.html#l00039">Timer.cpp:39</a></div></div>
<div class="ttc" id="a11736_html_abf4f563aa16366ac23eed652a8a8a67d"><div class="ttname"><a href="../../d2/d10/a11736.html#abf4f563aa16366ac23eed652a8a8a67d">DiscBuffer::readtime</a></div><div class="ttdeci">static double readtime</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4f/a03746_source.html#l00082">DiscBuffer.h:82</a></div></div>
<div class="ttc" id="a03320_html_af01b9b0c367940525ea2a7fffa7b3bf7"><div class="ttname"><a href="../../db/d69/a03320.html#af01b9b0c367940525ea2a7fffa7b3bf7">PETE_apply</a></div><div class="ttdeci">void PETE_apply(const OpPeriodic&lt; T &gt; &amp;, T &amp;a, const T &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d69/a03320_source.html#l00353">BCond.hpp:353</a></div></div>
<div class="ttc" id="a11944_html"><div class="ttname"><a href="../../d0/d4d/a11944.html">Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d3d/a13231_source.html#l00027">Timer.h:27</a></div></div>
<div class="ttc" id="a11864_html_a8bdcd8abcec1d747ecf82579b42c853c"><div class="ttname"><a href="../../d5/d16/a11864.html#a8bdcd8abcec1d747ecf82579b42c853c">IpplInfo::abort</a></div><div class="ttdeci">static void abort(const char *=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dab/a03815_source.html#l00616">IpplInfo.cpp:616</a></div></div>
<div class="ttc" id="a11740_html_a05bd58e90fa26c847ef382a8c306196d"><div class="ttname"><a href="../../d2/d0a/a11740.html#a05bd58e90fa26c847ef382a8c306196d">DiscConfig::getFilename</a></div><div class="ttdeci">const std::string &amp; getFilename(unsigned int fn) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00125">DiscConfig.h:125</a></div></div>
<div class="ttc" id="a11756_html_a0baa52e26c5a1a48f4ef355eee5e787d"><div class="ttname"><a href="../../d5/dc5/a11756.html#a0baa52e26c5a1a48f4ef355eee5e787d">DiscField::get_DiscType</a></div><div class="ttdeci">const char * get_DiscType()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00114">DiscField.h:114</a></div></div>
<div class="ttc" id="a11864_html_aebcb82f8a013adbf9812642262edfc38"><div class="ttname"><a href="../../d5/d16/a11864.html#aebcb82f8a013adbf9812642262edfc38">IpplInfo::Comm</a></div><div class="ttdeci">static Communicate * Comm</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d5e/a03818_source.html#l00084">IpplInfo.h:84</a></div></div>
<div class="ttc" id="a03545_html_a1aaf7fb71bd584f8ecfe0c9678450043"><div class="ttname"><a href="../../dd/d25/a03545.html#a1aaf7fb71bd584f8ecfe0c9678450043">FB_TAG_CYCLE</a></div><div class="ttdeci">#define FB_TAG_CYCLE</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d25/a03545_source.html#l00062">Tags.h:62</a></div></div>
<div class="ttc" id="a11756_html_a20ce03294864203a32e24276f1a87432"><div class="ttname"><a href="../../d5/dc5/a11756.html#a20ce03294864203a32e24276f1a87432">DiscField::TypeString</a></div><div class="ttdeci">std::string TypeString</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00864">DiscField.h:864</a></div></div>
<div class="ttc" id="a11756_html_ab44d74480220b446935be44e94eb2d70"><div class="ttname"><a href="../../d5/dc5/a11756.html#ab44d74480220b446935be44e94eb2d70">DiscField::read_data</a></div><div class="ttdeci">bool read_data(int outputDatafd, T *buffer, Offset_t readsize, Offset_t seekpos)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l01383">DiscField.h:1383</a></div></div>
<div class="ttc" id="a11756_html_af3f1c90d7e9e5ca5c0c488de9be932f6"><div class="ttname"><a href="../../d5/dc5/a11756.html#af3f1c90d7e9e5ca5c0c488de9be932f6">DiscField::create_files</a></div><div class="ttdeci">bool create_files()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00257">DiscField.hpp:257</a></div></div>
<div class="ttc" id="a08008_html_a1726674af15c63f514b9b4ff09767641"><div class="ttname"><a href="../../dd/d54/a08008.html#a1726674af15c63f514b9b4ff09767641">BareField::fillGuardCellsIfNotDirty</a></div><div class="ttdeci">void fillGuardCellsIfNotDirty() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de4/a03308_source.html#l00122">BareField.h:122</a></div></div>
<div class="ttc" id="a07944_html"><div class="ttname"><a href="../../d4/d8b/a07944.html">NDIndex</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d65/a03215_source.html#l00040">FieldDataSource.h:40</a></div></div>
<div class="ttc" id="a11756_html_adea1eab5d37e0559636433d06aca23aa"><div class="ttname"><a href="../../d5/dc5/a11756.html#adea1eab5d37e0559636433d06aca23aa">DiscField::open_df_file</a></div><div class="ttdeci">FILE * open_df_file(const std::string &amp;fnm, const std::string &amp;mode)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00179">DiscField.hpp:179</a></div></div>
<div class="ttc" id="a08956_html_a59757c3d732e56c61cfdf4710a09a3d6"><div class="ttname"><a href="../../d7/d31/a08956.html#a59757c3d732e56c61cfdf4710a09a3d6">Communicate::receive</a></div><div class="ttdeci">Message * receive(int &amp;node, int &amp;tag)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d8f/a03497_source.html#l00240">Communicate.cpp:240</a></div></div>
<div class="ttc" id="a09360_html_a4586e2ea141a20fe0c65cff03e54638e"><div class="ttname"><a href="../../dc/dd6/a09360.html#a4586e2ea141a20fe0c65cff03e54638e">Message::putmsg</a></div><div class="ttdeci">Message &amp; putmsg(void *, int, int=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de9/a03530_source.html#l00078">MessageFunctions.cpp:78</a></div></div>
<div class="ttc" id="a11736_html_a882bc6b9c08d1888e6a6212a351fc2f1"><div class="ttname"><a href="../../d2/d10/a11736.html#a882bc6b9c08d1888e6a6212a351fc2f1">DiscBuffer::readbytes</a></div><div class="ttdeci">static long readbytes</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4f/a03746_source.html#l00084">DiscBuffer.h:84</a></div></div>
<div class="ttc" id="a11776_html"><div class="ttname"><a href="../../d5/da2/a11776.html">DiscType</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df3/a03773_source.html#l00098">DiscType.h:98</a></div></div>
<div class="ttc" id="a11756_html_a705aefde97387f54f0a7b455827a2f41"><div class="ttname"><a href="../../d5/dc5/a11756.html#a705aefde97387f54f0a7b455827a2f41">DiscField::chunk_domain</a></div><div class="ttdeci">NDIndex&lt; Dim &gt; chunk_domain(const NDIndex&lt; Dim &gt; &amp;currblock, int chunkelems, int &amp;msdim, bool iscompressed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00873">DiscField.hpp:873</a></div></div>
<div class="ttc" id="a11756_html_ac37f34fb25c7a2f49c038d1443ba464f"><div class="ttname"><a href="../../d5/dc5/a11756.html#ac37f34fb25c7a2f49c038d1443ba464f">DiscField::ConfigOK</a></div><div class="ttdeci">bool ConfigOK</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00857">DiscField.h:857</a></div></div>
<div class="ttc" id="a11740_html_a456d1782e486580c3aa621e0099a1779"><div class="ttname"><a href="../../d2/d0a/a11740.html#a456d1782e486580c3aa621e0099a1779">DiscConfig::fileSMPs</a></div><div class="ttdeci">unsigned int fileSMPs() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dbc/a03752_source.html#l00081">DiscConfig.h:81</a></div></div>
<div class="ttc" id="a11736_html_ac5a7e89e6600571b0ed4078e242640af"><div class="ttname"><a href="../../d2/d10/a11736.html#ac5a7e89e6600571b0ed4078e242640af">DiscBuffer::resize</a></div><div class="ttdeci">static void * resize(long sz)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dd8/a03743_source.html#l00079">DiscBuffer.cpp:79</a></div></div>
<div class="ttc" id="a08008_html_ab436e2eb992a9a87449757517ab60b68"><div class="ttname"><a href="../../dd/d54/a08008.html#ab436e2eb992a9a87449757517ab60b68">BareField::end_if</a></div><div class="ttdeci">iterator_if end_if()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/de4/a03308_source.html#l00101">BareField.h:101</a></div></div>
<div class="ttc" id="a11756_html_a44e63ee2b178c9d4548f5df50256a107"><div class="ttname"><a href="../../d5/dc5/a11756.html#a44e63ee2b178c9d4548f5df50256a107">DiscField::~DiscField</a></div><div class="ttdeci">~DiscField()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00142">DiscField.hpp:142</a></div></div>
<div class="ttc" id="a11756_html_a078b6c2b3efe23b52458033b1ebae389"><div class="ttname"><a href="../../d5/dc5/a11756.html#a078b6c2b3efe23b52458033b1ebae389">DiscField::write</a></div><div class="ttdeci">bool write(Field&lt; T, Dim, M, C &gt; &amp;f, unsigned int varID)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00615">DiscField.h:615</a></div></div>
<div class="ttc" id="a11752_html_aaecae539de1b3c593610122ff7c42f89"><div class="ttname"><a href="../../d7/d74/a11752.html#aaecae539de1b3c593610122ff7c42f89">DFOffsetData::compressedVal</a></div><div class="ttdeci">T compressedVal</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00044">DiscField.h:44</a></div></div>
<div class="ttc" id="a08012_html_a621e7e0f4520838b2507ab3ad2442318"><div class="ttname"><a href="../../d3/d4c/a08012.html#a621e7e0f4520838b2507ab3ad2442318">LField::getOwned</a></div><div class="ttdeci">const NDIndex&lt; Dim &gt; &amp; getOwned() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d06/a03368_source.html#l00099">LField.h:99</a></div></div>
<div class="ttc" id="a11944_html_a6a69c5013bf0718850825e647619f62d"><div class="ttname"><a href="../../d0/d4d/a11944.html#a6a69c5013bf0718850825e647619f62d">Timer::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dcf/a13225_source.html#l00029">Timer.cpp:29</a></div></div>
<div class="ttc" id="a11756_html_aa2b16267f9c24426e9b164fbf897c638"><div class="ttname"><a href="../../d5/dc5/a11756.html#aa2b16267f9c24426e9b164fbf897c638">DiscField::read_layout</a></div><div class="ttdeci">int read_layout(int record, int sf)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d85/a03758_source.html#l00799">DiscField.hpp:799</a></div></div>
<div class="ttc" id="a11756_html_ad8d86aad21a49576293e31d55d20be88"><div class="ttname"><a href="../../d5/dc5/a11756.html#ad8d86aad21a49576293e31d55d20be88">DiscField::get_TypeString</a></div><div class="ttdeci">const char * get_TypeString()</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00111">DiscField.h:111</a></div></div>
<div class="ttc" id="a11756_html_a3cc9324c74039190e5cde0cc48a5f0ca"><div class="ttname"><a href="../../d5/dc5/a11756.html#a3cc9324c74039190e5cde0cc48a5f0ca">DiscField::numSMPs</a></div><div class="ttdeci">unsigned int numSMPs() const</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd8/a03755_source.html#l00943">DiscField.h:943</a></div></div>
<div class="ttc" id="a03818_html_a93d4be0c42bb6191255e156c2943be12"><div class="ttname"><a href="../../d4/d5e/a03818.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a></div><div class="ttdeci">#define ERRORMSG(msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d5e/a03818_source.html#l00350">IpplInfo.h:350</a></div></div>
<div class="ttc" id="a08956_html_ac4593203c34f26c625bd51c7502c297e"><div class="ttname"><a href="../../d7/d31/a08956.html#ac4593203c34f26c625bd51c7502c297e">Communicate::barrier</a></div><div class="ttdeci">void barrier(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d8f/a03497_source.html#l00439">Communicate.cpp:439</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 29 2026 15:26:25 for OPAL (Object Oriented Parallel Accelerator Library) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
