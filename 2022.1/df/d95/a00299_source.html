<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OPAL (Object Oriented Parallel Accelerator Library): src/Algorithms/ParallelCyclotronTracker.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "AMSmath.js", "AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OPAL (Object Oriented Parallel Accelerator Library)
   &#160;<span id="projectnumber">2022.1</span>
   </div>
   <div id="projectbrief">OPAL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_a2837dd329d585d987581ea971fad2e6.html">Algorithms</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ParallelCyclotronTracker.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../df/d95/a00299.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Class ParallelCyclotronTracker</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//   Tracker for OPAL-Cycl</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// Copyright (c) 2007 - 2014, Jianjun Yang, Andreas Adelmann and Matthias Toggweiler,</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//                            Paul Scherrer Institut, Villigen PSI, Switzerland</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// Copyright (c) 2014,        Daniel Winklehner, MIT, Cambridge, MA, USA</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// Copyright (c) 2012 - 2022, Paul Scherrer Institut, Villigen PSI, Switzerland</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// All rights reserved</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// Implemented as part of the PhD thesis</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// &quot;Beam dynamics in high intensity cyclotrons including neighboring bunch effects&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// and the paper</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// &quot;Beam dynamics in high intensity cyclotrons including neighboring bunch effects:</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// Model, implementation, and application&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// (https://journals.aps.org/prab/pdf/10.1103/PhysRevSTAB.13.064201)</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// This file is part of OPAL.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// OPAL is free software: you can redistribute it and/or modify</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// (at your option) any later version.</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">// You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// along with OPAL. If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d61/a00302.html">Algorithms/ParallelCyclotronTracker.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d3e/a00566.html">AbsBeamline/CCollimator.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d5c/a00578.html">AbsBeamline/Corrector.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d21/a00584.html">AbsBeamline/Cyclotron.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/db1/a00590.html">AbsBeamline/Degrader.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d25/a00596.html">AbsBeamline/Drift.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/daa/a00638.html">AbsBeamline/Marker.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d0f/a00644.html">AbsBeamline/Monitor.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d36/a00650.html">AbsBeamline/Multipole.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/df2/a00656.html">AbsBeamline/MultipoleT.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/df1/a00662.html">AbsBeamline/MultipoleTBase.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d5c/a00668.html">AbsBeamline/MultipoleTCurvedConstRadius.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d73/a00674.html">AbsBeamline/MultipoleTCurvedVarRadius.h</a>&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/dc0/a00734.html">AbsBeamline/MultipoleTStraight.h</a>&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/dce/a00740.html">AbsBeamline/Offset.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/dfa/a00746.html">AbsBeamline/PluginElement.h</a>&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d5c/a00752.html">AbsBeamline/Probe.h</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4a/a00758.html">AbsBeamline/RBend.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d7e/a00770.html">AbsBeamline/RFCavity.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/dd4/a00776.html">AbsBeamline/Ring.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d96/a00782.html">AbsBeamline/SBend.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d0c/a00788.html">AbsBeamline/SBend3D.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d12/a00794.html">AbsBeamline/ScalingFFAMagnet.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d0e/a00800.html">AbsBeamline/Septum.h</a>&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dad/a00806.html">AbsBeamline/Solenoid.h</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d8b/a00821.html">AbsBeamline/Stripper.h</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/de8/a00839.html">AbsBeamline/Vacuum.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/dcf/a00845.html">AbsBeamline/VariableRFCavity.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d4c/a00851.html">AbsBeamline/VariableRFCavityFringeField.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d82/a00857.html">AbsBeamline/VerticalFFAMagnet.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d15/a00188.html">AbstractObjects/Element.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dd5/a00215.html">AbstractObjects/OpalData.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/dd7/a00260.html">Algorithms/Ctunes.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d8d/a01007.html">Algorithms/PolynomialTimeDependence.h</a>&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d9d/a00464.html">BasicActions/DumpEMFields.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d29/a00470.html">BasicActions/DumpFields.h</a>&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d39/a01271.html">Beamlines/Beamline.h</a>&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/dda/a01289.html">Beamlines/FlaggedBeamline.h</a>&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d6f/a02234.html">Distribution/Distribution.h</a>&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/de7/a02270.html">Elements/OpalBeamline.h</a>&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d6b/a01853.html">Physics/Physics.h</a>&quot;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dce/a01859.html">Physics/Units.h</a>&quot;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/d5d/a03068.html">Structure/BoundaryGeometry.h</a>&quot;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d44/a03074.html">Structure/DataSink.h</a>&quot;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d07/a01913.html">Structure/LossDataSink.h</a>&quot;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/dc1/a03263.html">Utilities/OpalException.h</a>&quot;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/dce/a02168.html">Utilities/Options.h</a>&quot;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &lt;boost/filesystem.hpp&gt;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &lt;numeric&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="../../df/d95/a00299.html#a3f0fce822e33cfa8bf2e3fafb2521451">   94</a></span>&#160;constexpr <span class="keywordtype">double</span> <a class="code" href="../../df/d95/a00299.html#a3f0fce822e33cfa8bf2e3fafb2521451">c_mmtns</a> = <a class="code" href="../../d4/dd0/a04537.html#ad8fcab196be0672fdc6e1f091b9bb01a">Physics::c</a> * <a class="code" href="../../d0/d3d/a04539.html#a610458ef9e4cd6ea2d9b23bfddef69f8">Units::m2mm</a> / <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> <a class="code" href="../../dd/dca/a04847.html#a156606fbe21eefb03894cb3015bc976e">ParallelCyclotronTracker::xaxis</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(1.0, 0.0, 0.0);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> <a class="code" href="../../dd/dca/a04847.html#a705a3ae603fb70d81bedda510f07c348">ParallelCyclotronTracker::yaxis</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 1.0, 0.0);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> <a class="code" href="../../dd/dca/a04847.html#a83bc3db8fa4db57db2910ff920cd5858">ParallelCyclotronTracker::zaxis</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 1.0);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keyword">extern</span> <a class="code" href="../../d8/d4f/a12119.html">Inform</a> *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a8500a0ba7244a9e19630a091780e450d">  114</a></span>&#160;<a class="code" href="../../dd/dca/a04847.html#a3f99825f5bea312ad002cacd1f39158e">ParallelCyclotronTracker::ParallelCyclotronTracker</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d4e/a05623.html">Beamline</a>&amp; beamline,</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                                   <a class="code" href="../../d9/d06/a04735.html">PartBunchBase&lt;double, 3&gt;</a>* bunch,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                                                   <a class="code" href="../../d7/d4d/a07199.html">DataSink</a>&amp; ds,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                                   <span class="keyword">const</span> <a class="code" href="../../dd/d3d/a05379.html">PartData</a>&amp; reference,</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                                   <span class="keywordtype">bool</span> revBeam, <span class="keywordtype">bool</span> revTrack,</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                                   <span class="keywordtype">int</span> maxSTEPS,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                                   <a class="code" href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560c">Steppers::TimeIntegrator</a> timeintegrator,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                                   <span class="keyword">const</span> <span class="keywordtype">int</span>&amp; numBunch,</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                                   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; mbEta,</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                                   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; mbPara,</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                                   <span class="keyword">const</span> std::string&amp; mbMode,</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                                   <span class="keyword">const</span> std::string&amp; mbBinning)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    : <a class="code" href="../../dc/daf/a05399.html">Tracker</a>(beamline, bunch, reference, revBeam, revTrack)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    , bgf_m(nullptr)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    , maxSteps_m(maxSTEPS)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    , lastDumpedStep_m(0)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    , myNode_m(<a class="code" href="../../df/da4/a12131.html">Ippl</a>::myNode())</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    , initialLocalNum_m(bunch-&gt;getLocalNum())</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    , initialTotalNum_m(bunch-&gt;getTotalNum())</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    , opalRing_m(nullptr)</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    , itsStepper_mp(nullptr)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    , mode_m(<a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6e">TrackingMode</a>::<a class="code" href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560ca8c50748d684b7e7ff62154e821f2f18b">UNDEFINED</a>)</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    , stepper_m(timeintegrator)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#abe24adc3e8075fa31efcc433e82aa498">itsBeamline</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d3/d4e/a05623.html">Beamline</a>*<span class="keyword">&gt;</span>(beamline.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>());</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a248cafbfeef5f7465d79fc5bde4662c6">itsDataSink</a> = &amp;ds;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">if</span> ( numBunch &gt; 1 ) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a> = std::unique_ptr&lt;MultiBunchHandler&gt;(</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keyword">new</span> <a class="code" href="../../d2/d04/a04815.html">MultiBunchHandler</a>(bunch, numBunch, mbEta,</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                  mbPara, mbMode, mbBinning)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        );</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a> = <a class="code" href="../../d0/d9c/a12163.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a>(<span class="stringliteral">&quot;Integration&quot;</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>   = <a class="code" href="../../d0/d9c/a12163.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a>(<span class="stringliteral">&quot;Frametransform&quot;</span>);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">DumpTimer_m</a>        = <a class="code" href="../../d0/d9c/a12163.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a>(<span class="stringliteral">&quot;Dump&quot;</span>);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a7b7de46cb5ba096d06787417babe02ac">BinRepartTimer_m</a>   = <a class="code" href="../../d0/d9c/a12163.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a>(<span class="stringliteral">&quot;Binaryrepart&quot;</span>);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a0f86ab6a46d64fb7771a2529483ed48a">PluginElemTimer_m</a>  = <a class="code" href="../../d0/d9c/a12163.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a>(<span class="stringliteral">&quot;PluginElements&quot;</span>);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a586044342216bb6abc6fe79e5c54f28a">DelParticleTimer_m</a> = <a class="code" href="../../d0/d9c/a12163.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a>(<span class="stringliteral">&quot;DeleteParticles&quot;</span>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a566180cef8406a229e4cd208616de10c">setTrackingMode</a>();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a418bc2825324f3468d04640386bbac72">  162</a></span>&#160;<a class="code" href="../../dd/dca/a04847.html#a418bc2825324f3468d04640386bbac72">ParallelCyclotronTracker::~ParallelCyclotronTracker</a>() {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#ab66a59fab6e56302c0302b72cffe8fd8">bgf_m</a>)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#aa8e2942513971f295590f723d4195fbb">lossDs_m</a>-&gt;save();</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d2/d61/a05043.html">Component</a>* component : <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keyword">delete</span>(component);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> fd : <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keyword">delete</span>(fd);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../dd/dca/a04847.html#abe24adc3e8075fa31efcc433e82aa498">itsBeamline</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// delete opalRing_m;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ab251404bffc001dee5f7c39b56c08a6b">  176</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ab251404bffc001dee5f7c39b56c08a6b">ParallelCyclotronTracker::bgf_main_collision_test</a>() {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dca/a04847.html#ab66a59fab6e56302c0302b72cffe8fd8">bgf_m</a>) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="../../d8/d4f/a12119.html">Inform</a> msg(<span class="stringliteral">&quot;bgf_main_collision_test &quot;</span>);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> intecoords = 0.0;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// This has to match the dT in the rk4 pusher</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">double</span> dtime = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a4951c53df6841fd275a56f41fc76bfdf">getdT</a>() * <a class="code" href="../../dd/dca/a04847.html#a4951f43b20c6936bb3d15859a26a4932">getHarmonicNumber</a>();</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">int</span> triId = 0;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); i++) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordtype">int</span> res = <a class="code" href="../../dd/dca/a04847.html#ab66a59fab6e56302c0302b72cffe8fd8">bgf_m</a>-&gt;<a class="code" href="../../d8/da7/a07191.html#ab9558a286404d55536ffd717a5b2947b">partInside</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i],</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                    dtime, intecoords, triId);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">if</span> (res &gt;= 0) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#aa8e2942513971f295590f723d4195fbb">lossDs_m</a>-&gt;addParticle(<a class="code" href="../../df/d5e/a05351.html">OpalParticle</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i],</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                               <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i],</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                               <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>(),</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                                               <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a5f3de61e1c65ab5b1f336470ae29d48c">Q</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a2f9a3f71f9e8cae4965de06b4819e176">M</a>[i]),</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                  std::make_pair(<a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a>, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ac035c07285b91e2eac59fe13e0013d20">bunchNum</a>[i]));</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i] = -1;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <a class="code" href="../../d8/d4f/a12119.html">Inform</a> gmsgALL(<span class="stringliteral">&quot;OPAL&quot;</span>, <a class="code" href="../../d4/d2e/a03974.html#a92f1a0cddb2239428b24e94b918e4efb">INFORM_ALL_NODES</a>);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            gmsgALL &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a4f2ddb1680d4f912183950ea45ac1504">level4</a> &lt;&lt; <span class="stringliteral">&quot;* Particle &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i]</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; lost on boundary geometry&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">// only used for dumping into stat file</span></div><div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a68e7cdb19cd27bdaf777e4092158bff0">  209</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a68e7cdb19cd27bdaf777e4092158bff0">ParallelCyclotronTracker::dumpAngle</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; theta,</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                         <span class="keywordtype">double</span>&amp; prevAzimuth,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                         <span class="keywordtype">double</span>&amp; azimuth,</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">short</span>&amp; bunchNr) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> ( prevAzimuth &lt; 0.0 ) { <span class="comment">// only at first occurrence</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordtype">double</span> plus = 0.0;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;inRestartRun() ) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            plus = 360.0 * (<a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> - bunchNr);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        azimuth = theta + plus;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordtype">double</span> dtheta = theta - prevAzimuth;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">if</span> ( dtheta &lt; 0 ) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            dtheta += 360.0;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">if</span> ( dtheta &gt; 180 ) { <span class="comment">// rotating clockwise, reduce angle</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            dtheta -= 360;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        azimuth += dtheta;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    prevAzimuth = theta;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;}</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a5dc5b769d60d7310d604b9623fe31f4b">  233</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../dd/dca/a04847.html#a5dc5b769d60d7310d604b9623fe31f4b">ParallelCyclotronTracker::computeRadius</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; meanR)<span class="keyword"> const </span>{</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d0/d3d/a04539.html#a610458ef9e4cd6ea2d9b23bfddef69f8">Units::m2mm</a> * <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(meanR(0) * meanR(0) + meanR(1) * meanR(1));</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a00991ee8b1feb2e195fe423a67eae1d9">  238</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a00991ee8b1feb2e195fe423a67eae1d9">ParallelCyclotronTracker::computePathLengthUpdate</a>(std::vector&lt;double&gt;&amp; dl,</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                                       <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; dt)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;{</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// the last element in dotP is the dot-product over all particles</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    std::vector&lt;double&gt; dotP(dl.size());</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> == <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5aef7994f35f11e33b59aadbb2dbe6b605">DumpFrame::BUNCH_MEAN</a> || <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>()) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            dotP[<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ac035c07285b91e2eac59fe13e0013d20">bunchNum</a>[i]] += <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i]);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <a class="code" href="../../d4/d5e/a03686.html#a3f4c593649c5ad948ee3e8566bffeda6">allreduce</a>(dotP.data(), dotP.size(), std::plus&lt;double&gt;());</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">// dot-product over all particles</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="../../d5/d12/a03851.html#a06dc3d53220b680f16b2c655bcb86a40">sum</a> = std::accumulate(dotP.begin(), dotP.end() - 1, 0);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        dotP.back() = <a class="code" href="../../d5/d12/a03851.html#a06dc3d53220b680f16b2c655bcb86a40">sum</a> / double(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>());</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">// bunch specific --&gt; multi-bunches only</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">short</span> b = 0; b &lt; (short)dotP.size() - 1; ++b) {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            dotP[b] /= double(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a80253d8da2e44f1c729d52f685a11918">getTotalNumPerBunch</a>(b));</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>() == 0 ) {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="comment">// here we are in DumpFrame::GLOBAL mode</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        dotP[0] = 0.0;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">// here we are in DumpFrame::GLOBAL mode</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        dotP[0] = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[0], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[0]);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; dotP.size(); ++i) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> gamma = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(1.0 + dotP[i]);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> beta  = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(dotP[i]) / gamma;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        dl[i] = <a class="code" href="../../df/d95/a00299.html#a3f0fce822e33cfa8bf2e3fafb2521451">c_mmtns</a> * dt * <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * beta;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a61ca4fa0bee626420b2e224d949d1f1d">  282</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a61ca4fa0bee626420b2e224d949d1f1d">ParallelCyclotronTracker::openFiles</a>(<span class="keywordtype">size_t</span> numFiles, std::string SfileName) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;numFiles; i++) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        std::string SfileName2 = SfileName;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">if</span> (i&lt;=2) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            SfileName2 += std::string(<span class="stringliteral">&quot;-Angle&quot;</span> + std::to_string(<span class="keywordtype">int</span>(i)) + <span class="stringliteral">&quot;.dat&quot;</span>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="comment">// for single Particle Mode, output after each turn, to define matched initial phase ellipse.</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            SfileName2 += std::string(<span class="stringliteral">&quot;-afterEachTurn.dat&quot;</span>);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a42b090454954eacc9124dd0564ff6c4a">outfTheta_m</a>.emplace_back(<span class="keyword">new</span> std::ofstream(SfileName2.c_str()));</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a42b090454954eacc9124dd0564ff6c4a">outfTheta_m</a>.back()-&gt;precision(8);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a42b090454954eacc9124dd0564ff6c4a">outfTheta_m</a>.back()-&gt;setf(std::ios::scientific, std::ios::floatfield);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        *<a class="code" href="../../dd/dca/a04847.html#a42b090454954eacc9124dd0564ff6c4a">outfTheta_m</a>.back() &lt;&lt; <span class="stringliteral">&quot;# r [mm]        beta_r*gamma       &quot;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;theta [deg]     beta_theta*gamma        &quot;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;z [mm]          beta_z*gamma&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a321e270f5e0af494699b02963717712a">  308</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a321e270f5e0af494699b02963717712a">ParallelCyclotronTracker::closeFiles</a>() {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp; file : <a class="code" href="../../dd/dca/a04847.html#a42b090454954eacc9124dd0564ff6c4a">outfTheta_m</a>) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        file-&gt;close();</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ad2d6873a3e37619775b75f07aaddf14e">  320</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ad2d6873a3e37619775b75f07aaddf14e">ParallelCyclotronTracker::visitCyclotron</a>(<span class="keyword">const</span> <a class="code" href="../../d6/de9/a05059.html">Cyclotron</a>&amp; cycl) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ----------------------------- Cyclotron -------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d6/de9/a05059.html">Cyclotron</a>*<span class="keyword">&gt;</span>(cycl.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>());</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(<a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// Is this a Spiral Inflector Simulation? If yes, we&#39;ll give the user some</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// useful information</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#abf713a03b8e60b20282878c80e42b45d">spiral_flag</a> = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a156c84ef5b4abf775a91d0a78c531f41">getSpiralFlag</a>();</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#abf713a03b8e60b20282878c80e42b45d">spiral_flag</a>) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* This is a Spiral Inflector Simulation! This means the following:&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;* 1.) It is up to the user to provide appropriate geometry, electric and magnetic fields!&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;*     (Use BANDRF type cyclotron and use RFMAPFN to load both magnetic&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;*     and electric fields, setting SUPERPOSE to an array of TRUE values.)&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;* 2.) For high currents it is strongly recommended to use the SAAMG fieldsolver,&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;*     FFT does not give the correct results (boundary conditions are missing).&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;* 3.) The whole geometry will be meshed and used for the fieldsolver.&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;*     There will be no transformations of the bunch into a local frame und consequently,&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;*     the problem will be treated non-relativistically!&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;*     (This is not an issue for spiral inflectors as they are typically &lt; 100 keV/amu.)&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* Note: For now, multi-bunch mode (MBM) needs to be de-activated for spiral inflector&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a>         &lt;&lt; <span class="stringliteral">&quot;* and space charge needs to be solved every time-step. numBunch_m and scSolveFreq are reset.&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>()) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// Fresh run (no restart):</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;inRestartRun()) {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="comment">// Get reference values from cyclotron element</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="comment">// For now, these are still stored in mm. should be the only ones. -DW</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a>     = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#ae825fac52f9fd89c8d72afeee8c7d9d6">getRinit</a>();</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a7b789e2c8e8dafd47e2acfcd9c97d0da">getPHIinit</a>();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">referenceZ</a>     = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a7244044e37c23a1caedada75c427cc7d">getZinit</a>();</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a>    = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a1ee6f03da77906adaea8ae75e4eca91c">getPRinit</a>();</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a>    = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a3ffb79294234b5f9a161c698c0219bf2">getPZinit</a>();</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">if</span> (referenceTheta &lt;= -180.0 || referenceTheta &gt; 180.0) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;Error in ParallelCyclotronTracker::visitCyclotron&quot;</span>,</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                <span class="stringliteral">&quot;PHIINIT is out of [-180, 180)!&quot;</span>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> =  <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>.<a class="code" href="../../dd/d3d/a05379.html#a27d86c12be3dc52a56c245ff36041871">getGamma</a>() * <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>.<a class="code" href="../../dd/d3d/a05379.html#a23dba80ac1c93b895b2d0b8748cbb739">getBeta</a>();</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="comment">// Calculate reference azimuthal (tangential) momentum from total-, z- and radial momentum:</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordtype">float</span> insqrt = <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> * <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> - \</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            referencePr * <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a> - <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a> * <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">if</span> (insqrt &lt; 0) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">if</span> (insqrt &gt; -1.0<a class="code" href="../../d4/dd0/a04537.html#ad5ee779aee8511a18dfbb209e80efc64">e</a>-10) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a> = 0.0;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;Error in ParallelCyclotronTracker::visitCyclotron&quot;</span>,</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                    <span class="stringliteral">&quot;Pt imaginary!&quot;</span>);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a> = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(insqrt);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> &lt; 0.0) {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a> *= -1.0;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="comment">// End calculate referencePt</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="comment">// Restart a run:</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="comment">// If the user wants to save the restarted run in local frame,</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment">// make sure the previous h5 file was local too</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> != <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334">DumpFrame::GLOBAL</a>) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dca/a04847.html#acfc7806b7b39b4208cf61d82f384a260">previousH5Local</a>) {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;Error in ParallelCyclotronTracker::visitCyclotron&quot;</span>,</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                    <span class="stringliteral">&quot;You are trying a local restart from a global h5 file!&quot;</span>);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="comment">// Else, if the user wants to save the restarted run in global frame,</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="comment">// make sure the previous h5 file was global too</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#acfc7806b7b39b4208cf61d82f384a260">previousH5Local</a>) {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;Error in ParallelCyclotronTracker::visitCyclotron&quot;</span>,</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                    <span class="stringliteral">&quot;You are trying a global restart from a local h5 file!&quot;</span>);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="comment">// Adjust some of the reference variables from the h5 file</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a667a54de4021458f6c85dfe5017b7d89">referencePhi</a> *= <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad51fb20cb6a44ecea8f27ed8971f7373">referencePsi</a> *= <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> = <a class="code" href="../../dd/dca/a04847.html#a66c3d1957609f79519739182446fc8ba">bega</a>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordflow">if</span> (referenceTheta &lt;= -180.0 || referenceTheta &gt; 180.0) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;Error in ParallelCyclotronTracker::visitCyclotron&quot;</span>,</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                                <span class="stringliteral">&quot;PHIINIT is out of [-180, 180)!&quot;</span>);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a7cc5ddca11d4cd71b4d89552202b1fe9">sinRefTheta_m</a> = <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(<a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> * <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a081ae478e143023617c95cafe9f673fa">cosRefTheta_m</a> = <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(<a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> * <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Bunch global starting position:&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* RINIT   = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a>  &lt;&lt; <span class="stringliteral">&quot; [mm]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* PHIINIT = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> &lt;&lt; <span class="stringliteral">&quot; [deg]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ZINIT   = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">referenceZ</a> &lt;&lt; <span class="stringliteral">&quot; [mm]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Bunch global starting momenta:&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Initial gamma = &quot;</span> &lt;&lt; <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>.<a class="code" href="../../dd/d3d/a05379.html#a27d86c12be3dc52a56c245ff36041871">getGamma</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Initial beta  = &quot;</span> &lt;&lt; <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>.<a class="code" href="../../dd/d3d/a05379.html#a23dba80ac1c93b895b2d0b8748cbb739">getBeta</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Reference total momentum          = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> &lt;&lt; <span class="stringliteral">&quot; [beta gamma]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Reference azimuthal momentum (Pt) = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a> &lt;&lt; <span class="stringliteral">&quot; [beta gamma]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Reference radial momentum (Pr)    = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a>  &lt;&lt; <span class="stringliteral">&quot; [beta gamma]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Reference axial momentum (Pz)     = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a> &lt;&lt; <span class="stringliteral">&quot; [beta gamma]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordtype">double</span> sym = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a856e2c6f80b96099c311838d43707ec5">getSymmetry</a>();</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* &quot;</span> &lt;&lt; sym &lt;&lt; <span class="stringliteral">&quot;-fold field symmetry &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// ckr: this just returned the default value as defined in Component.h</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// double rff = cycl_m-&gt;getRfFrequ(0);</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// *gmsg &lt;&lt; &quot;* Rf frequency= &quot; &lt;&lt; rff &lt;&lt; &quot; [MHz]&quot; &lt;&lt; endl;</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    std::string fmfn = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a42bdd09ae90b58b328d111f263fa2346">getFieldMapFN</a>();</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Field map file       = &#39;&quot;</span> &lt;&lt; fmfn &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    std::string <a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a> = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#aecca8fc5b33b4aae7e36e6f18643a36e">getCyclotronType</a>();</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Type of cyclotron    = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">double</span> rmin = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#aea3b0d1c8394f7e5f4085916a7facef0">getMinR</a>();</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">double</span> rmax = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a4c9eca7f86527b2973cc0e59a105f6cc">getMaxR</a>();</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Radial aperture      = &quot;</span> &lt;&lt; rmin &lt;&lt; <span class="stringliteral">&quot; ... &quot;</span> &lt;&lt; rmax&lt;&lt;<span class="stringliteral">&quot; [m] &quot;</span>&lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordtype">double</span> zmin = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a89d6cd7c8b5a7d0d853610b516e208d0">getMinZ</a>();</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordtype">double</span> zmax = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a6b494eac546c4882fe31875442156d38">getMaxZ</a>();</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Vertical aperture    = &quot;</span> &lt;&lt; zmin &lt;&lt; <span class="stringliteral">&quot; ... &quot;</span> &lt;&lt; zmax&lt;&lt;<span class="stringliteral">&quot; [m]&quot;</span>&lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">double</span> h = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a098ca2acb3fa6876ab88acb644665708">getCyclHarm</a>();</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Number of trimcoils  = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#ae7ef6c8f2c32b4d352653702e9c5d19d">getNumberOfTrimcoils</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Harmonic number h    = &quot;</span> &lt;&lt; h &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    std::vector&lt;double&gt; rffrequ = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a550a1290510ba9cbbe3cffce08db7330">getRfFrequ</a>();</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* RF frequency         = &quot;</span> &lt;&lt; <a class="code" href="../../d2/df8/a04550.html#a1c34d43d91ced76e4bd1c6c57bcb345e">Util::doubleVectorToString</a>(rffrequ) &lt;&lt; <span class="stringliteral">&quot; [MHz]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a0ccedc49b74c1d07a5fe94d1dfde88db">setBFieldType</a>();</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a9cfd43b9e975434247599c2ae5060d4d">getBFieldType</a>() == <a class="code" href="../../d6/de9/a05059.html#a808e3ff40ea53380b27785b65295836ea260dc0178b15bfeec1dd1567deb562eb">Cyclotron::BFieldType::BANDRF</a>) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        std::vector&lt;double&gt; rfphi = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a94f9e38d995d2223e25e8a4119986eab">getRfPhi</a>();</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; rfphi.size(); ++i) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            rfphi[i] = rfphi[i] * <a class="code" href="../../d0/d3d/a04539.html#ac9c7e47f91a8010d7c98e49d6e924911">Units::rad2deg</a>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* RF inital phase      = &quot;</span> &lt;&lt; <a class="code" href="../../d2/df8/a04550.html#a1c34d43d91ced76e4bd1c6c57bcb345e">Util::doubleVectorToString</a>(rfphi) &lt;&lt; <span class="stringliteral">&quot; [deg]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        std::vector&lt;double&gt; escale = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a018390d0b305bc9a9ca47a5e9dda2f5e">getEScale</a>();</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* E-field scale factor = &quot;</span> &lt;&lt; <a class="code" href="../../d2/df8/a04550.html#a1c34d43d91ced76e4bd1c6c57bcb345e">Util::doubleVectorToString</a>(escale) &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        std::vector&lt;bool&gt; superpose = <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#ad58ddc82494a30a8e8c693cf123315c7">getSuperpose</a>();</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Superpose electric field maps -&gt; &quot;</span> &lt;&lt; <a class="code" href="../../d2/df8/a04550.html#a22fe2d8fb5afd81d8466be75b93ee345">Util::boolVectorToUpperString</a>(superpose) &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// Read in cyclotron field maps</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a9e16c6bb041406486ba4f9afe5774baa">initialise</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a6d21538ab068ab9ac41e5ef23dfe08a3">getBScale</a>());</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordtype">double</span> BcParameter[8] = {};</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    BcParameter[0] = <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a45abd18f34b73644de07ee326e1eae15">getRmin</a>();</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    BcParameter[1] = <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>-&gt;<a class="code" href="../../d6/de9/a05059.html#a60929072e89749b3003cfedb5a34fd34">getRmax</a>();</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">// Store inner radius and outer radius of cyclotron field map in the list</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">buildupFieldList</a>(BcParameter, <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a9b2455e659f96e1bd7c87cc69e99a08d">ElementType::CYCLOTRON</a>, <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;}</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a39eda77c6c8e9977d77732eccff45832">  491</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a39eda77c6c8e9977d77732eccff45832">ParallelCyclotronTracker::visitCCollimator</a>(<span class="keyword">const</span> <a class="code" href="../../de/ddd/a05031.html">CCollimator</a>&amp; coll) {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ----------------------------- Collimator ------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="../../de/ddd/a05031.html">CCollimator</a>* elptr = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../de/ddd/a05031.html">CCollimator</a>*<span class="keyword">&gt;</span>(coll.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>());</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(elptr);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Name    = &quot;</span> &lt;&lt; elptr-&gt;<a class="code" href="../../db/d78/a05071.html#a07827d00308052e65fe03da558f0b987">getName</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordtype">double</span> xstart = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#adf03280be6438e40778b65c2b3292c05">getXStart</a>();</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* XStart  = &quot;</span> &lt;&lt; xstart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordtype">double</span> xend = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#ab06a614073fd7204b808e8c5d7a3d6bf">getXEnd</a>();</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* XEnd    = &quot;</span> &lt;&lt; xend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordtype">double</span> ystart = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#a454774d958ed90147fc9c397b61ace89">getYStart</a>();</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* YStart  = &quot;</span> &lt;&lt; ystart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">double</span> yend = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#ae40ca7b43fba6abcc1f3ffcaead4f0c0">getYEnd</a>();</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* YEnd    = &quot;</span> &lt;&lt; yend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordtype">double</span> zstart = elptr-&gt;<a class="code" href="../../de/ddd/a05031.html#a46069205a3fb9f18ca806989637daf56">getZStart</a>();</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ZStart  = &quot;</span> &lt;&lt; zstart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordtype">double</span> zend = elptr-&gt;<a class="code" href="../../de/ddd/a05031.html#a6a2b188041e68f645cd8e4a3ed11eb68">getZEnd</a>();</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ZEnd    = &quot;</span> &lt;&lt; zend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordtype">double</span> width = elptr-&gt;<a class="code" href="../../de/ddd/a05031.html#a152b6b8844f238b93f08155aa4784c24">getWidth</a>();</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Width   = &quot;</span> &lt;&lt; width &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    elptr-&gt;<a class="code" href="../../df/daa/a05167.html#a471a9fee6c0fcb9881d6c2c539029f20">initialise</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordtype">double</span> BcParameter[8] = {};</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    BcParameter[0] = xstart;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    BcParameter[1] = xend;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    BcParameter[2] = ystart;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    BcParameter[3] = yend;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    BcParameter[4] = width;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">buildupFieldList</a>(BcParameter, <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ad8166b7d7c176c698b7b9f3418baae61">ElementType::CCOLLIMATOR</a>, elptr);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;}</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a6ca7214e1d4530b9163e0ecb28c37121">  538</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a6ca7214e1d4530b9163e0ecb28c37121">ParallelCyclotronTracker::visitCorrector</a>(<span class="keyword">const</span> <a class="code" href="../../d3/dd5/a05047.html">Corrector</a>&amp; corr) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;In Corrector; L= &quot;</span> &lt;&lt; corr.<a class="code" href="../../db/d78/a05071.html#a1b412456edcf01147abada7721605101">getElementLength</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;Corrector*&gt;(corr.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>()));</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a10798d8fbf3380d58c62af7b8c49a4f0">  548</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a10798d8fbf3380d58c62af7b8c49a4f0">ParallelCyclotronTracker::visitDegrader</a>(<span class="keyword">const</span> <a class="code" href="../../da/d0f/a05063.html">Degrader</a>&amp; <a class="code" href="../../dd/d61/a04548.html#ae012eab1467cc6a796881b2e44b4464f">deg</a>) {</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;In Degrader; L= &quot;</span> &lt;&lt; <a class="code" href="../../dd/d61/a04548.html#ae012eab1467cc6a796881b2e44b4464f">deg</a>.getElementLength() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;Degrader*&gt;(<a class="code" href="../../dd/d61/a04548.html#ae012eab1467cc6a796881b2e44b4464f">deg</a>.clone()));</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a8dcb3538f720a2cf6edb5e86da23b9fd">  559</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a8dcb3538f720a2cf6edb5e86da23b9fd">ParallelCyclotronTracker::visitDrift</a>(<span class="keyword">const</span> <a class="code" href="../../d3/df0/a05067.html">Drift</a>&amp; drift) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;In drift L= &quot;</span> &lt;&lt; drift.<a class="code" href="../../db/d78/a05071.html#a1b412456edcf01147abada7721605101">getElementLength</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;Drift*&gt;(drift.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>()));</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#adf87b5b7d4f21f9e9c962dd0ce159236">  569</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#adf87b5b7d4f21f9e9c962dd0ce159236">ParallelCyclotronTracker::visitFlexibleCollimator</a>(<span class="keyword">const</span> <a class="code" href="../../d9/de1/a05091.html">FlexibleCollimator</a>&amp;) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;}</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a566211233fe8fabae5ce34978883461c">  578</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a566211233fe8fabae5ce34978883461c">ParallelCyclotronTracker::visitOffset</a>(<span class="keyword">const</span> <a class="code" href="../../d7/d05/a05163.html">Offset</a>&amp; off) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> == <span class="keyword">nullptr</span>)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                            <span class="stringliteral">&quot;ParallelCylcotronTracker::visitOffset&quot;</span>,</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                            <span class="stringliteral">&quot;Attempt to place an offset when Ring not defined&quot;</span>);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <a class="code" href="../../d7/d05/a05163.html">Offset</a>* offNonConst = <span class="keyword">const_cast&lt;</span><a class="code" href="../../d7/d05/a05163.html">Offset</a>*<span class="keyword">&gt;</span>(&amp;off);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    offNonConst-&gt;<a class="code" href="../../d7/d05/a05163.html#a0a9ef0521bbc0431525cdcd2b0694b0c">updateGeometry</a>(<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#a09e8908fa4675875da6c8ba50d4b1475">getNextPosition</a>(),</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#a46dc7ddd81b6fa4f579202ce27efa1d8">getNextNormal</a>());</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(off);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a9e4710ef7f2847551ec7257cdea4d11a">  594</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a9e4710ef7f2847551ec7257cdea4d11a">ParallelCyclotronTracker::visitMarker</a>(<span class="keyword">const</span> <a class="code" href="../../de/d11/a05095.html">Marker</a>&amp; marker) {</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">//   *gmsg &lt;&lt; &quot;In Marker; L= &quot; &lt;&lt; marker.getElementLength() &lt;&lt; endl;</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;Marker*&gt;(marker.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>()));</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">// Do nothing.</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#af965e58b6fbc3b577e0c60006cfed52a">  605</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#af965e58b6fbc3b577e0c60006cfed52a">ParallelCyclotronTracker::visitMonitor</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d8f/a05099.html">Monitor</a>&amp; corr) {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">//   *gmsg &lt;&lt; &quot;In Monitor; L= &quot; &lt;&lt; corr.getElementLength() &lt;&lt; endl;</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;Monitor*&gt;(corr.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>()));</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">//   applyDrift(flip_s * corr.getElementLength());</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;}</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#abfe243db3a21f427dd2ea39cae907dde">  616</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#abfe243db3a21f427dd2ea39cae907dde">ParallelCyclotronTracker::visitMultipole</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d5e/a05103.html">Multipole</a>&amp; mult) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;In Multipole; L= &quot;</span> &lt;&lt; mult.<a class="code" href="../../db/d78/a05071.html#a1b412456edcf01147abada7721605101">getElementLength</a>() &lt;&lt; <span class="stringliteral">&quot; however the element is missing &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;Multipole*&gt;(mult.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>()));</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;}</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aa9e2feb987680602aed0f494a77b2724">  626</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#aa9e2feb987680602aed0f494a77b2724">ParallelCyclotronTracker::visitMultipoleT</a>(<span class="keyword">const</span> <a class="code" href="../../da/d41/a05107.html">MultipoleT</a>&amp; multT) {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding MultipoleT&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(multT);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitMultipoleT&quot;</span>,</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use MultipoleT element&quot;</span>);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;MultipoleT*&gt;(multT.<a class="code" href="../../da/d41/a05107.html#a4c16c9e3bf313baa1600d739c1852322">clone</a>()));</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;}</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a5ebb0be80afeeda200f8c514a60c1c97">  642</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a5ebb0be80afeeda200f8c514a60c1c97">ParallelCyclotronTracker::visitMultipoleTStraight</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d90/a05159.html">MultipoleTStraight</a>&amp; multTstraight) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding MultipoleTStraight&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(multTstraight);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitMultipoleTStraight&quot;</span>,</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use MultipoleTStraight element&quot;</span>);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;MultipoleTStraight*&gt;(multTstraight.<a class="code" href="../../d1/d90/a05159.html#a9140ae673f890ac564abc3fedaeabf8f">clone</a>()));</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;}</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aefe99013af8d2932f81efeb3097a7082">  658</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#aefe99013af8d2932f81efeb3097a7082">ParallelCyclotronTracker::visitMultipoleTCurvedConstRadius</a>(<span class="keyword">const</span> <a class="code" href="../../df/d84/a05115.html">MultipoleTCurvedConstRadius</a>&amp; multTccurv) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding MultipoleTCurvedConstRadius&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(multTccurv);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitMultipoleTCurvedConstRadius&quot;</span>,</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use MultipoleTCurvedConstRadius element&quot;</span>);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;MultipoleTCurvedConstRadius*&gt;(multTccurv.<a class="code" href="../../df/d84/a05115.html#af43120d831b2a8878d30eed4b26cda92">clone</a>()));</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;}</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ae6c1dfbec52756e69756076b982f8d07">  674</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ae6c1dfbec52756e69756076b982f8d07">ParallelCyclotronTracker::visitMultipoleTCurvedVarRadius</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d91/a05119.html">MultipoleTCurvedVarRadius</a>&amp; multTvcurv) {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding MultipoleTCurvedVarRadius&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(multTvcurv);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitMultipoleTCurvedVarRadius&quot;</span>,</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use MultipoleTCurvedVarRadius element&quot;</span>);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;MultipoleTCurvedVarRadius*&gt;(multTvcurv.<a class="code" href="../../d3/d91/a05119.html#a6530a62c33a7c5b7bd93e9f57f167522">clone</a>()));</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;}</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a16e1cf92e29384ddcff45a058f7b3cca">  690</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a16e1cf92e29384ddcff45a058f7b3cca">ParallelCyclotronTracker::visitProbe</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d66/a05171.html">Probe</a>&amp; prob) {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ----------------------------- Probe ------------------------------------ *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <a class="code" href="../../dc/d66/a05171.html">Probe</a>* elptr = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../dc/d66/a05171.html">Probe</a>*<span class="keyword">&gt;</span>(prob.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>());</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(elptr);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Name    = &quot;</span> &lt;&lt; elptr-&gt;<a class="code" href="../../db/d78/a05071.html#a07827d00308052e65fe03da558f0b987">getName</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordtype">double</span> xstart = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#adf03280be6438e40778b65c2b3292c05">getXStart</a>();</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* XStart  = &quot;</span> &lt;&lt; xstart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordtype">double</span> xend = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#ab06a614073fd7204b808e8c5d7a3d6bf">getXEnd</a>();</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* XEnd    = &quot;</span> &lt;&lt; xend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordtype">double</span> ystart = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#a454774d958ed90147fc9c397b61ace89">getYStart</a>();</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* YStart  = &quot;</span> &lt;&lt; ystart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="keywordtype">double</span> yend = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#ae40ca7b43fba6abcc1f3ffcaead4f0c0">getYEnd</a>();</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* YEnd    = &quot;</span> &lt;&lt; yend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">// initialise, do nothing</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    elptr-&gt;<a class="code" href="../../df/daa/a05167.html#a471a9fee6c0fcb9881d6c2c539029f20">initialise</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordtype">double</span> BcParameter[8] = {};</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    BcParameter[0] = xstart;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    BcParameter[1] = xend;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    BcParameter[2] = ystart;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    BcParameter[3] = yend;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    BcParameter[4] = 1 ; <span class="comment">// width</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">buildupFieldList</a>(BcParameter, <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a5a9b37d8d9e76a99e6f5160c3eff9057">ElementType::PROBE</a>, elptr);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;}</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a14632cb5aa5ae426d5a116f89d95f43f">  729</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a14632cb5aa5ae426d5a116f89d95f43f">ParallelCyclotronTracker::visitRBend</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d07/a05175.html">RBend</a>&amp; bend) {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;In RBend; L= &quot;</span> &lt;&lt; bend.<a class="code" href="../../db/d78/a05071.html#a1b412456edcf01147abada7721605101">getElementLength</a>() &lt;&lt; <span class="stringliteral">&quot; however the element is missing &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;RBend*&gt;(bend.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>()));</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;}</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00739"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ade672dfc65236c764d564883ff95888e">  739</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ade672dfc65236c764d564883ff95888e">ParallelCyclotronTracker::visitRFCavity</a>(<span class="keyword">const</span> <a class="code" href="../../d7/d48/a05183.html">RFCavity</a>&amp; as) {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ----------------------------- RFCavity --------------------------------- * &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <a class="code" href="../../d7/d48/a05183.html">RFCavity</a>* elptr = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d7/d48/a05183.html">RFCavity</a>*<span class="keyword">&gt;</span>(as.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>());</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(elptr);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">if</span> ( elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#adec967170bc7dce19c7da8295276c47f">getCavityType</a>() != <a class="code" href="../../d0/d7e/a00770.html#a14f1d94ac9a52ad024e43601016e506fa999a80f850dea20daf38a72e6afce808">CavityType::SGSW</a> ) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitRFCavity&quot;</span>,</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                            <span class="stringliteral">&quot;\&quot;&quot;</span> + elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#af497e7e36f2af3782333a865e038b262">getCavityTypeString</a>() + <span class="stringliteral">&quot;\&quot; is not valid \&quot;TYPE\&quot; for RFCavity.\n&quot;</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                            <span class="stringliteral">&quot;The ParallelCyclotronTracker can only play with cyclotron type RF system currently...&quot;</span>);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Name                      = &quot;</span> &lt;&lt; elptr-&gt;<a class="code" href="../../db/d78/a05071.html#a07827d00308052e65fe03da558f0b987">getName</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    std::string fmfn = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#aa22be4c5cd598e74e5b8fce44acfc20a">getFieldMapFN</a>();</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* RF Field map file         = &#39;&quot;</span> &lt;&lt; fmfn &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordtype">double</span> rmin = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#af90ea0cd7726b5fdb17082c0f702588a">getRmin</a>();</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Minimal radius of cavity  = &quot;</span> &lt;&lt; rmin &lt;&lt; <span class="stringliteral">&quot; [mm]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordtype">double</span> rmax = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#a06eb3e02d5e9c26cb967de237b1e41ad">getRmax</a>();</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Maximal radius of cavity  = &quot;</span> &lt;&lt; rmax &lt;&lt; <span class="stringliteral">&quot; [mm]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordtype">double</span> rff = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#ab363ff1acc9b0ccdf9d589731afd31ad">getCycFrequency</a>();</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* RF frequency (2*pi*f)     = &quot;</span> &lt;&lt; rff &lt;&lt; <span class="stringliteral">&quot; [rad/s]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordtype">double</span> angle = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#a0f2f53e846d80e68b785b63801787fb2">getAzimuth</a>();</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Cavity azimuth position   = &quot;</span> &lt;&lt; angle &lt;&lt; <span class="stringliteral">&quot; [deg] &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordtype">double</span> gap = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#ab4ded3eeeb2ef6ccd62a9de9d7623339">getGapWidth</a>();</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Cavity gap width          = &quot;</span> &lt;&lt; gap &lt;&lt; <span class="stringliteral">&quot; [mm] &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordtype">double</span> pdis = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#ac9dfec52bbe15f4bb6859b0d436dcf75">getPerpenDistance</a>();</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Cavity Shift distance     = &quot;</span> &lt;&lt; pdis &lt;&lt; <span class="stringliteral">&quot; [mm] &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordtype">double</span> phi0 = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#af3d5bda1a532c40cc7f527926f679cfb">getPhi0</a>();</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Initial RF phase (t=0)    = &quot;</span> &lt;&lt; phi0 &lt;&lt; <span class="stringliteral">&quot; [deg] &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">      Setup time dependence and in case of no</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">      timedependence use a polynom with  a_0 = 1 and a_k = 0, k = 1,2,3.</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    std::shared_ptr&lt;AbstractTimeDependence&gt; freq_atd = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    std::shared_ptr&lt;AbstractTimeDependence&gt; ampl_atd = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    std::shared_ptr&lt;AbstractTimeDependence&gt; phase_atd = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>  unityVec;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    unityVec.push_back(1.);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    unityVec.push_back(0.);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    unityVec.push_back(0.);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    unityVec.push_back(0.);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    std::string frequencyModelName = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#ac7787dad3dc8735c6b4267e8ffb1f4d6">getFrequencyModelName</a>();</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    std::string amplitudeModelName = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#a1282969cc6ffac1a3a82f9bb3c5bedaa">getAmplitudeModelName</a>();</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    std::string phaseModelName = elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#a06a3369805a5dfbc4bf2891c7db6b1a2">getPhaseModelName</a>();</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">if</span> (!frequencyModelName.empty()) {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        freq_atd = <a class="code" href="../../da/d97/a05319.html#a24e23ba4f7cb7106c38eda2c32f78f41">AbstractTimeDependence::getTimeDependence</a>(frequencyModelName);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Variable frequency RF Model name &quot;</span> &lt;&lt; frequencyModelName &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        freq_atd = std::shared_ptr&lt;AbstractTimeDependence&gt;(<span class="keyword">new</span> <a class="code" href="../../db/d18/a05383.html">PolynomialTimeDependence</a>(unityVec));</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">if</span> (!amplitudeModelName.empty()) {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        ampl_atd = <a class="code" href="../../da/d97/a05319.html#a24e23ba4f7cb7106c38eda2c32f78f41">AbstractTimeDependence::getTimeDependence</a>(amplitudeModelName);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Variable amplitude RF Model name &quot;</span> &lt;&lt; amplitudeModelName &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        ampl_atd = std::shared_ptr&lt;AbstractTimeDependence&gt;(<span class="keyword">new</span> <a class="code" href="../../db/d18/a05383.html">PolynomialTimeDependence</a>(unityVec));</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    }</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">if</span> (!phaseModelName.empty()) {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        phase_atd = <a class="code" href="../../da/d97/a05319.html#a24e23ba4f7cb7106c38eda2c32f78f41">AbstractTimeDependence::getTimeDependence</a>(phaseModelName);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Variable phase RF Model name &quot;</span> &lt;&lt; phaseModelName &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        phase_atd = std::shared_ptr&lt;AbstractTimeDependence&gt;(<span class="keyword">new</span> <a class="code" href="../../db/d18/a05383.html">PolynomialTimeDependence</a>(unityVec));</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="comment">// read cavity voltage profile data from file.</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    elptr-&gt;<a class="code" href="../../d7/d48/a05183.html#a6c0772681aaef3784df12ae9bbfd42c3">initialise</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, freq_atd, ampl_atd, phase_atd);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordtype">double</span> BcParameter[8] = {};</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    BcParameter[0] = <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * rmin;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    BcParameter[1] = <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * rmax;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    BcParameter[2] = <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * pdis;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    BcParameter[3] = angle;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">buildupFieldList</a>(BcParameter, <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ac04b3cc5b1a13dc2463b809070bbb67e">ElementType::RFCAVITY</a>, elptr);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;}</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a79d0fb5389e876a853c76fe0a945bbbd">  833</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a79d0fb5389e876a853c76fe0a945bbbd">ParallelCyclotronTracker::visitRing</a>(<span class="keyword">const</span> <a class="code" href="../../db/d48/a05187.html">Ring</a>&amp; ring) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ----------------------------- Ring ------------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../db/d48/a05187.html">Ring</a>*<span class="keyword">&gt;</span>(ring.<a class="code" href="../../db/d48/a05187.html#a9f4c9a04b52030335ecb0806c70b8c8e">clone</a>());</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#a7aca0509073f7b4c420ad11f118919b8">initialise</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a> = <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#a0200ef30ec10c311cb9525f213d4ef0a">getBeamRInit</a>();</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a> = <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#a4b16975819f51cbdb8ca2c353245bb50">getBeamPRInit</a>();</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> = <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#a8ef0edd082f46879c4d1d2f68e1de63b">getBeamPhiInit</a>();</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span> (referenceTheta &lt;= -180.0 || referenceTheta &gt; 180.0) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;Error in ParallelCyclotronTracker::visitRing&quot;</span>,</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                            <span class="stringliteral">&quot;PHIINIT is out of [-180, 180)!&quot;</span>);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">referenceZ</a> = 0.0;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a> = 0.0;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> = <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>.<a class="code" href="../../dd/d3d/a05379.html#a27d86c12be3dc52a56c245ff36041871">getGamma</a>() * <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>.<a class="code" href="../../dd/d3d/a05379.html#a23dba80ac1c93b895b2d0b8748cbb739">getBeta</a>();</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a> = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> * <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> - <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a> * <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a>);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> &lt; 0.0)</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a> *= -1.0;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a7cc5ddca11d4cd71b4d89552202b1fe9">sinRefTheta_m</a> = <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(<a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> * <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>);</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a081ae478e143023617c95cafe9f673fa">cosRefTheta_m</a> = <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(<a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> * <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordtype">double</span> BcParameter[8] = {}; <span class="comment">// zero initialise array</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">buildupFieldList</a>(BcParameter, <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ae69b8a2544417fb71e2767e95d7ac8f3">ElementType::RING</a>, <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="comment">// Finally print some diagnostic</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Initial beam radius = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a> &lt;&lt; <span class="stringliteral">&quot; [mm] &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Initial gamma = &quot;</span> &lt;&lt; <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>.<a class="code" href="../../dd/d3d/a05379.html#a27d86c12be3dc52a56c245ff36041871">getGamma</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Initial beta  = &quot;</span> &lt;&lt; <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>.<a class="code" href="../../dd/d3d/a05379.html#a23dba80ac1c93b895b2d0b8748cbb739">getBeta</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Total reference momentum      = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> &lt;&lt; <span class="stringliteral">&quot; [beta gamma]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Reference azimuthal momentum  = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a> &lt;&lt; <span class="stringliteral">&quot; [beta gamma]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Reference radial momentum     = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a> &lt;&lt; <span class="stringliteral">&quot; [beta gamma]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#a5141747e3bf9da4ee7b286017b6adfca">getSymmetry</a>() &lt;&lt; <span class="stringliteral">&quot; fold field symmetry &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Harmonic number h = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ac6000b3bd09a98173421e5b3acfd61ce">getHarmonicNumber</a>() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;}</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a9cf653e8be3eb7677e701046bc036bee">  885</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a9cf653e8be3eb7677e701046bc036bee">ParallelCyclotronTracker::visitSBend</a>(<span class="keyword">const</span> <a class="code" href="../../de/d61/a05191.html">SBend</a>&amp; bend) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;In SBend; L = &quot;</span> &lt;&lt; bend.<a class="code" href="../../db/d78/a05071.html#a1b412456edcf01147abada7721605101">getElementLength</a>() &lt;&lt; <span class="stringliteral">&quot; however the element is missing &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;SBend*&gt;(bend.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>()));</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;}</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a63460f8e3ddd2a77a72dc14596f3fd31">  890</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a63460f8e3ddd2a77a72dc14596f3fd31">ParallelCyclotronTracker::visitSBend3D</a>(<span class="keyword">const</span> <a class="code" href="../../dc/d65/a05195.html">SBend3D</a>&amp; bend) {</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding SBend3D&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(bend);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitSBend3D&quot;</span>,</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use SBend3D element&quot;</span>);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;}</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a5d6eda26e94b2e41f1ed2d52a25f0a20">  899</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a5d6eda26e94b2e41f1ed2d52a25f0a20">ParallelCyclotronTracker::visitScalingFFAMagnet</a>(<span class="keyword">const</span> <a class="code" href="../../d4/ddd/a05199.html">ScalingFFAMagnet</a>&amp; bend) {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding ScalingFFAMagnet&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <a class="code" href="../../d4/ddd/a05199.html">ScalingFFAMagnet</a>* newBend = bend.<a class="code" href="../../d4/ddd/a05199.html#a31a30edca7049e4e81c95c6f13cb893a">clone</a>(); <span class="comment">// setup the end field, if required</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        newBend-&gt;<a class="code" href="../../d4/ddd/a05199.html#a05c4570febdda04fe828f91bd5da2f6f">setupEndField</a>();</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(*newBend);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitScalingFFAMagnet&quot;</span>,</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use ScalingFFAMagnet element&quot;</span>);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;}</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aead185c769e9dd9d311789b7eb986812">  916</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#aead185c769e9dd9d311789b7eb986812">ParallelCyclotronTracker::visitSeptum</a>(<span class="keyword">const</span> <a class="code" href="../../de/d1b/a05203.html">Septum</a>&amp; sept) {</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ----------------------------- Septum ----------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <a class="code" href="../../de/d1b/a05203.html">Septum</a>* elptr = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../de/d1b/a05203.html">Septum</a>*<span class="keyword">&gt;</span>(sept.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>());</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(elptr);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Name    = &quot;</span> &lt;&lt; elptr-&gt;<a class="code" href="../../db/d78/a05071.html#a07827d00308052e65fe03da558f0b987">getName</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordtype">double</span> xstart = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#adf03280be6438e40778b65c2b3292c05">getXStart</a>();</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* XStart  = &quot;</span> &lt;&lt; xstart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordtype">double</span> xend = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#ab06a614073fd7204b808e8c5d7a3d6bf">getXEnd</a>();</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* XEnd    = &quot;</span> &lt;&lt; xend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keywordtype">double</span> ystart = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#a454774d958ed90147fc9c397b61ace89">getYStart</a>();</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* YStart  = &quot;</span> &lt;&lt; ystart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="keywordtype">double</span> yend = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#ae40ca7b43fba6abcc1f3ffcaead4f0c0">getYEnd</a>();</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* YEnd    = &quot;</span> &lt;&lt; yend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordtype">double</span> width = elptr-&gt;<a class="code" href="../../de/d1b/a05203.html#ae8acecad5f598176c0a70cfbd4a0660a">getWidth</a>();</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Width   = &quot;</span> &lt;&lt; width &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="comment">// initialise, do nothing</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    elptr-&gt;<a class="code" href="../../de/d1b/a05203.html#a5948316cc5f6ad2f85722642b2b20e24">initialise</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordtype">double</span> BcParameter[8] = {};</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    BcParameter[0] = xstart;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    BcParameter[1] = xend;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    BcParameter[2] = ystart;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    BcParameter[3] = yend;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    BcParameter[4] = width;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">buildupFieldList</a>(BcParameter, <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a7017fe0dbc9f6646ba4165017bb61188">ElementType::SEPTUM</a>, elptr);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;}</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ac3eb901a612fc16285ae165132ead491">  958</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ac3eb901a612fc16285ae165132ead491">ParallelCyclotronTracker::visitSolenoid</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d42/a05207.html">Solenoid</a>&amp; solenoid) {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(dynamic_cast&lt;Solenoid*&gt;(solenoid.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>()));</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <a class="code" href="../../d2/d61/a05043.html">Component</a>* elptr = *(--<a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.end());</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">if</span> (!elptr-&gt;<a class="code" href="../../db/d78/a05071.html#a7fb38d50e1dbcd9bd946599ce92a4f0c">hasAttribute</a>(<span class="stringliteral">&quot;ELEMEDGE&quot;</span>)) {</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Solenoid: no position of the element given!&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    }</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;}</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a34dabf7195310ff30d7eb53c5aae8b2a">  972</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a34dabf7195310ff30d7eb53c5aae8b2a">ParallelCyclotronTracker::visitStripper</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d6e/a05227.html">Stripper</a>&amp; stripper) {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ----------------------------- Stripper --------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <a class="code" href="../../d3/d6e/a05227.html">Stripper</a>* elptr = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d3/d6e/a05227.html">Stripper</a>*<span class="keyword">&gt;</span>(stripper.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>());</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(elptr);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Name    = &quot;</span> &lt;&lt; elptr-&gt;<a class="code" href="../../db/d78/a05071.html#a07827d00308052e65fe03da558f0b987">getName</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordtype">double</span> xstart = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#adf03280be6438e40778b65c2b3292c05">getXStart</a>();</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* XStart  = &quot;</span> &lt;&lt; xstart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordtype">double</span> xend = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#ab06a614073fd7204b808e8c5d7a3d6bf">getXEnd</a>();</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* XEnd    = &quot;</span> &lt;&lt; xend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordtype">double</span> ystart = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#a454774d958ed90147fc9c397b61ace89">getYStart</a>();</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* YStart  = &quot;</span> &lt;&lt; ystart &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordtype">double</span> yend = elptr-&gt;<a class="code" href="../../df/daa/a05167.html#ae40ca7b43fba6abcc1f3ffcaead4f0c0">getYEnd</a>();</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* YEnd    = &quot;</span> &lt;&lt; yend &lt;&lt; <span class="stringliteral">&quot; [m]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordtype">double</span> opcharge = elptr-&gt;<a class="code" href="../../d3/d6e/a05227.html#a703e850c3e78170de72d534e3ef25407">getOPCharge</a>();</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Charge of outcoming particle = +e * &quot;</span> &lt;&lt; opcharge &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordtype">double</span> opmass = elptr-&gt;<a class="code" href="../../d3/d6e/a05227.html#a32ca46c196b5f6c698ee73f0a5756dd6">getOPMass</a>();</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Mass of the outcoming particle = &quot;</span> &lt;&lt; opmass &lt;&lt; <span class="stringliteral">&quot; [GeV/c^2]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordtype">bool</span> stop = elptr-&gt;<a class="code" href="../../d3/d6e/a05227.html#a8626fd8f2d1d09858cd793b0c8682ecc">getStop</a>();</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; std::boolalpha</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;* Particles stripped will be deleted after interaction -&gt; &quot;</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;          &lt;&lt; stop &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    elptr-&gt;<a class="code" href="../../df/daa/a05167.html#a471a9fee6c0fcb9881d6c2c539029f20">initialise</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordtype">double</span> BcParameter[8] = {};</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    BcParameter[0] = xstart;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    BcParameter[1] = xend;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    BcParameter[2] = ystart;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    BcParameter[3] = yend;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    BcParameter[4] = 1; <span class="comment">// width</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    BcParameter[5] = opcharge;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    BcParameter[6] = opmass;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">buildupFieldList</a>(BcParameter, <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ad4a12d5c2d08bdb4c5bcd2f8e022848b">ElementType::STRIPPER</a>, elptr);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;}</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a175afb2b6d9e0abdef6cc0bc895492af"> 1023</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a175afb2b6d9e0abdef6cc0bc895492af">ParallelCyclotronTracker::visitVacuum</a>(<span class="keyword">const</span> <a class="code" href="../../d8/da5/a05247.html">Vacuum</a>&amp; vac) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ----------------------------- Vacuum ----------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <a class="code" href="../../d8/da5/a05247.html">Vacuum</a>* elptr = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d8/da5/a05247.html">Vacuum</a>*<span class="keyword">&gt;</span>(vac.<a class="code" href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">clone</a>());</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">myElements</a>.push_back(elptr);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordtype">double</span> BcParameter[8] = {};</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    std::string gas = elptr-&gt;<a class="code" href="../../d8/da5/a05247.html#ac589044f04ff30a2db8624aeb668392d">getResidualGasName</a>();</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Residual gas = &quot;</span> &lt;&lt; gas &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordtype">double</span> pressure = elptr-&gt;<a class="code" href="../../d8/da5/a05247.html#a3639b06d73c88ac7dbc3c65f6a8e9fdf">getPressure</a>();</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">if</span> ( boost::filesystem::exists(elptr-&gt;<a class="code" href="../../d8/da5/a05247.html#a41950fa7fd3ac7d5a09fe4e6504e1a3d">getPressureMapFN</a>()) ) {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        std::string pmfn = elptr-&gt;<a class="code" href="../../d8/da5/a05247.html#a41950fa7fd3ac7d5a09fe4e6504e1a3d">getPressureMapFN</a>();</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Pressure field map file = &#39;&quot;</span> &lt;&lt; pmfn &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Default pressure = &quot;</span> &lt;&lt; pressure &lt;&lt; <span class="stringliteral">&quot; [mbar]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    } <span class="keywordflow">else</span>  {</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Pressure     = &quot;</span> &lt;&lt; pressure &lt;&lt; <span class="stringliteral">&quot; [mbar]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordtype">double</span> pscale = elptr-&gt;<a class="code" href="../../d8/da5/a05247.html#a5cab72da0ece717746981e431eb4921e">getPScale</a>();</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordtype">double</span> temperature = elptr-&gt;<a class="code" href="../../d8/da5/a05247.html#ab02e83ae85c9bd4892f288f789d1aa67">getTemperature</a>();</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Temperature  = &quot;</span> &lt;&lt; temperature &lt;&lt; <span class="stringliteral">&quot; [K]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordtype">bool</span> stop = elptr-&gt;<a class="code" href="../../d8/da5/a05247.html#ad8778701431190d5c21a63522597926d">getStop</a>();</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; std::boolalpha</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;* Particles stripped will be deleted after interaction -&gt; &quot;</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;          &lt;&lt; stop &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    elptr-&gt;<a class="code" href="../../d8/da5/a05247.html#a8970d257074406f814f74c6b5732dca7">initialise</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    BcParameter[0] = pressure;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    BcParameter[1] = pscale;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    BcParameter[2] = temperature;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">buildupFieldList</a>(BcParameter, <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a9a311ef6dad816cb7a15c0ab41920ad8">ElementType::VACUUM</a>, elptr);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;}</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aac2a3c841c93ac378818374c39d78259"> 1066</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#aac2a3c841c93ac378818374c39d78259">ParallelCyclotronTracker::visitVariableRFCavity</a>(<span class="keyword">const</span> <a class="code" href="../../d4/d19/a05251.html">VariableRFCavity</a>&amp; cav) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding Variable RF Cavity&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>)</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(cav);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitVariableRFCavity&quot;</span>,</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use VariableRFCavity element&quot;</span>);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;}</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a997b77714d998c12a08177fbb36ce8d8">ParallelCyclotronTracker::visitVariableRFCavityFringeField</a></div><div class="line"><a name="l01081"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a997b77714d998c12a08177fbb36ce8d8"> 1081</a></span>&#160;                                  (<span class="keyword">const</span> <a class="code" href="../../d5/d12/a05255.html">VariableRFCavityFringeField</a>&amp; cav) {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding Variable RF Cavity with Fringe Field&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="keywordflow">if</span> (opalRing_m != <span class="keyword">nullptr</span>)</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        opalRing_m-&gt;appendElement(cav);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitVariableRFCavityFringeField&quot;</span>,</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use VariableRFCavity element&quot;</span>);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;}</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ae7e0f3e536882efb116fda87c13182a7"> 1095</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ae7e0f3e536882efb116fda87c13182a7">ParallelCyclotronTracker::visitVerticalFFAMagnet</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d56/a05259.html">VerticalFFAMagnet</a>&amp; mag) {</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Adding Vertical FFA Magnet&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>)</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">appendElement</a>(mag);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::visitVerticalFFAMagnet&quot;</span>,</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                            <span class="stringliteral">&quot;Need to define a RINGDEFINITION to use VerticalFFAMagnet element&quot;</span>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;}</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050"> 1112</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">ParallelCyclotronTracker::buildupFieldList</a>(<span class="keywordtype">double</span> BcParameter[], <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8">ElementType</a> elementType, <a class="code" href="../../d2/d61/a05043.html">Component</a> *elptr) {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <a class="code" href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">beamline_list::iterator</a> sindex;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a7641697762900193c6d36224b2536be2">type_pair</a> *localpair = <span class="keyword">new</span> <a class="code" href="../../dd/dca/a04847.html#a7641697762900193c6d36224b2536be2">type_pair</a>();</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    localpair-&gt;first = elementType;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++)</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        *(((localpair-&gt;second).first) + i) = *(BcParameter + i);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    (localpair-&gt;second).second = elptr;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="comment">// always put cyclotron as the first element in the list.</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordflow">if</span> (elementType == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ae69b8a2544417fb71e2767e95d7ac8f3">ElementType::RING</a> || elementType == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a9b2455e659f96e1bd7c87cc69e99a08d">ElementType::CYCLOTRON</a>) {</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        sindex = <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin();</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        sindex = <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.end();</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    }</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.insert(sindex, localpair);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;}</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a52d3ff11669ab54939aad6613f5473ce"> 1137</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a52d3ff11669ab54939aad6613f5473ce">ParallelCyclotronTracker::visitBeamline</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d4e/a05623.html">Beamline</a>&amp; bl) {</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d9a/a05639.html">FlaggedBeamline</a>* fbl = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="../../d7/d9a/a05639.html">FlaggedBeamline</a>*<span class="keyword">&gt;</span>(&amp;bl);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    fbl-&gt;<a class="code" href="../../d7/d9a/a05639.html#af62c28499e8dcba75002d2904a3680c2">iterate</a>(*<span class="keyword">this</span>, <span class="keyword">false</span>);<span class="comment">//*dynamic_cast&lt;BeamlineVisitor *&gt;(this), false);</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ae3f431534cfc2b8d46fdd10d5cf48bed"> 1142</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ae3f431534cfc2b8d46fdd10d5cf48bed">ParallelCyclotronTracker::checkNumPart</a>(std::string s) {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="keywordtype">int</span> nlp = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>();</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordtype">int</span> minnlp = 0;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordtype">int</span> maxnlp = 111111;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <a class="code" href="../../d4/d5e/a03686.html#a6e1e71ee127405447f7411777d80ebd6">reduce</a>(nlp, minnlp, <a class="code" href="../../dd/d8b/a11311.html">OpMinAssign</a>());</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <a class="code" href="../../d4/d5e/a03686.html#a6e1e71ee127405447f7411777d80ebd6">reduce</a>(nlp, maxnlp, <a class="code" href="../../d1/de3/a11315.html">OpMaxAssign</a>());</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot;min local particle number: &quot;</span>&lt;&lt; minnlp &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;*                     max local particle number: &quot;</span> &lt;&lt; maxnlp &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;}</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a9f6d9025ab15ab632872ae46f9e2bde8"> 1153</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a9f6d9025ab15ab632872ae46f9e2bde8">ParallelCyclotronTracker::execute</a>() {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">      Initialize common variables and structures</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">      for the integrators</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;inRestartRun()) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;<a class="code" href="../../d5/d13/a04739.html#af6d424393543f1c7fcac662f91a6c6b3">setOpenMode</a>(<a class="code" href="../../d5/d13/a04739.html#ae42695bd5e1bea11211a45955b49abd3a375ffb668aa90f1c7fcae55e9734a752">OpalData::OpenMode::APPEND</a>);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    }</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a>          = 0;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a12108331551c11541ccd3e34b23a96f3">restartStep0_m</a>  = 0;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a>    = 1;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a140b8898b353d8a9df18c0bfb5b289d0">azimuth_m</a>       = -1.0;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#acc4f790cd7ac121d150eefac50cb2166">prevAzimuth_m</a>   = -1.0;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="comment">// Record how many bunches have already been injected. ONLY FOR MPM</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>())</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;setNumBunch(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a926547f8adc7ff91c3fe639f0fadccbf">getNumBunch</a>());</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#abe24adc3e8075fa31efcc433e82aa498">itsBeamline</a>-&gt;<a class="code" href="../../db/d78/a05071.html#a4c963794b96d83d5d3be0a9fe3c44322">accept</a>(*<span class="keyword">this</span>);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>)</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ad250951f169d59aeee3671b74f5e45ec">lockRing</a>();</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">// Display the selected elements</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ------------------------------------------------------------------------ *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* The selected Beam line elements are :&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> fd : <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>) {</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8">ElementType</a> <a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a> = fd-&gt;first;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* -&gt; &quot;</span> &lt;&lt;  <a class="code" href="../../db/d78/a05071.html#a98ba64b0bb174add064da5223a737a66">ElementBase::getTypeString</a>(<a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a>) &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a> == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ac04b3cc5b1a13dc2463b809070bbb67e">ElementType::RFCAVITY</a>) {</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            <a class="code" href="../../d7/d48/a05183.html">RFCavity</a>* cav = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d7/d48/a05183.html">RFCavity</a>*<span class="keyword">&gt;</span>((fd-&gt;second).second);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            <a class="code" href="../../d4/d06/a04843.html">CavityCrossData</a> ccd = {cav, cav-&gt;<a class="code" href="../../d7/d48/a05183.html#a95ab6fb74ae41fbf95b87845cee2804f">getSinAzimuth</a>(), cav-&gt;<a class="code" href="../../d7/d48/a05183.html#a58648e6c9265858963a0104398aa6e02">getCosAzimuth</a>(), cav-&gt;<a class="code" href="../../d7/d48/a05183.html#ac9dfec52bbe15f4bb6859b0d436dcf75">getPerpenDistance</a>() * <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a>};</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a8b82aeeeef07b0058ccc6869846a3a4e">cavCrossDatas_m</a>.push_back(ccd);</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a> == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ad8166b7d7c176c698b7b9f3418baae61">ElementType::CCOLLIMATOR</a> ||</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                    <a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a> == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a5a9b37d8d9e76a99e6f5160c3eff9057">ElementType::PROBE</a>       ||</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                    <a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a> == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a7017fe0dbc9f6646ba4165017bb61188">ElementType::SEPTUM</a>      ||</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                    <a class="code" href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">type</a> == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ad4a12d5c2d08bdb4c5bcd2f8e022848b">ElementType::STRIPPER</a>) {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            <a class="code" href="../../df/daa/a05167.html">PluginElement</a>* element = <span class="keyword">static_cast&lt;</span><a class="code" href="../../df/daa/a05167.html">PluginElement</a>*<span class="keyword">&gt;</span>((fd-&gt;second).second);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a040f281006efd0782b8f2cd4cdbc0919">pluginElements_m</a>.push_back(element);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        }</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ------------------------------------------------------------------------ *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="comment">// Get BoundaryGeometry that is already initialized</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab66a59fab6e56302c0302b72cffe8fd8">bgf_m</a> = <a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;<a class="code" href="../../d5/d13/a04739.html#ad8297e5d291eb54eef52a22af617cf64">getGlobalGeometry</a>();</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#ab66a59fab6e56302c0302b72cffe8fd8">bgf_m</a>)</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#aa8e2942513971f295590f723d4195fbb">lossDs_m</a> = std::unique_ptr&lt;LossDataSink&gt;(<span class="keyword">new</span> <a class="code" href="../../dd/d85/a06231.html">LossDataSink</a>(<a class="code" href="../../dd/dca/a04847.html#ab66a59fab6e56302c0302b72cffe8fd8">bgf_m</a>-&gt;<a class="code" href="../../dc/d12/a04723.html#a5ec68ba1c3f450f8ea2b139f193c5a39">getOpalName</a>(),!<a class="code" href="../../d7/d8b/a04549.html#a3c0b76e671a3771342d4f52b5e0d380d">Options::asciidump</a>));</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="comment">// External field arrays for dumping</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 2; k++)</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>[k] = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <a class="code" href="../../da/dd4/a04971.html#a6c9e6340b7162c18ed7bf5cb4c84028a">DumpFields::writeFields</a>((((*<a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin())-&gt;second).second));</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <a class="code" href="../../da/d70/a04967.html#a673b786efdbf5e7bedaeca06b4876c4a">DumpEMFields::writeFields</a>((((*<a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin())-&gt;second).second));</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a21683008920646c679e377129a243ac7">function_t</a> func = std::bind(&amp;<a class="code" href="../../dd/dca/a04847.html#a877030a63b8e5869cda18b26c0b2e208">ParallelCyclotronTracker::getFieldsAtPoint</a>,</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                                <span class="keyword">this</span>,</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                std::placeholders::_1,</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                                std::placeholders::_2,</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                                std::placeholders::_3,</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                                std::placeholders::_4);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordflow">switch</span> ( <a class="code" href="../../dd/dca/a04847.html#ac66e14b4b0f94b3b11529966874d0ed3">stepper_m</a> ) {</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560ca4e221daf5caa2f0381b6c964b65ffe50">Steppers::TimeIntegrator::LF2</a>: {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* 2nd order Leap-Frog integrator&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a8de6452f41159e2027fb4cd65d9519fc">itsStepper_mp</a>.reset(<span class="keyword">new</span> <a class="code" href="../../de/dd6/a07151.html">LF2&lt;function_t&gt;</a>(func));</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        }</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560ca51d4403ff33999735d10c625271637a7">Steppers::TimeIntegrator::MTS</a>: {</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Multiple time stepping (MTS) integrator&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560cabf3dcdc52206565bf9085180efe37ad9">Steppers::TimeIntegrator::RK4</a>:</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        <span class="keywordflow">default</span>: {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* 4th order Runge-Kutta integrator&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a8de6452f41159e2027fb4cd65d9519fc">itsStepper_mp</a>.reset(<span class="keyword">new</span> <a class="code" href="../../d3/db9/a07155.html">RK4&lt;function_t&gt;</a>(func));</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        }</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    }</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#ac66e14b4b0f94b3b11529966874d0ed3">stepper_m</a> == <a class="code" href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560ca51d4403ff33999735d10c625271637a7">Steppers::TimeIntegrator::MTS</a>) {</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a4aab9067e07fca841908971f333bb05d">MtsTracker</a>();</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad2016305c2bf533cd133bd453e57f7f0">GenericTracker</a>();</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    }</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ------------------------------------------------------------------------ *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Finalizing i.e. write data and close files :&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> fd : <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        ((fd-&gt;second).second)-&gt;finalise();</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ------------------------------------------------------------------------ *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;}</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a4aab9067e07fca841908971f333bb05d"> 1250</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a4aab9067e07fca841908971f333bb05d">ParallelCyclotronTracker::MtsTracker</a>() {</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">     * variable             unit        meaning</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">     * ------------------------------------------------</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">     * t                    [ns]        time</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">     * dt                   [ns]        time step</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">     * oldReferenceTheta    [rad]       azimuth angle</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">     * itsBunch_m-&gt;R        [m]         particle position</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordtype">double</span> t = 0, dt = 0, oldReferenceTheta = 0;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    std::tie(t, dt, oldReferenceTheta) = <a class="code" href="../../dd/dca/a04847.html#a7236d29b67e337d42854b34af3063d22">initializeTracking_m</a>();</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordtype">int</span> <span class="keyword">const</span> numSubsteps = <a class="code" href="../../d4/d5e/a03542.html#a418b01af7e1c6223e54608b7e75e0cf6">std::max</a>(<a class="code" href="../../d7/d8b/a04549.html#a0d65ff32cbccf95253dd6d8e4a92031d">Options::mtsSubsteps</a>, 1);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* MTS: Number of substeps per step is &quot;</span> &lt;&lt; numSubsteps &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> dt_inner = dt / double(numSubsteps);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* MTS: The inner time step is therefore &quot;</span> &lt;&lt; dt_inner &lt;&lt; <span class="stringliteral">&quot; [ns]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">//     int SteptoLastInj = itsBunch_m-&gt;getSteptoLastInj();</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordtype">bool</span> flagTransition = <span class="keyword">false</span>; <span class="comment">// flag to determine when to transit from single-bunch to multi-bunches mode</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ---------------------- Start tracking ---------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a61749a31a61cc801127ed1ea764d03ca">hasFieldSolver</a>() )</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a472a74c55259d687fd274dbeac60a53a">computeSpaceChargeFields_m</a>();</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="keywordflow">for</span> (; (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> &lt; <a class="code" href="../../dd/dca/a04847.html#af43c8be817f32734eb9683d693856bb4">maxSteps_m</a>) &amp;&amp; (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>()&gt;0); <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a>++) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="keywordtype">bool</span> finishedTurn = <span class="keyword">false</span>;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#a453b96859e7bdbd1f5df17f34f6981eb">Options::sptDumpFreq</a> == 0) {</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ae413f18725a0b8a5bef87f40d2c32f46">singleParticleDump</a>();</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        }</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../da/d49/a09219.html#ac4593203c34f26c625bd51c7502c297e">barrier</a>();</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="comment">// First half kick from space charge force</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a61749a31a61cc801127ed1ea764d03ca">hasFieldSolver</a>()) {</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a00bd119c89760f339a293b7c66b9cd55">kick</a>(0.5 * dt);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        }</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="comment">// Substeps for external field integration</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="../../d8/d25/a04596.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a> = 0; <a class="code" href="../../d8/d25/a04596.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a> &lt; numSubsteps; ++<a class="code" href="../../d8/d25/a04596.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a>)</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a666d11a4d347fdefa083a03ce36088b4">borisExternalFields</a>(dt_inner);</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="comment">// bunch injection</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="comment">// TODO: Where is correct location for this piece of code? Beginning/end of step? Before field solve?</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a31acc2346a133e5a834afddb1332a0f6">injectBunch</a>(flagTransition);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a61749a31a61cc801127ed1ea764d03ca">hasFieldSolver</a>() ) {</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a472a74c55259d687fd274dbeac60a53a">computeSpaceChargeFields_m</a>();</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            <span class="comment">// if field solver is not available , only update bunch, to transfer particles between nodes if needed,</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <span class="comment">// reset parameters such as LocalNum, initialTotalNum_m.</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            <span class="comment">// INFOMSG(&quot;No space charge Effects are included!&quot;&lt;&lt;endl;);</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#ab08b0e5cb95b53c6e80d36c884babd3a">Options::repartFreq</a> * 100) == 0) { <span class="comment">//TODO: why * 100?</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanP = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                <span class="keywordtype">double</span> <span class="keyword">const</span> phi = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanP(0), meanP(1)) - 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a>;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>();</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, meanR);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a270741b3a4a1bd7d6ff17a6ea690255b">updateNumTotal</a>();</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a10e0bca491e7f0692e75f0fc7922da07">repartition</a>();</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, meanR);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            }</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        }</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="comment">// Second half kick from space charge force</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a61749a31a61cc801127ed1ea764d03ca">hasFieldSolver</a>())</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a00bd119c89760f339a293b7c66b9cd55">kick</a>(0.5 * dt);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="comment">// recalculate bingamma and reset the BinID for each particles according to its current gamma</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() &amp;&amp; (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#ac6f115a7078d40475a6249e5dceb9345">Options::rebinFreq</a> == 0)) {</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;updateParticleBins(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        }</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <span class="comment">// dump some data after one push in single particle tracking</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> == <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0679273e201afd0bf57af3961f8a23b8">TrackingMode::SINGLE</a> ) {</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            <span class="keywordtype">double</span> temp_meanTheta = <a class="code" href="../../dd/dca/a04847.html#ad1fe10141777e52cb4a66fa9fbfa1f49">calculateAngle2</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](0),</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                                                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](1)); <span class="comment">// [-pi, pi]</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9ff9d61613dbb3f45737a245cb32a82a">dumpThetaEachTurn_m</a>(t, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i],</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                temp_meanTheta, finishedTurn);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a05279c9d1f4e62435bd0304a8de108f5">dumpAzimuthAngles_m</a>(t, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i],</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                                oldReferenceTheta, temp_meanTheta);</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            oldReferenceTheta = temp_meanTheta;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> == <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea4073a3520c889c260be3a79189cedb26">TrackingMode::BUNCH</a> ) {</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            <span class="comment">// both for single bunch and multi-bunch</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            <span class="comment">// avoid dump at the first step</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            <span class="comment">// finishedTurn has not been changed in first push</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#a4fdf924bb54c04c26a2ee6448fa01cae">isTurnDone</a>() ) {</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                ++<a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a>;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                finishedTurn = <span class="keyword">true</span>;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;*** Finished turn &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> - 1</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                      &lt;&lt; <span class="stringliteral">&quot;, Total number of live particles: &quot;</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                      &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;            }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            <span class="comment">// Recalculate bingamma and reset the BinID for each particles according to its current gamma</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() &amp;&amp; (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#ac6f115a7078d40475a6249e5dceb9345">Options::rebinFreq</a> == 0)) {</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;updateParticleBins(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            }</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        <span class="comment">// printing + updating bunch parameters + updating t</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a3efa96beca39db5e15c4b224d2596850">update_m</a>(t, dt, finishedTurn);</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    }</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="comment">// Some post-integration stuff</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ---------------------- DONE TRACKING PARTICLES ------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="comment">//FIXME</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a> Ttime = <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>();</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a> Tdeltr = <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>();</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a> Tdeltz = <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>();</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#affc8203b8ad033dd1672d1b8d0ab7e9f">ivector_t</a> TturnNumber = <a class="code" href="../../dd/dca/a04847.html#affc8203b8ad033dd1672d1b8d0ab7e9f">ivector_t</a>();</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a982b55a67be81156364fe1f8af54c4b2">finalizeTracking_m</a>(Ttime, Tdeltr, Tdeltz, TturnNumber);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;}</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ad2016305c2bf533cd133bd453e57f7f0"> 1383</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ad2016305c2bf533cd133bd453e57f7f0">ParallelCyclotronTracker::GenericTracker</a>() {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">     * variable             unit        meaning</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">     * ------------------------------------------------</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">     * t                    [ns]        time</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">     * dt                   [ns]        time step</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">     * oldReferenceTheta    [rad]       azimuth angle</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">     * itsBunch_m-&gt;R        [m]         particle position</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="comment">// Generic Tracker that has three modes defined by timeIntegrator_m:</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="comment">// 0 --- RK-4 (default)</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="comment">// 1 --- LF-2</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    <span class="comment">// (2 --- MTS ... not yet implemented in generic tracker)</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="comment">// mbHandler_m-&gt;getNumBunch() determines the number of bunches in multibunch mode (MBM, 1 for OFF)</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="comment">// Total number of particles determines single particle mode (SPM, 1 particle) or</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="comment">// Static Equilibrium Orbit Mode (SEO, 2 particles)</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordtype">double</span> t = 0, dt = 0, oldReferenceTheta = 0;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    std::tie(t, dt, oldReferenceTheta) = <a class="code" href="../../dd/dca/a04847.html#a7236d29b67e337d42854b34af3063d22">initializeTracking_m</a>();</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="comment">// If initialTotalNum_m = 2, trigger SEO mode and prepare for transverse tuning calculation</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="comment">// Where is the IF here? -DW</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a> Ttime, Tdeltr, Tdeltz;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#affc8203b8ad033dd1672d1b8d0ab7e9f">ivector_t</a> TturnNumber;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="comment">// Apply the plugin elements: probe, collimator, stripper, septum once before first step</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="keywordtype">bool</span> flagNeedUpdate = <a class="code" href="../../dd/dca/a04847.html#a68fea5657661817956cb8b52aecd44b0">applyPluginElements</a>(dt);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="comment">// Destroy particles if they are marked as Bin = -1 in the plugin elements</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="comment">// or out of global aperture</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ad7eecb45b13ecf2eb11bdc95c6a4f296">deleteParticle</a>(flagNeedUpdate);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">/********************************</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">     *     Main integration loop    *</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">     ********************************/</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ---------------------- Start tracking ---------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordflow">for</span> (; (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> &lt; <a class="code" href="../../dd/dca/a04847.html#af43c8be817f32734eb9683d693856bb4">maxSteps_m</a>) &amp;&amp; (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>()&gt;0); <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a>++) {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        <span class="keywordtype">bool</span> finishedTurn = <span class="keyword">false</span>;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a>) {</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ead88946b678e4c2f251d4e292e8142291">TrackingMode::SEO</a>: {</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                <span class="comment">// initialTotalNum_m == 2</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#af2afb9b11e96ae14c0f448d950b31ec1">seoMode_m</a>(t, dt, finishedTurn, Ttime, Tdeltr, Tdeltz, TturnNumber);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            }</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0679273e201afd0bf57af3961f8a23b8">TrackingMode::SINGLE</a>: {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                <span class="comment">// initialTotalNum_m == 1</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a3aa4e3f090e50a22880361f10775fff9">singleMode_m</a>(t, dt, finishedTurn, oldReferenceTheta);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            }</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea4073a3520c889c260be3a79189cedb26">TrackingMode::BUNCH</a>: {</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                <span class="comment">// initialTotalNum_m &gt; 2</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                <span class="comment">// Start Tracking for number of particles &gt; 2 (i.e. not single and not SEO mode)</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#aa1d62a6f0278bdacc6dc77ddec8a2e64">bunchMode_m</a>(t, dt, finishedTurn);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0db45d2a4141101bdfe48e3314cfbca3">TrackingMode::UNDEFINED</a>: {</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::GenericTracker()&quot;</span>,</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                                    <span class="stringliteral">&quot;No such tracking mode.&quot;</span>);</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;            }</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        <span class="comment">// Update bunch and some parameters and output some info</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a3efa96beca39db5e15c4b224d2596850">update_m</a>(t, dt, finishedTurn);</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    } <span class="comment">// end for: the integration is DONE after maxSteps_m steps or if all particles are lost!</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="comment">// Some post-integration stuff</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ---------------------- DONE TRACKING PARTICLES ------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a982b55a67be81156364fe1f8af54c4b2">finalizeTracking_m</a>(Ttime, Tdeltr, Tdeltz, TturnNumber);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;}</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a877030a63b8e5869cda18b26c0b2e208"> 1461</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a877030a63b8e5869cda18b26c0b2e208">ParallelCyclotronTracker::getFieldsAtPoint</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t, <span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; Pindex, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; Efield, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; Bfield) {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordtype">bool</span> outOfBound = this-&gt;<a class="code" href="../../dd/dca/a04847.html#a24e7de550ff5ade419fcd0838a026a3d">computeExternalFields_m</a>(Pindex, t, Efield, Bfield);</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="comment">// For runs without space charge effects, override this step to save time</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a61749a31a61cc801127ed1ea764d03ca">hasFieldSolver</a>()) {</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <span class="comment">// Don&#39;t do for reference particle</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[Pindex] != 0) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            <span class="comment">// add external Field and self space charge field</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;            Efield += <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a02869c9275595621525ce0adb352d6e1">Ef</a>[Pindex];</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            Bfield += <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aca40478a5171d91ec95f336b8f3fcfd2">Bf</a>[Pindex];</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        }</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    }</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">return</span> outOfBound;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;}</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a52d5fc95fde1a205343739362d465f36"> 1492</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a52d5fc95fde1a205343739362d465f36">ParallelCyclotronTracker::checkGapCross</a>(<a class="code" href="../../dd/d24/a07475.html">Vector_t</a> Rold, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> Rnew,</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                                             <a class="code" href="../../d7/d48/a05183.html">RFCavity</a> * rfcavity, <span class="keywordtype">double</span>&amp; Dold)</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;{</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="keywordtype">bool</span> flag = <span class="keyword">false</span>;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordtype">double</span> sinx = rfcavity-&gt;<a class="code" href="../../d7/d48/a05183.html#a95ab6fb74ae41fbf95b87845cee2804f">getSinAzimuth</a>();</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="keywordtype">double</span> cosx = rfcavity-&gt;<a class="code" href="../../d7/d48/a05183.html#a58648e6c9265858963a0104398aa6e02">getCosAzimuth</a>();</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="comment">// TODO: Presumably this is still in mm, so for now, change to m -DW</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordtype">double</span> PerpenDistance = <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * rfcavity-&gt;<a class="code" href="../../d7/d48/a05183.html#ac9dfec52bbe15f4bb6859b0d436dcf75">getPerpenDistance</a>();</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordtype">double</span> distNew = (Rnew[0] * sinx - Rnew[1] * cosx) - PerpenDistance;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordtype">double</span> distOld = (Rold[0] * sinx - Rold[1] * cosx) - PerpenDistance;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordflow">if</span> (distOld &gt; 0.0 &amp;&amp; distNew &lt;= 0.0) flag = <span class="keyword">true</span>;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="comment">// This parameter is used correct cavity phase</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    Dold = <a class="code" href="../../d0/d3d/a04539.html#a610458ef9e4cd6ea2d9b23bfddef69f8">Units::m2mm</a> * distOld;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="keywordflow">return</span> flag;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;}</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a5c507cc377b28df9b66a7b3831c2ed05"> 1508</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a5c507cc377b28df9b66a7b3831c2ed05">ParallelCyclotronTracker::RFkick</a>(<a class="code" href="../../d7/d48/a05183.html">RFCavity</a> * rfcavity, <span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> <span class="keywordtype">double</span> dt, <span class="keyword">const</span> <span class="keywordtype">int</span> Pindex){</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="comment">// For OPAL 2.0: As long as the RFCavity is in mm, we have to change R to mm here -DW</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordtype">double</span> radius = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../dc/d2c/a00893.html#a6dcaf0865921eacb4895202a9de28592">std::pow</a>(<a class="code" href="../../d0/d3d/a04539.html#a610458ef9e4cd6ea2d9b23bfddef69f8">Units::m2mm</a> * <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[Pindex](0), 2.0) + <a class="code" href="../../dc/d2c/a00893.html#a6dcaf0865921eacb4895202a9de28592">std::pow</a>(<a class="code" href="../../d0/d3d/a04539.html#a610458ef9e4cd6ea2d9b23bfddef69f8">Units::m2mm</a> * <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[Pindex](1), 2.0)</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                         - <a class="code" href="../../dc/d2c/a00893.html#a6dcaf0865921eacb4895202a9de28592">std::pow</a>(rfcavity-&gt;<a class="code" href="../../d7/d48/a05183.html#ac9dfec52bbe15f4bb6859b0d436dcf75">getPerpenDistance</a>() , 2.0));</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="keywordtype">double</span> rmin = rfcavity-&gt;<a class="code" href="../../d7/d48/a05183.html#af90ea0cd7726b5fdb17082c0f702588a">getRmin</a>();</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keywordtype">double</span> rmax = rfcavity-&gt;<a class="code" href="../../d7/d48/a05183.html#a06eb3e02d5e9c26cb967de237b1e41ad">getRmax</a>();</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordtype">double</span> nomalRadius = (radius - rmin) / (rmax - rmin);</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="keywordtype">double</span> tempP[3];</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">if</span> (nomalRadius &lt;= 1.0 &amp;&amp; nomalRadius &gt;= 0.0) {</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;            tempP[j] = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[Pindex](j);  <span class="comment">//[px,py,pz]  units: dimensionless</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        <span class="comment">// here evaluate voltage and conduct momenta kicking;</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        rfcavity-&gt;<a class="code" href="../../d7/d48/a05183.html#a08878a675b003ca43d8c316788837260">getMomentaKick</a>(nomalRadius, tempP, t, dt, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[Pindex], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af51331c43ea82142dd6d237e6e3e5bfd">getM</a>(), <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a16508077c3f6403314e7923dc74e06f9">getQ</a>()); <span class="comment">// t : ns</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++)</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[Pindex](j) = tempP[j];</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    }</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;}</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"><a class="line" href="../../d4/d10/a04839.html"> 1532</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/d10/a04839.html">adder</a> {</div><div class="line"><a name="l01533"></a><span class="lineno"><a class="line" href="../../d4/d10/a04839.html#a9bcc218cddc435e790b3bb7d2b465814"> 1533</a></span>&#160;    <a class="code" href="../../d4/d10/a04839.html#a9bcc218cddc435e790b3bb7d2b465814">adder</a>() : <a class="code" href="../../d4/d10/a04839.html#a2b4258527c3fb536008df49e74c90480">sum</a>(0) {}</div><div class="line"><a name="l01534"></a><span class="lineno"><a class="line" href="../../d4/d10/a04839.html#a2b4258527c3fb536008df49e74c90480"> 1534</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d4/d10/a04839.html#a2b4258527c3fb536008df49e74c90480">sum</a>;</div><div class="line"><a name="l01535"></a><span class="lineno"><a class="line" href="../../d4/d10/a04839.html#a9584a540808ca5c5dcb70648fba7a27a"> 1535</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d4/d10/a04839.html#a9584a540808ca5c5dcb70648fba7a27a">operator()</a>(<span class="keywordtype">double</span> x) { <a class="code" href="../../d4/d10/a04839.html#a2b4258527c3fb536008df49e74c90480">sum</a> += x; }</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;};</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#adeaccb2d7a0aac369969c8f7b7a6a7c7"> 1550</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#adeaccb2d7a0aac369969c8f7b7a6a7c7">ParallelCyclotronTracker::getTunes</a>(<a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; t, <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; r, <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; z,</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;                                        <span class="keywordtype">int</span> lastTurn, <span class="keywordtype">double</span>&amp; <span class="comment">/*nur*/</span>, <span class="keywordtype">double</span>&amp; <span class="comment">/*nuz*/</span>) {</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <a class="code" href="../../d9/d61/a04775.html">TUNE_class</a> *tune;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="keywordtype">int</span> Ndat = t.size();</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment">      remove mean</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="keywordtype">double</span> rsum =  <a class="code" href="../../d4/d4b/a03464.html#a3099ce8a1a14a88e0a9476f23a62046b">for_each</a>(r.begin(), r.end(), <a class="code" href="../../d4/d10/a04839.html">adder</a>()).<a class="code" href="../../d5/d12/a03851.html#a06dc3d53220b680f16b2c655bcb86a40">sum</a>;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Ndat; i++)</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        r[i] -= rsum;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keywordtype">double</span> zsum =  <a class="code" href="../../d4/d4b/a03464.html#a3099ce8a1a14a88e0a9476f23a62046b">for_each</a>(z.begin(), z.end(), <a class="code" href="../../d4/d10/a04839.html">adder</a>()).<a class="code" href="../../d5/d12/a03851.html#a06dc3d53220b680f16b2c655bcb86a40">sum</a>;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Ndat; i++)</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        z[i] -= zsum;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordtype">double</span> ti = *(t.begin());</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordtype">double</span> tf = t[t.size()-1];</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="../../d6/daf/a05323.html#a057172529af54894134f41e521014af0ae1e0af60f17fb4443908f0d9b4bb0344">T</a> = (tf - ti);</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    t.clear();</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; Ndat; i++) {</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        t.push_back(i);</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    }</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <a class="code" href="../../d6/daf/a05323.html#a057172529af54894134f41e521014af0ae1e0af60f17fb4443908f0d9b4bb0344">T</a> = t[Ndat-1];</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ************************************* nuR ******************************************* *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* ===&gt; &quot;</span> &lt;&lt; Ndat &lt;&lt; <span class="stringliteral">&quot; data points  Ti=&quot;</span> &lt;&lt; ti &lt;&lt; <span class="stringliteral">&quot; Tf= &quot;</span> &lt;&lt; tf &lt;&lt; <span class="stringliteral">&quot; -&gt; T= &quot;</span> &lt;&lt; <a class="code" href="../../d6/daf/a05323.html#a057172529af54894134f41e521014af0ae1e0af60f17fb4443908f0d9b4bb0344">T</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="keywordtype">int</span> nhis_lomb = 10;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="keywordtype">int</span>  stat = 0;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="comment">// book tune class</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    tune = <span class="keyword">new</span> <a class="code" href="../../d9/d61/a04775.html">TUNE_class</a>();</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    stat = tune-&gt;<a class="code" href="../../d9/d61/a04775.html#a5f6ee191b9e0eed7b2b66e75f3d502f3">lombAnalysis</a>(t, r, nhis_lomb, <a class="code" href="../../d6/daf/a05323.html#a057172529af54894134f41e521014af0ae1e0af60f17fb4443908f0d9b4bb0344">T</a> / lastTurn);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <span class="keywordflow">if</span> (stat != 0)</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* TUNE: Lomb analysis failed&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ************************************************************************************* *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <span class="keyword">delete</span> tune;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    tune = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="comment">// FIXME: FixMe: need to come from the inputfile</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    nhis_lomb = 100;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;    <span class="keywordflow">if</span> (zsum != 0.0) {</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ************************************* nuZ ******************************************* *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* ===&gt; &quot;</span> &lt;&lt; Ndat &lt;&lt; <span class="stringliteral">&quot; data points  Ti=&quot;</span> &lt;&lt; ti &lt;&lt; <span class="stringliteral">&quot; Tf= &quot;</span> &lt;&lt; tf &lt;&lt; <span class="stringliteral">&quot; -&gt; T= &quot;</span> &lt;&lt; <a class="code" href="../../d6/daf/a05323.html#a057172529af54894134f41e521014af0ae1e0af60f17fb4443908f0d9b4bb0344">T</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="comment">// book tune class</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        tune = <span class="keyword">new</span> <a class="code" href="../../d9/d61/a04775.html">TUNE_class</a>();</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        stat = tune-&gt;<a class="code" href="../../d9/d61/a04775.html#a5f6ee191b9e0eed7b2b66e75f3d502f3">lombAnalysis</a>(t, z, nhis_lomb, <a class="code" href="../../d6/daf/a05323.html#a057172529af54894134f41e521014af0ae1e0af60f17fb4443908f0d9b4bb0344">T</a> / lastTurn);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <span class="keywordflow">if</span> (stat != 0)</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* TUNE: Lomb analysis failed&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ************************************************************************************* *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        <span class="keyword">delete</span> tune;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        tune = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    }</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;}</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a4951f43b20c6936bb3d15859a26a4932"> 1617</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../dd/dca/a04847.html#a4951f43b20c6936bb3d15859a26a4932">ParallelCyclotronTracker::getHarmonicNumber</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a> != <span class="keyword">nullptr</span>)</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">opalRing_m</a>-&gt;<a class="code" href="../../db/d48/a05187.html#ac6000b3bd09a98173421e5b3acfd61ce">getHarmonicNumber</a>();</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <a class="code" href="../../d6/de9/a05059.html">Cyclotron</a>* elcycl = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d6/de9/a05059.html">Cyclotron</a>*<span class="keyword">&gt;</span>(((*<a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin())-&gt;second).second);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <span class="keywordflow">if</span> (elcycl != <span class="keyword">nullptr</span>)</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        <span class="keywordflow">return</span> elcycl-&gt;<a class="code" href="../../d6/de9/a05059.html#a098ca2acb3fa6876ab88acb644665708">getCyclHarm</a>();</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::getHarmonicNumber()&quot;</span>,</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                        std::string(<span class="stringliteral">&quot;The first item in the FieldDimensions list does not &quot;</span>)</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                        +std::string(<span class="stringliteral">&quot;seem to be a Ring or a Cyclotron element&quot;</span>));</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;}</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div><div class="line"><a name="l01629"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4"> 1629</a></span>&#160;<a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">ParallelCyclotronTracker::calcMeanR</a>(<span class="keywordtype">short</span> bunchNr)<span class="keyword"> const </span>{</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanR(0.0, 0.0, 0.0);</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;        <span class="comment">// take all particles if bunchNr &lt;= -1</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        <span class="keywordflow">if</span> ( bunchNr &gt; -1 &amp;&amp; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ac035c07285b91e2eac59fe13e0013d20">bunchNum</a>[i] != bunchNr)</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; 3; ++d) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            meanR(d) += <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](d);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        }</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    }</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <a class="code" href="../../d4/d5e/a03686.html#a6e1e71ee127405447f7411777d80ebd6">reduce</a>(meanR, meanR, <a class="code" href="../../dc/dc9/a11819.html">OpAddAssign</a>());</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="../../d8/d25/a04596.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a> = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>();</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <span class="keywordflow">if</span> ( bunchNr &gt; -1 )</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        <a class="code" href="../../d8/d25/a04596.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a> = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a80253d8da2e44f1c729d52f685a11918">getTotalNumPerBunch</a>(bunchNr);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="keywordflow">return</span> meanR / <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(<a class="code" href="../../d8/d25/a04596.html#a5c17dec4af54fc8232e6bbd18a28804a">n</a>);</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;}</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a"> 1652</a></span>&#160;<a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">ParallelCyclotronTracker::calcMeanP</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanP(0.0, 0.0, 0.0);</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; 3; ++d) {</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            meanP(d) += <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](d);</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        }</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    }</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <a class="code" href="../../d4/d5e/a03686.html#a6e1e71ee127405447f7411777d80ebd6">reduce</a>(meanP, meanP, <a class="code" href="../../dc/dc9/a11819.html">OpAddAssign</a>());</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="keywordflow">return</span> meanP / <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>());</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;}</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;</div><div class="line"><a name="l01665"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a10e0bca491e7f0692e75f0fc7922da07"> 1665</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a10e0bca491e7f0692e75f0fc7922da07">ParallelCyclotronTracker::repartition</a>() {</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#ab08b0e5cb95b53c6e80d36c884babd3a">Options::repartFreq</a>) == 0) {</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a7b7de46cb5ba096d06787417babe02ac">BinRepartTimer_m</a>);</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a9703f915aa5424bbf6e0ffeaa026efaa">do_binaryRepart</a>();</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../da/d49/a09219.html#ac4593203c34f26c625bd51c7502c297e">barrier</a>();</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a7b7de46cb5ba096d06787417babe02ac">BinRepartTimer_m</a>);</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    }</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;}</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c"> 1674</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">ParallelCyclotronTracker::globalToLocal</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors,</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                                             <span class="keywordtype">double</span> phi, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> translationToGlobal) {</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    particleVectors -= translationToGlobal;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <a class="code" href="../../db/de3/a05387.html">Tenzor&lt;double, 3&gt;</a> <span class="keyword">const</span> rotation( <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(phi), <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(phi), 0,</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                                      -<a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(phi), <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(phi), 0,</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                                      0,        0, 1); <span class="comment">// clockwise rotation</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        particleVectors[i] = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(rotation, particleVectors[i]);</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    }</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;}</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047"> 1690</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">ParallelCyclotronTracker::localToGlobal</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors,</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                                             <span class="keywordtype">double</span> phi, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> translationToGlobal) {</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <a class="code" href="../../db/de3/a05387.html">Tenzor&lt;double, 3&gt;</a> <span class="keyword">const</span> rotation(<a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(phi), -<a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(phi), 0,</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                                     <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(phi),  <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(phi), 0,</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                                     0,         0, 1); <span class="comment">// counter-clockwise rotation</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        particleVectors[i] = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(rotation, particleVectors[i]);</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    }</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    particleVectors += translationToGlobal;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;}</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a4b7b31edc4ca317e5106368a8e8303e2"> 1707</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">ParallelCyclotronTracker::globalToLocal</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors,</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                                                    <a class="code" href="../../d2/dc7/a05391.html">Quaternion_t</a> <span class="keyword">const</span> quaternion,</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                                                    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR) {</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="comment">// Translation from global to local</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    particleVectors -= meanR;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="comment">// Rotation to align P_mean with x-axis</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aba83f00e82d1cb7ae648db1c9c77c9d1">rotateWithQuaternion</a>(particleVectors, quaternion);</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;}</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aa32a172d4ec417d1b9018f48a8df8177"> 1720</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">ParallelCyclotronTracker::localToGlobal</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors,</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                                                    <a class="code" href="../../d2/dc7/a05391.html">Quaternion_t</a> <span class="keyword">const</span> quaternion,</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                                                    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR) {</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="comment">// Reverse the quaternion by multiplying the axis components (x,y,z) with -1</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <a class="code" href="../../d2/dc7/a05391.html">Quaternion_t</a> reverseQuaternion = quaternion * -1.0;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    reverseQuaternion(0) *= -1.0;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="comment">// Rotation back to original P_mean direction</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aba83f00e82d1cb7ae648db1c9c77c9d1">rotateWithQuaternion</a>(particleVectors, reverseQuaternion);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <span class="comment">// Translation from local to global</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    particleVectors += meanR;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;}</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a44d6529e19733c6779280aa9a664a89a"> 1736</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">ParallelCyclotronTracker::globalToLocal</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors,</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                                                    <span class="keywordtype">double</span> <span class="keyword">const</span> phi,</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                                                    <span class="keywordtype">double</span> <span class="keyword">const</span> psi,</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                                                    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR) {</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="comment">//double const tolerance = 1.0e-4; // TODO What is a good angle threshold? -DW</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="comment">// Translation from global to local</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    particleVectors -= meanR;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="comment">// Rotation to align P_mean with x-axis</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a3451f8fb01e84fc30d0525dd8e3becff">rotateAroundZ</a>(particleVectors, phi);</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="comment">// If theta is large enough (i.e. there is significant momentum in z direction)</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="comment">// rotate around x-axis next</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="comment">//if (fabs(psi) &gt; tolerance)</span></div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a498ce8d32ed882ab5642bf2fc22341fc">rotateAroundX</a>(particleVectors, psi);</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;}</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div><div class="line"><a name="l01757"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a209f1e92cd6746e3d76cf0ed213f4538"> 1757</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">ParallelCyclotronTracker::globalToLocal</a>(<a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; myVector,</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                                                    <span class="keywordtype">double</span> <span class="keyword">const</span> phi,</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                                                    <span class="keywordtype">double</span> <span class="keyword">const</span> psi,</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                                                    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR) {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="comment">//double const tolerance = 1.0e-4; // TODO What is a good angle threshold? -DW</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="comment">// Translation from global to local</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    myVector -= meanR;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="comment">// Rotation to align P_mean with x-axis</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a3451f8fb01e84fc30d0525dd8e3becff">rotateAroundZ</a>(myVector, phi);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="comment">// If theta is large enough (i.e. there is significant momentum in z direction)</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    <span class="comment">// rotate around x-axis next</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    <span class="comment">//if (fabs(psi) &gt; tolerance)</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a498ce8d32ed882ab5642bf2fc22341fc">rotateAroundX</a>(myVector, psi);</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;}</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div><div class="line"><a name="l01778"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ac7b89336be871ea40db6e104a0d96c28"> 1778</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">ParallelCyclotronTracker::localToGlobal</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors,</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                                                    <span class="keywordtype">double</span> <span class="keyword">const</span> phi,</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                                                    <span class="keywordtype">double</span> <span class="keyword">const</span> psi,</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;                                                    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR) {</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="comment">//double const tolerance = 1.0e-4; // TODO What is a good angle threshold? -DW</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    <span class="comment">// If theta is large enough (i.e. there is significant momentum in z direction)</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    <span class="comment">// rotate back around x-axis next</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="comment">//if (fabs(psi) &gt; tolerance)</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a498ce8d32ed882ab5642bf2fc22341fc">rotateAroundX</a>(particleVectors, -psi);</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    <span class="comment">// Rotation to align P_mean with x-axis</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a3451f8fb01e84fc30d0525dd8e3becff">rotateAroundZ</a>(particleVectors, -phi);</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    <span class="comment">// Translation from local to global</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    particleVectors += meanR;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;}</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aabc9e58f40328f5da0b4bae1b582fadb"> 1799</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">ParallelCyclotronTracker::localToGlobal</a>(<a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; myVector,</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                                                    <span class="keywordtype">double</span> <span class="keyword">const</span> phi,</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;                                                    <span class="keywordtype">double</span> <span class="keyword">const</span> psi,</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                                                    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR) {</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="comment">//double const tolerance = 1.0e-4; // TODO What is a good angle threshold? -DW</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    <span class="comment">// If theta is large enough (i.e. there is significant momentum in z direction)</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="comment">// rotate back around x-axis next</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="comment">//if (fabs(psi) &gt; tolerance)</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a498ce8d32ed882ab5642bf2fc22341fc">rotateAroundX</a>(myVector, -psi);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    <span class="comment">// Rotation to align P_mean with x-axis</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a3451f8fb01e84fc30d0525dd8e3becff">rotateAroundZ</a>(myVector, -phi);</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    <span class="comment">// Translation from local to global</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    myVector += meanR;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">TransformTimer_m</a>);</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;}</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;</div><div class="line"><a name="l01820"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aba83f00e82d1cb7ae648db1c9c77c9d1"> 1820</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#aba83f00e82d1cb7ae648db1c9c77c9d1">ParallelCyclotronTracker::rotateWithQuaternion</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors, <a class="code" href="../../d2/dc7/a05391.html">Quaternion_t</a> <span class="keyword">const</span> quaternion) {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> quaternionVectorComponent = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(quaternion(1), quaternion(2), quaternion(3));</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> quaternionScalarComponent = quaternion(0);</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        particleVectors[i] = 2.0f * <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(quaternionVectorComponent, particleVectors[i]) * quaternionVectorComponent +</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            (quaternionScalarComponent * quaternionScalarComponent -</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;             <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(quaternionVectorComponent, quaternionVectorComponent)) * particleVectors[i] + 2.0f *</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            quaternionScalarComponent * <a class="code" href="../../d3/d53/a01262.html#a01046d3dab4c1e9ad6b2b6dee8cc8310">cross</a>(quaternionVectorComponent, particleVectors[i]);</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    }</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;}</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a36d5e16ad9f038941a636c32096863cf"> 1834</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a36d5e16ad9f038941a636c32096863cf">ParallelCyclotronTracker::normalizeQuaternion</a>(<a class="code" href="../../d2/dc7/a05391.html">Quaternion_t</a>&amp; quaternion){</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <span class="keywordtype">double</span> tolerance = 1.0e-10;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <span class="keywordtype">double</span> length2 = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(quaternion, quaternion);</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d6b/a03845.html#a7633e9416cb6fdd16745f5ba3e3ea7d3">std::abs</a>(length2) &gt; tolerance &amp;&amp; <a class="code" href="../../de/d6b/a03845.html#a7633e9416cb6fdd16745f5ba3e3ea7d3">std::abs</a>(length2 - 1.0f) &gt; tolerance) {</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        <span class="keywordtype">double</span> length = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(length2);</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        quaternion /= length;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    }</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;}</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div><div class="line"><a name="l01846"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a58aca05163adeaae3cf39bb3a2734726"> 1846</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a58aca05163adeaae3cf39bb3a2734726">ParallelCyclotronTracker::normalizeVector</a>(<a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; vector) {</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    <span class="keywordtype">double</span> tolerance = 1.0e-10;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <span class="keywordtype">double</span> length2 = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(vector, vector);</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d6b/a03845.html#a7633e9416cb6fdd16745f5ba3e3ea7d3">std::abs</a>(length2) &gt; tolerance &amp;&amp; <a class="code" href="../../de/d6b/a03845.html#a7633e9416cb6fdd16745f5ba3e3ea7d3">std::abs</a>(length2 - 1.0f) &gt; tolerance) {</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        <span class="keywordtype">double</span> length = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(length2);</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        vector /= length;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    }</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;}</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a3451f8fb01e84fc30d0525dd8e3becff"> 1858</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a3451f8fb01e84fc30d0525dd8e3becff">ParallelCyclotronTracker::rotateAroundZ</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors, <span class="keywordtype">double</span> <span class="keyword">const</span> phi) {</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="comment">// Clockwise rotation of particles &#39;particleVectors&#39; by &#39;phi&#39; around Z axis</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <a class="code" href="../../db/de3/a05387.html">Tenzor&lt;double, 3&gt;</a> <span class="keyword">const</span> rotation( <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(phi), <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(phi), 0,</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                                      -<a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(phi), <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(phi), 0,</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                                      0,        0, 1);</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        particleVectors[i] = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(rotation, particleVectors[i]);</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    }</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;}</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div><div class="line"><a name="l01870"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aeec997bbc4ba8b6f4da4e68459e8d407"> 1870</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a3451f8fb01e84fc30d0525dd8e3becff">ParallelCyclotronTracker::rotateAroundZ</a>(<a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; myVector, <span class="keywordtype">double</span> <span class="keyword">const</span> phi) {</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    <span class="comment">// Clockwise rotation of single vector &#39;myVector&#39; by &#39;phi&#39; around Z axis</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <a class="code" href="../../db/de3/a05387.html">Tenzor&lt;double, 3&gt;</a> <span class="keyword">const</span> rotation( <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(phi), <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(phi), 0,</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                                      -<a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(phi), <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(phi), 0,</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                                      0,        0, 1);</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    myVector = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(rotation, myVector);</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;}</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;</div><div class="line"><a name="l01880"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a498ce8d32ed882ab5642bf2fc22341fc"> 1880</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a498ce8d32ed882ab5642bf2fc22341fc">ParallelCyclotronTracker::rotateAroundX</a>(<a class="code" href="../../d0/d37/a08231.html">ParticleAttrib&lt;Vector_t&gt;</a>&amp; particleVectors, <span class="keywordtype">double</span> <span class="keyword">const</span> psi) {</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="comment">// Clockwise rotation of particles &#39;particleVectors&#39; by &#39;psi&#39; around X axis</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <a class="code" href="../../db/de3/a05387.html">Tenzor&lt;double, 3&gt;</a> <span class="keyword">const</span> rotation(1,  0,          0,</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                                     0,  <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(psi), <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(psi),</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                                     0, -<a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(psi), <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(psi));</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        particleVectors[i] = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(rotation, particleVectors[i]);</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    }</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;}</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div><div class="line"><a name="l01893"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a52b5e6c7a67e4fe141345145fe241fc1"> 1893</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a498ce8d32ed882ab5642bf2fc22341fc">ParallelCyclotronTracker::rotateAroundX</a>(<a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; myVector, <span class="keywordtype">double</span> <span class="keyword">const</span> psi) {</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <span class="comment">// Clockwise rotation of single vector &#39;myVector&#39; by &#39;psi&#39; around X axis</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <a class="code" href="../../db/de3/a05387.html">Tenzor&lt;double, 3&gt;</a> <span class="keyword">const</span> rotation(1,  0,          0,</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                                     0,  <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(psi), <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(psi),</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                                     0, -<a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(psi), <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(psi));</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    myVector = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(rotation, myVector);</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;}</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div><div class="line"><a name="l01903"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a9a8843522ab0b1e76f7f19411df5b790"> 1903</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a9a8843522ab0b1e76f7f19411df5b790">ParallelCyclotronTracker::getQuaternionTwoVectors</a>(<a class="code" href="../../dd/d24/a07475.html">Vector_t</a> u, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> v, <a class="code" href="../../d2/dc7/a05391.html">Quaternion_t</a>&amp; quaternion) {</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <span class="comment">// four vector (w,x,y,z) of the quaternion of P_mean with the positive x-axis</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a58aca05163adeaae3cf39bb3a2734726">normalizeVector</a>(u);</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a58aca05163adeaae3cf39bb3a2734726">normalizeVector</a>(v);</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keywordtype">double</span> k_cos_theta = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(u, v);</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    <span class="keywordtype">double</span> k = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(u, u) * <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(v, v));</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="keywordtype">double</span> tolerance1 = 1.0e-5;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <span class="keywordtype">double</span> tolerance2 = 1.0e-8;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> resultVectorComponent;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d6b/a03845.html#a7633e9416cb6fdd16745f5ba3e3ea7d3">std::abs</a>(k_cos_theta / k + 1.0) &lt; tolerance1) {</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        <span class="comment">// u and v are almost exactly antiparallel so we need to do</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <span class="comment">// 180 degree rotation around any vector orthogonal to u</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        resultVectorComponent = <a class="code" href="../../d3/d53/a01262.html#a01046d3dab4c1e9ad6b2b6dee8cc8310">cross</a>(u, <a class="code" href="../../dd/dca/a04847.html#a156606fbe21eefb03894cb3015bc976e">xaxis</a>);</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <span class="comment">// If by chance u is parallel to xaxis, use zaxis instead</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(resultVectorComponent, resultVectorComponent) &lt; tolerance2) {</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;            resultVectorComponent = <a class="code" href="../../d3/d53/a01262.html#a01046d3dab4c1e9ad6b2b6dee8cc8310">cross</a>(u, <a class="code" href="../../dd/dca/a04847.html#a83bc3db8fa4db57db2910ff920cd5858">zaxis</a>);</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        }</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        <span class="keywordtype">double</span> halfAngle = 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a>;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="keywordtype">double</span> sinHalfAngle = <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(halfAngle);</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        resultVectorComponent *= sinHalfAngle;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        k = 0.0;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;        k_cos_theta = <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(halfAngle);</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        resultVectorComponent = <a class="code" href="../../d3/d53/a01262.html#a01046d3dab4c1e9ad6b2b6dee8cc8310">cross</a>(u, v);</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    }</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    quaternion(0) = k_cos_theta + k;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    quaternion(1) = resultVectorComponent(0);</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    quaternion(2) = resultVectorComponent(1);</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    quaternion(3) = resultVectorComponent(2);</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a36d5e16ad9f038941a636c32096863cf">normalizeQuaternion</a>(quaternion);</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;}</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;</div><div class="line"><a name="l01947"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a81ae54fff64696e717e2d5f8c5993ec1"> 1947</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a81ae54fff64696e717e2d5f8c5993ec1">ParallelCyclotronTracker::push</a>(<span class="keywordtype">double</span> h) {</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <span class="comment">/* h   [ns]</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment">     * dt1 [ns]</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment">     * dt2 [ns]</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    h *= <a class="code" href="../../d0/d3d/a04539.html#a749503871b5f00aac95bd6fe1071fdd5">Units::ns2s</a>;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="keywordtype">bool</span> flagNeedUpdate = <span class="keyword">false</span>;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> oldR = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i];</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> gamma = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(1.0 + <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i]));</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> c_gamma = <a class="code" href="../../d4/dd0/a04537.html#ad8fcab196be0672fdc6e1f091b9bb01a">Physics::c</a> / gamma;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> v = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i] * c_gamma;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i] += h * v;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp; ccd : <a class="code" href="../../dd/dca/a04847.html#a8b82aeeeef07b0058ccc6869846a3a4e">cavCrossDatas_m</a>) {</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;            <span class="keywordtype">double</span> <span class="keyword">const</span> distNew = (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i][0] * ccd.sinAzimuth - <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i][1] * ccd.cosAzimuth) - ccd.perpenDistance;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;            <span class="keywordtype">bool</span> tagCrossing = <span class="keyword">false</span>;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;            <span class="keywordtype">double</span> distOld;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;            if (distNew &lt;= 0.0) {</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                distOld = (oldR[0] * ccd.sinAzimuth - oldR[1] * ccd.cosAzimuth) - ccd.perpenDistance;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                if (distOld &gt; 0.0) tagCrossing = <span class="keyword">true</span>;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;            }</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;            <span class="keywordflow">if</span> (tagCrossing) {</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                <span class="keywordtype">double</span> <span class="keyword">const</span> dt1 = distOld / <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(v, v));</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                <span class="keywordtype">double</span> <span class="keyword">const</span> dt2 = h - dt1;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                <span class="comment">// Retrack particle from the old postion to cavity gap point</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i] = oldR + dt1 * v;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                <span class="comment">// Momentum kick</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                <span class="comment">//itsBunch_m-&gt;R[i] *= 1000.0; // RFkick uses [itsBunch_m-&gt;R] == mm</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a5c507cc377b28df9b66a7b3831c2ed05">RFkick</a>(ccd.cavity, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>() * <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a>, dt1, i);</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                <span class="comment">//itsBunch_m-&gt;R[i] *= 0.001;</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i] += dt2 * <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i] * c_gamma;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            }</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        }</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;        flagNeedUpdate |= (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i] &lt; 0);</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    }</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keywordflow">return</span> flagNeedUpdate;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;}</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a00bd119c89760f339a293b7c66b9cd55"> 1994</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a00bd119c89760f339a293b7c66b9cd55">ParallelCyclotronTracker::kick</a>(<span class="keywordtype">double</span> h) {</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="keywordtype">bool</span> flagNeedUpdate = <span class="keyword">false</span>;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <a class="code" href="../../df/d78/a07147.html">BorisPusher</a> pusher;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> q = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a5f3de61e1c65ab5b1f336470ae29d48c">Q</a>[0] / <a class="code" href="../../d4/dd0/a04537.html#ab9b5c9c33385e7d484177d8ee38e22f2">Physics::q_e</a>; <span class="comment">// For now all particles have the same charge</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> M = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a2f9a3f71f9e8cae4965de06b4819e176">M</a>[0] * <a class="code" href="../../d0/d3d/a04539.html#ab246135577e4a9983d50620a1e89775a">Units::GeV2eV</a>; <span class="comment">// For now all particles have the same rest energy</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        pusher.<a class="code" href="../../df/d78/a07147.html#a063ebfefbbf275703add583e42f5bd5f">kick</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i],</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a02869c9275595621525ce0adb352d6e1">Ef</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aca40478a5171d91ec95f336b8f3fcfd2">Bf</a>[i],</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                    h * <a class="code" href="../../d0/d3d/a04539.html#a749503871b5f00aac95bd6fe1071fdd5">Units::ns2s</a>, M, q);</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        flagNeedUpdate |= (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i] &lt; 0);</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    }</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keywordflow">return</span> flagNeedUpdate;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;}</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div><div class="line"><a name="l02014"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a666d11a4d347fdefa083a03ce36088b4"> 2014</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a666d11a4d347fdefa083a03ce36088b4">ParallelCyclotronTracker::borisExternalFields</a>(<span class="keywordtype">double</span> h) {</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    <span class="comment">// h in [ns]</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="comment">// push particles for first half step</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <span class="keywordtype">bool</span> flagNeedUpdate = <a class="code" href="../../dd/dca/a04847.html#a81ae54fff64696e717e2d5f8c5993ec1">push</a>(0.5 * h);</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="comment">// Evaluate external fields</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a02869c9275595621525ce0adb352d6e1">Ef</a>[i] = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aca40478a5171d91ec95f336b8f3fcfd2">Bf</a>[i] = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a24e7de550ff5ade419fcd0838a026a3d">computeExternalFields_m</a>(i, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>() * <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a>,</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a02869c9275595621525ce0adb352d6e1">Ef</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aca40478a5171d91ec95f336b8f3fcfd2">Bf</a>[i]);</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    }</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="comment">// Kick particles for full step</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    flagNeedUpdate |= <a class="code" href="../../dd/dca/a04847.html#a00bd119c89760f339a293b7c66b9cd55">kick</a>(h);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="comment">// push particles for second half step</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    flagNeedUpdate |= <a class="code" href="../../dd/dca/a04847.html#a81ae54fff64696e717e2d5f8c5993ec1">push</a>(0.5 * h);</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    <span class="comment">// apply the plugin elements: probe, collimator, stripper, septum</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    flagNeedUpdate |= <a class="code" href="../../dd/dca/a04847.html#a68fea5657661817956cb8b52aecd44b0">applyPluginElements</a>(h);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="comment">// destroy particles if they are marked as Bin=-1 in the plugin elements or out of global apeture</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ad7eecb45b13ecf2eb11bdc95c6a4f296">deleteParticle</a>(flagNeedUpdate);</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;}</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div><div class="line"><a name="l02045"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a68fea5657661817956cb8b52aecd44b0"> 2045</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a68fea5657661817956cb8b52aecd44b0">ParallelCyclotronTracker::applyPluginElements</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> dt) {</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0f86ab6a46d64fb7771a2529483ed48a">PluginElemTimer_m</a>);</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">beamline_list::iterator</a> sindex = ++(<a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin()); sindex != <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.end(); ++sindex) {</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        <span class="keywordflow">if</span> (((*sindex)-&gt;first) == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a9a311ef6dad816cb7a15c0ab41920ad8">ElementType::VACUUM</a>) {</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;            <a class="code" href="../../d8/da5/a05247.html">Vacuum</a>* vac = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d8/da5/a05247.html">Vacuum</a>*<span class="keyword">&gt;</span>(((*sindex)-&gt;second).second);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            vac-&gt;<a class="code" href="../../d8/da5/a05247.html#aa6791e81ff97015ab88e53b2f0628da7">checkVacuum</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, <a class="code" href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">cycl_m</a>);</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        }</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    }</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="keywordtype">bool</span> flag = <span class="keyword">false</span>;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../df/daa/a05167.html">PluginElement</a>* element : <a class="code" href="../../dd/dca/a04847.html#a040f281006efd0782b8f2cd4cdbc0919">pluginElements_m</a>) {</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        <span class="keywordtype">bool</span> tmp = element-&gt;check(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>,</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                                  <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a>,</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                                  <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>(),</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;                                  dt);</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        flag |= tmp;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="keywordflow">if</span> ( tmp ) {</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a270741b3a4a1bd7d6ff17a6ea690255b">updateNumTotal</a>();</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Total number of particles after PluginElement= &quot;</span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                  &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        }</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    }</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0f86ab6a46d64fb7771a2529483ed48a">PluginElemTimer_m</a>);</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="keywordflow">return</span> flag;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;}</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;</div><div class="line"><a name="l02074"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ad7eecb45b13ecf2eb11bdc95c6a4f296"> 2074</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#ad7eecb45b13ecf2eb11bdc95c6a4f296">ParallelCyclotronTracker::deleteParticle</a>(<span class="keywordtype">bool</span> flagNeedUpdate) {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a586044342216bb6abc6fe79e5c54f28a">DelParticleTimer_m</a>);</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;    <span class="comment">// Update immediately if any particles are lost during this step</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1) % <a class="code" href="../../d7/d8b/a04549.html#aa086ad175559dc4faee94af4f5b4052b">Options::delPartFreq</a> != 0) {</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a586044342216bb6abc6fe79e5c54f28a">DelParticleTimer_m</a>);</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    }</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <a class="code" href="../../d4/d5e/a03686.html#a3f4c593649c5ad948ee3e8566bffeda6">allreduce</a>(flagNeedUpdate, 1, std::logical_or&lt;bool&gt;());</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">if</span> (flagNeedUpdate) {</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        <span class="keywordtype">short</span> bunchCount = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a926547f8adc7ff91c3fe639f0fadccbf">getNumBunch</a>();</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        std::vector&lt;size_t&gt; locLostParticleNum(bunchCount, 0);</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> leb = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3fc75c2f6f10d9e768b668d9a6281781">getLastemittedBin</a>();</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        std::unique_ptr&lt;size_t[]&gt; localBinCount;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            localBinCount = std::unique_ptr&lt;size_t[]&gt;(<span class="keyword">new</span> <span class="keywordtype">size_t</span>[leb]);</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; leb; ++i)</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                localBinCount[i] = 0;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        }</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); i++) {</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i] &lt; 0) {</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                ++locLostParticleNum[<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ac035c07285b91e2eac59fe13e0013d20">bunchNum</a>[i]];</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aca3eb11cbe8b8affeae9aef3ba398e75">destroy</a>(1, i);</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                <span class="comment">/* we need to count the local number of particles</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">                 * per energy bin</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                ++localBinCount[<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i]];</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;            }</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        }</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            <span class="comment">// set the local bin count</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; leb; ++i) {</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a29ca57fb0fea183092d65cc5cd7278a4">setLocalBinCount</a>(localBinCount[i], i);</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;            }</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        }</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;        std::vector&lt;size_t&gt; localnum(bunchCount + 1);</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; localnum.size() - 1; ++i) {</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;            localnum[i] = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a51ee6119a807a463ea3ae3acf14618d0">getLocalNumPerBunch</a>(i) - locLostParticleNum[i];</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a4f7728801e0d3c663b2d2b49246c665d">setLocalNumPerBunch</a>(localnum[i], i);</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        }</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        <span class="comment">/* We need to destroy the particles now</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment">         * before we compute the means. We also</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment">         * have to update the total number of particles</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="comment">         * otherwise the statistics are wrong.</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ab134c61db6f524d3c21741c4879501aa">performDestroy</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        <span class="comment">/* total number of particles of individual bunches</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">         * last index of vector contains total number over all</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="comment">         * bunches, used as a check</span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        std::vector&lt;size_t&gt; totalnum(bunchCount + 1);</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        localnum[bunchCount] = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>();</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        <a class="code" href="../../d4/d5e/a03686.html#a3f4c593649c5ad948ee3e8566bffeda6">allreduce</a>(localnum.data(), totalnum.data(), localnum.size(), std::plus&lt;size_t&gt;());</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a85249558619c2a5f4cc71c706384e898">setTotalNum</a>(totalnum[bunchCount]);</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">short</span> i = 0; i &lt; bunchCount; ++i) {</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ac4c8a918a6235f9f03f76666f36b9a6e">setTotalNumPerBunch</a>(totalnum[i], i);</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        }</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="../../d5/d12/a03851.html#a06dc3d53220b680f16b2c655bcb86a40">sum</a> = std::accumulate(totalnum.begin(),</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                                     totalnum.end() - 1, 0);</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d12/a03851.html#a06dc3d53220b680f16b2c655bcb86a40">sum</a> != totalnum[bunchCount] ) {</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;            <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::deleteParticle()&quot;</span>,</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                                <span class="stringliteral">&quot;Total number of particles &quot;</span> + std::to_string(totalnum[bunchCount]) +</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                                <span class="stringliteral">&quot; != &quot;</span> + std::to_string(<a class="code" href="../../d5/d12/a03851.html#a06dc3d53220b680f16b2c655bcb86a40">sum</a>) + <span class="stringliteral">&quot; (sum over all bunches)&quot;</span>);</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        }</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;        <span class="keywordtype">size_t</span> globLostParticleNum = 0;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        <span class="keywordtype">size_t</span> locNumLost = std::accumulate(locLostParticleNum.begin(),</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                                            locLostParticleNum.end(), 0);</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        <a class="code" href="../../d4/d5e/a03686.html#a6e1e71ee127405447f7411777d80ebd6">reduce</a>(locNumLost, globLostParticleNum, 1, std::plus&lt;size_t&gt;());</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <span class="keywordflow">if</span> ( globLostParticleNum &gt; 0 ) {</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#acb24191df3a19b295603a460591ba95d">level3</a> &lt;&lt; <span class="stringliteral">&quot;At step &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;, lost &quot;</span>  &lt;&lt; globLostParticleNum &lt;&lt; <span class="stringliteral">&quot; particles&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        }</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;        <span class="keywordflow">if</span> (totalnum[bunchCount] == 0) {</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;            <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a586044342216bb6abc6fe79e5c54f28a">DelParticleTimer_m</a>);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;            <span class="keywordflow">return</span> flagNeedUpdate;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        }</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>();</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanP = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;        <span class="comment">// Bunch (local) azimuth at meanR w.r.t. y-axis</span></div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> phi = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanP(0), meanP(1)) - 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a>;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;        <span class="comment">// Bunch (local) elevation at meanR w.r.t. xy plane</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> psi = 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a> - <a class="code" href="../../d5/d12/a03851.html#a98c9dc238bd3ab19e8545cbd35595457">std::acos</a>(meanP(2) / <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(meanP, meanP)));</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        <span class="comment">// For statistics data, the bunch is transformed into a local coordinate system</span></div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        <span class="comment">// with meanP in direction of y-axis -DW</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi, meanR);</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>(0.0)); <span class="comment">// P should be rotated, but not shifted</span></div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;        <span class="comment">//itsBunch_m-&gt;R *= Vector_t(0.001); // mm --&gt; m</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;        <span class="comment">// Now destroy particles and update pertinent parameters in local frame</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;        <span class="comment">// Note that update() will be called within boundp() -DW</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ad1ee6b7f03a3b0613c452a83a5e94641">boundp</a>();</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        <span class="comment">//itsBunch_m-&gt;update();</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a644c68187c47b47efa54ab2cf9ef3a27">calcBeamParameters</a>();</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m --&gt; mm</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi, meanR);</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>(0.0));</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        <span class="comment">// If particles were deleted, recalculate bingamma and reset BinID for remaining particles</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() )</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;updateParticleBins(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    }</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a586044342216bb6abc6fe79e5c54f28a">DelParticleTimer_m</a>);</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;    <span class="keywordflow">return</span> flagNeedUpdate;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;}</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div><div class="line"><a name="l02206"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aa2a7c1676c046c2d6a907fe30999d0e0"> 2206</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#aa2a7c1676c046c2d6a907fe30999d0e0">ParallelCyclotronTracker::initTrackOrbitFile</a>() {</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;    std::string f = <a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;<a class="code" href="../../d5/d13/a04739.html#a3539361fbd2937b2b70723d6470ba8a6">getInputBasename</a>() + std::string(<span class="stringliteral">&quot;-trackOrbit.dat&quot;</span>);</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a>.setf(std::ios::scientific, std::ios::floatfield);</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a>.precision(8);</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#abd96d31b26f1521d9d9af6280d850c84">myNode_m</a> == 0) {</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;inRestartRun()) {</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a>.open(f.c_str(), std::ios::app);</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot;# Restart at integration step &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8b691219af289152e6b74910ea4b30c1">getLocalTrackStep</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a>.open(f.c_str());</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot;# The six-dimensional phase space data in the global Cartesian coordinates&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot;# Part. ID    x [m]       beta_x*gamma       y [m]      beta_y*gamma        z [m]      beta_z*gamma&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        }</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    }</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;}</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div><div class="line"><a name="l02226"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#af904f7566da33371647e4302af1b8c83"> 2226</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#af904f7566da33371647e4302af1b8c83">ParallelCyclotronTracker::initDistInGlobalFrame</a>() {</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;inRestartRun()) {</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        <span class="comment">// Start a new run (no restart)</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;        <span class="keywordtype">double</span> <span class="keyword">const</span> initialReferenceTheta = <a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> * <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;        <span class="comment">// TODO: Replace with TracerParticle</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;        <span class="comment">// Force the initial phase space values of the particle with ID = 0 to zero,</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;        <span class="comment">// to set it as a reference particle.</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#ab1d99d0d2dcadea751b95fb22d773ba2">initialTotalNum_m</a> &gt; 2) {</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dd/dca/a04847.html#a84f93e4f3383e7e6401bd6672ae7c12c">initialLocalNum_m</a>; ++i) {</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i] == 0) {</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i] = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0);</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i] = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0);</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                }</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            }</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        }</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        <span class="comment">// Initialize global R</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m --&gt; mm</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> initMeanR = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(<a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a> * <a class="code" href="../../dd/dca/a04847.html#a081ae478e143023617c95cafe9f673fa">cosRefTheta_m</a>,</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                                            <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a> * <a class="code" href="../../dd/dca/a04847.html#a7cc5ddca11d4cd71b4d89552202b1fe9">sinRefTheta_m</a>,</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                                            <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * <a class="code" href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">referenceZ</a>);</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, initialReferenceTheta, initMeanR);</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        <span class="comment">// Initialize global P (Cartesian, but input P_ref is in Pr, Ptheta, Pz,</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        <span class="comment">// so translation has to be done before the rotation this once)</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        <span class="comment">// Cave: In the local frame, the positive y-axis is the direction of movement -DW</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dd/dca/a04847.html#a84f93e4f3383e7e6401bd6672ae7c12c">initialLocalNum_m</a>; ++i) {</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](0) += <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a>;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](1) += <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a>;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](2) += <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a>;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        }</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        <span class="comment">// Out of the three coordinates of meanR (R, Theta, Z) only the angle</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        <span class="comment">// changes the momentum vector...</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, initialReferenceTheta);</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;        <a class="code" href="../../d8/d6f/a02234.html#add802868496e19113f6924d041d7d9ab">DistributionType</a> distType = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aac28c50caf6e56e830f5ba00e3d92bda">getDistType</a>();</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        <span class="keywordflow">if</span> (distType == <a class="code" href="../../d8/d6f/a02234.html#add802868496e19113f6924d041d7d9abaa689fe8f0fbe6f20034cbd7de3bc8b69">DistributionType::FROMFILE</a>) {</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ac5fccd0ab2edcb6a158da8868103a114">checkFileMomentum</a>();</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;        }</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;        <span class="comment">// Initialize the bin number of the first bunch to 0</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dd/dca/a04847.html#a84f93e4f3383e7e6401bd6672ae7c12c">initialLocalNum_m</a>; ++i) {</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i] = 0;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        }</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="comment">// Set time step per particle</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a98599d211ac1cf8ca5543b5ca6463f8f">setTimeStep</a>();</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        <span class="comment">// Backup initial distribution if multi bunch mode</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="../../dd/dca/a04847.html#ab1d99d0d2dcadea751b95fb22d773ba2">initialTotalNum_m</a> &gt; 2) &amp;&amp; <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() &amp;&amp; <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;isForceMode()) {</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;saveBunch(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        }</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        <span class="comment">// Else: Restart from the distribution in the h5 file</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        <span class="comment">// Do a local frame restart (we have already checked that the old h5 file was saved in local</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        <span class="comment">// frame as well).</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> != <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334">DumpFrame::GLOBAL</a>)) {</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Restart in the local frame&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;            <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m --&gt; mm</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;            <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> initMeanR = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(<a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a> * <a class="code" href="../../dd/dca/a04847.html#a081ae478e143023617c95cafe9f673fa">cosRefTheta_m</a>,</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                                                <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a> * <a class="code" href="../../dd/dca/a04847.html#a7cc5ddca11d4cd71b4d89552202b1fe9">sinRefTheta_m</a>,</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                                                <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a> * <a class="code" href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">referenceZ</a>);</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;            <span class="comment">// Do the transformations</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, <a class="code" href="../../dd/dca/a04847.html#a667a54de4021458f6c85dfe5017b7d89">referencePhi</a>, <a class="code" href="../../dd/dca/a04847.html#ad51fb20cb6a44ecea8f27ed8971f7373">referencePsi</a>, initMeanR);</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, <a class="code" href="../../dd/dca/a04847.html#a667a54de4021458f6c85dfe5017b7d89">referencePhi</a>, <a class="code" href="../../dd/dca/a04847.html#ad51fb20cb6a44ecea8f27ed8971f7373">referencePsi</a>);</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;            <span class="comment">// Initialize the bin number of the first bunch to 0</span></div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dd/dca/a04847.html#a84f93e4f3383e7e6401bd6672ae7c12c">initialLocalNum_m</a>; ++i) {</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i] = 0;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;            }</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;            <span class="comment">// Or do a global frame restart (no transformations necessary)</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Restart in the global frame&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ab2aa67387d9fcce4400137ec44d08b60">pathLength_m</a> = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af1981256edd10c077d2c6ae225b1b9b6">get_sPos</a>();</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;            <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m --&gt; mm</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;        }</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    }</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    <span class="comment">// set the number of particles per bunch</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aab55b06c27fd5e864909bf5aa889b49b">countTotalNumPerBunch</a>();</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    <span class="comment">// ------------ Get some Values ---------------------------------------------------------- //</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>();</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanP = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    <span class="comment">// Bunch (local) azimuth at meanR w.r.t. y-axis</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> phi = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanP(0), meanP(1)) - 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a>;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <span class="comment">// Bunch (local) elevation at meanR w.r.t. xy plane</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> psi = 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a> - <a class="code" href="../../d5/d12/a03851.html#a98c9dc238bd3ab19e8545cbd35595457">std::acos</a>(meanP(2) / <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(meanP, meanP)));</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    <span class="keywordtype">double</span> radius = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(meanR[0] * meanR[0] + meanR[1] * meanR[1]);  <span class="comment">// [m]</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;setRadiusTurns(radius);</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    }</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    <span class="comment">// Do boundp and repartition in the local frame at beginning of this run</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi, meanR);</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi); <span class="comment">// P should be rotated, but not shifted</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <span class="comment">//itsBunch_m-&gt;R *= Vector_t(0.001); // mm --&gt; m</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ad1ee6b7f03a3b0613c452a83a5e94641">boundp</a>();</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ae3f431534cfc2b8d46fdd10d5cf48bed">checkNumPart</a>(std::string(<span class="stringliteral">&quot;\n* Before repartition: &quot;</span>));</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a10e0bca491e7f0692e75f0fc7922da07">repartition</a>();</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ae3f431534cfc2b8d46fdd10d5cf48bed">checkNumPart</a>(std::string(<span class="stringliteral">&quot;\n* After repartition:  &quot;</span>));</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a644c68187c47b47efa54ab2cf9ef3a27">calcBeamParameters</a>();</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* *********************** Bunch information in local frame: ************************&quot;</span>;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; *<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m --&gt; mm</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi, meanR);</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi);</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    <span class="comment">// Save initial distribution if not a restart</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;inRestartRun()) {</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> -= 1;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ac729e8c4e7e902451a45b16399c6084e">bunchDumpPhaseSpaceData</a>();</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a6ebda3b639c81ba350e7b6171948c1a4">bunchDumpStatData</a>();</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> += 1;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    }</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="comment">// Print out the Bunch information at beginning of the run. Because the bunch information</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="comment">// displays in units of m we have to change back and forth one more time.</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="comment">//itsBunch_m-&gt;R *= Vector_t(0.001); // mm --&gt; m</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a644c68187c47b47efa54ab2cf9ef3a27">calcBeamParameters</a>();</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="comment">// multi-bunch simulation only</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a4fc2af79c0bf674856416b87028369a2">saveInjectValues</a>();</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* *********************** Bunch information in global frame: ***********************&quot;</span>;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; *<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m --&gt; mm</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;}</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div><div class="line"><a name="l02383"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a98599d211ac1cf8ca5543b5ca6463f8f"> 2383</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a98599d211ac1cf8ca5543b5ca6463f8f">ParallelCyclotronTracker::setTimeStep</a>() {</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dd/dca/a04847.html#a84f93e4f3383e7e6401bd6672ae7c12c">initialLocalNum_m</a>; ++i) {</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a9e08de7a5c9634721e4ea0fc6ee0d8cd">dt</a>[i] = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a4951c53df6841fd275a56f41fc76bfdf">getdT</a>();</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    }</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;}</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;</div><div class="line"><a name="l02389"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ac5fccd0ab2edcb6a158da8868103a114"> 2389</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ac5fccd0ab2edcb6a158da8868103a114">ParallelCyclotronTracker::checkFileMomentum</a>() {</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    <span class="keywordtype">double</span> pTotalMean = 0.0;</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dd/dca/a04847.html#a84f93e4f3383e7e6401bd6672ae7c12c">initialLocalNum_m</a>; ++i) {</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;        pTotalMean += <a class="code" href="../../d0/d85/a00908.html#a7a49daa94331dcd77650d976f3030012">euclidean_norm</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i]);</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    }</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    <a class="code" href="../../d4/d5e/a03686.html#a3f4c593649c5ad948ee3e8566bffeda6">allreduce</a>(pTotalMean, 1, std::plus&lt;double&gt;());</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    pTotalMean /= <a class="code" href="../../dd/dca/a04847.html#ab1d99d0d2dcadea751b95fb22d773ba2">initialTotalNum_m</a>;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d6b/a03845.html#a7633e9416cb6fdd16745f5ba3e3ea7d3">std::abs</a>(pTotalMean - <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a>) / pTotalMean &gt; 1<a class="code" href="../../d4/dd0/a04537.html#ad5ee779aee8511a18dfbb209e80efc64">e</a>-2) {</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;        <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::checkFileMomentum&quot;</span>,</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                            <span class="stringliteral">&quot;The total momentum of the particle distribution\n&quot;</span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                            <span class="stringliteral">&quot;in the global reference frame: &quot;</span> +</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                            std::to_string(pTotalMean) + <span class="stringliteral">&quot;,\n&quot;</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                            <span class="stringliteral">&quot;is different from the momentum given\n&quot;</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                            <span class="stringliteral">&quot;in the \&quot;BEAM\&quot; command: &quot;</span> +</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                            std::to_string(<a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a>) + <span class="stringliteral">&quot;.\n&quot;</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                            <span class="stringliteral">&quot;In Opal-cycl the initial distribution\n&quot;</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                            <span class="stringliteral">&quot;is specified in the local reference frame.\n&quot;</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                            <span class="stringliteral">&quot;When using a \&quot;FROMFILE\&quot; type distribution, the momentum \n&quot;</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                            <span class="stringliteral">&quot;must be the same as the specified in the \&quot;BEAM\&quot; command,\n&quot;</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                            <span class="stringliteral">&quot;which is in global reference frame.&quot;</span>);</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;    }</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;}</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">//TODO: This can be completely rewritten with TracerParticle -DW</span></div><div class="line"><a name="l02418"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ae413f18725a0b8a5bef87f40d2c32f46"> 2418</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ae413f18725a0b8a5bef87f40d2c32f46">ParallelCyclotronTracker::singleParticleDump</a>() {</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">DumpTimer_m</a>);</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/da4/a12131.html#ace7b103c3bf58266544e165c6b5a69d4">Ippl::getNodes</a>() &gt; 1 ) {</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;        <span class="keywordtype">double</span> x;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;        <span class="keywordtype">int</span> id;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a> tmpr;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#affc8203b8ad033dd1672d1b8d0ab7e9f">ivector_t</a> tmpi;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;        <span class="keywordtype">int</span> tag = <a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../d4/dc7/a09807.html#aec355d9c01194461adbba236ffbd7b21">next_tag</a>(<a class="code" href="../../dd/df6/a03713.html#a9143761a2f804639c3d7c7134dea8d44">IPPL_APP_TAG4</a>, <a class="code" href="../../dd/df6/a03713.html#a23a98645c0ac63580934633969bd4a4c">IPPL_APP_CYCLE</a>);</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;        <span class="comment">// for all nodes, find the location of particle with ID = 0 &amp; 1 in bunch containers</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;        <span class="keywordtype">int</span> found[2] = {-1, -1};</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;        <span class="keywordtype">int</span> counter = 0;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); ++i) {</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i] == 0) {</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                found[counter] = i;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                counter++;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;            }</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i] == 1) {</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                found[counter] = i;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                counter++;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;            }</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;        }</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#abd96d31b26f1521d9d9af6280d850c84">myNode_m</a> == 0) {</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;            <span class="keywordtype">int</span> notReceived = <a class="code" href="../../df/da4/a12131.html#ace7b103c3bf58266544e165c6b5a69d4">Ippl::getNodes</a>() - 1;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;            <span class="keywordtype">int</span> numberOfPart = 0;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;            <span class="comment">// receive other nodes</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;            <span class="keywordflow">while</span>(notReceived &gt; 0) {</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                <span class="keywordtype">int</span> node = <a class="code" href="../../d9/d9a/a03668.html#a2ecfb905230e85a1a2cadf2c1aa65ced">COMM_ANY_NODE</a>;</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                <a class="code" href="../../d9/de9/a09623.html">Message</a> *rmsg =  <a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../da/d49/a09219.html#ac0e671485db61cd6fdf8961504250b2b">receive_block</a>(node, tag);</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                <span class="keywordflow">if</span> (rmsg == <span class="keyword">nullptr</span>)</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                    <a class="code" href="../../dd/d27/a03989.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Could not receive from client nodes in main.&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                --notReceived;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                rmsg-&gt;<a class="code" href="../../d9/de9/a09623.html#aeb7c0c5d1f49f8fd1b78eae709216da9">get</a>(&amp;numberOfPart);</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numberOfPart; ++i) {</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                    rmsg-&gt;<a class="code" href="../../d9/de9/a09623.html#aeb7c0c5d1f49f8fd1b78eae709216da9">get</a>(&amp;<span class="keywordtype">id</span>);</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                    tmpi.push_back(<span class="keywordtype">id</span>);</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; 6; ii++) {</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                        rmsg-&gt;<a class="code" href="../../d9/de9/a09623.html#aeb7c0c5d1f49f8fd1b78eae709216da9">get</a>(&amp;x);</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;                        tmpr.push_back(x);</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                    }</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                }</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                <span class="keyword">delete</span> rmsg;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;            }</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;            <span class="comment">// own node</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; counter; ++i) {</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                tmpi.push_back(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[found[i]]);</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; ++j) {</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                    tmpr.push_back(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[found[i]](j));</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;                    tmpr.push_back(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[found[i]](j));</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                }</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;            }</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;            <span class="comment">// store</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;            <a class="code" href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">dvector_t::iterator</a> itParameter = tmpr.begin();</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> tmpid : tmpi) {</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot;ID&quot;</span> &lt;&lt; tmpid;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                <span class="keywordflow">if</span> (tmpid == 0) { <span class="comment">// for stat file</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a5d3f889cb1da052c04f1ce823946467f">RefPartR_m</a>[0] = *itParameter;</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a5d3f889cb1da052c04f1ce823946467f">RefPartR_m</a>[1] = *(itParameter + 2);</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a5d3f889cb1da052c04f1ce823946467f">RefPartR_m</a>[2] = *(itParameter + 4);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0e1323e04044303804432d62ce2f68f0">RefPartP_m</a>[0] = *(itParameter + 1);</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0e1323e04044303804432d62ce2f68f0">RefPartP_m</a>[1] = *(itParameter + 3);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0e1323e04044303804432d62ce2f68f0">RefPartP_m</a>[2] = *(itParameter + 5);</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                }</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; 6; ii++) {</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                    <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; *itParameter;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                    ++itParameter;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                }</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            }</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;            <span class="comment">// for other nodes</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;            <a class="code" href="../../d9/de9/a09623.html">Message</a> *smsg = <span class="keyword">new</span> <a class="code" href="../../d9/de9/a09623.html">Message</a>();</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;            smsg-&gt;<a class="code" href="../../d9/de9/a09623.html#a3fc943d7af8a5f88178faeab977802c0">put</a>(counter);</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; counter; i++) {</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                smsg-&gt;<a class="code" href="../../d9/de9/a09623.html#a3fc943d7af8a5f88178faeab977802c0">put</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[found[i]]);</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 3; j++) {</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                    smsg-&gt;<a class="code" href="../../d9/de9/a09623.html#a3fc943d7af8a5f88178faeab977802c0">put</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[found[i]](j));</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;                    smsg-&gt;<a class="code" href="../../d9/de9/a09623.html#a3fc943d7af8a5f88178faeab977802c0">put</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[found[i]](j));</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                }</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;            }</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;send(smsg, 0, tag)) {</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                <a class="code" href="../../dd/d27/a03989.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a>(<span class="stringliteral">&quot;Ippl::Comm-&gt;send(smsg, 0, tag) failed &quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>);</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;            }</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;        }</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        <a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../da/d49/a09219.html#ac4593203c34f26c625bd51c7502c297e">barrier</a>();</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); i++) {</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i] == 0 || <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i] == 1) {</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot;ID&quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](2) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](2) &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i] == 0) { <span class="comment">// for stat file</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a5d3f889cb1da052c04f1ce823946467f">RefPartR_m</a> = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i];</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0e1323e04044303804432d62ce2f68f0">RefPartP_m</a> = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i];</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                }</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;            }</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;        }</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    }</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">DumpTimer_m</a>);</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;}</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;</div><div class="line"><a name="l02546"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a6ebda3b639c81ba350e7b6171948c1a4"> 2546</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a6ebda3b639c81ba350e7b6171948c1a4">ParallelCyclotronTracker::bunchDumpStatData</a>(){</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">DumpTimer_m</a>);</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;    <span class="comment">// dump stat file per bunch in case of multi-bunch mode</span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>()) {</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        <span class="keywordtype">double</span> phi = 0.0, psi = 0.0;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>();</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        <span class="comment">// Bunch (global) angle w.r.t. x-axis (cylinder coordinates)</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        <span class="keywordtype">double</span> theta = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanR(0), meanR(1)) * <a class="code" href="../../d0/d3d/a04539.html#ac9c7e47f91a8010d7c98e49d6e924911">Units::rad2deg</a>;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        <span class="comment">// fix azimuth_m --&gt; make monotonically increasing</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a68e7cdb19cd27bdaf777e4092158bff0">dumpAngle</a>(theta, <a class="code" href="../../dd/dca/a04847.html#acc4f790cd7ac121d150eefac50cb2166">prevAzimuth_m</a>, <a class="code" href="../../dd/dca/a04847.html#a140b8898b353d8a9df18c0bfb5b289d0">azimuth_m</a>);</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a840b1f8ae80e3e83dfc32de00ef8e090">updateAzimuthAndRadius</a>();</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> != <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334">DumpFrame::GLOBAL</a>) {</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;            <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanP = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;            <span class="comment">// Bunch (local) azimuth at meanR w.r.t. y-axis</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;            phi = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanP(0), meanP(1)) - 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a>;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;            <span class="comment">// Bunch (local) elevation at meanR w.r.t. xy plane</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;            psi = 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a> - <a class="code" href="../../d5/d12/a03851.html#a98c9dc238bd3ab19e8545cbd35595457">std::acos</a>(meanP(2) / <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(meanP, meanP)));</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;            <span class="comment">// Rotate so Pmean is in positive y direction. No shift, so that normalized emittance and</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;            <span class="comment">// unnormalized emittance as well as centroids are calculated correctly in</span></div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;            <span class="comment">// PartBunch::calcBeamParameters()</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi, meanR);</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi);</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;        }</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a248cafbfeef5f7465d79fc5bde4662c6">itsDataSink</a>-&gt;<a class="code" href="../../d7/d4d/a07199.html#abcbbb6b928c3eacb3a00ed572b8c17f7">writeMultiBunchStatistics</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>.get());</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> != <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334">DumpFrame::GLOBAL</a>) {</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi, meanR);</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi);</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;        }</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;        <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">DumpTimer_m</a>);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    }</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    <span class="comment">// --------------------------------- Get some Values ---------------------------------------- //</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> temp_t = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>() * <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a>;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanR;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanP;</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> == <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5aef7994f35f11e33b59aadbb2dbe6b605">DumpFrame::BUNCH_MEAN</a>) {</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;        meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>();</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        meanP = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>() &gt; 0) {</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        meanR = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[0];</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        meanP = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[0];</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;    }</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    <span class="keywordtype">double</span> phi = 0;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;    <span class="keywordtype">double</span> psi = 0;</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;    <span class="comment">// Bunch (global) angle w.r.t. x-axis (cylinder coordinates)</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <span class="keywordtype">double</span> azimuth = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanR(0), meanR(1)) * <a class="code" href="../../d0/d3d/a04539.html#ac9c7e47f91a8010d7c98e49d6e924911">Units::rad2deg</a>;</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <span class="comment">// fix azimuth_m --&gt; make monotonically increasing</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a68e7cdb19cd27bdaf777e4092158bff0">dumpAngle</a>(azimuth, <a class="code" href="../../dd/dca/a04847.html#acc4f790cd7ac121d150eefac50cb2166">prevAzimuth_m</a>, <a class="code" href="../../dd/dca/a04847.html#a140b8898b353d8a9df18c0bfb5b289d0">azimuth_m</a>);</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    <span class="comment">// --------------  Calculate the external fields at the center of the bunch ----------------- //</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    <a class="code" href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">beamline_list::iterator</a> DumpSindex = <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin();</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;    (((*DumpSindex)-&gt;second).second)-&gt;apply(meanR, meanP, temp_t, <a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a>, <a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a>);</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    <span class="comment">// If we are saving in local frame, bunch and fields at the bunch center have to be rotated</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    <span class="comment">// TODO: Make decision if we maybe want to always save statistics data in local frame? -DW</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> != <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334">DumpFrame::GLOBAL</a>) {</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;        <span class="comment">// -------------------- ----------- Do Transformations ---------------------------------- //</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;        <span class="comment">// Bunch (local) azimuth at meanR w.r.t. y-axis</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;        phi = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanP(0), meanP(1)) - 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a>;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;        <span class="comment">// Bunch (local) elevation at meanR w.r.t. xy plane</span></div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;        psi = 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a> - <a class="code" href="../../d5/d12/a03851.html#a98c9dc238bd3ab19e8545cbd35595457">std::acos</a>(meanP(2) / <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(meanP, meanP)));</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;        <span class="comment">// Rotate so Pmean is in positive y direction. No shift, so that normalized emittance and</span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;        <span class="comment">// unnormalized emittance as well as centroids are calculated correctly in</span></div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        <span class="comment">// PartBunch::calcBeamParameters()</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a>, phi, psi);</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a>, phi, psi);</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi);</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi);</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;    }</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;    <span class="comment">//itsBunch_m-&gt;R *= Vector_t(0.001); // mm -&gt; m</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>[0] = <a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a> * <a class="code" href="../../d0/d3d/a04539.html#ac294dfae49b56b7534adc75143a93a50">Units::kG2T</a>;</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>[1] = <a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a>;        <span class="comment">// kV/mm? -DW</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;    <span class="comment">// Save the stat file</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a248cafbfeef5f7465d79fc5bde4662c6">itsDataSink</a>-&gt;<a class="code" href="../../d7/d4d/a07199.html#a505ef3ad13321eefe16b9fd420a930bd">dumpSDDS</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>, <a class="code" href="../../dd/dca/a04847.html#a140b8898b353d8a9df18c0bfb5b289d0">azimuth_m</a>);</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m -&gt; mm</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    <span class="comment">// If we are in local mode, transform back after saving</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> != <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334">DumpFrame::GLOBAL</a>) {</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi);</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi);</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    }</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">DumpTimer_m</a>);</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;}</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;</div><div class="line"><a name="l02657"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ac729e8c4e7e902451a45b16399c6084e"> 2657</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ac729e8c4e7e902451a45b16399c6084e">ParallelCyclotronTracker::bunchDumpPhaseSpaceData</a>() {</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="comment">// --------------------------------- Particle dumping --------------------------------------- //</span></div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    <span class="comment">// Note: Don&#39;t dump when</span></div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <span class="comment">// 1. after one turn</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    <span class="comment">// in order to sychronize the dump step for multi-bunch and single bunch for comparison</span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    <span class="comment">// with each other during post-process phase.</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    <span class="comment">// ------------------------------------------------------------------------------------------ //</span></div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">DumpTimer_m</a>);</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    <span class="comment">// --------------------------------- Get some Values ---------------------------------------- //</span></div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> temp_t = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>() * <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a>;</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanR;</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanP;</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    <span class="comment">// in case of multi-bunch mode take always bunch mean (although it takes all bunches)</span></div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> == <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5aef7994f35f11e33b59aadbb2dbe6b605">DumpFrame::BUNCH_MEAN</a> || <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>()) {</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>();</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        meanP = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>() &gt; 0) {</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;        meanR = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[0];</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        meanP = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[0];</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    }</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> betagamma_temp = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(meanP, meanP));</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> E = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a02fe0321c9ea6a5dd397b567e24eea57">get_meanKineticEnergy</a>();</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <span class="comment">// Bunch (global) angle w.r.t. x-axis (cylinder coordinates)</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> theta = <a class="code" href="../../de/d6b/a03845.html#adece0042b4015b8521d983143b6af21a">std::atan2</a>(meanR(1), meanR(0));</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;    <span class="comment">// Bunch (local) azimuth at meanR w.r.t. y-axis</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> phi = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanP(0), meanP(1)) - 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a>;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    <span class="comment">// Bunch (local) elevation at meanR w.r.t. xy plane</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;    <span class="keywordtype">double</span> <span class="keyword">const</span> psi = 0.5 * <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a> - <a class="code" href="../../d5/d12/a03851.html#a98c9dc238bd3ab19e8545cbd35595457">std::acos</a>(meanP(2) / <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(meanP, meanP)));</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <span class="comment">// ---------------- Re-calculate reference values in format of input values ----------------- //</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    <span class="comment">// Position:</span></div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    <span class="comment">// New OPAL 2.0: Init in m (back to mm just for output) -DW</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a> = <a class="code" href="../../dd/dca/a04847.html#a5dc5b769d60d7310d604b9623fe31f4b">computeRadius</a>(meanR); <span class="comment">// includes m --&gt; mm conversion</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> = theta / <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">referenceZ</a> = <a class="code" href="../../d0/d3d/a04539.html#a610458ef9e4cd6ea2d9b23bfddef69f8">Units::m2mm</a> * meanR(2);</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    <span class="comment">// Momentum in Theta-hat, R-hat, Z-hat coordinates at position meanR:</span></div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> = betagamma_temp;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a> = meanP(2);</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a> = meanP(0) * <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(theta) + meanP(1) * <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(theta);</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a> = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> * <a class="code" href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">referencePtot</a> - \</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;                       <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a> * <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a> - <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a> * <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a>);</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    <span class="comment">// -----  Calculate the external fields at the center of the bunch (Cave: Global Frame) ----- //</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <a class="code" href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">beamline_list::iterator</a> DumpSindex = <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin();</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0);</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    (((*DumpSindex)-&gt;second).second)-&gt;apply(meanR, meanP, temp_t, <a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a>, <a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a>);</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>[0] = <a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a> * <a class="code" href="../../d0/d3d/a04539.html#ac294dfae49b56b7534adc75143a93a50">Units::kG2T</a>;</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>[1] = <a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a>;</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    <span class="comment">// -------------- If flag psDumpFrame is global, dump bunch in global frame ------------- //</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#a1a84a90daa50ed0cc2359659555baed9">Options::psDumpFreq</a> &lt; <a class="code" href="../../d4/d5e/a03542.html#a418b01af7e1c6223e54608b7e75e0cf6">std::numeric_limits&lt;int&gt;::max</a>() ){</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        <span class="keywordtype">bool</span> dumpLocalFrame    = <span class="keyword">true</span>;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;        std::string dumpString = <span class="stringliteral">&quot;local&quot;</span>;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a> == <a class="code" href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334">DumpFrame::GLOBAL</a>) {</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;            dumpLocalFrame = <span class="keyword">false</span>;</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;            dumpString     = <span class="stringliteral">&quot;global&quot;</span>;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;        }</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        <span class="keywordflow">if</span> (dumpLocalFrame == <span class="keyword">true</span>) {</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;            <span class="comment">// ---------------- If flag psDumpFrame is local, dump bunch in local frame ---------------- //</span></div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;            <span class="comment">// The bunch is transformed into a local coordinate system with meanP in direction of y-axis</span></div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi, meanR);</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;            <span class="comment">//globalToLocal(itsBunch_m-&gt;R, phi, psi, meanR * Vector_t(0.001));</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi); <span class="comment">// P should only be rotated</span></div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a>, phi, psi);</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a>, phi, psi);</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;        }</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>[0] = <a class="code" href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">extB_m</a> * <a class="code" href="../../d0/d3d/a04539.html#ac294dfae49b56b7534adc75143a93a50">Units::kG2T</a>;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>[1] = <a class="code" href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">extE_m</a>;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2261d79226429e5115467037fd585804">lastDumpedStep_m</a> = <a class="code" href="../../dd/dca/a04847.html#a248cafbfeef5f7465d79fc5bde4662c6">itsDataSink</a>-&gt;<a class="code" href="../../d7/d4d/a07199.html#a7f1fc5c3a7495fbdcbb35d15aa258843">dumpH5</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, <span class="comment">// Local and in m</span></div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                                               <a class="code" href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">FDext_m</a>, E,</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                                               <a class="code" href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">referencePr</a>,</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;                                               <a class="code" href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">referencePt</a>,</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                                               <a class="code" href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">referencePz</a>,</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;                                               <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a>,</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;                                               <a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a>,</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                                               <a class="code" href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">referenceZ</a>,</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                                               phi / <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>, <span class="comment">// P_mean azimuth</span></div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                                               <span class="comment">// at ref. R/Th/Z</span></div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                                               psi / <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>, <span class="comment">// P_mean elevation</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                                               <span class="comment">// at ref. R/Th/Z</span></div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                                               dumpLocalFrame);        <span class="comment">// Flag localFrame</span></div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        <span class="keywordflow">if</span> (dumpLocalFrame == <span class="keyword">true</span>) {</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;            <span class="comment">// Return to global frame</span></div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, phi, psi, meanR);</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;            <span class="comment">//localToGlobal(itsBunch_m-&gt;R, phi, psi, meanR * Vector_t(0.001));</span></div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>, phi, psi);</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;        }</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;        <span class="comment">// Tell user in which mode we are dumping</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;        <span class="comment">// New: no longer dumping for num part &lt; 3, omit phase space dump number info</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a2261d79226429e5115467037fd585804">lastDumpedStep_m</a> == -1) {</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;          *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* Integration step &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (no phase space dump for &lt;= 2 particles)&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;          *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* Phase space dump &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a2261d79226429e5115467037fd585804">lastDumpedStep_m</a></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; dumpString &lt;&lt; <span class="stringliteral">&quot; frame) at integration step &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1 &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        }</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    }</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    <span class="comment">// Print dump information on screen</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* T = &quot;</span> &lt;&lt; temp_t &lt;&lt; <span class="stringliteral">&quot; ns&quot;</span></div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;, Live Particles: &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* E = &quot;</span> &lt;&lt; E &lt;&lt; <span class="stringliteral">&quot; MeV&quot;</span></div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;, beta * gamma = &quot;</span> &lt;&lt; betagamma_temp &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Bunch position: R =  &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">referenceR</a> &lt;&lt; <span class="stringliteral">&quot; mm&quot;</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;, Theta = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> &lt;&lt; <span class="stringliteral">&quot; Deg&quot;</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;, Z = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">referenceZ</a> &lt;&lt; <span class="stringliteral">&quot; mm&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Local Azimuth = &quot;</span> &lt;&lt; phi / <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a> &lt;&lt; <span class="stringliteral">&quot; Deg&quot;</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;, Local Elevation = &quot;</span> &lt;&lt; psi / <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a> &lt;&lt; <span class="stringliteral">&quot; Deg&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">DumpTimer_m</a>);</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;}</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;</div><div class="line"><a name="l02788"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a4fdf924bb54c04c26a2ee6448fa01cae"> 2788</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a4fdf924bb54c04c26a2ee6448fa01cae">ParallelCyclotronTracker::isTurnDone</a>() {</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> &gt; 10) &amp;&amp; (((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1) %<a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">stepsPerTurn</a>) == 0);</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;}</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;</div><div class="line"><a name="l02792"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a3efa96beca39db5e15c4b224d2596850"> 2792</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a3efa96beca39db5e15c4b224d2596850">ParallelCyclotronTracker::update_m</a>(<span class="keywordtype">double</span>&amp; t, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; dt,</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                                        <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; finishedTurn)</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;{</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="comment">// Reference parameters</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    t += dt;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a601a0ddf82954fd61f5139586e3389ba">updateTime</a>(dt);</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a28964ccb8f0261cf71e4ab9289f424a9">setLocalTrackStep</a>((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1));</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1 % 1000)) {</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;Step &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1 &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    }</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a5dfd077e43b0e75cd740b32a4944713b">updatePathLength</a>(dt);</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    <span class="comment">// Here is global frame, don&#39;t do itsBunch_m-&gt;boundp();</span></div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>()&gt;0) {</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;        <span class="comment">// Only dump last step if we have particles left.</span></div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;        <span class="comment">// Check separately for phase space (ps) and statistics (stat) data dump frequency</span></div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> != <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ead88946b678e4c2f251d4e292e8142291">TrackingMode::SEO</a> &amp;&amp; ( ((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1) % <a class="code" href="../../d7/d8b/a04549.html#a1a84a90daa50ed0cc2359659555baed9">Options::psDumpFreq</a> == 0) ||</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                                      (<a class="code" href="../../d7/d8b/a04549.html#a3baf2f09d4554903eae71cc1e435da19">Options::psDumpEachTurn</a> &amp;&amp; finishedTurn)))</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        {</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;            <span class="comment">// Write phase space data to h5 file</span></div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#ac729e8c4e7e902451a45b16399c6084e">bunchDumpPhaseSpaceData</a>();</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;        }</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> != <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ead88946b678e4c2f251d4e292e8142291">TrackingMode::SEO</a> &amp;&amp; ( ((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1) % <a class="code" href="../../d7/d8b/a04549.html#ae1dc7de1cbb27c5535580db7cdf7be6a">Options::statDumpFreq</a> == 0) ||</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                                      (<a class="code" href="../../d7/d8b/a04549.html#a3baf2f09d4554903eae71cc1e435da19">Options::psDumpEachTurn</a> &amp;&amp; finishedTurn)))</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;        {</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            <span class="comment">// Write statistics data to stat file</span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a6ebda3b639c81ba350e7b6171948c1a4">bunchDumpStatData</a>();</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;        }</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    }</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d8b/a04549.html#a3baf2f09d4554903eae71cc1e435da19">Options::psDumpEachTurn</a> &amp;&amp; finishedTurn) {</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="../../df/daa/a05167.html">PluginElement</a>* element : <a class="code" href="../../dd/dca/a04847.html#a040f281006efd0782b8f2cd4cdbc0919">pluginElements_m</a>) {</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;            element-&gt;save();</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;        }</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    }</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;}</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;</div><div class="line"><a name="l02835"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a7236d29b67e337d42854b34af3063d22"> 2835</a></span>&#160;std::tuple&lt;double, double, double&gt; <a class="code" href="../../dd/dca/a04847.html#a7236d29b67e337d42854b34af3063d22">ParallelCyclotronTracker::initializeTracking_m</a>() {</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    <span class="comment">// Read in some control parameters</span></div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a70e03a952c0c250de7f7a5b338cbbe25">scSolveFreq</a>         = (<a class="code" href="../../dd/dca/a04847.html#abf713a03b8e60b20282878c80e42b45d">spiral_flag</a>) ? 1 : <a class="code" href="../../d7/d8b/a04549.html#aa51de3749908577e69be3d4cb91cfc60">Options::scSolveFreq</a>;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">stepsPerTurn</a>        = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a9e73bbdc479046a669d634051609598e">getStepsPerTurn</a>();</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    <span class="comment">// Define 3 special azimuthal angles where dump particle&#39;s six parameters</span></div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    <span class="comment">// at each turn into 3 ASCII files. only important in single particle tracking</span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a2b4e517d1c586cac4aa4bd4e4cc187b5">azimuth_angle_m</a>.resize(3);</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a2b4e517d1c586cac4aa4bd4e4cc187b5">azimuth_angle_m</a>[0] = 0.0;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a2b4e517d1c586cac4aa4bd4e4cc187b5">azimuth_angle_m</a>[1] = 22.5 * <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a2b4e517d1c586cac4aa4bd4e4cc187b5">azimuth_angle_m</a>[2] = 45.0 * <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    <span class="keywordtype">double</span> harm = <a class="code" href="../../dd/dca/a04847.html#a4951f43b20c6936bb3d15859a26a4932">getHarmonicNumber</a>();</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    <span class="keywordtype">double</span> dt   = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a4951c53df6841fd275a56f41fc76bfdf">getdT</a>() * <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a> * harm;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    <span class="keywordtype">double</span> t    = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>()  * <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a>;</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;    <span class="keywordtype">double</span> oldReferenceTheta = <a class="code" href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">referenceTheta</a> * <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a>;      <span class="comment">// init here, reset each step</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a32d840e781f868f4433aaf563e3b9102">deltaTheta</a>       = <a class="code" href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a> / (<a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">stepsPerTurn</a>); <span class="comment">// half of the average angle per step</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    <span class="comment">//int stepToLastInj = itsBunch_m-&gt;getSteptoLastInj(); // TODO: Do we need this? -DW</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    <span class="comment">// Record how many bunches have already been injected. ONLY FOR MBM</span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>()) {</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;setNumBunch(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a926547f8adc7ff91c3fe639f0fadccbf">getNumBunch</a>());</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;     }</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#aa2a7c1676c046c2d6a907fe30999d0e0">initTrackOrbitFile</a>();</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;    <span class="comment">// Get data from h5 file for restart run and reset current step</span></div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="comment">// to last step of previous simulation</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;inRestartRun()) {</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a12108331551c11541ccd3e34b23a96f3">restartStep0_m</a> = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8b691219af289152e6b74910ea4b30c1">getLocalTrackStep</a>();</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> = <a class="code" href="../../dd/dca/a04847.html#a12108331551c11541ccd3e34b23a96f3">restartStep0_m</a>;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> = <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> / <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">stepsPerTurn</a> + 1;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Restart at integration step &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a12108331551c11541ccd3e34b23a96f3">restartStep0_m</a></div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; at turn &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> - 1 &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ab4724e863899fa7bf8bbc59cf2e22cbe">initPathLength</a>();</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    }</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#abd81f5dbcda886d66f60dbdf53799e28">stepsNextCheck</a> = <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">stepsPerTurn</a>; <span class="comment">// Steps to next check for transition</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#af904f7566da33371647e4302af1b8c83">initDistInGlobalFrame</a>();</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>()) {</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;updateParticleBins(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;    }</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    <span class="comment">// --- Output to user --- //</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Beginning of this run is at t = &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot; [ns]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* The time step is set to dt = &quot;</span> &lt;&lt; dt &lt;&lt; <span class="stringliteral">&quot; [ns]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* MBM: Time interval between neighbour bunches is set to &quot;</span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;              &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">stepsPerTurn</a> * dt &lt;&lt; <span class="stringliteral">&quot;[ns]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* MBM: The particles energy bin reset frequency is set to &quot;</span></div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;              &lt;&lt; <a class="code" href="../../d7/d8b/a04549.html#ac6f115a7078d40475a6249e5dceb9345">Options::rebinFreq</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    }</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Single particle trajectory dump frequency is set to &quot;</span> &lt;&lt; <a class="code" href="../../d7/d8b/a04549.html#a453b96859e7bdbd1f5df17f34f6981eb">Options::sptDumpFreq</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* The frequency to solve space charge fields is set to &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a70e03a952c0c250de7f7a5b338cbbe25">scSolveFreq</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* The repartition frequency is set to &quot;</span> &lt;&lt; <a class="code" href="../../d7/d8b/a04549.html#ab08b0e5cb95b53c6e80d36c884babd3a">Options::repartFreq</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="keywordflow">switch</span> ( <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> ) {</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ead88946b678e4c2f251d4e292e8142291">TrackingMode::SEO</a>: {</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ------------------------- STATIC EQUILIBRIUM ORBIT MODE ----------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* Instruction: When the total particle number is equal to 2, SEO mode is triggered      *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* automatically. This mode does NOT include any RF cavities. The initial distribution   *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* file must be specified. In the file the first line is for reference particle and the  *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* second line is for off-center particle. The tune is calculated by FFT routines based  *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* on these two particles.                                                               *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* ---------------- NOTE: SEO MODE ONLY WORKS SERIALLY ON SINGLE NODE ------------------ *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../df/da4/a12131.html#ace7b103c3bf58266544e165c6b5a69d4">Ippl::getNodes</a>() != 1)</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;Error in ParallelCyclotronTracker::initializeTracking_m&quot;</span>,</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;                                    <span class="stringliteral">&quot;SEO MODE ONLY WORKS SERIALLY ON SINGLE NODE!&quot;</span>);</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        }</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0679273e201afd0bf57af3961f8a23b8">TrackingMode::SINGLE</a>: {</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* ------------------------------ SINGLE PARTICLE MODE --------------------------------- *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* Instruction: When the total particle number is equal to 1, single particle mode is    *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* triggered automatically. The initial distribution file must be specified which should *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* contain only one line for the single particle                                         *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* ---------NOTE: SINGLE PARTICLE MODE ONLY WORKS SERIALLY ON A SINGLE NODE ------------ *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../df/da4/a12131.html#ace7b103c3bf58266544e165c6b5a69d4">Ippl::getNodes</a>() != 1)</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;Error in ParallelCyclotronTracker::initializeTracking_m&quot;</span>,</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;                                    <span class="stringliteral">&quot;SINGLE PARTICLE MODE ONLY WORKS SERIALLY ON A SINGLE NODE!&quot;</span>);</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;            <span class="comment">// For single particle mode open output files</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a61ca4fa0bee626420b2e224d949d1f1d">openFiles</a>(<a class="code" href="../../dd/dca/a04847.html#a2b4e517d1c586cac4aa4bd4e4cc187b5">azimuth_angle_m</a>.size() + 1, <a class="code" href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a>()-&gt;<a class="code" href="../../d5/d13/a04739.html#a3539361fbd2937b2b70723d6470ba8a6">getInputBasename</a>());</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        }</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea4073a3520c889c260be3a79189cedb26">TrackingMode::BUNCH</a>: {</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        }</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0db45d2a4141101bdfe48e3314cfbca3">TrackingMode::UNDEFINED</a>: {}</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        <span class="keywordflow">default</span>:  {</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;            <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::initializeTracking_m()&quot;</span>,</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;                                <span class="stringliteral">&quot;No such tracking mode.&quot;</span>);</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        }</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    }</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <span class="keywordflow">return</span> std::make_tuple(t, dt, oldReferenceTheta);</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;}</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div><div class="line"><a name="l02946"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a982b55a67be81156364fe1f8af54c4b2"> 2946</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a982b55a67be81156364fe1f8af54c4b2">ParallelCyclotronTracker::finalizeTracking_m</a>(<a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; Ttime,</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                                                  <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; Tdeltr,</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;                                                  <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; Tdeltz, <a class="code" href="../../dd/dca/a04847.html#affc8203b8ad033dd1672d1b8d0ab7e9f">ivector_t</a>&amp; TturnNumber) {</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ii = 0; ii &lt; (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>()); ii++) {</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[ii] == 0) {</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;            <span class="keywordtype">double</span> FinalMomentum2 = <a class="code" href="../../dc/d2c/a00893.html#a6dcaf0865921eacb4895202a9de28592">std::pow</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[ii](0), 2.0) + <a class="code" href="../../dc/d2c/a00893.html#a6dcaf0865921eacb4895202a9de28592">std::pow</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[ii](1), 2.0) + <a class="code" href="../../dc/d2c/a00893.html#a6dcaf0865921eacb4895202a9de28592">std::pow</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[ii](2), 2.0);</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;            <span class="keywordtype">double</span> FinalEnergy = (<a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(1.0 + FinalMomentum2) - 1.0) * <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af51331c43ea82142dd6d237e6e3e5bfd">getM</a>() * <a class="code" href="../../d0/d3d/a04539.html#aa14d6948383276c44c8b5f6022cd48bd">Units::eV2MeV</a>;</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Final energy of reference particle = &quot;</span> &lt;&lt; FinalEnergy &lt;&lt; <span class="stringliteral">&quot; [MeV]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Total phase space dump number(includes the initial distribution) = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a2261d79226429e5115467037fd585804">lastDumpedStep_m</a> + 1 &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* One can restart simulation from the last dump step (--restart &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#a2261d79226429e5115467037fd585804">lastDumpedStep_m</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;        }</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    }</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    <a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../da/d49/a09219.html#ac4593203c34f26c625bd51c7502c297e">barrier</a>();</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    <span class="keywordflow">switch</span> ( <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> ) {</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ead88946b678e4c2f251d4e292e8142291">TrackingMode::SEO</a>: {</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;            <span class="comment">// Calculate tunes after tracking.</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;            *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* **************** The result for tune calculation (NO space charge) ******************* *&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;* Number of tracked turns: &quot;</span> &lt;&lt; TturnNumber.back() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;            <span class="keywordtype">double</span> nur, nuz;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#adeaccb2d7a0aac369969c8f7b7a6a7c7">getTunes</a>(Ttime, Tdeltr, Tdeltz, TturnNumber.back(), nur, nuz);</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;        }</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0679273e201afd0bf57af3961f8a23b8">TrackingMode::SINGLE</a>:</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a321e270f5e0af494699b02963717712a">closeFiles</a>();</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;            <span class="comment">// fall through</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea4073a3520c889c260be3a79189cedb26">TrackingMode::BUNCH</a>: <span class="comment">// we do nothing</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0db45d2a4141101bdfe48e3314cfbca3">TrackingMode::UNDEFINED</a>:</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;        <span class="keywordflow">default</span>: {</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;            <span class="comment">// not for multibunch</span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>()) {</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;*&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Finished during turn &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> - 1 &lt;&lt; <span class="stringliteral">&quot; turns completed)&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* Cave: Turn number is not correct for restart mode&quot;</span>&lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;            }</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;        }</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    }</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../da/d49/a09219.html#ac4593203c34f26c625bd51c7502c297e">barrier</a>();</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#abd96d31b26f1521d9d9af6280d850c84">myNode_m</a> == 0) {</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a>.close();</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    }</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* *********************** Bunch information in global frame: ***********************&quot;</span>;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>() &gt; 0) {</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        <span class="comment">// Print out the Bunch information at end of the run.</span></div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a644c68187c47b47efa54ab2cf9ef3a27">calcBeamParameters</a>();</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; *<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a> &lt;&lt; <span class="stringliteral">&quot;* No Particles left in bunch!&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* **********************************************************************************&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    }</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;}</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;</div><div class="line"><a name="l03005"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a566180cef8406a229e4cd208616de10c"> 3005</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a566180cef8406a229e4cd208616de10c">ParallelCyclotronTracker::setTrackingMode</a>() {</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#ab1d99d0d2dcadea751b95fb22d773ba2">initialTotalNum_m</a> == 1 ) {</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> = <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0679273e201afd0bf57af3961f8a23b8">TrackingMode::SINGLE</a>;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#ab1d99d0d2dcadea751b95fb22d773ba2">initialTotalNum_m</a> == 2 ) {</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> = <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ead88946b678e4c2f251d4e292e8142291">TrackingMode::SEO</a>;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#ab1d99d0d2dcadea751b95fb22d773ba2">initialTotalNum_m</a> &gt; 2 ) {</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> = <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea4073a3520c889c260be3a79189cedb26">TrackingMode::BUNCH</a>;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">mode_m</a> = <a class="code" href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0db45d2a4141101bdfe48e3314cfbca3">TrackingMode::UNDEFINED</a>;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    }</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;}</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;</div><div class="line"><a name="l03017"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#af2afb9b11e96ae14c0f448d950b31ec1"> 3017</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#af2afb9b11e96ae14c0f448d950b31ec1">ParallelCyclotronTracker::seoMode_m</a>(<span class="keywordtype">double</span>&amp; t, <span class="keyword">const</span> <span class="keywordtype">double</span> dt, <span class="keywordtype">bool</span>&amp; <span class="comment">/*finishedTurn*/</span>,</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;                                         <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; Ttime, <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; Tdeltr,</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;                                         <a class="code" href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">dvector_t</a>&amp; Tdeltz, <a class="code" href="../../dd/dca/a04847.html#affc8203b8ad033dd1672d1b8d0ab7e9f">ivector_t</a>&amp; TturnNumber) {</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    <span class="comment">// 2 particles: Trigger SEO mode</span></div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    <span class="comment">// (Switch off cavity and calculate betatron oscillation tuning)</span></div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;    <span class="keywordtype">double</span> r_tuning[2], z_tuning[2];</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>()); i++) {</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#a453b96859e7bdbd1f5df17f34f6981eb">Options::sptDumpFreq</a> == 0)) {</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot;ID&quot;</span> &lt;&lt; (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i]);</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](0)</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;                             &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](0)</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;                             &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](1)</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;                             &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](1)</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                             &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](2)</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;                             &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](2)</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;                             &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;        }</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;        <span class="keywordtype">double</span> OldTheta = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](0), <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](1));</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;        r_tuning[i] = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](0) * <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(OldTheta) +</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;                      <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](1) * <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(OldTheta);</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;        z_tuning[i] = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](2);</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;        <span class="comment">// Integrate for one step in the lab Cartesian frame (absolute value).</span></div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a8de6452f41159e2027fb4cd65d9519fc">itsStepper_mp</a>-&gt;advance(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, i, t, dt);</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;        <span class="keywordflow">if</span> ( (i == 0) &amp;&amp; <a class="code" href="../../dd/dca/a04847.html#a4fdf924bb54c04c26a2ee6448fa01cae">isTurnDone</a>() ) {</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a>++;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;        }</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    } <span class="comment">// end for: finish one step tracking for all particles for initialTotalNum_m == 2 mode</span></div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    <span class="comment">// store dx and dz for future tune calculation if higher precision needed, reduce freqSample.</span></div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#a453b96859e7bdbd1f5df17f34f6981eb">Options::sptDumpFreq</a> == 0) {</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;        Ttime.push_back(t * <a class="code" href="../../d0/d3d/a04539.html#a749503871b5f00aac95bd6fe1071fdd5">Units::ns2s</a>);</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        Tdeltz.push_back(z_tuning[1]);</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;        Tdeltr.push_back(r_tuning[1] - r_tuning[0]);</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;        TturnNumber.push_back(<a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a>);</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;    }</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;}</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;</div><div class="line"><a name="l03065"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a3aa4e3f090e50a22880361f10775fff9"> 3065</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a3aa4e3f090e50a22880361f10775fff9">ParallelCyclotronTracker::singleMode_m</a>(<span class="keywordtype">double</span>&amp; t, <span class="keyword">const</span> <span class="keywordtype">double</span> dt,</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;                                            <span class="keywordtype">bool</span>&amp; finishedTurn, <span class="keywordtype">double</span>&amp; oldReferenceTheta) {</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    <span class="comment">// 1 particle: Trigger single particle mode</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;    <span class="comment">// ********************************************************************************** //</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    <span class="comment">// * This was moved here b/c collision should be tested before the actual           * //</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;    <span class="comment">// * timestep (bgf_main_collision_test() predicts the next step automatically)      * //</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    <span class="comment">// apply the plugin elements: probe, collimator, stripper, septum</span></div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    <span class="keywordtype">bool</span> flagNeedUpdate = <a class="code" href="../../dd/dca/a04847.html#a68fea5657661817956cb8b52aecd44b0">applyPluginElements</a>(dt);</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    <span class="comment">// check if we lose particles at the boundary</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab251404bffc001dee5f7c39b56c08a6b">bgf_main_collision_test</a>();</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;    <span class="comment">// ********************************************************************************** //</span></div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>() == 0) <span class="keywordflow">return</span>; <span class="comment">// might happen if particle is in collimator</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; <span class="comment">// we only have a single particle</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#a453b96859e7bdbd1f5df17f34f6981eb">Options::sptDumpFreq</a> == 0 ) {</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">outfTrackOrbit_m</a> &lt;&lt; <span class="stringliteral">&quot;ID&quot;</span> &lt;&lt;<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">ID</a>[i]</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](0)</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](0)</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](1)</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](1)</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](2)</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;                         &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i](2)</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;                         &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;    }</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;    <span class="keywordtype">double</span> temp_meanTheta = <a class="code" href="../../dd/dca/a04847.html#ad1fe10141777e52cb4a66fa9fbfa1f49">calculateAngle2</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](0),</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;                                            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i](1)); <span class="comment">// [-pi, pi]</span></div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a9ff9d61613dbb3f45737a245cb32a82a">dumpThetaEachTurn_m</a>(t, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i],</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;                        temp_meanTheta, finishedTurn);</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a05279c9d1f4e62435bd0304a8de108f5">dumpAzimuthAngles_m</a>(t, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i], <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i],</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;                        oldReferenceTheta, temp_meanTheta);</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    oldReferenceTheta = temp_meanTheta;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="comment">// used for gap crossing checking</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> Rold = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i]; <span class="comment">// [x,y,z]    (mm)</span></div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> Pold = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i]; <span class="comment">// [px,py,pz] (beta*gamma)</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    <span class="comment">// integrate for one step in the lab Cartesian frame (absolute value).</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a8de6452f41159e2027fb4cd65d9519fc">itsStepper_mp</a>-&gt;advance(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, i, t, dt);</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;    <span class="comment">// If gap crossing happens, do momenta kicking (not if gap crossing just happened)</span></div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8168f4f0d38ce6c3e77b1a83544a41d2">cavityGapCrossed</a>[i] == <span class="keyword">true</span>)</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8168f4f0d38ce6c3e77b1a83544a41d2">cavityGapCrossed</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a99dd00a33159ed2c1e1e67f53df92b78">gapCrossKick_m</a>(i, t, dt, Rold, Pold);</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    <span class="comment">// Destroy particles if they are marked as Bin = -1 in the plugin elements</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    <span class="comment">// or out of the global aperture</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    flagNeedUpdate |= (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i] &lt; 0);</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ad7eecb45b13ecf2eb11bdc95c6a4f296">deleteParticle</a>(flagNeedUpdate);</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;}</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;</div><div class="line"><a name="l03129"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#aa1d62a6f0278bdacc6dc77ddec8a2e64"> 3129</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#aa1d62a6f0278bdacc6dc77ddec8a2e64">ParallelCyclotronTracker::bunchMode_m</a>(<span class="keywordtype">double</span>&amp; t, <span class="keyword">const</span> <span class="keywordtype">double</span> dt, <span class="keywordtype">bool</span>&amp; finishedTurn) {</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;    <span class="comment">// Flag for transition from single-bunch to multi-bunches mode</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> flagTransition = <span class="keyword">false</span>;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;    <span class="comment">// single particle dumping</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#a453b96859e7bdbd1f5df17f34f6981eb">Options::sptDumpFreq</a> == 0)</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ae413f18725a0b8a5bef87f40d2c32f46">singleParticleDump</a>();</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;    <span class="comment">// Find out if we need to do bunch injection</span></div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a31acc2346a133e5a834afddb1332a0f6">injectBunch</a>(flagTransition);</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;<span class="comment">//     oldReferenceTheta = calculateAngle2(meanR(0), meanR(1));</span></div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <span class="comment">// Calculate SC field before each time step and keep constant during integration.</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    <span class="comment">// Space Charge effects are included only when total macropaticles number is NOT LESS THAN 1000.</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a61749a31a61cc801127ed1ea764d03ca">hasFieldSolver</a>()) {</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a70e03a952c0c250de7f7a5b338cbbe25">scSolveFreq</a> == 0) {</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a472a74c55259d687fd274dbeac60a53a">computeSpaceChargeFields_m</a>();</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;            <span class="comment">// If we are not solving for the space charge fields at this time step</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;            <span class="comment">// we will apply the fields from the previous step and have to rotate them</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;            <span class="comment">// accordingly. For this we find the quaternion between the previous mean momentum (PreviousMeanP)</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;            <span class="comment">// and the current mean momentum (meanP) and rotate the fields with this quaternion.</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;            <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanP = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;            <a class="code" href="../../d2/dc7/a05391.html">Quaternion_t</a> quaternionToNewMeanP;</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9a8843522ab0b1e76f7f19411df5b790">getQuaternionTwoVectors</a>(<a class="code" href="../../dd/dca/a04847.html#a9cef33b9fef5d81d80703c5082038ebc">PreviousMeanP</a>, meanP, quaternionToNewMeanP);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;            <span class="comment">// Reset PreviousMeanP. Cave: This HAS to be after the quaternion is calculated!</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a9cef33b9fef5d81d80703c5082038ebc">PreviousMeanP</a> = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;            <span class="comment">// Rotate the fields</span></div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a02869c9275595621525ce0adb352d6e1">Ef</a>, quaternionToNewMeanP);</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aca40478a5171d91ec95f336b8f3fcfd2">Bf</a>, quaternionToNewMeanP);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;        }</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    }</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;    <span class="comment">// *** This was moved here b/c collision should be tested before the **********************</span></div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    <span class="comment">// *** actual timestep (bgf_main_collision_test() predicts the next step automatically) -DW</span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;    <span class="comment">// Apply the plugin elements: probe, collimator, stripper, septum</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    <span class="keywordtype">bool</span> flagNeedUpdate = <a class="code" href="../../dd/dca/a04847.html#a68fea5657661817956cb8b52aecd44b0">applyPluginElements</a>(dt);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    <span class="comment">// check if we lose particles at the boundary</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab251404bffc001dee5f7c39b56c08a6b">bgf_main_collision_test</a>();</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">getLocalNum</a>(); i++) {</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        <span class="comment">// used for gap crossing checking</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> Rold = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i]; <span class="comment">// [x,y,z]    (mm)</span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> Pold = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i]; <span class="comment">// [px,py,pz] (beta*gamma)</span></div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        <span class="comment">// Integrate for one step in the lab Cartesian frame (absolute value).</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a8de6452f41159e2027fb4cd65d9519fc">itsStepper_mp</a>-&gt;advance(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, i, t, dt);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        <span class="comment">// If gap crossing happens, do momenta kicking (not if gap crossing just happened)</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8168f4f0d38ce6c3e77b1a83544a41d2">cavityGapCrossed</a>[i] == <span class="keyword">true</span>) {</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8168f4f0d38ce6c3e77b1a83544a41d2">cavityGapCrossed</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a99dd00a33159ed2c1e1e67f53df92b78">gapCrossKick_m</a>(i, t, dt, Rold, Pold);</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;        }</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;        flagNeedUpdate |= (<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">Bin</a>[i] &lt; 0);</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;    }</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;    <a class="code" href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a>(<a class="code" href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">IntegrationTimer_m</a>);</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;    <span class="comment">// Destroy particles if they are marked as Bin = -1 in the plugin elements</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    <span class="comment">// or out of global aperture</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ad7eecb45b13ecf2eb11bdc95c6a4f296">deleteParticle</a>(flagNeedUpdate);</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <span class="comment">// Recalculate bingamma and reset the BinID for each particles according to its current gamma</span></div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() &amp;&amp; <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> % <a class="code" href="../../d7/d8b/a04549.html#ac6f115a7078d40475a6249e5dceb9345">Options::rebinFreq</a> == 0) {</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;updateParticleBins(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    }</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="comment">// Some status output for user after each turn</span></div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#a4fdf924bb54c04c26a2ee6448fa01cae">isTurnDone</a>() ) {</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a>++;</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;        finishedTurn = <span class="keyword">true</span>;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;*** Finished turn &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> - 1</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, Total number of live particles: &quot;</span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;              &lt;&lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">getTotalNum</a>() &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;    }</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;    <a class="code" href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">Ippl::Comm</a>-&gt;<a class="code" href="../../da/d49/a09219.html#ac4593203c34f26c625bd51c7502c297e">barrier</a>();</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;}</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;</div><div class="line"><a name="l03224"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a99dd00a33159ed2c1e1e67f53df92b78"> 3224</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a99dd00a33159ed2c1e1e67f53df92b78">ParallelCyclotronTracker::gapCrossKick_m</a>(<span class="keywordtype">size_t</span> i, <span class="keywordtype">double</span> t,</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;                                              <span class="keywordtype">double</span> dt,</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;                                              <span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; Rold,</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;                                              <span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; Pold) {</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">beamline_list::iterator</a> sindex = ++(<a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin());</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;        sindex != <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.end(); ++sindex)</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;    {</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;        <span class="keywordtype">bool</span> tag_crossing = <span class="keyword">false</span>;</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        <span class="keywordtype">double</span> DistOld = 0.0; <span class="comment">//mm</span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;        <a class="code" href="../../d7/d48/a05183.html">RFCavity</a> * rfcav;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;        <span class="keywordflow">if</span> (((*sindex)-&gt;first) == <a class="code" href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ac04b3cc5b1a13dc2463b809070bbb67e">ElementType::RFCAVITY</a>) {</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;            <span class="comment">// here check gap cross in the list, if do , set tag_crossing to TRUE</span></div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;            rfcav = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d7/d48/a05183.html">RFCavity</a> *<span class="keyword">&gt;</span>(((*sindex)-&gt;second).second);</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;            tag_crossing = <a class="code" href="../../dd/dca/a04847.html#a52d5fc95fde1a205343739362d465f36">checkGapCross</a>(Rold, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i], rfcav, DistOld);</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        }</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <span class="keywordflow">if</span> ( tag_crossing ) {</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8168f4f0d38ce6c3e77b1a83544a41d2">cavityGapCrossed</a>[i] = <span class="keyword">true</span>;</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;            <span class="keywordtype">double</span> oldMomentum2  = <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(Pold, Pold);</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;            <span class="keywordtype">double</span> oldBetgam = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(oldMomentum2);</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;            <span class="keywordtype">double</span> oldGamma = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(1.0 + oldMomentum2);</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;            <span class="keywordtype">double</span> oldBeta = oldBetgam / oldGamma;</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            <span class="keywordtype">double</span> dt1 = DistOld / (<a class="code" href="../../d4/dd0/a04537.html#ad8fcab196be0672fdc6e1f091b9bb01a">Physics::c</a> * oldBeta * <a class="code" href="../../d0/d3d/a04539.html#a610458ef9e4cd6ea2d9b23bfddef69f8">Units::m2mm</a> / <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a>); <span class="comment">// ns, c in [mm/ns]</span></div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            <span class="keywordtype">double</span> dt2 = dt - dt1;</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;            <span class="comment">// retrack particle from the old postion to cavity gap point</span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;            <span class="comment">// restore the old coordinates and momenta</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>[i] = Rold;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">P</a>[i] = Pold;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;            <span class="keywordflow">if</span> (dt / dt1 &lt; 1.0e9) {</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a8de6452f41159e2027fb4cd65d9519fc">itsStepper_mp</a>-&gt;advance(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, i, t, dt1);</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;            }</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;            <span class="comment">// Momentum kick</span></div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a5c507cc377b28df9b66a7b3831c2ed05">RFkick</a>(rfcav, t, dt1, i);</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;            <span class="comment">/* Retrack particle from cavity gap point for</span></div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;<span class="comment">             * the left time to finish the entire timestep</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;            <span class="keywordflow">if</span> (dt / dt2 &lt; 1.0e9) {</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;                <a class="code" href="../../dd/dca/a04847.html#a8de6452f41159e2027fb4cd65d9519fc">itsStepper_mp</a>-&gt;advance(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, i, t, dt2);</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;            }</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;        }</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;    }</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;}</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;</div><div class="line"><a name="l03274"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a05279c9d1f4e62435bd0304a8de108f5"> 3274</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a05279c9d1f4e62435bd0304a8de108f5">ParallelCyclotronTracker::dumpAzimuthAngles_m</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t,</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;                                                   <span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>,</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;                                                   <span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; P,</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;                                                   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; oldReferenceTheta,</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;                                                   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; temp_meanTheta) {</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;=2; i++) {</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;        <span class="keywordflow">if</span> ((oldReferenceTheta &lt; <a class="code" href="../../dd/dca/a04847.html#a2b4e517d1c586cac4aa4bd4e4cc187b5">azimuth_angle_m</a>[i] - <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a32d840e781f868f4433aaf563e3b9102">deltaTheta</a>) &amp;&amp;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;            (  temp_meanTheta &gt;= <a class="code" href="../../dd/dca/a04847.html#a2b4e517d1c586cac4aa4bd4e4cc187b5">azimuth_angle_m</a>[i] - <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a32d840e781f868f4433aaf563e3b9102">deltaTheta</a>))</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;        {</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;            *(<a class="code" href="../../dd/dca/a04847.html#a42b090454954eacc9124dd0564ff6c4a">outfTheta_m</a>[i]) &lt;&lt; <span class="stringliteral">&quot;#Turn number = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a></div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot;, Time = &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot; [ns]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::hypot(<a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>(0), <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>(1))</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; P(0) * <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(temp_meanTheta) + P(1) * <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(temp_meanTheta)</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; temp_meanTheta * <a class="code" href="../../d0/d3d/a04539.html#ac9c7e47f91a8010d7c98e49d6e924911">Units::rad2deg</a></div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; - P(0) * <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(temp_meanTheta) + P(1) * <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(temp_meanTheta)</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>(2)</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; P(2) &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;        }</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;    }</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;}</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div><div class="line"><a name="l03296"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a9ff9d61613dbb3f45737a245cb32a82a"> 3296</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a9ff9d61613dbb3f45737a245cb32a82a">ParallelCyclotronTracker::dumpThetaEachTurn_m</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t,</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;                                                   <span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>,</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;                                                   <span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; P,</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;                                                   <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; temp_meanTheta,</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;                                                   <span class="keywordtype">bool</span>&amp; finishedTurn) {</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#a4fdf924bb54c04c26a2ee6448fa01cae">isTurnDone</a>() ) {</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;        ++<a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a>;</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;        finishedTurn = <span class="keyword">true</span>;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* SPT: Finished turn &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> - 1 &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;        *(<a class="code" href="../../dd/dca/a04847.html#a42b090454954eacc9124dd0564ff6c4a">outfTheta_m</a>[3]) &lt;&lt; <span class="stringliteral">&quot;#Turn number = &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot;, Time = &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot; [ns]&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(<a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>(0) * <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>(0) + <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>(1) * <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>(1))</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; P(0) * <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(temp_meanTheta) +</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;                                    P(1) * <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(temp_meanTheta)</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; temp_meanTheta / <a class="code" href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; - P(0) * <a class="code" href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">std::sin</a>(temp_meanTheta) +</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;                                      P(1) * <a class="code" href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">std::cos</a>(temp_meanTheta)</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>(2)</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;                          &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; P(2) &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">std::endl</a>;</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    }</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;}</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;</div><div class="line"><a name="l03321"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a472a74c55259d687fd274dbeac60a53a"> 3321</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a472a74c55259d687fd274dbeac60a53a">ParallelCyclotronTracker::computeSpaceChargeFields_m</a>() {</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    <span class="comment">// Firstly reset E and B to zero before fill new space charge field data for each track step</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aca40478a5171d91ec95f336b8f3fcfd2">Bf</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0);</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a02869c9275595621525ce0adb352d6e1">Ef</a> = <a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0);</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#abf713a03b8e60b20282878c80e42b45d">spiral_flag</a> &amp;&amp; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a4da4a63f81523ab5ff01250771273e82">getFieldSolverType</a>() == <a class="code" href="../../d9/d5e/a03086.html#a2c04156333cc3a156108be6f45c52c46ae176082761913ad28e702817b7388d91">FieldSolverType::SAAMG</a>) {</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        <span class="comment">// --- Single bunch mode with spiral inflector --- //</span></div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        <span class="comment">// If we are doing a spiral inflector simulation and are using the SAAMG solver</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;        <span class="comment">// we don&#39;t rotate or translate the bunch and gamma is 1.0 (non-relativistic).</span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;        <span class="comment">//itsBunch_m-&gt;R *= Vector_t(0.001); // mm --&gt; m</span></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8fc8a2726ce302ccf893c2bf638d6572">setGlobalMeanR</a>(<a class="code" href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a>(0.0, 0.0, 0.0));</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a523b980cb29cdb5359f6db0f28f14859">setGlobalToLocalQuaternion</a>(<a class="code" href="../../d7/d59/a01013.html#a040681895588e18fb97e0ca41cc8d560">Quaternion_t</a>(1.0, 0.0, 0.0, 0.0));</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;        <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a55b7d442caf5f6a0b76d5b59d15947d8">computeSelfFields_cycl</a>(1.0);</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;        <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m --&gt; mm</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> <span class="keyword">const</span> meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>(); <span class="comment">// (m)</span></div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a9cef33b9fef5d81d80703c5082038ebc">PreviousMeanP</a> = <a class="code" href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">calcMeanP</a>();</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;        <span class="comment">// Since calcMeanP takes into account all particles of all bins (TODO: Check this! -DW)</span></div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;        <span class="comment">// Using the quaternion method with PreviousMeanP and yaxis should give the correct result</span></div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;        <a class="code" href="../../d2/dc7/a05391.html">Quaternion_t</a> quaternionToYAxis;</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a9a8843522ab0b1e76f7f19411df5b790">getQuaternionTwoVectors</a>(<a class="code" href="../../dd/dca/a04847.html#a9cef33b9fef5d81d80703c5082038ebc">PreviousMeanP</a>, <a class="code" href="../../dd/dca/a04847.html#a705a3ae603fb70d81bedda510f07c348">yaxis</a>, quaternionToYAxis);</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">globalToLocal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, quaternionToYAxis, meanR);</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;        <span class="comment">//itsBunch_m-&gt;R *= Vector_t(0.001); // mm --&gt; m</span></div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> + 1) % <a class="code" href="../../d7/d8b/a04549.html#a298ab310a012dbdc1be6e41b00944d1c">Options::boundpDestroyFreq</a> == 0) {</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a10684e1d8a9df362042d1d93efee21aa">boundp_destroyCycl</a>();</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#ad1ee6b7f03a3b0613c452a83a5e94641">boundp</a>();</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;        }</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../dd/dca/a04847.html#a47c3f99997b482ad918f9b368dde3ed3">hasMultiBunch</a>()) {</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;            <span class="comment">// --- Multibunch mode --- //</span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;            <span class="comment">// Calculate gamma for each energy bin</span></div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aae4a6a553da223fafcacd4b29167144c">calcGammas_cycl</a>();</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a10e0bca491e7f0692e75f0fc7922da07">repartition</a>();</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;            <span class="comment">// Calculate space charge field for each energy bin</span></div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> b = 0; b &lt; <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a3fc75c2f6f10d9e768b668d9a6281781">getLastemittedBin</a>(); b++) {</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aaed94ffd2ba695bf55c197a56ae45545">setBinCharge</a>(b, <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a19aacd7d2904a811460d487ade713b9a">getChargePerParticle</a>());</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;                <span class="comment">//itsBunch_m-&gt;setGlobalMeanR(0.001 * meanR);</span></div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8fc8a2726ce302ccf893c2bf638d6572">setGlobalMeanR</a>(meanR);</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a523b980cb29cdb5359f6db0f28f14859">setGlobalToLocalQuaternion</a>(quaternionToYAxis);</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;                <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a55b7d442caf5f6a0b76d5b59d15947d8">computeSelfFields_cycl</a>(b);</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;            }</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a5f3de61e1c65ab5b1f336470ae29d48c">Q</a> = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a19aacd7d2904a811460d487ade713b9a">getChargePerParticle</a>();</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;            <span class="comment">// --- Single bunch mode --- //</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;            <span class="keywordtype">double</span> temp_meangamma = <a class="code" href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">std::sqrt</a>(1.0 + <a class="code" href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a>(<a class="code" href="../../dd/dca/a04847.html#a9cef33b9fef5d81d80703c5082038ebc">PreviousMeanP</a>, <a class="code" href="../../dd/dca/a04847.html#a9cef33b9fef5d81d80703c5082038ebc">PreviousMeanP</a>));</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a10e0bca491e7f0692e75f0fc7922da07">repartition</a>();</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;            <span class="comment">//itsBunch_m-&gt;setGlobalMeanR(0.001 * meanR);</span></div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a8fc8a2726ce302ccf893c2bf638d6572">setGlobalMeanR</a>(meanR);</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a523b980cb29cdb5359f6db0f28f14859">setGlobalToLocalQuaternion</a>(quaternionToYAxis);</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;            <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a55b7d442caf5f6a0b76d5b59d15947d8">computeSelfFields_cycl</a>(temp_meangamma);</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;        }</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;        <span class="comment">//scale coordinates back</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;        <span class="comment">//itsBunch_m-&gt;R *= Vector_t(1000.0); // m --&gt; mm</span></div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        <span class="comment">// Transform coordinates back to global</span></div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">R</a>, quaternionToYAxis, meanR);</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;        <span class="comment">// Transform self field back to global frame (rotate only)</span></div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a02869c9275595621525ce0adb352d6e1">Ef</a>, quaternionToYAxis);</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">localToGlobal</a>(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#aca40478a5171d91ec95f336b8f3fcfd2">Bf</a>, quaternionToYAxis);</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;    }</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;}</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;</div><div class="line"><a name="l03411"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ab35a878d911033d3e2e32089027f3e9b"> 3411</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a24e7de550ff5ade419fcd0838a026a3d">ParallelCyclotronTracker::computeExternalFields_m</a>(<span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; i, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t,</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;                                                       <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; Efield, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; Bfield) {</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    <a class="code" href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">beamline_list::iterator</a> sindex = <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin();</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;    <span class="comment">// Flag whether a particle is out of field</span></div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;    <span class="keywordtype">bool</span> outOfBound = (((*sindex)-&gt;second).second)-&gt;apply(i, t, Efield, Bfield);</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;    Bfield *= <a class="code" href="../../d0/d3d/a04539.html#ac294dfae49b56b7534adc75143a93a50">Units::kG2T</a>;</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;    Efield *= <a class="code" href="../../d0/d3d/a04539.html#aa78682c4d302f04b7515c830a29dbbfd">Units::kV2V</a> / <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a>;</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="keywordflow">return</span> outOfBound;</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;}</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;</div><div class="line"><a name="l03425"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a24e7de550ff5ade419fcd0838a026a3d"> 3425</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dd/dca/a04847.html#a24e7de550ff5ade419fcd0838a026a3d">ParallelCyclotronTracker::computeExternalFields_m</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; <a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>, <span class="keyword">const</span> <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; P, <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; t,</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;                                                       <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; Efield, <a class="code" href="../../dd/d24/a07475.html">Vector_t</a>&amp; Bfield) {</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;    <a class="code" href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">beamline_list::iterator</a> sindex = <a class="code" href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">FieldDimensions</a>.begin();</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;    <span class="comment">// Flag whether a particle is out of field</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;    <span class="keywordtype">bool</span> outOfBound = (((*sindex)-&gt;second).second)-&gt;apply(<a class="code" href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">R</a>, P, t, Efield, Bfield);</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;    Bfield *= <a class="code" href="../../d0/d3d/a04539.html#ac294dfae49b56b7534adc75143a93a50">Units::kG2T</a>;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;    Efield *= <a class="code" href="../../d0/d3d/a04539.html#aa78682c4d302f04b7515c830a29dbbfd">Units::kV2V</a> / <a class="code" href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a>;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;    <span class="keywordflow">return</span> outOfBound;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;}</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;</div><div class="line"><a name="l03440"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a31acc2346a133e5a834afddb1332a0f6"> 3440</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a31acc2346a133e5a834afddb1332a0f6">ParallelCyclotronTracker::injectBunch</a>(<span class="keywordtype">bool</span>&amp; flagTransition) {</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() || <a class="code" href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">step_m</a> != <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#abd81f5dbcda886d66f60dbdf53799e28">stepsNextCheck</a>) {</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;    }</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">short</span> result = <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;injectBunch(<a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>, <a class="code" href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">itsReference</a>,</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;                                                  flagTransition);</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    <span class="keywordflow">switch</span> ( result ) {</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;        <span class="keywordflow">case</span> 0: {</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;            <span class="comment">// nothing happened</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;        }</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;        <span class="keywordflow">case</span> 1: {</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            <span class="comment">// bunch got saved</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a4fc2af79c0bf674856416b87028369a2">saveInjectValues</a>();</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#abd81f5dbcda886d66f60dbdf53799e28">stepsNextCheck</a> += <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">stepsPerTurn</a>;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;            <span class="keywordflow">if</span> ( flagTransition ) {</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;                *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* MBM: Saving beam distribution at turn &quot;</span> &lt;&lt; <a class="code" href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">turnnumber_m</a> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;                *<a class="code" href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a> &lt;&lt; <span class="stringliteral">&quot;* MBM: After one revolution, Multi-Bunch Mode will be invoked&quot;</span> &lt;&lt; <a class="code" href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a>;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;            }</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;        }</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;        <span class="keywordflow">case</span> 2: {</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;            <span class="comment">// bunch got injected</span></div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;            <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#abd81f5dbcda886d66f60dbdf53799e28">stepsNextCheck</a> += <a class="code" href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">setup_m</a>.<a class="code" href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">stepsPerTurn</a>;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;        }</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;        <span class="keywordflow">default</span>: {</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;            <span class="keywordflow">throw</span> <a class="code" href="../../dd/d99/a07323.html">OpalException</a>(<span class="stringliteral">&quot;ParallelCyclotronTracker::injectBunch()&quot;</span>,</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                                <span class="stringliteral">&quot;Unknown return value &quot;</span> + std::to_string(result));</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;        }</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;    }</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;}</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;</div><div class="line"><a name="l03476"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a4fc2af79c0bf674856416b87028369a2"> 3476</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a4fc2af79c0bf674856416b87028369a2">ParallelCyclotronTracker::saveInjectValues</a>() {</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;    <span class="keywordflow">if</span> ( !<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    }</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>();</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;    <span class="comment">// Bunch (global) angle w.r.t. x-axis (cylinder coordinates)</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;    <span class="keywordtype">double</span> theta = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanR(0), meanR(1)) * <a class="code" href="../../d0/d3d/a04539.html#ac9c7e47f91a8010d7c98e49d6e924911">Units::rad2deg</a>;</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;    <span class="comment">// fix azimuth_m --&gt; make monotonically increasing</span></div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a68e7cdb19cd27bdaf777e4092158bff0">dumpAngle</a>(theta, <a class="code" href="../../dd/dca/a04847.html#acc4f790cd7ac121d150eefac50cb2166">prevAzimuth_m</a>, <a class="code" href="../../dd/dca/a04847.html#a140b8898b353d8a9df18c0bfb5b289d0">azimuth_m</a>);</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> radius = <a class="code" href="../../dd/dca/a04847.html#a5dc5b769d60d7310d604b9623fe31f4b">computeRadius</a>(meanR);</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;    <a class="code" href="../../d6/d6f/a04819.html">MultiBunchHandler::injection_t</a>&amp; inj = <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;getInjectionValues();</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;    inj.<a class="code" href="../../d6/d6f/a04819.html#a2dacae1107896d1d8b6ffefc77aabf5e">time</a>       = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>() * <a class="code" href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a>;</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;    inj.<a class="code" href="../../d6/d6f/a04819.html#a7019d93696ad9a040b7887886406fdd2">pathlength</a> = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af1981256edd10c077d2c6ae225b1b9b6">get_sPos</a>();</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;    inj.<a class="code" href="../../d6/d6f/a04819.html#a53633ef0e15f9b5e75049f986b64190e">azimuth</a>    = <a class="code" href="../../dd/dca/a04847.html#a140b8898b353d8a9df18c0bfb5b289d0">azimuth_m</a>;</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;    inj.<a class="code" href="../../d6/d6f/a04819.html#a266a5dab6906981146329961e4f4b1b4">radius</a>     = radius;</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;}</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;</div><div class="line"><a name="l03500"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a5dfd077e43b0e75cd740b32a4944713b"> 3500</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a5dfd077e43b0e75cd740b32a4944713b">ParallelCyclotronTracker::updatePathLength</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; dt) {</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;    <span class="comment">/* the last element includes all particles,</span></div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;<span class="comment">     * all other elements are bunch number specific</span></div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;    std::vector&lt;double&gt; lpaths(1);</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        lpaths.resize(<a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;getNumBunch() + 1);</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;    }</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#a00991ee8b1feb2e195fe423a67eae1d9">computePathLengthUpdate</a>(lpaths, dt);</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;    <a class="code" href="../../dd/dca/a04847.html#ab2aa67387d9fcce4400137ec44d08b60">pathLength_m</a> += lpaths.back();</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#a2495b52e4f4220f661085319990c8936">set_sPos</a>(<a class="code" href="../../dd/dca/a04847.html#ab2aa67387d9fcce4400137ec44d08b60">pathLength_m</a>);</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;updatePathLength(lpaths);</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;    }</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;}</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div><div class="line"><a name="l03521"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a601a0ddf82954fd61f5139586e3389ba"> 3521</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a601a0ddf82954fd61f5139586e3389ba">ParallelCyclotronTracker::updateTime</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; dt) {</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    <span class="comment">// t is in seconds</span></div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    <span class="keywordtype">double</span> t = <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">getT</a>();</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;    <a class="code" href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">itsBunch_m</a>-&gt;<a class="code" href="../../d9/d06/a04735.html#addc3c351123a7c560c34507b2fa67b5c">setT</a>(t + dt * <a class="code" href="../../d0/d3d/a04539.html#a749503871b5f00aac95bd6fe1071fdd5">Units::ns2s</a>);</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;updateTime(dt);</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    }</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;}</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;</div><div class="line"><a name="l03533"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#a840b1f8ae80e3e83dfc32de00ef8e090"> 3533</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#a840b1f8ae80e3e83dfc32de00ef8e090">ParallelCyclotronTracker::updateAzimuthAndRadius</a>() {</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>()) {</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    }</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">short</span> b = 0; b &lt; <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;getNumBunch(); ++b) {</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;        <a class="code" href="../../dd/d24/a07475.html">Vector_t</a> meanR = <a class="code" href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">calcMeanR</a>(b);</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;        <a class="code" href="../../d6/d34/a04823.html">MultiBunchHandler::beaminfo_t</a>&amp; binfo = <a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>-&gt;getBunchInfo(b);</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;        binfo.<a class="code" href="../../d6/d34/a04823.html#a5d177ee17dfe89492526dba49dd8ef43">radius</a>  = <a class="code" href="../../dd/dca/a04847.html#a5dc5b769d60d7310d604b9623fe31f4b">computeRadius</a>(meanR);</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;        <span class="keywordtype">double</span> azimuth = <a class="code" href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">calculateAngle</a>(meanR(0), meanR(1)) * <a class="code" href="../../d0/d3d/a04539.html#ac9c7e47f91a8010d7c98e49d6e924911">Units::rad2deg</a>;</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a68e7cdb19cd27bdaf777e4092158bff0">dumpAngle</a>(azimuth, binfo.<a class="code" href="../../d6/d34/a04823.html#a7a0770f8b060534be3c679f8d0d53514">prevAzimuth</a>, binfo.<a class="code" href="../../d6/d34/a04823.html#a23cc0eb5e97f8ed8839a49a6ef754635">azimuth</a>, b);</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    }</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;}</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;</div><div class="line"><a name="l03549"></a><span class="lineno"><a class="line" href="../../dd/dca/a04847.html#ab4724e863899fa7bf8bbc59cf2e22cbe"> 3549</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dd/dca/a04847.html#ab4724e863899fa7bf8bbc59cf2e22cbe">ParallelCyclotronTracker::initPathLength</a>() {</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">isMultiBunch</a>() ) {</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;        <span class="comment">// we need to reset the path length of each bunch</span></div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;        <a class="code" href="../../dd/dca/a04847.html#a248cafbfeef5f7465d79fc5bde4662c6">itsDataSink</a>-&gt;<a class="code" href="../../d7/d4d/a07199.html#a034c1da0d8ebe536ecf7d2815930fc94">setMultiBunchInitialPathLengh</a>(<a class="code" href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">mbHandler_m</a>.get());</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;    }</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;}</div><div class="ttc" id="a05047_html"><div class="ttname"><a href="../../d3/dd5/a05047.html">Corrector</a></div><div class="ttdoc">Interface for general corrector. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d5c/a00578_source.html#l00035">Corrector.h:35</a></div></div>
<div class="ttc" id="a04735_html_a270741b3a4a1bd7d6ff17a6ea690255b"><div class="ttname"><a href="../../d9/d06/a04735.html#a270741b3a4a1bd7d6ff17a6ea690255b">PartBunchBase::updateNumTotal</a></div><div class="ttdeci">void updateNumTotal()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l00305">PartBunchBase.hpp:305</a></div></div>
<div class="ttc" id="a05071_html_a1b412456edcf01147abada7721605101"><div class="ttname"><a href="../../db/d78/a05071.html#a1b412456edcf01147abada7721605101">ElementBase::getElementLength</a></div><div class="ttdeci">virtual double getElementLength() const</div><div class="ttdoc">Get design length. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0a/a00602_source.html#l00414">ElementBase.h:414</a></div></div>
<div class="ttc" id="a05059_html_a60929072e89749b3003cfedb5a34fd34"><div class="ttname"><a href="../../d6/de9/a05059.html#a60929072e89749b3003cfedb5a34fd34">Cyclotron::getRmax</a></div><div class="ttdeci">virtual double getRmax() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00305">Cyclotron.cpp:305</a></div></div>
<div class="ttc" id="a01853_html"><div class="ttname"><a href="../../db/d6b/a01853.html">Physics.h</a></div></div>
<div class="ttc" id="a04539_html_ac294dfae49b56b7534adc75143a93a50"><div class="ttname"><a href="../../d0/d3d/a04539.html#ac294dfae49b56b7534adc75143a93a50">Units::kG2T</a></div><div class="ttdeci">constexpr double kG2T</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00059">Units.h:59</a></div></div>
<div class="ttc" id="a05247_html"><div class="ttname"><a href="../../d8/da5/a05247.html">Vacuum</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/de8/a00839_source.html#l00061">Vacuum.h:61</a></div></div>
<div class="ttc" id="a04847_html_a5eaf210491af2f2a02edde9db8a2e072"><div class="ttname"><a href="../../dd/dca/a04847.html#a5eaf210491af2f2a02edde9db8a2e072">ParallelCyclotronTracker::setup_m</a></div><div class="ttdeci">struct ParallelCyclotronTracker::settings setup_m</div></div>
<div class="ttc" id="a02168_html_acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334"><div class="ttname"><a href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5a6eecfba72d12922ee1dead07a0ef3334">DumpFrame::GLOBAL</a></div></div>
<div class="ttc" id="a04539_html_ae5357e8a4622de64853ecc793737a79d"><div class="ttname"><a href="../../d0/d3d/a04539.html#ae5357e8a4622de64853ecc793737a79d">Units::deg2rad</a></div><div class="ttdeci">constexpr double deg2rad</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00143">Units.h:143</a></div></div>
<div class="ttc" id="a09623_html_a3fc943d7af8a5f88178faeab977802c0"><div class="ttname"><a href="../../d9/de9/a09623.html#a3fc943d7af8a5f88178faeab977802c0">Message::put</a></div><div class="ttdeci">Message &amp; put(const T &amp;val)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1c/a03692_source.html#l00406">Message.h:406</a></div></div>
<div class="ttc" id="a04550_html_a22fe2d8fb5afd81d8466be75b93ee345"><div class="ttname"><a href="../../d2/df8/a04550.html#a22fe2d8fb5afd81d8466be75b93ee345">Util::boolVectorToUpperString</a></div><div class="ttdeci">std::string boolVectorToUpperString(const std::vector&lt; bool &gt; &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d59/a02219_source.html#l00160">Util.cpp:160</a></div></div>
<div class="ttc" id="a04735_html_af1981256edd10c077d2c6ae225b1b9b6"><div class="ttname"><a href="../../d9/d06/a04735.html#af1981256edd10c077d2c6ae225b1b9b6">PartBunchBase::get_sPos</a></div><div class="ttdeci">double get_sPos() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01049">PartBunchBase.hpp:1049</a></div></div>
<div class="ttc" id="a04735_html_a51ee6119a807a463ea3ae3acf14618d0"><div class="ttname"><a href="../../d9/d06/a04735.html#a51ee6119a807a463ea3ae3acf14618d0">PartBunchBase::getLocalNumPerBunch</a></div><div class="ttdeci">size_t getLocalNumPerBunch(short n) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01448">PartBunchBase.hpp:1448</a></div></div>
<div class="ttc" id="a04847_html_a117429ca368f7dca0e3bea11ed991021"><div class="ttname"><a href="../../dd/dca/a04847.html#a117429ca368f7dca0e3bea11ed991021">ParallelCyclotronTracker::extB_m</a></div><div class="ttdeci">Vector_t extB_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00303">ParallelCyclotronTracker.h:303</a></div></div>
<div class="ttc" id="a04847_html_a982b55a67be81156364fe1f8af54c4b2"><div class="ttname"><a href="../../dd/dca/a04847.html#a982b55a67be81156364fe1f8af54c4b2">ParallelCyclotronTracker::finalizeTracking_m</a></div><div class="ttdeci">void finalizeTracking_m(dvector_t &amp;Ttime, dvector_t &amp;Tdeltr, dvector_t &amp;Tdeltz, ivector_t &amp;TturnNumber)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02946">ParallelCyclotronTracker.cpp:2946</a></div></div>
<div class="ttc" id="a04847_html_a2ec2bc6a0a79dae23c6c568b36a561e5"><div class="ttname"><a href="../../dd/dca/a04847.html#a2ec2bc6a0a79dae23c6c568b36a561e5">ParallelCyclotronTracker::mbHandler_m</a></div><div class="ttdeci">std::unique_ptr&lt; MultiBunchHandler &gt; mbHandler_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00262">ParallelCyclotronTracker.h:262</a></div></div>
<div class="ttc" id="a04847_html_a8de6452f41159e2027fb4cd65d9519fc"><div class="ttname"><a href="../../dd/dca/a04847.html#a8de6452f41159e2027fb4cd65d9519fc">ParallelCyclotronTracker::itsStepper_mp</a></div><div class="ttdeci">std::unique_ptr&lt; Stepper&lt; function_t &gt; &gt; itsStepper_mp</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00460">ParallelCyclotronTracker.h:460</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8ae69b8a2544417fb71e2767e95d7ac8f3"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ae69b8a2544417fb71e2767e95d7ac8f3">ElementType::RING</a></div></div>
<div class="ttc" id="a07147_html_a063ebfefbbf275703add583e42f5bd5f"><div class="ttname"><a href="../../df/d78/a07147.html#a063ebfefbbf275703add583e42f5bd5f">BorisPusher::kick</a></div><div class="ttdeci">void kick(const Vector_t &amp;R, Vector_t &amp;P, const Vector_t &amp;Ef, const Vector_t &amp;Bf, const double &amp;dt) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d23/a03038_source.html#l00065">BorisPusher.h:65</a></div></div>
<div class="ttc" id="a04847_html_a83172750245917351809eb7cca06595c"><div class="ttname"><a href="../../dd/dca/a04847.html#a83172750245917351809eb7cca06595c">ParallelCyclotronTracker::globalToLocal</a></div><div class="ttdeci">void globalToLocal(ParticleAttrib&lt; Vector_t &gt; &amp;vectorArray, double phi, Vector_t const translationToGlobal=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01674">ParallelCyclotronTracker.cpp:1674</a></div></div>
<div class="ttc" id="a04847_html_aba83f00e82d1cb7ae648db1c9c77c9d1"><div class="ttname"><a href="../../dd/dca/a04847.html#aba83f00e82d1cb7ae648db1c9c77c9d1">ParallelCyclotronTracker::rotateWithQuaternion</a></div><div class="ttdeci">void rotateWithQuaternion(ParticleAttrib&lt; Vector_t &gt; &amp;vectorArray, Quaternion_t const quaternion)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01820">ParallelCyclotronTracker.cpp:1820</a></div></div>
<div class="ttc" id="a00770_html_a14f1d94ac9a52ad024e43601016e506fa999a80f850dea20daf38a72e6afce808"><div class="ttname"><a href="../../d0/d7e/a00770.html#a14f1d94ac9a52ad024e43601016e506fa999a80f850dea20daf38a72e6afce808">CavityType::SGSW</a></div></div>
<div class="ttc" id="a04723_html_a5ec68ba1c3f450f8ea2b139f193c5a39"><div class="ttname"><a href="../../dc/d12/a04723.html#a5ec68ba1c3f450f8ea2b139f193c5a39">Object::getOpalName</a></div><div class="ttdeci">const std::string &amp; getOpalName() const</div><div class="ttdoc">Return object name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db1/a00200_source.html#l00310">Object.cpp:310</a></div></div>
<div class="ttc" id="a05187_html_a7aca0509073f7b4c420ad11f118919b8"><div class="ttname"><a href="../../db/d48/a05187.html#a7aca0509073f7b4c420ad11f118919b8">Ring::initialise</a></div><div class="ttdeci">virtual void initialise(PartBunchBase&lt; double, 3 &gt; *bunch, double &amp;startField, double &amp;endField) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dba/a00773_source.html#l00162">Ring.cpp:162</a></div></div>
<div class="ttc" id="a05187_html_a46dc7ddd81b6fa4f579202ce27efa1d8"><div class="ttname"><a href="../../db/d48/a05187.html#a46dc7ddd81b6fa4f579202ce27efa1d8">Ring::getNextNormal</a></div><div class="ttdeci">Vector_t getNextNormal() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dba/a00773_source.html#l00220">Ring.cpp:220</a></div></div>
<div class="ttc" id="a04739_html_ad8297e5d291eb54eef52a22af617cf64"><div class="ttname"><a href="../../d5/d13/a04739.html#ad8297e5d291eb54eef52a22af617cf64">OpalData::getGlobalGeometry</a></div><div class="ttdeci">BoundaryGeometry * getGlobalGeometry()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc1/a00212_source.html#l00461">OpalData.cpp:461</a></div></div>
<div class="ttc" id="a00299_html_af2090682b58787f3464d7bf5b07b3ea8"><div class="ttname"><a href="../../df/d95/a00299.html#af2090682b58787f3464d7bf5b07b3ea8">gmsg</a></div><div class="ttdeci">Inform * gmsg</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df8/a02717_source.html#l00061">Main.cpp:61</a></div></div>
<div class="ttc" id="a04847_html_acc4f790cd7ac121d150eefac50cb2166"><div class="ttname"><a href="../../dd/dca/a04847.html#acc4f790cd7ac121d150eefac50cb2166">ParallelCyclotronTracker::prevAzimuth_m</a></div><div class="ttdeci">double prevAzimuth_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00285">ParallelCyclotronTracker.h:285</a></div></div>
<div class="ttc" id="a04735_html_a80253d8da2e44f1c729d52f685a11918"><div class="ttname"><a href="../../d9/d06/a04735.html#a80253d8da2e44f1c729d52f685a11918">PartBunchBase::getTotalNumPerBunch</a></div><div class="ttdeci">size_t getTotalNumPerBunch(short n) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01434">PartBunchBase.hpp:1434</a></div></div>
<div class="ttc" id="a05623_html"><div class="ttname"><a href="../../d3/d4e/a05623.html">Beamline</a></div><div class="ttdoc">An abstract sequence of beam line components. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d39/a01271_source.html#l00034">Beamline.h:34</a></div></div>
<div class="ttc" id="a04735_html_a61749a31a61cc801127ed1ea764d03ca"><div class="ttname"><a href="../../d9/d06/a04735.html#a61749a31a61cc801127ed1ea764d03ca">PartBunchBase::hasFieldSolver</a></div><div class="ttdeci">bool hasFieldSolver()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01351">PartBunchBase.hpp:1351</a></div></div>
<div class="ttc" id="a05187_html_ac6000b3bd09a98173421e5b3acfd61ce"><div class="ttname"><a href="../../db/d48/a05187.html#ac6000b3bd09a98173421e5b3acfd61ce">Ring::getHarmonicNumber</a></div><div class="ttdeci">double getHarmonicNumber()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/a00776_source.html#l00222">Ring.h:222</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8a7017fe0dbc9f6646ba4165017bb61188"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a7017fe0dbc9f6646ba4165017bb61188">ElementType::SEPTUM</a></div></div>
<div class="ttc" id="a04847_html_ab7465c427fa65b689499fa1678417050"><div class="ttname"><a href="../../dd/dca/a04847.html#ab7465c427fa65b689499fa1678417050">ParallelCyclotronTracker::buildupFieldList</a></div><div class="ttdeci">void buildupFieldList(double BcParameter[], ElementType elementType, Component *elptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01112">ParallelCyclotronTracker.cpp:1112</a></div></div>
<div class="ttc" id="a03974_html_a92f1a0cddb2239428b24e94b918e4efb"><div class="ttname"><a href="../../d4/d2e/a03974.html#a92f1a0cddb2239428b24e94b918e4efb">INFORM_ALL_NODES</a></div><div class="ttdeci">#define INFORM_ALL_NODES</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2e/a03974_source.html#l00039">Inform.h:39</a></div></div>
<div class="ttc" id="a03713_html_a9143761a2f804639c3d7c7134dea8d44"><div class="ttname"><a href="../../dd/df6/a03713.html#a9143761a2f804639c3d7c7134dea8d44">IPPL_APP_TAG4</a></div><div class="ttdeci">#define IPPL_APP_TAG4</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df6/a03713_source.html#l00097">Tags.h:97</a></div></div>
<div class="ttc" id="a00839_html"><div class="ttname"><a href="../../df/de8/a00839.html">Vacuum.h</a></div></div>
<div class="ttc" id="a00668_html"><div class="ttname"><a href="../../d0/d5c/a00668.html">MultipoleTCurvedConstRadius.h</a></div></div>
<div class="ttc" id="a07155_html"><div class="ttname"><a href="../../d3/db9/a07155.html">RK4</a></div><div class="ttdoc">4-th order Runnge-Kutta stepper </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de4/a03047_source.html#l00027">RK4.h:27</a></div></div>
<div class="ttc" id="a04847_html_a1e624e38e72dda3c7a47906428c8ca90"><div class="ttname"><a href="../../dd/dca/a04847.html#a1e624e38e72dda3c7a47906428c8ca90">ParallelCyclotronTracker::referencePr</a></div><div class="ttdeci">double referencePr</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00244">ParallelCyclotronTracker.h:244</a></div></div>
<div class="ttc" id="a05059_html_a94f9e38d995d2223e25e8a4119986eab"><div class="ttname"><a href="../../d6/de9/a05059.html#a94f9e38d995d2223e25e8a4119986eab">Cyclotron::getRfPhi</a></div><div class="ttdeci">virtual std::vector&lt; double &gt; getRfPhi() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00213">Cyclotron.cpp:213</a></div></div>
<div class="ttc" id="a04819_html"><div class="ttname"><a href="../../d6/d6f/a04819.html">MultiBunchHandler::injection_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00037">MultiBunchHandler.h:37</a></div></div>
<div class="ttc" id="a04735_html_a4f7728801e0d3c663b2d2b49246c665d"><div class="ttname"><a href="../../d9/d06/a04735.html#a4f7728801e0d3c663b2d2b49246c665d">PartBunchBase::setLocalNumPerBunch</a></div><div class="ttdeci">void setLocalNumPerBunch(size_t numpart, short n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01441">PartBunchBase.hpp:1441</a></div></div>
<div class="ttc" id="a05379_html"><div class="ttname"><a href="../../dd/d3d/a05379.html">PartData</a></div><div class="ttdoc">Particle reference data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/a00998_source.html#l00035">PartData.h:35</a></div></div>
<div class="ttc" id="a04819_html_a53633ef0e15f9b5e75049f986b64190e"><div class="ttname"><a href="../../d6/d6f/a04819.html#a53633ef0e15f9b5e75049f986b64190e">MultiBunchHandler::injection_t::azimuth</a></div><div class="ttdeci">double azimuth</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00047">MultiBunchHandler.h:47</a></div></div>
<div class="ttc" id="a03542_html_a418b01af7e1c6223e54608b7e75e0cf6"><div class="ttname"><a href="../../d4/d5e/a03542.html#a418b01af7e1c6223e54608b7e75e0cf6">max</a></div><div class="ttdeci">T::PETE_Expr_t::PETE_Return_t max(const PETE_Expr&lt; T &gt; &amp;expr, NDIndex&lt; D &gt; &amp;loc)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d5e/a03542_source.html#l00084">ReductionLoc.h:84</a></div></div>
<div class="ttc" id="a04735_html_a9e73bbdc479046a669d634051609598e"><div class="ttname"><a href="../../d9/d06/a04735.html#a9e73bbdc479046a669d634051609598e">PartBunchBase::getStepsPerTurn</a></div><div class="ttdeci">int getStepsPerTurn() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01377">PartBunchBase.hpp:1377</a></div></div>
<div class="ttc" id="a04847_html_adf87b5b7d4f21f9e9c962dd0ce159236"><div class="ttname"><a href="../../dd/dca/a04847.html#adf87b5b7d4f21f9e9c962dd0ce159236">ParallelCyclotronTracker::visitFlexibleCollimator</a></div><div class="ttdeci">virtual void visitFlexibleCollimator(const FlexibleCollimator &amp;)</div><div class="ttdoc">Apply the algorithm to a flexible collimator. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00569">ParallelCyclotronTracker.cpp:569</a></div></div>
<div class="ttc" id="a04735_html_aac28c50caf6e56e830f5ba00e3d92bda"><div class="ttname"><a href="../../d9/d06/a04735.html#aac28c50caf6e56e830f5ba00e3d92bda">PartBunchBase::getDistType</a></div><div class="ttdeci">DistributionType getDistType() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01676">PartBunchBase.hpp:1676</a></div></div>
<div class="ttc" id="a09219_html_ac0e671485db61cd6fdf8961504250b2b"><div class="ttname"><a href="../../da/d49/a09219.html#ac0e671485db61cd6fdf8961504250b2b">Communicate::receive_block</a></div><div class="ttdeci">Message * receive_block(int &amp;node, int &amp;tag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/df9/a03665_source.html#l00300">Communicate.cpp:300</a></div></div>
<div class="ttc" id="a00656_html"><div class="ttname"><a href="../../dc/df2/a00656.html">MultipoleT.h</a></div></div>
<div class="ttc" id="a05067_html"><div class="ttname"><a href="../../d3/df0/a05067.html">Drift</a></div><div class="ttdoc">Interface for drift space. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00033">Drift.h:33</a></div></div>
<div class="ttc" id="a04847_html_a39eda77c6c8e9977d77732eccff45832"><div class="ttname"><a href="../../dd/dca/a04847.html#a39eda77c6c8e9977d77732eccff45832">ParallelCyclotronTracker::visitCCollimator</a></div><div class="ttdeci">virtual void visitCCollimator(const CCollimator &amp;)</div><div class="ttdoc">Apply the algorithm to a collimator. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00491">ParallelCyclotronTracker.cpp:491</a></div></div>
<div class="ttc" id="a00893_html_ae000d8140b7105680d14b9db8786945d"><div class="ttname"><a href="../../dc/d2c/a00893.html#ae000d8140b7105680d14b9db8786945d">sin</a></div><div class="ttdeci">Tps&lt; T &gt; sin(const Tps&lt; T &gt; &amp;x)</div><div class="ttdoc">Sine. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2c/a00893_source.html#l00111">TpsMath.h:111</a></div></div>
<div class="ttc" id="a04735_html_aca3eb11cbe8b8affeae9aef3ba398e75"><div class="ttname"><a href="../../d9/d06/a04735.html#aca3eb11cbe8b8affeae9aef3ba398e75">PartBunchBase::destroy</a></div><div class="ttdeci">void destroy(size_t M, size_t I, bool doNow=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01994">PartBunchBase.hpp:1994</a></div></div>
<div class="ttc" id="a04847_html_a8b82aeeeef07b0058ccc6869846a3a4e"><div class="ttname"><a href="../../dd/dca/a04847.html#a8b82aeeeef07b0058ccc6869846a3a4e">ParallelCyclotronTracker::cavCrossDatas_m</a></div><div class="ttdeci">std::vector&lt; CavityCrossData &gt; cavCrossDatas_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00222">ParallelCyclotronTracker.h:222</a></div></div>
<div class="ttc" id="a04847_html_a58aca05163adeaae3cf39bb3a2734726"><div class="ttname"><a href="../../dd/dca/a04847.html#a58aca05163adeaae3cf39bb3a2734726">ParallelCyclotronTracker::normalizeVector</a></div><div class="ttdeci">void normalizeVector(Vector_t &amp;vector)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01846">ParallelCyclotronTracker.cpp:1846</a></div></div>
<div class="ttc" id="a05107_html_a4c16c9e3bf313baa1600d739c1852322"><div class="ttname"><a href="../../da/d41/a05107.html#a4c16c9e3bf313baa1600d739c1852322">MultipoleT::clone</a></div><div class="ttdeci">ElementBase * clone() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../de/ddd/a00653_source.html#l00084">MultipoleT.cpp:84</a></div></div>
<div class="ttc" id="a04550_html_a1c34d43d91ced76e4bd1c6c57bcb345e"><div class="ttname"><a href="../../d2/df8/a04550.html#a1c34d43d91ced76e4bd1c6c57bcb345e">Util::doubleVectorToString</a></div><div class="ttdeci">std::string doubleVectorToString(const std::vector&lt; double &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d59/a02219_source.html#l00175">Util.cpp:175</a></div></div>
<div class="ttc" id="a05059_html_a7244044e37c23a1caedada75c427cc7d"><div class="ttname"><a href="../../d6/de9/a05059.html#a7244044e37c23a1caedada75c427cc7d">Cyclotron::getZinit</a></div><div class="ttdeci">virtual double getZinit() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00151">Cyclotron.cpp:151</a></div></div>
<div class="ttc" id="a05167_html"><div class="ttname"><a href="../../df/daa/a05167.html">PluginElement</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dfa/a00746_source.html#l00030">PluginElement.h:30</a></div></div>
<div class="ttc" id="a04735_html_a5f3de61e1c65ab5b1f336470ae29d48c"><div class="ttname"><a href="../../d9/d06/a04735.html#a5f3de61e1c65ab5b1f336470ae29d48c">PartBunchBase::Q</a></div><div class="ttdeci">ParticleAttrib&lt; double &gt; Q</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00575">PartBunchBase.h:575</a></div></div>
<div class="ttc" id="a00215_html"><div class="ttname"><a href="../../d3/dd5/a00215.html">OpalData.h</a></div></div>
<div class="ttc" id="a01007_html"><div class="ttname"><a href="../../d6/d8d/a01007.html">PolynomialTimeDependence.h</a></div></div>
<div class="ttc" id="a00644_html"><div class="ttname"><a href="../../d9/d0f/a00644.html">Monitor.h</a></div></div>
<div class="ttc" id="a05187_html_a4b16975819f51cbdb8ca2c353245bb50"><div class="ttname"><a href="../../db/d48/a05187.html#a4b16975819f51cbdb8ca2c353245bb50">Ring::getBeamPRInit</a></div><div class="ttdeci">double getBeamPRInit() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/a00776_source.html#l00247">Ring.h:247</a></div></div>
<div class="ttc" id="a01271_html"><div class="ttname"><a href="../../dd/d39/a01271.html">Beamline.h</a></div></div>
<div class="ttc" id="a05071_html_a07827d00308052e65fe03da558f0b987"><div class="ttname"><a href="../../db/d78/a05071.html#a07827d00308052e65fe03da558f0b987">ElementBase::getName</a></div><div class="ttdeci">virtual const std::string &amp; getName() const</div><div class="ttdoc">Get element name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8a/a00599_source.html#l00163">ElementBase.cpp:163</a></div></div>
<div class="ttc" id="a05203_html_a5948316cc5f6ad2f85722642b2b20e24"><div class="ttname"><a href="../../de/d1b/a05203.html#a5948316cc5f6ad2f85722642b2b20e24">Septum::initialise</a></div><div class="ttdeci">virtual void initialise(PartBunchBase&lt; double, 3 &gt; *bunch, double &amp;startField, double &amp;endField) override</div><div class="ttdoc">Pure virtual implementation of Component. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/db8/a00797_source.html#l00047">Septum.cpp:47</a></div></div>
<div class="ttc" id="a01262_html_a731854fb8292e52014666a5412601853"><div class="ttname"><a href="../../d3/d53/a01262.html#a731854fb8292e52014666a5412601853">dot</a></div><div class="ttdeci">double dot(const Vector3D &amp;lhs, const Vector3D &amp;rhs)</div><div class="ttdoc">Vector dot product. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d53/a01262_source.html#l00118">Vector3D.cpp:118</a></div></div>
<div class="ttc" id="a04847_html_ae6c1dfbec52756e69756076b982f8d07"><div class="ttname"><a href="../../dd/dca/a04847.html#ae6c1dfbec52756e69756076b982f8d07">ParallelCyclotronTracker::visitMultipoleTCurvedVarRadius</a></div><div class="ttdeci">virtual void visitMultipoleTCurvedVarRadius(const MultipoleTCurvedVarRadius &amp;)</div><div class="ttdoc">Apply the algorithm to an arbitrary curved multipole of variable radius. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00674">ParallelCyclotronTracker.cpp:674</a></div></div>
<div class="ttc" id="a05255_html"><div class="ttname"><a href="../../d5/d12/a05255.html">VariableRFCavityFringeField</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d4c/a00851_source.html#l00058">VariableRFCavityFringeField.h:58</a></div></div>
<div class="ttc" id="a04847_html_af9d9c5b485cc9b75d725499c5bb05339"><div class="ttname"><a href="../../dd/dca/a04847.html#af9d9c5b485cc9b75d725499c5bb05339">ParallelCyclotronTracker::extE_m</a></div><div class="ttdeci">Vector_t extE_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00303">ParallelCyclotronTracker.h:303</a></div></div>
<div class="ttc" id="a05163_html_a0a9ef0521bbc0431525cdcd2b0694b0c"><div class="ttname"><a href="../../d7/d05/a05163.html#a0a9ef0521bbc0431525cdcd2b0694b0c">Offset::updateGeometry</a></div><div class="ttdeci">void updateGeometry(Vector_t startPosition, Vector_t startDirection)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db2/a00737_source.html#l00183">Offset.cpp:183</a></div></div>
<div class="ttc" id="a07199_html"><div class="ttname"><a href="../../d7/d4d/a07199.html">DataSink</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d44/a03074_source.html#l00048">DataSink.h:48</a></div></div>
<div class="ttc" id="a04819_html_a2dacae1107896d1d8b6ffefc77aabf5e"><div class="ttname"><a href="../../d6/d6f/a04819.html#a2dacae1107896d1d8b6ffefc77aabf5e">MultiBunchHandler::injection_t::time</a></div><div class="ttdeci">double time</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00043">MultiBunchHandler.h:43</a></div></div>
<div class="ttc" id="a07199_html_a034c1da0d8ebe536ecf7d2815930fc94"><div class="ttname"><a href="../../d7/d4d/a07199.html#a034c1da0d8ebe536ecf7d2815930fc94">DataSink::setMultiBunchInitialPathLengh</a></div><div class="ttdeci">void setMultiBunchInitialPathLengh(MultiBunchHandler *mbhandler_p)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d48/a03071_source.html#l00218">DataSink.cpp:218</a></div></div>
<div class="ttc" id="a05247_html_a3639b06d73c88ac7dbc3c65f6a8e9fdf"><div class="ttname"><a href="../../d8/da5/a05247.html#a3639b06d73c88ac7dbc3c65f6a8e9fdf">Vacuum::getPressure</a></div><div class="ttdeci">double getPressure() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/a00836_source.html#l00128">Vacuum.cpp:128</a></div></div>
<div class="ttc" id="a03068_html"><div class="ttname"><a href="../../da/d5d/a03068.html">BoundaryGeometry.h</a></div></div>
<div class="ttc" id="a05043_html"><div class="ttname"><a href="../../d2/d61/a05043.html">Component</a></div><div class="ttdoc">Interface for a single beam element. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d06/a00572_source.html#l00050">Component.h:50</a></div></div>
<div class="ttc" id="a04847_html_a140b8898b353d8a9df18c0bfb5b289d0"><div class="ttname"><a href="../../dd/dca/a04847.html#a140b8898b353d8a9df18c0bfb5b289d0">ParallelCyclotronTracker::azimuth_m</a></div><div class="ttdeci">double azimuth_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00284">ParallelCyclotronTracker.h:284</a></div></div>
<div class="ttc" id="a04572_html_a7eab9239ce282f0848816013973b560ca8c50748d684b7e7ff62154e821f2f18b"><div class="ttname"><a href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560ca8c50748d684b7e7ff62154e821f2f18b">Steppers::UNDEFINED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d90/a03056_source.html#l00026">Steppers.h:26</a></div></div>
<div class="ttc" id="a04847_html_a566211233fe8fabae5ce34978883461c"><div class="ttname"><a href="../../dd/dca/a04847.html#a566211233fe8fabae5ce34978883461c">ParallelCyclotronTracker::visitOffset</a></div><div class="ttdeci">virtual void visitOffset(const Offset &amp;)</div><div class="ttdoc">Apply the algorithm to a offset (placement). </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00578">ParallelCyclotronTracker.cpp:578</a></div></div>
<div class="ttc" id="a09219_html_ac4593203c34f26c625bd51c7502c297e"><div class="ttname"><a href="../../da/d49/a09219.html#ac4593203c34f26c625bd51c7502c297e">Communicate::barrier</a></div><div class="ttdeci">void barrier(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/df9/a03665_source.html#l00439">Communicate.cpp:439</a></div></div>
<div class="ttc" id="a04847_html_aedf3aa817811624c252183ede3f47e08"><div class="ttname"><a href="../../dd/dca/a04847.html#aedf3aa817811624c252183ede3f47e08">ParallelCyclotronTracker::DumpTimer_m</a></div><div class="ttdeci">IpplTimings::TimerRef DumpTimer_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00333">ParallelCyclotronTracker.h:333</a></div></div>
<div class="ttc" id="a05167_html_ae40ca7b43fba6abcc1f3ffcaead4f0c0"><div class="ttname"><a href="../../df/daa/a05167.html#ae40ca7b43fba6abcc1f3ffcaead4f0c0">PluginElement::getYEnd</a></div><div class="ttdeci">double getYEnd() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/a00743_source.html#l00190">PluginElement.cpp:190</a></div></div>
<div class="ttc" id="a04735_html_a9703f915aa5424bbf6e0ffeaa026efaa"><div class="ttname"><a href="../../d9/d06/a04735.html#a9703f915aa5424bbf6e0ffeaa026efaa">PartBunchBase::do_binaryRepart</a></div><div class="ttdeci">virtual void do_binaryRepart()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l00212">PartBunchBase.hpp:212</a></div></div>
<div class="ttc" id="a04847_html_a877030a63b8e5869cda18b26c0b2e208"><div class="ttname"><a href="../../dd/dca/a04847.html#a877030a63b8e5869cda18b26c0b2e208">ParallelCyclotronTracker::getFieldsAtPoint</a></div><div class="ttdeci">bool getFieldsAtPoint(const double &amp;t, const size_t &amp;Pindex, Vector_t &amp;Efield, Vector_t &amp;Bfield)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01461">ParallelCyclotronTracker.cpp:1461</a></div></div>
<div class="ttc" id="a04847_html_af965e58b6fbc3b577e0c60006cfed52a"><div class="ttname"><a href="../../dd/dca/a04847.html#af965e58b6fbc3b577e0c60006cfed52a">ParallelCyclotronTracker::visitMonitor</a></div><div class="ttdeci">virtual void visitMonitor(const Monitor &amp;)</div><div class="ttdoc">Apply the algorithm to a beam position monitor. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00605">ParallelCyclotronTracker.cpp:605</a></div></div>
<div class="ttc" id="a05159_html_a9140ae673f890ac564abc3fedaeabf8f"><div class="ttname"><a href="../../d1/d90/a05159.html#a9140ae673f890ac564abc3fedaeabf8f">MultipoleTStraight::clone</a></div><div class="ttdeci">virtual ElementBase * clone() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../df/df7/a00731_source.html#l00051">MultipoleTStraight.cpp:51</a></div></div>
<div class="ttc" id="a04847_html_a4fdf924bb54c04c26a2ee6448fa01cae"><div class="ttname"><a href="../../dd/dca/a04847.html#a4fdf924bb54c04c26a2ee6448fa01cae">ParallelCyclotronTracker::isTurnDone</a></div><div class="ttdeci">bool isTurnDone()</div><div class="ttdoc">Check if turn done. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02788">ParallelCyclotronTracker.cpp:2788</a></div></div>
<div class="ttc" id="a09623_html"><div class="ttname"><a href="../../d9/de9/a09623.html">Message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1c/a03692_source.html#l00142">Message.h:142</a></div></div>
<div class="ttc" id="a04847_html_a3f99825f5bea312ad002cacd1f39158e"><div class="ttname"><a href="../../dd/dca/a04847.html#a3f99825f5bea312ad002cacd1f39158e">ParallelCyclotronTracker::ParallelCyclotronTracker</a></div><div class="ttdeci">ParallelCyclotronTracker()</div></div>
<div class="ttc" id="a04847_html_a5dfd077e43b0e75cd740b32a4944713b"><div class="ttname"><a href="../../dd/dca/a04847.html#a5dfd077e43b0e75cd740b32a4944713b">ParallelCyclotronTracker::updatePathLength</a></div><div class="ttdeci">void updatePathLength(const double &amp;dt)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03500">ParallelCyclotronTracker.cpp:3500</a></div></div>
<div class="ttc" id="a04823_html_a7a0770f8b060534be3c679f8d0d53514"><div class="ttname"><a href="../../d6/d34/a04823.html#a7a0770f8b060534be3c679f8d0d53514">MultiBunchHandler::beaminfo_t::prevAzimuth</a></div><div class="ttdeci">double prevAzimuth</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00072">MultiBunchHandler.h:72</a></div></div>
<div class="ttc" id="a00188_html"><div class="ttname"><a href="../../da/d15/a00188.html">Element.h</a></div></div>
<div class="ttc" id="a07475_html"><div class="ttname"><a href="../../dd/d24/a07475.html">Vektor</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dee/a03338_source.html#l00024">TSVMeta.h:24</a></div></div>
<div class="ttc" id="a00788_html"><div class="ttname"><a href="../../df/d0c/a00788.html">SBend3D.h</a></div></div>
<div class="ttc" id="a05099_html"><div class="ttname"><a href="../../d3/d8f/a05099.html">Monitor</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d0f/a00644_source.html#l00032">Monitor.h:32</a></div></div>
<div class="ttc" id="a04839_html"><div class="ttname"><a href="../../d4/d10/a04839.html">adder</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01532">ParallelCyclotronTracker.cpp:1532</a></div></div>
<div class="ttc" id="a05399_html"><div class="ttname"><a href="../../dc/daf/a05399.html">Tracker</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d23/a01025_source.html#l00076">Tracker.h:76</a></div></div>
<div class="ttc" id="a05199_html"><div class="ttname"><a href="../../d4/ddd/a05199.html">ScalingFFAMagnet</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d12/a00794_source.html#l00047">ScalingFFAMagnet.h:47</a></div></div>
<div class="ttc" id="a05187_html_a8ef0edd082f46879c4d1d2f68e1de63b"><div class="ttname"><a href="../../db/d48/a05187.html#a8ef0edd082f46879c4d1d2f68e1de63b">Ring::getBeamPhiInit</a></div><div class="ttdeci">double getBeamPhiInit() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/a00776_source.html#l00241">Ring.h:241</a></div></div>
<div class="ttc" id="a03851_html_a06dc3d53220b680f16b2c655bcb86a40"><div class="ttname"><a href="../../d5/d12/a03851.html#a06dc3d53220b680f16b2c655bcb86a40">sum</a></div><div class="ttdeci">T::PETE_Expr_t::PETE_Return_t sum(const PETE_Expr&lt; T &gt; &amp;expr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d12/a03851_source.html#l01111">PETE.h:1111</a></div></div>
<div class="ttc" id="a00776_html"><div class="ttname"><a href="../../d9/dd4/a00776.html">Ring.h</a></div></div>
<div class="ttc" id="a05183_html_a95ab6fb74ae41fbf95b87845cee2804f"><div class="ttname"><a href="../../d7/d48/a05183.html#a95ab6fb74ae41fbf95b87845cee2804f">RFCavity::getSinAzimuth</a></div><div class="ttdeci">virtual double getSinAzimuth() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00302">RFCavity.cpp:302</a></div></div>
<div class="ttc" id="a05059_html_a6b494eac546c4882fe31875442156d38"><div class="ttname"><a href="../../d6/de9/a05059.html#a6b494eac546c4882fe31875442156d38">Cyclotron::getMaxZ</a></div><div class="ttdeci">virtual double getMaxZ() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00345">Cyclotron.cpp:345</a></div></div>
<div class="ttc" id="a05247_html_a8970d257074406f814f74c6b5732dca7"><div class="ttname"><a href="../../d8/da5/a05247.html#a8970d257074406f814f74c6b5732dca7">Vacuum::initialise</a></div><div class="ttdeci">virtual void initialise(PartBunchBase&lt; double, 3 &gt; *bunch, double &amp;startField, double &amp;endField) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/a00836_source.html#l00233">Vacuum.cpp:233</a></div></div>
<div class="ttc" id="a04847_html_abfe243db3a21f427dd2ea39cae907dde"><div class="ttname"><a href="../../dd/dca/a04847.html#abfe243db3a21f427dd2ea39cae907dde">ParallelCyclotronTracker::visitMultipole</a></div><div class="ttdeci">virtual void visitMultipole(const Multipole &amp;)</div><div class="ttdoc">Apply the algorithm to a multipole. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00616">ParallelCyclotronTracker.cpp:616</a></div></div>
<div class="ttc" id="a05387_html"><div class="ttname"><a href="../../db/de3/a05387.html">Tenzor&lt; double, 3 &gt;</a></div></div>
<div class="ttc" id="a04537_html_ad8fcab196be0672fdc6e1f091b9bb01a"><div class="ttname"><a href="../../d4/dd0/a04537.html#ad8fcab196be0672fdc6e1f091b9bb01a">Physics::c</a></div><div class="ttdeci">constexpr double c</div><div class="ttdoc">The velocity of light in m/s. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6b/a01853_source.html#l00045">Physics.h:45</a></div></div>
<div class="ttc" id="a05183_html_a08878a675b003ca43d8c316788837260"><div class="ttname"><a href="../../d7/d48/a05183.html#a08878a675b003ca43d8c316788837260">RFCavity::getMomentaKick</a></div><div class="ttdeci">void getMomentaKick(const double normalRadius, double momentum[], const double t, const double dtCorrt, const int PID, const double restMass, const int chargenumber)</div><div class="ttdoc">used in OPAL-cycl </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00363">RFCavity.cpp:363</a></div></div>
<div class="ttc" id="a04735_html_a02869c9275595621525ce0adb352d6e1"><div class="ttname"><a href="../../d9/d06/a04735.html#a02869c9275595621525ce0adb352d6e1">PartBunchBase::Ef</a></div><div class="ttdeci">ParticleAttrib&lt; Vector_t &gt; Ef</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00578">PartBunchBase.h:578</a></div></div>
<div class="ttc" id="a00464_html"><div class="ttname"><a href="../../d2/d9d/a00464.html">DumpEMFields.h</a></div></div>
<div class="ttc" id="a04735_html_a3fc75c2f6f10d9e768b668d9a6281781"><div class="ttname"><a href="../../d9/d06/a04735.html#a3fc75c2f6f10d9e768b668d9a6281781">PartBunchBase::getLastemittedBin</a></div><div class="ttdeci">int getLastemittedBin()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l00322">PartBunchBase.hpp:322</a></div></div>
<div class="ttc" id="a04572_html_a7eab9239ce282f0848816013973b560ca51d4403ff33999735d10c625271637a7"><div class="ttname"><a href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560ca51d4403ff33999735d10c625271637a7">Steppers::MTS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d90/a03056_source.html#l00029">Steppers.h:29</a></div></div>
<div class="ttc" id="a05187_html"><div class="ttname"><a href="../../db/d48/a05187.html">Ring</a></div><div class="ttdoc">Ring describes a ring type geometry for tracking. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/a00776_source.html#l00064">Ring.h:64</a></div></div>
<div class="ttc" id="a04847_html_aa9e2feb987680602aed0f494a77b2724"><div class="ttname"><a href="../../dd/dca/a04847.html#aa9e2feb987680602aed0f494a77b2724">ParallelCyclotronTracker::visitMultipoleT</a></div><div class="ttdeci">virtual void visitMultipoleT(const MultipoleT &amp;)</div><div class="ttdoc">Apply the algorithm to an arbitrary multipole. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00626">ParallelCyclotronTracker.cpp:626</a></div></div>
<div class="ttc" id="a04847_html_a52d3ff11669ab54939aad6613f5473ce"><div class="ttname"><a href="../../dd/dca/a04847.html#a52d3ff11669ab54939aad6613f5473ce">ParallelCyclotronTracker::visitBeamline</a></div><div class="ttdeci">virtual void visitBeamline(const Beamline &amp;)</div><div class="ttdoc">Apply the algorithm to a beam line. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01137">ParallelCyclotronTracker.cpp:1137</a></div></div>
<div class="ttc" id="a04819_html_a7019d93696ad9a040b7887886406fdd2"><div class="ttname"><a href="../../d6/d6f/a04819.html#a7019d93696ad9a040b7887886406fdd2">MultiBunchHandler::injection_t::pathlength</a></div><div class="ttdeci">double pathlength</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00046">MultiBunchHandler.h:46</a></div></div>
<div class="ttc" id="a04847_html_ad8da0627c388a54d35052ad1e91f6047"><div class="ttname"><a href="../../dd/dca/a04847.html#ad8da0627c388a54d35052ad1e91f6047">ParallelCyclotronTracker::localToGlobal</a></div><div class="ttdeci">void localToGlobal(ParticleAttrib&lt; Vector_t &gt; &amp;vectorArray, double phi, Vector_t const translationToGlobal=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01690">ParallelCyclotronTracker.cpp:1690</a></div></div>
<div class="ttc" id="a04549_html_a1a84a90daa50ed0cc2359659555baed9"><div class="ttname"><a href="../../d7/d8b/a04549.html#a1a84a90daa50ed0cc2359659555baed9">Options::psDumpFreq</a></div><div class="ttdeci">int psDumpFreq</div><div class="ttdoc">The frequency to dump the phase space, i.e.dump data when steppsDumpFreq==0. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00039">Options.cpp:39</a></div></div>
<div class="ttc" id="a03851_html_a98c9dc238bd3ab19e8545cbd35595457"><div class="ttname"><a href="../../d5/d12/a03851.html#a98c9dc238bd3ab19e8545cbd35595457">acos</a></div><div class="ttdeci">PETE_TUTree&lt; FnArcCos, typename T::PETE_Expr_t &gt; acos(const PETE_Expr&lt; T &gt; &amp;l)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d12/a03851_source.html#l00725">PETE.h:725</a></div></div>
<div class="ttc" id="a04847_html_a79d0fb5389e876a853c76fe0a945bbbd"><div class="ttname"><a href="../../dd/dca/a04847.html#a79d0fb5389e876a853c76fe0a945bbbd">ParallelCyclotronTracker::visitRing</a></div><div class="ttdeci">virtual void visitRing(const Ring &amp;ring)</div><div class="ttdoc">Apply the algorithm to a ring. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00833">ParallelCyclotronTracker.cpp:833</a></div></div>
<div class="ttc" id="a05119_html_a6530a62c33a7c5b7bd93e9f57f167522"><div class="ttname"><a href="../../d3/d91/a05119.html#a6530a62c33a7c5b7bd93e9f57f167522">MultipoleTCurvedVarRadius::clone</a></div><div class="ttdeci">virtual ElementBase * clone() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d13/a00671_source.html#l00057">MultipoleTCurvedVarRadius.cpp:57</a></div></div>
<div class="ttc" id="a05319_html_a24e23ba4f7cb7106c38eda2c32f78f41"><div class="ttname"><a href="../../da/d97/a05319.html#a24e23ba4f7cb7106c38eda2c32f78f41">AbstractTimeDependence::getTimeDependence</a></div><div class="ttdeci">static std::shared_ptr&lt; AbstractTimeDependence &gt; getTimeDependence(std::string name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d82/a00920_source.html#l00036">AbstractTimeDependence.cpp:36</a></div></div>
<div class="ttc" id="a04815_html"><div class="ttname"><a href="../../d2/d04/a04815.html">MultiBunchHandler</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00035">MultiBunchHandler.h:35</a></div></div>
<div class="ttc" id="a05175_html"><div class="ttname"><a href="../../dc/d07/a05175.html">RBend</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4a/a00758_source.html#l00058">RBend.h:58</a></div></div>
<div class="ttc" id="a02168_html"><div class="ttname"><a href="../../d1/dce/a02168.html">Options.h</a></div></div>
<div class="ttc" id="a04847_html_a498ce8d32ed882ab5642bf2fc22341fc"><div class="ttname"><a href="../../dd/dca/a04847.html#a498ce8d32ed882ab5642bf2fc22341fc">ParallelCyclotronTracker::rotateAroundX</a></div><div class="ttdeci">void rotateAroundX(ParticleAttrib&lt; Vector_t &gt; &amp;particleVectors, double const psi)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01880">ParallelCyclotronTracker.cpp:1880</a></div></div>
<div class="ttc" id="a04847_html_a14632cb5aa5ae426d5a116f89d95f43f"><div class="ttname"><a href="../../dd/dca/a04847.html#a14632cb5aa5ae426d5a116f89d95f43f">ParallelCyclotronTracker::visitRBend</a></div><div class="ttdeci">virtual void visitRBend(const RBend &amp;)</div><div class="ttdoc">Apply the algorithm to a rectangular bend. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00729">ParallelCyclotronTracker.cpp:729</a></div></div>
<div class="ttc" id="a05059_html_a89d6cd7c8b5a7d0d853610b516e208d0"><div class="ttname"><a href="../../d6/de9/a05059.html#a89d6cd7c8b5a7d0d853610b516e208d0">Cyclotron::getMinZ</a></div><div class="ttdeci">virtual double getMinZ() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00335">Cyclotron.cpp:335</a></div></div>
<div class="ttc" id="a04847_html_a06565575d308890d696a84a209c70283"><div class="ttname"><a href="../../dd/dca/a04847.html#a06565575d308890d696a84a209c70283">ParallelCyclotronTracker::opalRing_m</a></div><div class="ttdeci">Ring * opalRing_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00446">ParallelCyclotronTracker.h:446</a></div></div>
<div class="ttc" id="a04847_html_afdc2f338c8e0174d980fee36173b226d"><div class="ttname"><a href="../../dd/dca/a04847.html#afdc2f338c8e0174d980fee36173b226d">ParallelCyclotronTracker::mode_m</a></div><div class="ttdeci">TrackingMode mode_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00469">ParallelCyclotronTracker.h:469</a></div></div>
<div class="ttc" id="a00662_html"><div class="ttname"><a href="../../dc/df1/a00662.html">MultipoleTBase.h</a></div></div>
<div class="ttc" id="a05063_html"><div class="ttname"><a href="../../da/d0f/a05063.html">Degrader</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db1/a00590_source.html#l00028">Degrader.h:28</a></div></div>
<div class="ttc" id="a03971_html_a3479363bc276c3798e3f3656c66d93ed"><div class="ttname"><a href="../../d0/dce/a03971.html#a3479363bc276c3798e3f3656c66d93ed">endl</a></div><div class="ttdeci">Inform &amp; endl(Inform &amp;inf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dce/a03971_source.html#l00042">Inform.cpp:42</a></div></div>
<div class="ttc" id="a05163_html"><div class="ttname"><a href="../../d7/d05/a05163.html">Offset</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dce/a00740_source.html#l00066">Offset.h:66</a></div></div>
<div class="ttc" id="a04847_html_a61ca4fa0bee626420b2e224d949d1f1d"><div class="ttname"><a href="../../dd/dca/a04847.html#a61ca4fa0bee626420b2e224d949d1f1d">ParallelCyclotronTracker::openFiles</a></div><div class="ttdeci">void openFiles(size_t numFiles, std::string fn)</div><div class="ttdoc">@ open / close output coordinate files </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00282">ParallelCyclotronTracker.cpp:282</a></div></div>
<div class="ttc" id="a04735_html_ac035c07285b91e2eac59fe13e0013d20"><div class="ttname"><a href="../../d9/d06/a04735.html#ac035c07285b91e2eac59fe13e0013d20">PartBunchBase::bunchNum</a></div><div class="ttdeci">ParticleAttrib&lt; short &gt; bunchNum</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00588">PartBunchBase.h:588</a></div></div>
<div class="ttc" id="a05183_html_a58648e6c9265858963a0104398aa6e02"><div class="ttname"><a href="../../d7/d48/a05183.html#a58648e6c9265858963a0104398aa6e02">RFCavity::getCosAzimuth</a></div><div class="ttdeci">virtual double getCosAzimuth() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00306">RFCavity.cpp:306</a></div></div>
<div class="ttc" id="a04539_html_aa14d6948383276c44c8b5f6022cd48bd"><div class="ttname"><a href="../../d0/d3d/a04539.html#aa14d6948383276c44c8b5f6022cd48bd">Units::eV2MeV</a></div><div class="ttdeci">constexpr double eV2MeV</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00077">Units.h:77</a></div></div>
<div class="ttc" id="a00821_html"><div class="ttname"><a href="../../d6/d8b/a00821.html">Stripper.h</a></div></div>
<div class="ttc" id="a00650_html"><div class="ttname"><a href="../../da/d36/a00650.html">Multipole.h</a></div></div>
<div class="ttc" id="a07199_html_a505ef3ad13321eefe16b9fd420a930bd"><div class="ttname"><a href="../../d7/d4d/a07199.html#a505ef3ad13321eefe16b9fd420a930bd">DataSink::dumpSDDS</a></div><div class="ttdeci">void dumpSDDS(PartBunchBase&lt; double, 3 &gt; *beam, Vector_t FDext[], const double &amp;azimuth=-1) const</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d48/a03071_source.html#l00105">DataSink.cpp:105</a></div></div>
<div class="ttc" id="a04839_html_a2b4258527c3fb536008df49e74c90480"><div class="ttname"><a href="../../d4/d10/a04839.html#a2b4258527c3fb536008df49e74c90480">adder::sum</a></div><div class="ttdeci">double sum</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01534">ParallelCyclotronTracker.cpp:1534</a></div></div>
<div class="ttc" id="a04847_html_a36d5e16ad9f038941a636c32096863cf"><div class="ttname"><a href="../../dd/dca/a04847.html#a36d5e16ad9f038941a636c32096863cf">ParallelCyclotronTracker::normalizeQuaternion</a></div><div class="ttdeci">void normalizeQuaternion(Quaternion_t &amp;quaternion)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01834">ParallelCyclotronTracker.cpp:1834</a></div></div>
<div class="ttc" id="a04847_html_af43c8be817f32734eb9683d693856bb4"><div class="ttname"><a href="../../dd/dca/a04847.html#af43c8be817f32734eb9683d693856bb4">ParallelCyclotronTracker::maxSteps_m</a></div><div class="ttdeci">int maxSteps_m</div><div class="ttdoc">The maximal number of steps the system is integrated. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00231">ParallelCyclotronTracker.h:231</a></div></div>
<div class="ttc" id="a04847_html_a21683008920646c679e377129a243ac7"><div class="ttname"><a href="../../dd/dca/a04847.html#a21683008920646c679e377129a243ac7">ParallelCyclotronTracker::function_t</a></div><div class="ttdeci">std::function&lt; bool(const double &amp;, const size_t &amp;, Vector_t &amp;, Vector_t &amp;)&gt; function_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00458">ParallelCyclotronTracker.h:458</a></div></div>
<div class="ttc" id="a04735_html_a523b980cb29cdb5359f6db0f28f14859"><div class="ttname"><a href="../../d9/d06/a04735.html#a523b980cb29cdb5359f6db0f28f14859">PartBunchBase::setGlobalToLocalQuaternion</a></div><div class="ttdeci">void setGlobalToLocalQuaternion(Quaternion_t globalToLocalQuaternion)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01493">PartBunchBase.hpp:1493</a></div></div>
<div class="ttc" id="a05183_html_a06a3369805a5dfbc4bf2891c7db6b1a2"><div class="ttname"><a href="../../d7/d48/a05183.html#a06a3369805a5dfbc4bf2891c7db6b1a2">RFCavity::getPhaseModelName</a></div><div class="ttdeci">std::string getPhaseModelName()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7e/a00770_source.html#l00465">RFCavity.h:465</a></div></div>
<div class="ttc" id="a04847_html_a52d5fc95fde1a205343739362d465f36"><div class="ttname"><a href="../../dd/dca/a04847.html#a52d5fc95fde1a205343739362d465f36">ParallelCyclotronTracker::checkGapCross</a></div><div class="ttdeci">bool checkGapCross(Vector_t Rold, Vector_t Rnew, RFCavity *rfcavity, double &amp;DistOld)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01492">ParallelCyclotronTracker.cpp:1492</a></div></div>
<div class="ttc" id="a04847_html_a15a0bffb1dc6ad134121709cc90c6f6ea0db45d2a4141101bdfe48e3314cfbca3"><div class="ttname"><a href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0db45d2a4141101bdfe48e3314cfbca3">ParallelCyclotronTracker::TrackingMode::UNDEFINED</a></div></div>
<div class="ttc" id="a04735_html_a3473f0bbd78f0e387277bb72490d9ee3"><div class="ttname"><a href="../../d9/d06/a04735.html#a3473f0bbd78f0e387277bb72490d9ee3">PartBunchBase::getTotalNum</a></div><div class="ttdeci">size_t getTotalNum() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01900">PartBunchBase.hpp:1900</a></div></div>
<div class="ttc" id="a05199_html_a31a30edca7049e4e81c95c6f13cb893a"><div class="ttname"><a href="../../d4/ddd/a05199.html#a31a30edca7049e4e81c95c6f13cb893a">ScalingFFAMagnet::clone</a></div><div class="ttdeci">ScalingFFAMagnet * clone() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/a00791_source.html#l00059">ScalingFFAMagnet.cpp:59</a></div></div>
<div class="ttc" id="a00893_html_a6dcaf0865921eacb4895202a9de28592"><div class="ttname"><a href="../../dc/d2c/a00893.html#a6dcaf0865921eacb4895202a9de28592">pow</a></div><div class="ttdeci">Tps&lt; T &gt; pow(const Tps&lt; T &gt; &amp;x, int y)</div><div class="ttdoc">Integer power. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2c/a00893_source.html#l00076">TpsMath.h:76</a></div></div>
<div class="ttc" id="a04847_html_af22bc369a0c1bf03b2a4fd94ff544134"><div class="ttname"><a href="../../dd/dca/a04847.html#af22bc369a0c1bf03b2a4fd94ff544134">ParallelCyclotronTracker::isMultiBunch</a></div><div class="ttdeci">bool isMultiBunch() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00579">ParallelCyclotronTracker.h:579</a></div></div>
<div class="ttc" id="a04847_html_a5d6eda26e94b2e41f1ed2d52a25f0a20"><div class="ttname"><a href="../../dd/dca/a04847.html#a5d6eda26e94b2e41f1ed2d52a25f0a20">ParallelCyclotronTracker::visitScalingFFAMagnet</a></div><div class="ttdeci">virtual void visitScalingFFAMagnet(const ScalingFFAMagnet &amp;bend)</div><div class="ttdoc">Apply the algorithm to a scaling FFA magnet. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00899">ParallelCyclotronTracker.cpp:899</a></div></div>
<div class="ttc" id="a00596_html"><div class="ttname"><a href="../../dc/d25/a00596.html">Drift.h</a></div></div>
<div class="ttc" id="a04539_html_ae751b04bf56c8b789fbcf34e84573985"><div class="ttname"><a href="../../d0/d3d/a04539.html#ae751b04bf56c8b789fbcf34e84573985">Units::s2ns</a></div><div class="ttdeci">constexpr double s2ns</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00044">Units.h:44</a></div></div>
<div class="ttc" id="a04735_html_aae4a6a553da223fafcacd4b29167144c"><div class="ttname"><a href="../../d9/d06/a04735.html#aae4a6a553da223fafcacd4b29167144c">PartBunchBase::calcGammas_cycl</a></div><div class="ttdeci">void calcGammas_cycl()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l00386">PartBunchBase.hpp:386</a></div></div>
<div class="ttc" id="a05059_html_aea3b0d1c8394f7e5f4085916a7facef0"><div class="ttname"><a href="../../d6/de9/a05059.html#aea3b0d1c8394f7e5f4085916a7facef0">Cyclotron::getMinR</a></div><div class="ttdeci">virtual double getMinR() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00321">Cyclotron.cpp:321</a></div></div>
<div class="ttc" id="a04847_html_afcdf474f385a59cac951072737fa34e0"><div class="ttname"><a href="../../dd/dca/a04847.html#afcdf474f385a59cac951072737fa34e0">ParallelCyclotronTracker::cycl_m</a></div><div class="ttdeci">Cyclotron * cycl_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00228">ParallelCyclotronTracker.h:228</a></div></div>
<div class="ttc" id="a04549_html_aa086ad175559dc4faee94af4f5b4052b"><div class="ttname"><a href="../../d7/d8b/a04549.html#aa086ad175559dc4faee94af4f5b4052b">Options::delPartFreq</a></div><div class="ttdeci">unsigned int delPartFreq</div><div class="ttdoc">The frequency to delete particles (currently: OPAL-cycl only) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00109">Options.cpp:109</a></div></div>
<div class="ttc" id="a05183_html_a06eb3e02d5e9c26cb967de237b1e41ad"><div class="ttname"><a href="../../d7/d48/a05183.html#a06eb3e02d5e9c26cb967de237b1e41ad">RFCavity::getRmax</a></div><div class="ttdeci">virtual double getRmax() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00294">RFCavity.cpp:294</a></div></div>
<div class="ttc" id="a01859_html"><div class="ttname"><a href="../../d3/dce/a01859.html">Units.h</a></div></div>
<div class="ttc" id="a04595_html_a5e638eb56ea4e912de37583bd5a42cd8"><div class="ttname"><a href="../../dd/dec/a04595.html#a5e638eb56ea4e912de37583bd5a42cd8">client::function::type</a></div><div class="ttdeci">boost::function&lt; boost::tuple&lt; double, bool &gt;arguments_t)&gt; type</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d4b/a04169_source.html#l00021">function.hpp:21</a></div></div>
<div class="ttc" id="a05095_html"><div class="ttname"><a href="../../de/d11/a05095.html">Marker</a></div><div class="ttdoc">Interface for a marker. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/a00638_source.html#l00032">Marker.h:32</a></div></div>
<div class="ttc" id="a00584_html"><div class="ttname"><a href="../../d7/d21/a00584.html">Cyclotron.h</a></div></div>
<div class="ttc" id="a02234_html_add802868496e19113f6924d041d7d9ab"><div class="ttname"><a href="../../d8/d6f/a02234.html#add802868496e19113f6924d041d7d9ab">DistributionType</a></div><div class="ttdeci">DistributionType</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6f/a02234_source.html#l00050">Distribution.h:50</a></div></div>
<div class="ttc" id="a05167_html_a471a9fee6c0fcb9881d6c2c539029f20"><div class="ttname"><a href="../../df/daa/a05167.html#a471a9fee6c0fcb9881d6c2c539029f20">PluginElement::initialise</a></div><div class="ttdeci">virtual void initialise(PartBunchBase&lt; double, 3 &gt; *bunch, double &amp;startField, double &amp;endField) override</div><div class="ttdoc">Pure virtual implementation of Component. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/a00743_source.html#l00048">PluginElement.cpp:48</a></div></div>
<div class="ttc" id="a04735_html"><div class="ttname"><a href="../../d9/d06/a04735.html">PartBunchBase&lt; double, 3 &gt;</a></div></div>
<div class="ttc" id="a05195_html"><div class="ttname"><a href="../../dc/d65/a05195.html">SBend3D</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0c/a00788_source.html#l00050">SBend3D.h:50</a></div></div>
<div class="ttc" id="a04847_html_aa8e2942513971f295590f723d4195fbb"><div class="ttname"><a href="../../dd/dca/a04847.html#aa8e2942513971f295590f723d4195fbb">ParallelCyclotronTracker::lossDs_m</a></div><div class="ttdeci">std::unique_ptr&lt; LossDataSink &gt; lossDs_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00449">ParallelCyclotronTracker.h:449</a></div></div>
<div class="ttc" id="a05199_html_a05c4570febdda04fe828f91bd5da2f6f"><div class="ttname"><a href="../../d4/ddd/a05199.html#a05c4570febdda04fe828f91bd5da2f6f">ScalingFFAMagnet::setupEndField</a></div><div class="ttdeci">void setupEndField()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/a00791_source.html#l00209">ScalingFFAMagnet.cpp:209</a></div></div>
<div class="ttc" id="a07199_html_a7f1fc5c3a7495fbdcbb35d15aa258843"><div class="ttname"><a href="../../d7/d4d/a07199.html#a7f1fc5c3a7495fbdcbb35d15aa258843">DataSink::dumpH5</a></div><div class="ttdeci">void dumpH5(PartBunchBase&lt; double, 3 &gt; *beam, Vector_t FDext[]) const</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d48/a03071_source.html#l00086">DataSink.cpp:86</a></div></div>
<div class="ttc" id="a04847_html_acfc7806b7b39b4208cf61d82f384a260"><div class="ttname"><a href="../../dd/dca/a04847.html#acfc7806b7b39b4208cf61d82f384a260">ParallelCyclotronTracker::previousH5Local</a></div><div class="ttdeci">bool previousH5Local</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00256">ParallelCyclotronTracker.h:256</a></div></div>
<div class="ttc" id="a12163_html_a8b229ce711198a6e0e190e7d9098c3eb"><div class="ttname"><a href="../../d0/d9c/a12163.html#a8b229ce711198a6e0e190e7d9098c3eb">IpplTimings::stopTimer</a></div><div class="ttdeci">static void stopTimer(TimerRef t)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9f/a04013_source.html#l00192">IpplTimings.h:192</a></div></div>
<div class="ttc" id="a00782_html"><div class="ttname"><a href="../../da/d96/a00782.html">SBend.h</a></div></div>
<div class="ttc" id="a04847_html_a8d2c887a9b6c6a82d9afc2636f7daa50"><div class="ttname"><a href="../../dd/dca/a04847.html#a8d2c887a9b6c6a82d9afc2636f7daa50">ParallelCyclotronTracker::FieldDimensions</a></div><div class="ttdeci">beamline_list FieldDimensions</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00218">ParallelCyclotronTracker.h:218</a></div></div>
<div class="ttc" id="a05379_html_a23dba80ac1c93b895b2d0b8748cbb739"><div class="ttname"><a href="../../dd/d3d/a05379.html#a23dba80ac1c93b895b2d0b8748cbb739">PartData::getBeta</a></div><div class="ttdeci">double getBeta() const</div><div class="ttdoc">The relativistic beta per particle. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/a00998_source.html#l00124">PartData.h:124</a></div></div>
<div class="ttc" id="a05183_html_ac7787dad3dc8735c6b4267e8ffb1f4d6"><div class="ttname"><a href="../../d7/d48/a05183.html#ac7787dad3dc8735c6b4267e8ffb1f4d6">RFCavity::getFrequencyModelName</a></div><div class="ttdeci">std::string getFrequencyModelName()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7e/a00770_source.html#l00480">RFCavity.h:480</a></div></div>
<div class="ttc" id="a04823_html"><div class="ttname"><a href="../../d6/d34/a04823.html">MultiBunchHandler::beaminfo_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00051">MultiBunchHandler.h:51</a></div></div>
<div class="ttc" id="a04847_html_ab4724e863899fa7bf8bbc59cf2e22cbe"><div class="ttname"><a href="../../dd/dca/a04847.html#ab4724e863899fa7bf8bbc59cf2e22cbe">ParallelCyclotronTracker::initPathLength</a></div><div class="ttdeci">void initPathLength()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03549">ParallelCyclotronTracker.cpp:3549</a></div></div>
<div class="ttc" id="a04823_html_a5d177ee17dfe89492526dba49dd8ef43"><div class="ttname"><a href="../../d6/d34/a04823.html#a5d177ee17dfe89492526dba49dd8ef43">MultiBunchHandler::beaminfo_t::radius</a></div><div class="ttdeci">double radius</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00071">MultiBunchHandler.h:71</a></div></div>
<div class="ttc" id="a05383_html"><div class="ttname"><a href="../../db/d18/a05383.html">PolynomialTimeDependence</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8d/a01007_source.html#l00042">PolynomialTimeDependence.h:42</a></div></div>
<div class="ttc" id="a04539_html_a5de683c729816e185eca14a1ca6fd911"><div class="ttname"><a href="../../d0/d3d/a04539.html#a5de683c729816e185eca14a1ca6fd911">Units::mm2m</a></div><div class="ttdeci">constexpr double mm2m</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00029">Units.h:29</a></div></div>
<div class="ttc" id="a00470_html"><div class="ttname"><a href="../../d0/d29/a00470.html">DumpFields.h</a></div></div>
<div class="ttc" id="a05183_html"><div class="ttname"><a href="../../d7/d48/a05183.html">RFCavity</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7e/a00770_source.html#l00037">RFCavity.h:37</a></div></div>
<div class="ttc" id="a04735_html_af51331c43ea82142dd6d237e6e3e5bfd"><div class="ttname"><a href="../../d9/d06/a04735.html#af51331c43ea82142dd6d237e6e3e5bfd">PartBunchBase::getM</a></div><div class="ttdeci">double getM() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01636">PartBunchBase.hpp:1636</a></div></div>
<div class="ttc" id="a04847_html_a2b4e517d1c586cac4aa4bd4e4cc187b5"><div class="ttname"><a href="../../dd/dca/a04847.html#a2b4e517d1c586cac4aa4bd4e4cc187b5">ParallelCyclotronTracker::azimuth_angle_m</a></div><div class="ttdeci">std::vector&lt; double &gt; azimuth_angle_m</div><div class="ttdoc">the different azimuthal angles for the outfTheta_m output files </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00312">ParallelCyclotronTracker.h:312</a></div></div>
<div class="ttc" id="a00770_html"><div class="ttname"><a href="../../d0/d7e/a00770.html">RFCavity.h</a></div></div>
<div class="ttc" id="a04847_html_ae413f18725a0b8a5bef87f40d2c32f46"><div class="ttname"><a href="../../dd/dca/a04847.html#ae413f18725a0b8a5bef87f40d2c32f46">ParallelCyclotronTracker::singleParticleDump</a></div><div class="ttdeci">void singleParticleDump()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02418">ParallelCyclotronTracker.cpp:2418</a></div></div>
<div class="ttc" id="a00806_html"><div class="ttname"><a href="../../d0/dad/a00806.html">Solenoid.h</a></div></div>
<div class="ttc" id="a05031_html_a46069205a3fb9f18ca806989637daf56"><div class="ttname"><a href="../../de/ddd/a05031.html#a46069205a3fb9f18ca806989637daf56">CCollimator::getZStart</a></div><div class="ttdeci">double getZStart()</div><div class="ttdoc">Member variable access. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d3e/a00566_source.html#l00090">CCollimator.h:90</a></div></div>
<div class="ttc" id="a04847_html_a05279c9d1f4e62435bd0304a8de108f5"><div class="ttname"><a href="../../dd/dca/a04847.html#a05279c9d1f4e62435bd0304a8de108f5">ParallelCyclotronTracker::dumpAzimuthAngles_m</a></div><div class="ttdeci">void dumpAzimuthAngles_m(const double &amp;t, const Vector_t &amp;R, const Vector_t &amp;P, const double &amp;oldReferenceTheta, const double &amp;temp_meanTheta)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03274">ParallelCyclotronTracker.cpp:3274</a></div></div>
<div class="ttc" id="a05183_html_ab4ded3eeeb2ef6ccd62a9de9d7623339"><div class="ttname"><a href="../../d7/d48/a05183.html#ab4ded3eeeb2ef6ccd62a9de9d7623339">RFCavity::getGapWidth</a></div><div class="ttdeci">virtual double getGapWidth() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00314">RFCavity.cpp:314</a></div></div>
<div class="ttc" id="a05071_html_a98ba64b0bb174add064da5223a737a66"><div class="ttname"><a href="../../db/d78/a05071.html#a98ba64b0bb174add064da5223a737a66">ElementBase::getTypeString</a></div><div class="ttdeci">std::string getTypeString() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0a/a00602_source.html#l00578">ElementBase.h:578</a></div></div>
<div class="ttc" id="a03086_html_a2c04156333cc3a156108be6f45c52c46ae176082761913ad28e702817b7388d91"><div class="ttname"><a href="../../d9/d5e/a03086.html#a2c04156333cc3a156108be6f45c52c46ae176082761913ad28e702817b7388d91">FieldSolverType::SAAMG</a></div></div>
<div class="ttc" id="a04735_html_a28964ccb8f0261cf71e4ab9289f424a9"><div class="ttname"><a href="../../d9/d06/a04735.html#a28964ccb8f0261cf71e4ab9289f424a9">PartBunchBase::setLocalTrackStep</a></div><div class="ttdeci">void setLocalTrackStep(long long n)</div><div class="ttdoc">step in a TRACK command </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01395">PartBunchBase.hpp:1395</a></div></div>
<div class="ttc" id="a05247_html_ab02e83ae85c9bd4892f288f789d1aa67"><div class="ttname"><a href="../../d8/da5/a05247.html#ab02e83ae85c9bd4892f288f789d1aa67">Vacuum::getTemperature</a></div><div class="ttdeci">double getTemperature() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/a00836_source.html#l00162">Vacuum.cpp:162</a></div></div>
<div class="ttc" id="a04847_html_a9f6d9025ab15ab632872ae46f9e2bde8"><div class="ttname"><a href="../../dd/dca/a04847.html#a9f6d9025ab15ab632872ae46f9e2bde8">ParallelCyclotronTracker::execute</a></div><div class="ttdeci">virtual void execute()</div><div class="ttdoc">Apply the algorithm to the top-level beamline. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01153">ParallelCyclotronTracker.cpp:1153</a></div></div>
<div class="ttc" id="a04851_html_abd81f5dbcda886d66f60dbdf53799e28"><div class="ttname"><a href="../../dd/d3b/a04851.html#abd81f5dbcda886d66f60dbdf53799e28">ParallelCyclotronTracker::settings::stepsNextCheck</a></div><div class="ttdeci">int stepsNextCheck</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00466">ParallelCyclotronTracker.h:466</a></div></div>
<div class="ttc" id="a04847_html_a667a54de4021458f6c85dfe5017b7d89"><div class="ttname"><a href="../../dd/dca/a04847.html#a667a54de4021458f6c85dfe5017b7d89">ParallelCyclotronTracker::referencePhi</a></div><div class="ttdeci">double referencePhi</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00250">ParallelCyclotronTracker.h:250</a></div></div>
<div class="ttc" id="a04847_html_a12108331551c11541ccd3e34b23a96f3"><div class="ttname"><a href="../../dd/dca/a04847.html#a12108331551c11541ccd3e34b23a96f3">ParallelCyclotronTracker::restartStep0_m</a></div><div class="ttdeci">long long restartStep0_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00279">ParallelCyclotronTracker.h:279</a></div></div>
<div class="ttc" id="a04847_html_ab1d99d0d2dcadea751b95fb22d773ba2"><div class="ttname"><a href="../../dd/dca/a04847.html#ab1d99d0d2dcadea751b95fb22d773ba2">ParallelCyclotronTracker::initialTotalNum_m</a></div><div class="ttdeci">const size_t initialTotalNum_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00307">ParallelCyclotronTracker.h:307</a></div></div>
<div class="ttc" id="a04735_html_a644c68187c47b47efa54ab2cf9ef3a27"><div class="ttname"><a href="../../d9/d06/a04735.html#a644c68187c47b47efa54ab2cf9ef3a27">PartBunchBase::calcBeamParameters</a></div><div class="ttdeci">void calcBeamParameters()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01267">PartBunchBase.hpp:1267</a></div></div>
<div class="ttc" id="a04847_html_a99dd00a33159ed2c1e1e67f53df92b78"><div class="ttname"><a href="../../dd/dca/a04847.html#a99dd00a33159ed2c1e1e67f53df92b78">ParallelCyclotronTracker::gapCrossKick_m</a></div><div class="ttdeci">void gapCrossKick_m(size_t i, double t, double dt, const Vector_t &amp;Rold, const Vector_t &amp;Pold)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03224">ParallelCyclotronTracker.cpp:3224</a></div></div>
<div class="ttc" id="a04572_html_a7eab9239ce282f0848816013973b560cabf3dcdc52206565bf9085180efe37ad9"><div class="ttname"><a href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560cabf3dcdc52206565bf9085180efe37ad9">Steppers::RK4</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d90/a03056_source.html#l00027">Steppers.h:27</a></div></div>
<div class="ttc" id="a04847_html_a081ae478e143023617c95cafe9f673fa"><div class="ttname"><a href="../../dd/dca/a04847.html#a081ae478e143023617c95cafe9f673fa">ParallelCyclotronTracker::cosRefTheta_m</a></div><div class="ttdeci">double cosRefTheta_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00259">ParallelCyclotronTracker.h:259</a></div></div>
<div class="ttc" id="a03464_html_a3099ce8a1a14a88e0a9476f23a62046b"><div class="ttname"><a href="../../d4/d4b/a03464.html#a3099ce8a1a14a88e0a9476f23a62046b">for_each</a></div><div class="ttdeci">bool for_each(const BareFieldIterator&lt; T, D &gt; &amp;p, SameFieldID s, C)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4b/a03464_source.html#l00030">AssignDefs.h:30</a></div></div>
<div class="ttc" id="a11311_html"><div class="ttname"><a href="../../dd/d8b/a11311.html">OpMinAssign</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/de6/a03848_source.html#l00615">IpplTypeComputations.h:615</a></div></div>
<div class="ttc" id="a04735_html_aec07e66108fa824f2316899308c69706"><div class="ttname"><a href="../../d9/d06/a04735.html#aec07e66108fa824f2316899308c69706">PartBunchBase::ID</a></div><div class="ttdeci">ParticleIndex_t &amp; ID</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00571">PartBunchBase.h:571</a></div></div>
<div class="ttc" id="a04847_html_a9cef33b9fef5d81d80703c5082038ebc"><div class="ttname"><a href="../../dd/dca/a04847.html#a9cef33b9fef5d81d80703c5082038ebc">ParallelCyclotronTracker::PreviousMeanP</a></div><div class="ttdeci">Vector_t PreviousMeanP</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00254">ParallelCyclotronTracker.h:254</a></div></div>
<div class="ttc" id="a04549_html_a0d65ff32cbccf95253dd6d8e4a92031d"><div class="ttname"><a href="../../d7/d8b/a04549.html#a0d65ff32cbccf95253dd6d8e4a92031d">Options::mtsSubsteps</a></div><div class="ttdeci">int mtsSubsteps</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00059">Options.cpp:59</a></div></div>
<div class="ttc" id="a05247_html_ac589044f04ff30a2db8624aeb668392d"><div class="ttname"><a href="../../d8/da5/a05247.html#ac589044f04ff30a2db8624aeb668392d">Vacuum::getResidualGasName</a></div><div class="ttdeci">std::string getResidualGasName()</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/a00836_source.html#l00115">Vacuum.cpp:115</a></div></div>
<div class="ttc" id="a04847_html_a15a0bffb1dc6ad134121709cc90c6f6ead88946b678e4c2f251d4e292e8142291"><div class="ttname"><a href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ead88946b678e4c2f251d4e292e8142291">ParallelCyclotronTracker::TrackingMode::SEO</a></div></div>
<div class="ttc" id="a04847_html_ae7e0f3e536882efb116fda87c13182a7"><div class="ttname"><a href="../../dd/dca/a04847.html#ae7e0f3e536882efb116fda87c13182a7">ParallelCyclotronTracker::visitVerticalFFAMagnet</a></div><div class="ttdeci">virtual void visitVerticalFFAMagnet(const VerticalFFAMagnet &amp;bend)</div><div class="ttdoc">Apply the algorithm to a vertical FFA magnet. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01095">ParallelCyclotronTracker.cpp:1095</a></div></div>
<div class="ttc" id="a04847_html_a9715509cdafd134fd6ab2cbe9f35014f"><div class="ttname"><a href="../../dd/dca/a04847.html#a9715509cdafd134fd6ab2cbe9f35014f">ParallelCyclotronTracker::outfTrackOrbit_m</a></div><div class="ttdeci">std::ofstream outfTrackOrbit_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00318">ParallelCyclotronTracker.h:318</a></div></div>
<div class="ttc" id="a04843_html"><div class="ttname"><a href="../../d4/d06/a04843.html">CavityCrossData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00047">ParallelCyclotronTracker.h:47</a></div></div>
<div class="ttc" id="a00638_html"><div class="ttname"><a href="../../d1/daa/a00638.html">Marker.h</a></div></div>
<div class="ttc" id="a04537_html_ab9b5c9c33385e7d484177d8ee38e22f2"><div class="ttname"><a href="../../d4/dd0/a04537.html#ab9b5c9c33385e7d484177d8ee38e22f2">Physics::q_e</a></div><div class="ttdeci">constexpr double q_e</div><div class="ttdoc">The elementary charge in As. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6b/a01853_source.html#l00069">Physics.h:69</a></div></div>
<div class="ttc" id="a05031_html_a152b6b8844f238b93f08155aa4784c24"><div class="ttname"><a href="../../de/ddd/a05031.html#a152b6b8844f238b93f08155aa4784c24">CCollimator::getWidth</a></div><div class="ttdeci">double getWidth()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d3e/a00566_source.html#l00100">CCollimator.h:100</a></div></div>
<div class="ttc" id="a04847_html_ad2d6873a3e37619775b75f07aaddf14e"><div class="ttname"><a href="../../dd/dca/a04847.html#ad2d6873a3e37619775b75f07aaddf14e">ParallelCyclotronTracker::visitCyclotron</a></div><div class="ttdeci">virtual void visitCyclotron(const Cyclotron &amp;cycl)</div><div class="ttdoc">Apply the algorithm to a cyclotron. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00320">ParallelCyclotronTracker.cpp:320</a></div></div>
<div class="ttc" id="a04847_html_a040f281006efd0782b8f2cd4cdbc0919"><div class="ttname"><a href="../../dd/dca/a04847.html#a040f281006efd0782b8f2cd4cdbc0919">ParallelCyclotronTracker::pluginElements_m</a></div><div class="ttdeci">std::vector&lt; PluginElement * &gt; pluginElements_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00221">ParallelCyclotronTracker.h:221</a></div></div>
<div class="ttc" id="a09807_html_aec355d9c01194461adbba236ffbd7b21"><div class="ttname"><a href="../../d4/dc7/a09807.html#aec355d9c01194461adbba236ffbd7b21">TagMaker::next_tag</a></div><div class="ttdeci">int next_tag(int t, int s=1000)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d46/a03710_source.html#l00039">TagMaker.h:39</a></div></div>
<div class="ttc" id="a04839_html_a9bcc218cddc435e790b3bb7d2b465814"><div class="ttname"><a href="../../d4/d10/a04839.html#a9bcc218cddc435e790b3bb7d2b465814">adder::adder</a></div><div class="ttdeci">adder()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01533">ParallelCyclotronTracker.cpp:1533</a></div></div>
<div class="ttc" id="a05059_html_a550a1290510ba9cbbe3cffce08db7330"><div class="ttname"><a href="../../d6/de9/a05059.html#a550a1290510ba9cbbe3cffce08db7330">Cyclotron::getRfFrequ</a></div><div class="ttdeci">virtual std::vector&lt; double &gt; getRfFrequ() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00226">Cyclotron.cpp:226</a></div></div>
<div class="ttc" id="a00590_html"><div class="ttname"><a href="../../d7/db1/a00590.html">Degrader.h</a></div></div>
<div class="ttc" id="a04537_html_af00c979ab8f73b55fb60d7afcd523f55"><div class="ttname"><a href="../../d4/dd0/a04537.html#af00c979ab8f73b55fb60d7afcd523f55">Physics::pi</a></div><div class="ttdeci">constexpr double pi</div><div class="ttdoc">The value of . </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6b/a01853_source.html#l00030">Physics.h:30</a></div></div>
<div class="ttc" id="a04971_html_a6c9e6340b7162c18ed7bf5cb4c84028a"><div class="ttname"><a href="../../da/dd4/a04971.html#a6c9e6340b7162c18ed7bf5cb4c84028a">DumpFields::writeFields</a></div><div class="ttdeci">static void writeFields(Component *field)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d5e/a00467_source.html#l00129">DumpFields.cpp:129</a></div></div>
<div class="ttc" id="a04735_html_a8b691219af289152e6b74910ea4b30c1"><div class="ttname"><a href="../../d9/d06/a04735.html#a8b691219af289152e6b74910ea4b30c1">PartBunchBase::getLocalTrackStep</a></div><div class="ttdeci">long long getLocalTrackStep() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01407">PartBunchBase.hpp:1407</a></div></div>
<div class="ttc" id="a04553_html_a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c"><div class="ttname"><a href="../../d3/d56/a04553.html#a688ab1fa411e54adcc1666a08d5dda71a68d05d208b1d7fa33cad6c1326732a3c">Attrib::Distribution::R</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6f/a02234_source.html#l00122">Distribution.h:122</a></div></div>
<div class="ttc" id="a05639_html_af62c28499e8dcba75002d2904a3680c2"><div class="ttname"><a href="../../d7/d9a/a05639.html#af62c28499e8dcba75002d2904a3680c2">TBeamline::iterate</a></div><div class="ttdeci">virtual void iterate(BeamlineVisitor &amp;, bool r2l) const</div><div class="ttdoc">Apply visitor to all elements of the line. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d34/a01298_source.html#l00205">TBeamline.h:205</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8">ElementType</a></div><div class="ttdeci">ElementType</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0a/a00602_source.html#l00088">ElementBase.h:88</a></div></div>
<div class="ttc" id="a04735_html_a10684e1d8a9df362042d1d93efee21aa"><div class="ttname"><a href="../../d9/d06/a04735.html#a10684e1d8a9df362042d1d93efee21aa">PartBunchBase::boundp_destroyCycl</a></div><div class="ttdeci">void boundp_destroyCycl()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l00611">PartBunchBase.hpp:611</a></div></div>
<div class="ttc" id="a04847_html_ac6e5d97e5c26f01844d25624a3ac6612"><div class="ttname"><a href="../../dd/dca/a04847.html#ac6e5d97e5c26f01844d25624a3ac6612">ParallelCyclotronTracker::dvector_t</a></div><div class="ttdeci">std::vector&lt; double &gt; dvector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00057">ParallelCyclotronTracker.h:57</a></div></div>
<div class="ttc" id="a05187_html_a09e8908fa4675875da6c8ba50d4b1475"><div class="ttname"><a href="../../db/d48/a05187.html#a09e8908fa4675875da6c8ba50d4b1475">Ring::getNextPosition</a></div><div class="ttdeci">Vector_t getNextPosition() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dba/a00773_source.html#l00211">Ring.cpp:211</a></div></div>
<div class="ttc" id="a04847_html_a83bc3db8fa4db57db2910ff920cd5858"><div class="ttname"><a href="../../dd/dca/a04847.html#a83bc3db8fa4db57db2910ff920cd5858">ParallelCyclotronTracker::zaxis</a></div><div class="ttdeci">static Vector_t const zaxis</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00236">ParallelCyclotronTracker.h:236</a></div></div>
<div class="ttc" id="a05183_html_aa22be4c5cd598e74e5b8fce44acfc20a"><div class="ttname"><a href="../../d7/d48/a05183.html#aa22be4c5cd598e74e5b8fce44acfc20a">RFCavity::getFieldMapFN</a></div><div class="ttdeci">virtual std::string getFieldMapFN() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00335">RFCavity.cpp:335</a></div></div>
<div class="ttc" id="a04823_html_a23cc0eb5e97f8ed8839a49a6ef754635"><div class="ttname"><a href="../../d6/d34/a04823.html#a23cc0eb5e97f8ed8839a49a6ef754635">MultiBunchHandler::beaminfo_t::azimuth</a></div><div class="ttdeci">double azimuth</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00070">MultiBunchHandler.h:70</a></div></div>
<div class="ttc" id="a04735_html_a0e1323e04044303804432d62ce2f68f0"><div class="ttname"><a href="../../d9/d06/a04735.html#a0e1323e04044303804432d62ce2f68f0">PartBunchBase::RefPartP_m</a></div><div class="ttdeci">Vector_t RefPartP_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00591">PartBunchBase.h:591</a></div></div>
<div class="ttc" id="a04735_html_ab134c61db6f524d3c21741c4879501aa"><div class="ttname"><a href="../../d9/d06/a04735.html#ab134c61db6f524d3c21741c4879501aa">PartBunchBase::performDestroy</a></div><div class="ttdeci">void performDestroy(bool updateLocalNum=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01999">PartBunchBase.hpp:1999</a></div></div>
<div class="ttc" id="a04775_html_a5f6ee191b9e0eed7b2b66e75f3d502f3"><div class="ttname"><a href="../../d9/d61/a04775.html#a5f6ee191b9e0eed7b2b66e75f3d502f3">TUNE_class::lombAnalysis</a></div><div class="ttdeci">int lombAnalysis(double *x, double *y, int Ndat, int nhis)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d39/a00257_source.html#l00146">Ctunes.cpp:146</a></div></div>
<div class="ttc" id="a05227_html_a8626fd8f2d1d09858cd793b0c8682ecc"><div class="ttname"><a href="../../d3/d6e/a05227.html#a8626fd8f2d1d09858cd793b0c8682ecc">Stripper::getStop</a></div><div class="ttdeci">bool getStop() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d60/a00818_source.html#l00093">Stripper.cpp:93</a></div></div>
<div class="ttc" id="a02270_html"><div class="ttname"><a href="../../d4/de7/a02270.html">OpalBeamline.h</a></div></div>
<div class="ttc" id="a04735_html_aab55b06c27fd5e864909bf5aa889b49b"><div class="ttname"><a href="../../d9/d06/a04735.html#aab55b06c27fd5e864909bf5aa889b49b">PartBunchBase::countTotalNumPerBunch</a></div><div class="ttdeci">void countTotalNumPerBunch()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01455">PartBunchBase.hpp:1455</a></div></div>
<div class="ttc" id="a03263_html"><div class="ttname"><a href="../../dc/dc1/a03263.html">OpalException.h</a></div></div>
<div class="ttc" id="a05247_html_aa6791e81ff97015ab88e53b2f0628da7"><div class="ttname"><a href="../../d8/da5/a05247.html#aa6791e81ff97015ab88e53b2f0628da7">Vacuum::checkVacuum</a></div><div class="ttdeci">virtual bool checkVacuum(PartBunchBase&lt; double, 3 &gt; *bunch, Cyclotron *cycl)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/a00836_source.html#l00201">Vacuum.cpp:201</a></div></div>
<div class="ttc" id="a05071_html_a7fb38d50e1dbcd9bd946599ce92a4f0c"><div class="ttname"><a href="../../db/d78/a05071.html#a7fb38d50e1dbcd9bd946599ce92a4f0c">ElementBase::hasAttribute</a></div><div class="ttdeci">virtual bool hasAttribute(const std::string &amp;aKey) const</div><div class="ttdoc">Test for existence of an attribute. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d8a/a00599_source.html#l00201">ElementBase.cpp:201</a></div></div>
<div class="ttc" id="a05059_html_a9cfd43b9e975434247599c2ae5060d4d"><div class="ttname"><a href="../../d6/de9/a05059.html#a9cfd43b9e975434247599c2ae5060d4d">Cyclotron::getBFieldType</a></div><div class="ttdeci">BFieldType getBFieldType() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00389">Cyclotron.cpp:389</a></div></div>
<div class="ttc" id="a04847_html_a4951f43b20c6936bb3d15859a26a4932"><div class="ttname"><a href="../../dd/dca/a04847.html#a4951f43b20c6936bb3d15859a26a4932">ParallelCyclotronTracker::getHarmonicNumber</a></div><div class="ttdeci">double getHarmonicNumber() const</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01617">ParallelCyclotronTracker.cpp:1617</a></div></div>
<div class="ttc" id="a04775_html"><div class="ttname"><a href="../../d9/d61/a04775.html">TUNE_class</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd7/a00260_source.html#l00010">Ctunes.h:10</a></div></div>
<div class="ttc" id="a04847_html_ae3f431534cfc2b8d46fdd10d5cf48bed"><div class="ttname"><a href="../../dd/dca/a04847.html#ae3f431534cfc2b8d46fdd10d5cf48bed">ParallelCyclotronTracker::checkNumPart</a></div><div class="ttdeci">void checkNumPart(std::string s)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01142">ParallelCyclotronTracker.cpp:1142</a></div></div>
<div class="ttc" id="a00800_html"><div class="ttname"><a href="../../df/d0e/a00800.html">Septum.h</a></div></div>
<div class="ttc" id="a04735_html_a2495b52e4f4220f661085319990c8936"><div class="ttname"><a href="../../d9/d06/a04735.html#a2495b52e4f4220f661085319990c8936">PartBunchBase::set_sPos</a></div><div class="ttdeci">void set_sPos(double s)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01055">PartBunchBase.hpp:1055</a></div></div>
<div class="ttc" id="a09623_html_aeb7c0c5d1f49f8fd1b78eae709216da9"><div class="ttname"><a href="../../d9/de9/a09623.html#aeb7c0c5d1f49f8fd1b78eae709216da9">Message::get</a></div><div class="ttdeci">Message &amp; get(const T &amp;cval)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1c/a03692_source.html#l00476">Message.h:476</a></div></div>
<div class="ttc" id="a01013_html_a040681895588e18fb97e0ca41cc8d560"><div class="ttname"><a href="../../d7/d59/a01013.html#a040681895588e18fb97e0ca41cc8d560">Quaternion_t</a></div><div class="ttdeci">Quaternion Quaternion_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d59/a01013_source.html#l00044">Quaternion.h:44</a></div></div>
<div class="ttc" id="a01262_html_a01046d3dab4c1e9ad6b2b6dee8cc8310"><div class="ttname"><a href="../../d3/d53/a01262.html#a01046d3dab4c1e9ad6b2b6dee8cc8310">cross</a></div><div class="ttdeci">Vector3D cross(const Vector3D &amp;lhs, const Vector3D &amp;rhs)</div><div class="ttdoc">Vector cross product. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d53/a01262_source.html#l00111">Vector3D.cpp:111</a></div></div>
<div class="ttc" id="a00758_html"><div class="ttname"><a href="../../d2/d4a/a00758.html">RBend.h</a></div></div>
<div class="ttc" id="a12163_html_a59ffa7a04c160376d3a6593bff568fb4"><div class="ttname"><a href="../../d0/d9c/a12163.html#a59ffa7a04c160376d3a6593bff568fb4">IpplTimings::getTimer</a></div><div class="ttdeci">static TimerRef getTimer(const char *nm)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9f/a04013_source.html#l00182">IpplTimings.h:182</a></div></div>
<div class="ttc" id="a04847_html_a24e7de550ff5ade419fcd0838a026a3d"><div class="ttname"><a href="../../dd/dca/a04847.html#a24e7de550ff5ade419fcd0838a026a3d">ParallelCyclotronTracker::computeExternalFields_m</a></div><div class="ttdeci">bool computeExternalFields_m(const Vector_t &amp;R, const Vector_t &amp;P, const double &amp;t, Vector_t &amp;Efield, Vector_t &amp;Bfield)</div><div class="ttdoc">Calculate the field map at an arbitrary point. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03425">ParallelCyclotronTracker.cpp:3425</a></div></div>
<div class="ttc" id="a04847_html_adeaccb2d7a0aac369969c8f7b7a6a7c7"><div class="ttname"><a href="../../dd/dca/a04847.html#adeaccb2d7a0aac369969c8f7b7a6a7c7">ParallelCyclotronTracker::getTunes</a></div><div class="ttdeci">bool getTunes(dvector_t &amp;t, dvector_t &amp;r, dvector_t &amp;z, int lastTurn, double &amp;nur, double &amp;nuz)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01550">ParallelCyclotronTracker.cpp:1550</a></div></div>
<div class="ttc" id="a04847_html_a81ae54fff64696e717e2d5f8c5993ec1"><div class="ttname"><a href="../../dd/dca/a04847.html#a81ae54fff64696e717e2d5f8c5993ec1">ParallelCyclotronTracker::push</a></div><div class="ttdeci">bool push(double h)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01947">ParallelCyclotronTracker.cpp:1947</a></div></div>
<div class="ttc" id="a04847_html_acac2f03c131d14fb2757bafc94aeb190"><div class="ttname"><a href="../../dd/dca/a04847.html#acac2f03c131d14fb2757bafc94aeb190">ParallelCyclotronTracker::referencePtot</a></div><div class="ttdeci">double referencePtot</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00247">ParallelCyclotronTracker.h:247</a></div></div>
<div class="ttc" id="a04735_html_ac4c8a918a6235f9f03f76666f36b9a6e"><div class="ttname"><a href="../../d9/d06/a04735.html#ac4c8a918a6235f9f03f76666f36b9a6e">PartBunchBase::setTotalNumPerBunch</a></div><div class="ttdeci">void setTotalNumPerBunch(size_t numpart, short n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01427">PartBunchBase.hpp:1427</a></div></div>
<div class="ttc" id="a04847_html_a68fea5657661817956cb8b52aecd44b0"><div class="ttname"><a href="../../dd/dca/a04847.html#a68fea5657661817956cb8b52aecd44b0">ParallelCyclotronTracker::applyPluginElements</a></div><div class="ttdeci">bool applyPluginElements(const double dt)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02045">ParallelCyclotronTracker.cpp:2045</a></div></div>
<div class="ttc" id="a04847_html_a31acc2346a133e5a834afddb1332a0f6"><div class="ttname"><a href="../../dd/dca/a04847.html#a31acc2346a133e5a834afddb1332a0f6">ParallelCyclotronTracker::injectBunch</a></div><div class="ttdeci">void injectBunch(bool &amp;flagTransition)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03440">ParallelCyclotronTracker.cpp:3440</a></div></div>
<div class="ttc" id="a04847_html_a63460f8e3ddd2a77a72dc14596f3fd31"><div class="ttname"><a href="../../dd/dca/a04847.html#a63460f8e3ddd2a77a72dc14596f3fd31">ParallelCyclotronTracker::visitSBend3D</a></div><div class="ttdeci">virtual void visitSBend3D(const SBend3D &amp;)</div><div class="ttdoc">Apply the algorithm to a sector bend with 3D field map. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00890">ParallelCyclotronTracker.cpp:890</a></div></div>
<div class="ttc" id="a12131_html"><div class="ttname"><a href="../../df/da4/a12131.html">IpplInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d27/a03989_source.html#l00069">IpplInfo.h:69</a></div></div>
<div class="ttc" id="a00746_html"><div class="ttname"><a href="../../d4/dfa/a00746.html">PluginElement.h</a></div></div>
<div class="ttc" id="a05071_html_aa5580165a9f8b9e6d873927cff20d986"><div class="ttname"><a href="../../db/d78/a05071.html#aa5580165a9f8b9e6d873927cff20d986">ElementBase::clone</a></div><div class="ttdeci">virtual ElementBase * clone() const =0</div><div class="ttdoc">Return clone. </div></div>
<div class="ttc" id="a04847_html_a47c3f99997b482ad918f9b368dde3ed3"><div class="ttname"><a href="../../dd/dca/a04847.html#a47c3f99997b482ad918f9b368dde3ed3">ParallelCyclotronTracker::hasMultiBunch</a></div><div class="ttdeci">bool hasMultiBunch() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00585">ParallelCyclotronTracker.h:585</a></div></div>
<div class="ttc" id="a04847_html_a34dabf7195310ff30d7eb53c5aae8b2a"><div class="ttname"><a href="../../dd/dca/a04847.html#a34dabf7195310ff30d7eb53c5aae8b2a">ParallelCyclotronTracker::visitStripper</a></div><div class="ttdeci">virtual void visitStripper(const Stripper &amp;)</div><div class="ttdoc">Apply the algorithm to a particle stripper. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00972">ParallelCyclotronTracker.cpp:972</a></div></div>
<div class="ttc" id="a04847_html_ad7eecb45b13ecf2eb11bdc95c6a4f296"><div class="ttname"><a href="../../dd/dca/a04847.html#ad7eecb45b13ecf2eb11bdc95c6a4f296">ParallelCyclotronTracker::deleteParticle</a></div><div class="ttdeci">bool deleteParticle(bool=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02074">ParallelCyclotronTracker.cpp:2074</a></div></div>
<div class="ttc" id="a04735_html_a9e08de7a5c9634721e4ea0fc6ee0d8cd"><div class="ttname"><a href="../../d9/d06/a04735.html#a9e08de7a5c9634721e4ea0fc6ee0d8cd">PartBunchBase::dt</a></div><div class="ttdeci">ParticleAttrib&lt; double &gt; dt</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00583">PartBunchBase.h:583</a></div></div>
<div class="ttc" id="a05183_html_af497e7e36f2af3782333a865e038b262"><div class="ttname"><a href="../../d7/d48/a05183.html#af497e7e36f2af3782333a865e038b262">RFCavity::getCavityTypeString</a></div><div class="ttdeci">std::string getCavityTypeString() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00331">RFCavity.cpp:331</a></div></div>
<div class="ttc" id="a04847_html_a6ca7214e1d4530b9163e0ecb28c37121"><div class="ttname"><a href="../../dd/dca/a04847.html#a6ca7214e1d4530b9163e0ecb28c37121">ParallelCyclotronTracker::visitCorrector</a></div><div class="ttdeci">virtual void visitCorrector(const Corrector &amp;)</div><div class="ttdoc">Apply the algorithm to a closed orbit corrector. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00538">ParallelCyclotronTracker.cpp:538</a></div></div>
<div class="ttc" id="a04847_html_ab251404bffc001dee5f7c39b56c08a6b"><div class="ttname"><a href="../../dd/dca/a04847.html#ab251404bffc001dee5f7c39b56c08a6b">ParallelCyclotronTracker::bgf_main_collision_test</a></div><div class="ttdeci">void bgf_main_collision_test()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00176">ParallelCyclotronTracker.cpp:176</a></div></div>
<div class="ttc" id="a04847_html_affc8203b8ad033dd1672d1b8d0ab7e9f"><div class="ttname"><a href="../../dd/dca/a04847.html#affc8203b8ad033dd1672d1b8d0ab7e9f">ParallelCyclotronTracker::ivector_t</a></div><div class="ttdeci">std::vector&lt; int &gt; ivector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00058">ParallelCyclotronTracker.h:58</a></div></div>
<div class="ttc" id="a04847_html_a156606fbe21eefb03894cb3015bc976e"><div class="ttname"><a href="../../dd/dca/a04847.html#a156606fbe21eefb03894cb3015bc976e">ParallelCyclotronTracker::xaxis</a></div><div class="ttdeci">static Vector_t const xaxis</div><div class="ttdoc">The positive axes unit vectors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00234">ParallelCyclotronTracker.h:234</a></div></div>
<div class="ttc" id="a00734_html"><div class="ttname"><a href="../../d6/dc0/a00734.html">MultipoleTStraight.h</a></div></div>
<div class="ttc" id="a04847_html_a3efa96beca39db5e15c4b224d2596850"><div class="ttname"><a href="../../dd/dca/a04847.html#a3efa96beca39db5e15c4b224d2596850">ParallelCyclotronTracker::update_m</a></div><div class="ttdeci">void update_m(double &amp;t, const double &amp;dt, const bool &amp;finishedTurn)</div><div class="ttdoc">Update time and path length, write to output files. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02792">ParallelCyclotronTracker.cpp:2792</a></div></div>
<div class="ttc" id="a04847_html_ab2aa67387d9fcce4400137ec44d08b60"><div class="ttname"><a href="../../dd/dca/a04847.html#ab2aa67387d9fcce4400137ec44d08b60">ParallelCyclotronTracker::pathLength_m</a></div><div class="ttdeci">double pathLength_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00267">ParallelCyclotronTracker.h:267</a></div></div>
<div class="ttc" id="a04549_html_a298ab310a012dbdc1be6e41b00944d1c"><div class="ttname"><a href="../../d7/d8b/a04549.html#a298ab310a012dbdc1be6e41b00944d1c">Options::boundpDestroyFreq</a></div><div class="ttdeci">int boundpDestroyFreq</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00087">Options.cpp:87</a></div></div>
<div class="ttc" id="a03971_html_acb24191df3a19b295603a460591ba95d"><div class="ttname"><a href="../../d0/dce/a03971.html#acb24191df3a19b295603a460591ba95d">level3</a></div><div class="ttdeci">Inform &amp; level3(Inform &amp;inf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dce/a03971_source.html#l00047">Inform.cpp:47</a></div></div>
<div class="ttc" id="a04847_html_a472a74c55259d687fd274dbeac60a53a"><div class="ttname"><a href="../../dd/dca/a04847.html#a472a74c55259d687fd274dbeac60a53a">ParallelCyclotronTracker::computeSpaceChargeFields_m</a></div><div class="ttdeci">void computeSpaceChargeFields_m()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03321">ParallelCyclotronTracker.cpp:3321</a></div></div>
<div class="ttc" id="a05059_html_a42bdd09ae90b58b328d111f263fa2346"><div class="ttname"><a href="../../d6/de9/a05059.html#a42bdd09ae90b58b328d111f263fa2346">Cyclotron::getFieldMapFN</a></div><div class="ttdeci">virtual std::string getFieldMapFN() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00183">Cyclotron.cpp:183</a></div></div>
<div class="ttc" id="a05059_html_a0ccedc49b74c1d07a5fe94d1dfde88db"><div class="ttname"><a href="../../d6/de9/a05059.html#a0ccedc49b74c1d07a5fe94d1dfde88db">Cyclotron::setBFieldType</a></div><div class="ttdeci">void setBFieldType()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00369">Cyclotron.cpp:369</a></div></div>
<div class="ttc" id="a03989_html_a93d4be0c42bb6191255e156c2943be12"><div class="ttname"><a href="../../dd/d27/a03989.html#a93d4be0c42bb6191255e156c2943be12">ERRORMSG</a></div><div class="ttdeci">#define ERRORMSG(msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d27/a03989_source.html#l00350">IpplInfo.h:350</a></div></div>
<div class="ttc" id="a04735_html_a0d4d51f2d1ee3bf4046918fe2d022cc7"><div class="ttname"><a href="../../d9/d06/a04735.html#a0d4d51f2d1ee3bf4046918fe2d022cc7">PartBunchBase::Bin</a></div><div class="ttdeci">ParticleAttrib&lt; int &gt; Bin</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00582">PartBunchBase.h:582</a></div></div>
<div class="ttc" id="a04735_html_a4da4a63f81523ab5ff01250771273e82"><div class="ttname"><a href="../../d9/d06/a04735.html#a4da4a63f81523ab5ff01250771273e82">PartBunchBase::getFieldSolverType</a></div><div class="ttdeci">FieldSolverType getFieldSolverType() const</div><div class="ttdoc">Return the fieldsolver type if we have a fieldsolver. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01361">PartBunchBase.hpp:1361</a></div></div>
<div class="ttc" id="a04847_html_a557bfd6809307e8e6d5e7abbc92de914"><div class="ttname"><a href="../../dd/dca/a04847.html#a557bfd6809307e8e6d5e7abbc92de914">ParallelCyclotronTracker::step_m</a></div><div class="ttdeci">long long step_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00278">ParallelCyclotronTracker.h:278</a></div></div>
<div class="ttc" id="a05227_html_a32ca46c196b5f6c698ee73f0a5756dd6"><div class="ttname"><a href="../../d3/d6e/a05227.html#a32ca46c196b5f6c698ee73f0a5756dd6">Stripper::getOPMass</a></div><div class="ttdeci">double getOPMass() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d60/a00818_source.html#l00085">Stripper.cpp:85</a></div></div>
<div class="ttc" id="a08231_html"><div class="ttname"><a href="../../d0/d37/a08231.html">ParticleAttrib</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/de2/a03410_source.html#l00025">MakeDataSource.h:25</a></div></div>
<div class="ttc" id="a04539_html_a610458ef9e4cd6ea2d9b23bfddef69f8"><div class="ttname"><a href="../../d0/d3d/a04539.html#a610458ef9e4cd6ea2d9b23bfddef69f8">Units::m2mm</a></div><div class="ttdeci">constexpr double m2mm</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00026">Units.h:26</a></div></div>
<div class="ttc" id="a04847_html_a4aab9067e07fca841908971f333bb05d"><div class="ttname"><a href="../../dd/dca/a04847.html#a4aab9067e07fca841908971f333bb05d">ParallelCyclotronTracker::MtsTracker</a></div><div class="ttdeci">void MtsTracker()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01250">ParallelCyclotronTracker.cpp:1250</a></div></div>
<div class="ttc" id="a04847_html_aac2a3c841c93ac378818374c39d78259"><div class="ttname"><a href="../../dd/dca/a04847.html#aac2a3c841c93ac378818374c39d78259">ParallelCyclotronTracker::visitVariableRFCavity</a></div><div class="ttdeci">virtual void visitVariableRFCavity(const VariableRFCavity &amp;cav)</div><div class="ttdoc">Apply the algorithm to a variabel RF cavity. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01066">ParallelCyclotronTracker.cpp:1066</a></div></div>
<div class="ttc" id="a02168_html_acd22617257a8ed81fc3eb5e5e53c69b5aef7994f35f11e33b59aadbb2dbe6b605"><div class="ttname"><a href="../../d1/dce/a02168.html#acd22617257a8ed81fc3eb5e5e53c69b5aef7994f35f11e33b59aadbb2dbe6b605">DumpFrame::BUNCH_MEAN</a></div></div>
<div class="ttc" id="a05059_html_a098ca2acb3fa6876ab88acb644665708"><div class="ttname"><a href="../../d6/de9/a05059.html#a098ca2acb3fa6876ab88acb644665708">Cyclotron::getCyclHarm</a></div><div class="ttdeci">virtual double getCyclHarm() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00297">Cyclotron.cpp:297</a></div></div>
<div class="ttc" id="a04851_html_a32d840e781f868f4433aaf563e3b9102"><div class="ttname"><a href="../../dd/d3b/a04851.html#a32d840e781f868f4433aaf563e3b9102">ParallelCyclotronTracker::settings::deltaTheta</a></div><div class="ttdeci">double deltaTheta</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00465">ParallelCyclotronTracker.h:465</a></div></div>
<div class="ttc" id="a05323_html_a057172529af54894134f41e521014af0ae1e0af60f17fb4443908f0d9b4bb0344"><div class="ttname"><a href="../../d6/daf/a05323.html#a057172529af54894134f41e521014af0ae1e0af60f17fb4443908f0d9b4bb0344">AbstractTracker::T</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d92/a00929_source.html#l00039">AbstractTracker.h:39</a></div></div>
<div class="ttc" id="a04847_html_a418bc2825324f3468d04640386bbac72"><div class="ttname"><a href="../../dd/dca/a04847.html#a418bc2825324f3468d04640386bbac72">ParallelCyclotronTracker::~ParallelCyclotronTracker</a></div><div class="ttdeci">virtual ~ParallelCyclotronTracker()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00162">ParallelCyclotronTracker.cpp:162</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8a9a311ef6dad816cb7a15c0ab41920ad8"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a9a311ef6dad816cb7a15c0ab41920ad8">ElementType::VACUUM</a></div></div>
<div class="ttc" id="a05247_html_a41950fa7fd3ac7d5a09fe4e6504e1a3d"><div class="ttname"><a href="../../d8/da5/a05247.html#a41950fa7fd3ac7d5a09fe4e6504e1a3d">Vacuum::getPressureMapFN</a></div><div class="ttdeci">std::string getPressureMapFN() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/a00836_source.html#l00141">Vacuum.cpp:141</a></div></div>
<div class="ttc" id="a05059_html_ae825fac52f9fd89c8d72afeee8c7d9d6"><div class="ttname"><a href="../../d6/de9/a05059.html#ae825fac52f9fd89c8d72afeee8c7d9d6">Cyclotron::getRinit</a></div><div class="ttdeci">virtual double getRinit() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00127">Cyclotron.cpp:127</a></div></div>
<div class="ttc" id="a05167_html_a454774d958ed90147fc9c397b61ace89"><div class="ttname"><a href="../../df/daa/a05167.html#a454774d958ed90147fc9c397b61ace89">PluginElement::getYStart</a></div><div class="ttdeci">double getYStart() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/a00743_source.html#l00186">PluginElement.cpp:186</a></div></div>
<div class="ttc" id="a05187_html_ae0d1bcb3efbc9396ab65ab28bce39e0f"><div class="ttname"><a href="../../db/d48/a05187.html#ae0d1bcb3efbc9396ab65ab28bce39e0f">Ring::appendElement</a></div><div class="ttdeci">void appendElement(const Component &amp;element)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dba/a00773_source.html#l00229">Ring.cpp:229</a></div></div>
<div class="ttc" id="a04819_html_a266a5dab6906981146329961e4f4b1b4"><div class="ttname"><a href="../../d6/d6f/a04819.html#a266a5dab6906981146329961e4f4b1b4">MultiBunchHandler::injection_t::radius</a></div><div class="ttdeci">double radius</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d25/a00290_source.html#l00048">MultiBunchHandler.h:48</a></div></div>
<div class="ttc" id="a05059_html_a4c9eca7f86527b2973cc0e59a105f6cc"><div class="ttname"><a href="../../d6/de9/a05059.html#a4c9eca7f86527b2973cc0e59a105f6cc">Cyclotron::getMaxR</a></div><div class="ttdeci">virtual double getMaxR() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00325">Cyclotron.cpp:325</a></div></div>
<div class="ttc" id="a05031_html"><div class="ttname"><a href="../../de/ddd/a05031.html">CCollimator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d3e/a00566_source.html#l00025">CCollimator.h:25</a></div></div>
<div class="ttc" id="a04847_html_a7236d29b67e337d42854b34af3063d22"><div class="ttname"><a href="../../dd/dca/a04847.html#a7236d29b67e337d42854b34af3063d22">ParallelCyclotronTracker::initializeTracking_m</a></div><div class="ttdeci">std::tuple&lt; double, double, double &gt; initializeTracking_m()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02835">ParallelCyclotronTracker.cpp:2835</a></div></div>
<div class="ttc" id="a05059_html_ae7ef6c8f2c32b4d352653702e9c5d19d"><div class="ttname"><a href="../../d6/de9/a05059.html#ae7ef6c8f2c32b4d352653702e9c5d19d">Cyclotron::getNumberOfTrimcoils</a></div><div class="ttdeci">unsigned int getNumberOfTrimcoils() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00293">Cyclotron.cpp:293</a></div></div>
<div class="ttc" id="a03668_html_a2ecfb905230e85a1a2cadf2c1aa65ced"><div class="ttname"><a href="../../d9/d9a/a03668.html#a2ecfb905230e85a1a2cadf2c1aa65ced">COMM_ANY_NODE</a></div><div class="ttdeci">const int COMM_ANY_NODE</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/a03668_source.html#l00040">Communicate.h:40</a></div></div>
<div class="ttc" id="a04735_html_a2f9a3f71f9e8cae4965de06b4819e176"><div class="ttname"><a href="../../d9/d06/a04735.html#a2f9a3f71f9e8cae4965de06b4819e176">PartBunchBase::M</a></div><div class="ttdeci">ParticleAttrib&lt; double &gt; M</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00576">PartBunchBase.h:576</a></div></div>
<div class="ttc" id="a03686_html_a6e1e71ee127405447f7411777d80ebd6"><div class="ttname"><a href="../../d4/d5e/a03686.html#a6e1e71ee127405447f7411777d80ebd6">reduce</a></div><div class="ttdeci">bool reduce(Communicate &amp;, InputIterator, InputIterator, OutputIterator, const ReduceOp &amp;, bool *IncludeVal=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/a03689_source.html#l00055">GlobalComm.hpp:55</a></div></div>
<div class="ttc" id="a00578_html"><div class="ttname"><a href="../../dd/d5c/a00578.html">Corrector.h</a></div></div>
<div class="ttc" id="a05059_html_a6d21538ab068ab9ac41e5ef23dfe08a3"><div class="ttname"><a href="../../d6/de9/a05059.html#a6d21538ab068ab9ac41e5ef23dfe08a3">Cyclotron::getBScale</a></div><div class="ttdeci">virtual double getBScale() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00276">Cyclotron.cpp:276</a></div></div>
<div class="ttc" id="a04847_html_a15a0bffb1dc6ad134121709cc90c6f6ea4073a3520c889c260be3a79189cedb26"><div class="ttname"><a href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea4073a3520c889c260be3a79189cedb26">ParallelCyclotronTracker::TrackingMode::BUNCH</a></div></div>
<div class="ttc" id="a04847_html_a5ebb0be80afeeda200f8c514a60c1c97"><div class="ttname"><a href="../../dd/dca/a04847.html#a5ebb0be80afeeda200f8c514a60c1c97">ParallelCyclotronTracker::visitMultipoleTStraight</a></div><div class="ttdeci">virtual void visitMultipoleTStraight(const MultipoleTStraight &amp;)</div><div class="ttdoc">Apply the algorithm to an arbitrary straight multipole. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00642">ParallelCyclotronTracker.cpp:642</a></div></div>
<div class="ttc" id="a04847_html_a2261d79226429e5115467037fd585804"><div class="ttname"><a href="../../dd/dca/a04847.html#a2261d79226429e5115467037fd585804">ParallelCyclotronTracker::lastDumpedStep_m</a></div><div class="ttdeci">int lastDumpedStep_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00264">ParallelCyclotronTracker.h:264</a></div></div>
<div class="ttc" id="a04847_html_a4fc2af79c0bf674856416b87028369a2"><div class="ttname"><a href="../../dd/dca/a04847.html#a4fc2af79c0bf674856416b87028369a2">ParallelCyclotronTracker::saveInjectValues</a></div><div class="ttdeci">void saveInjectValues()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03476">ParallelCyclotronTracker.cpp:3476</a></div></div>
<div class="ttc" id="a04847_html_ad51fb20cb6a44ecea8f27ed8971f7373"><div class="ttname"><a href="../../dd/dca/a04847.html#ad51fb20cb6a44ecea8f27ed8971f7373">ParallelCyclotronTracker::referencePsi</a></div><div class="ttdeci">double referencePsi</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00249">ParallelCyclotronTracker.h:249</a></div></div>
<div class="ttc" id="a04739_html_af6d424393543f1c7fcac662f91a6c6b3"><div class="ttname"><a href="../../d5/d13/a04739.html#af6d424393543f1c7fcac662f91a6c6b3">OpalData::setOpenMode</a></div><div class="ttdeci">void setOpenMode(OpenMode openMode)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc1/a00212_source.html#l00349">OpalData.cpp:349</a></div></div>
<div class="ttc" id="a04735_html_a926547f8adc7ff91c3fe639f0fadccbf"><div class="ttname"><a href="../../d9/d06/a04735.html#a926547f8adc7ff91c3fe639f0fadccbf">PartBunchBase::getNumBunch</a></div><div class="ttdeci">short getNumBunch() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01421">PartBunchBase.hpp:1421</a></div></div>
<div class="ttc" id="a04735_html_a8168f4f0d38ce6c3e77b1a83544a41d2"><div class="ttname"><a href="../../d9/d06/a04735.html#a8168f4f0d38ce6c3e77b1a83544a41d2">PartBunchBase::cavityGapCrossed</a></div><div class="ttdeci">ParticleAttrib&lt; short &gt; cavityGapCrossed</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00587">PartBunchBase.h:587</a></div></div>
<div class="ttc" id="a03686_html_a3f4c593649c5ad948ee3e8566bffeda6"><div class="ttname"><a href="../../d4/d5e/a03686.html#a3f4c593649c5ad948ee3e8566bffeda6">allreduce</a></div><div class="ttdeci">void allreduce(const T *input, T *output, int count, Op op)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/a03689_source.html#l00510">GlobalComm.hpp:510</a></div></div>
<div class="ttc" id="a06231_html"><div class="ttname"><a href="../../dd/d85/a06231.html">LossDataSink</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/a01913_source.html#l00081">LossDataSink.h:81</a></div></div>
<div class="ttc" id="a00566_html"><div class="ttname"><a href="../../d0/d3e/a00566.html">CCollimator.h</a></div></div>
<div class="ttc" id="a05115_html_af43120d831b2a8878d30eed4b26cda92"><div class="ttname"><a href="../../df/d84/a05115.html#af43120d831b2a8878d30eed4b26cda92">MultipoleTCurvedConstRadius::clone</a></div><div class="ttdeci">virtual ElementBase * clone() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d46/a00665_source.html#l00056">MultipoleTCurvedConstRadius.cpp:56</a></div></div>
<div class="ttc" id="a05059_html_a1ee6f03da77906adaea8ae75e4eca91c"><div class="ttname"><a href="../../d6/de9/a05059.html#a1ee6f03da77906adaea8ae75e4eca91c">Cyclotron::getPRinit</a></div><div class="ttdeci">virtual double getPRinit() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00135">Cyclotron.cpp:135</a></div></div>
<div class="ttc" id="a04739_html_ac79e35ccb2194504a19ce52ddc5fd6e0"><div class="ttname"><a href="../../d5/d13/a04739.html#ac79e35ccb2194504a19ce52ddc5fd6e0">OpalData::getInstance</a></div><div class="ttdeci">static OpalData * getInstance()</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc1/a00212_source.html#l00196">OpalData.cpp:196</a></div></div>
<div class="ttc" id="a04847_html_a7641697762900193c6d36224b2536be2"><div class="ttname"><a href="../../dd/dca/a04847.html#a7641697762900193c6d36224b2536be2">ParallelCyclotronTracker::type_pair</a></div><div class="ttdeci">std::pair&lt; ElementType, element_pair &gt; type_pair</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00060">ParallelCyclotronTracker.h:60</a></div></div>
<div class="ttc" id="a04539_html_aa78682c4d302f04b7515c830a29dbbfd"><div class="ttname"><a href="../../d0/d3d/a04539.html#aa78682c4d302f04b7515c830a29dbbfd">Units::kV2V</a></div><div class="ttdeci">constexpr double kV2V</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00062">Units.h:62</a></div></div>
<div class="ttc" id="a04847_html_ad1fe10141777e52cb4a66fa9fbfa1f49"><div class="ttname"><a href="../../dd/dca/a04847.html#ad1fe10141777e52cb4a66fa9fbfa1f49">ParallelCyclotronTracker::calculateAngle2</a></div><div class="ttdeci">double calculateAngle2(double x, double y)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00573">ParallelCyclotronTracker.h:573</a></div></div>
<div class="ttc" id="a07151_html"><div class="ttname"><a href="../../de/dd6/a07151.html">LF2</a></div><div class="ttdoc">Leap-Frog 2nd order. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d23/a03041_source.html#l00026">LF2.h:26</a></div></div>
<div class="ttc" id="a03713_html_a23a98645c0ac63580934633969bd4a4c"><div class="ttname"><a href="../../dd/df6/a03713.html#a23a98645c0ac63580934633969bd4a4c">IPPL_APP_CYCLE</a></div><div class="ttdeci">#define IPPL_APP_CYCLE</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/df6/a03713_source.html#l00103">Tags.h:103</a></div></div>
<div class="ttc" id="a00893_html_a38612900df9e86a0c30bbbcfab4f0be9"><div class="ttname"><a href="../../dc/d2c/a00893.html#a38612900df9e86a0c30bbbcfab4f0be9">cos</a></div><div class="ttdeci">Tps&lt; T &gt; cos(const Tps&lt; T &gt; &amp;x)</div><div class="ttdoc">Cosine. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2c/a00893_source.html#l00129">TpsMath.h:129</a></div></div>
<div class="ttc" id="a05183_html_a1282969cc6ffac1a3a82f9bb3c5bedaa"><div class="ttname"><a href="../../d7/d48/a05183.html#a1282969cc6ffac1a3a82f9bb3c5bedaa">RFCavity::getAmplitudeModelName</a></div><div class="ttdeci">std::string getAmplitudeModelName()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7e/a00770_source.html#l00450">RFCavity.h:450</a></div></div>
<div class="ttc" id="a04847_html_a00bd119c89760f339a293b7c66b9cd55"><div class="ttname"><a href="../../dd/dca/a04847.html#a00bd119c89760f339a293b7c66b9cd55">ParallelCyclotronTracker::kick</a></div><div class="ttdeci">bool kick(double h)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01994">ParallelCyclotronTracker.cpp:1994</a></div></div>
<div class="ttc" id="a04847_html_a10798d8fbf3380d58c62af7b8c49a4f0"><div class="ttname"><a href="../../dd/dca/a04847.html#a10798d8fbf3380d58c62af7b8c49a4f0">ParallelCyclotronTracker::visitDegrader</a></div><div class="ttdeci">virtual void visitDegrader(const Degrader &amp;)</div><div class="ttdoc">Apply the algorithm to a degrader. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00548">ParallelCyclotronTracker.cpp:548</a></div></div>
<div class="ttc" id="a05183_html_ab363ff1acc9b0ccdf9d589731afd31ad"><div class="ttname"><a href="../../d7/d48/a05183.html#ab363ff1acc9b0ccdf9d589731afd31ad">RFCavity::getCycFrequency</a></div><div class="ttdeci">virtual double getCycFrequency() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00349">RFCavity.cpp:349</a></div></div>
<div class="ttc" id="a04851_html_a703d30176dcd83320323c55929303ed5"><div class="ttname"><a href="../../dd/d3b/a04851.html#a703d30176dcd83320323c55929303ed5">ParallelCyclotronTracker::settings::stepsPerTurn</a></div><div class="ttdeci">int stepsPerTurn</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00464">ParallelCyclotronTracker.h:464</a></div></div>
<div class="ttc" id="a00752_html"><div class="ttname"><a href="../../dd/d5c/a00752.html">Probe.h</a></div></div>
<div class="ttc" id="a04539_html_ac9c7e47f91a8010d7c98e49d6e924911"><div class="ttname"><a href="../../d0/d3d/a04539.html#ac9c7e47f91a8010d7c98e49d6e924911">Units::rad2deg</a></div><div class="ttdeci">constexpr double rad2deg</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00146">Units.h:146</a></div></div>
<div class="ttc" id="a04847_html_abd96d31b26f1521d9d9af6280d850c84"><div class="ttname"><a href="../../dd/dca/a04847.html#abd96d31b26f1521d9d9af6280d850c84">ParallelCyclotronTracker::myNode_m</a></div><div class="ttdeci">const int myNode_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00305">ParallelCyclotronTracker.h:305</a></div></div>
<div class="ttc" id="a04847_html_a840b1f8ae80e3e83dfc32de00ef8e090"><div class="ttname"><a href="../../dd/dca/a04847.html#a840b1f8ae80e3e83dfc32de00ef8e090">ParallelCyclotronTracker::updateAzimuthAndRadius</a></div><div class="ttdeci">void updateAzimuthAndRadius()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03533">ParallelCyclotronTracker.cpp:3533</a></div></div>
<div class="ttc" id="a04847_html_a4dc913467861193e1296857af2469078"><div class="ttname"><a href="../../dd/dca/a04847.html#a4dc913467861193e1296857af2469078">ParallelCyclotronTracker::calculateAngle</a></div><div class="ttdeci">double calculateAngle(double x, double y)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00559">ParallelCyclotronTracker.h:559</a></div></div>
<div class="ttc" id="a04549_html_a453b96859e7bdbd1f5df17f34f6981eb"><div class="ttname"><a href="../../d7/d8b/a04549.html#a453b96859e7bdbd1f5df17f34f6981eb">Options::sptDumpFreq</a></div><div class="ttdeci">int sptDumpFreq</div><div class="ttdoc">The frequency to dump single particle trajectory of particles with ID = 0 &amp; 1. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00047">Options.cpp:47</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8ad8166b7d7c176c698b7b9f3418baae61"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ad8166b7d7c176c698b7b9f3418baae61">ElementType::CCOLLIMATOR</a></div></div>
<div class="ttc" id="a11819_html"><div class="ttname"><a href="../../dc/dc9/a11819.html">OpAddAssign</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/a03854_source.html#l00557">TypeComputations.h:557</a></div></div>
<div class="ttc" id="a04847_html_a98599d211ac1cf8ca5543b5ca6463f8f"><div class="ttname"><a href="../../dd/dca/a04847.html#a98599d211ac1cf8ca5543b5ca6463f8f">ParallelCyclotronTracker::setTimeStep</a></div><div class="ttdeci">void setTimeStep()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02383">ParallelCyclotronTracker.cpp:2383</a></div></div>
<div class="ttc" id="a04735_html_a85249558619c2a5f4cc71c706384e898"><div class="ttname"><a href="../../d9/d06/a04735.html#a85249558619c2a5f4cc71c706384e898">PartBunchBase::setTotalNum</a></div><div class="ttdeci">void setTotalNum(size_t n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01921">PartBunchBase.hpp:1921</a></div></div>
<div class="ttc" id="a00740_html"><div class="ttname"><a href="../../dc/dce/a00740.html">Offset.h</a></div></div>
<div class="ttc" id="a05351_html"><div class="ttname"><a href="../../df/d5e/a05351.html">OpalParticle</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dd4/a00968_source.html#l00023">OpalParticle.h:23</a></div></div>
<div class="ttc" id="a05251_html"><div class="ttname"><a href="../../d4/d19/a05251.html">VariableRFCavity</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dcf/a00845_source.html#l00049">VariableRFCavity.h:49</a></div></div>
<div class="ttc" id="a02234_html"><div class="ttname"><a href="../../d8/d6f/a02234.html">Distribution.h</a></div></div>
<div class="ttc" id="a05059_html_a45abd18f34b73644de07ee326e1eae15"><div class="ttname"><a href="../../d6/de9/a05059.html#a45abd18f34b73644de07ee326e1eae15">Cyclotron::getRmin</a></div><div class="ttdeci">virtual double getRmin() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00301">Cyclotron.cpp:301</a></div></div>
<div class="ttc" id="a05183_html_ac9dfec52bbe15f4bb6859b0d436dcf75"><div class="ttname"><a href="../../d7/d48/a05183.html#ac9dfec52bbe15f4bb6859b0d436dcf75">RFCavity::getPerpenDistance</a></div><div class="ttdeci">virtual double getPerpenDistance() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00310">RFCavity.cpp:310</a></div></div>
<div class="ttc" id="a04847_html_a175afb2b6d9e0abdef6cc0bc895492af"><div class="ttname"><a href="../../dd/dca/a04847.html#a175afb2b6d9e0abdef6cc0bc895492af">ParallelCyclotronTracker::visitVacuum</a></div><div class="ttdeci">virtual void visitVacuum(const Vacuum &amp;)</div><div class="ttdoc">Apply the algorithm to a vacuum space. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01023">ParallelCyclotronTracker.cpp:1023</a></div></div>
<div class="ttc" id="a05227_html_a703e850c3e78170de72d534e3ef25407"><div class="ttname"><a href="../../d3/d6e/a05227.html#a703e850c3e78170de72d534e3ef25407">Stripper::getOPCharge</a></div><div class="ttdeci">double getOPCharge() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d60/a00818_source.html#l00081">Stripper.cpp:81</a></div></div>
<div class="ttc" id="a04847_html_aa2a7c1676c046c2d6a907fe30999d0e0"><div class="ttname"><a href="../../dd/dca/a04847.html#aa2a7c1676c046c2d6a907fe30999d0e0">ParallelCyclotronTracker::initTrackOrbitFile</a></div><div class="ttdeci">void initTrackOrbitFile()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02206">ParallelCyclotronTracker.cpp:2206</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8a9b2455e659f96e1bd7c87cc69e99a08d"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a9b2455e659f96e1bd7c87cc69e99a08d">ElementType::CYCLOTRON</a></div></div>
<div class="ttc" id="a12119_html"><div class="ttname"><a href="../../d8/d4f/a12119.html">Inform</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2e/a03974_source.html#l00042">Inform.h:42</a></div></div>
<div class="ttc" id="a05379_html_a27d86c12be3dc52a56c245ff36041871"><div class="ttname"><a href="../../dd/d3d/a05379.html#a27d86c12be3dc52a56c245ff36041871">PartData::getGamma</a></div><div class="ttdeci">double getGamma() const</div><div class="ttdoc">The relativistic gamma per particle. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/a00998_source.html#l00129">PartData.h:129</a></div></div>
<div class="ttc" id="a05247_html_ad8778701431190d5c21a63522597926d"><div class="ttname"><a href="../../d8/da5/a05247.html#ad8778701431190d5c21a63522597926d">Vacuum::getStop</a></div><div class="ttdeci">bool getStop() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/a00836_source.html#l00175">Vacuum.cpp:175</a></div></div>
<div class="ttc" id="a04735_html_a16508077c3f6403314e7923dc74e06f9"><div class="ttname"><a href="../../d9/d06/a04735.html#a16508077c3f6403314e7923dc74e06f9">PartBunchBase::getQ</a></div><div class="ttdeci">double getQ() const</div><div class="ttdoc">Access to reference data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01630">PartBunchBase.hpp:1630</a></div></div>
<div class="ttc" id="a04847_html_a5dc5b769d60d7310d604b9623fe31f4b"><div class="ttname"><a href="../../dd/dca/a04847.html#a5dc5b769d60d7310d604b9623fe31f4b">ParallelCyclotronTracker::computeRadius</a></div><div class="ttdeci">double computeRadius(const Vector_t &amp;meanR) const</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00233">ParallelCyclotronTracker.cpp:233</a></div></div>
<div class="ttc" id="a04851_html_a70e03a952c0c250de7f7a5b338cbbe25"><div class="ttname"><a href="../../dd/d3b/a04851.html#a70e03a952c0c250de7f7a5b338cbbe25">ParallelCyclotronTracker::settings::scSolveFreq</a></div><div class="ttdeci">int scSolveFreq</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00463">ParallelCyclotronTracker.h:463</a></div></div>
<div class="ttc" id="a04596_html_a5c17dec4af54fc8232e6bbd18a28804a"><div class="ttname"><a href="../../d8/d25/a04596.html#a5c17dec4af54fc8232e6bbd18a28804a">Hypervolume::n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dce/a04214_source.html#l00056">hypervolume.cpp:56</a></div></div>
<div class="ttc" id="a05059_html_a856e2c6f80b96099c311838d43707ec5"><div class="ttname"><a href="../../d6/de9/a05059.html#a856e2c6f80b96099c311838d43707ec5">Cyclotron::getSymmetry</a></div><div class="ttdeci">virtual double getSymmetry() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00252">Cyclotron.cpp:252</a></div></div>
<div class="ttc" id="a04847_html_a16e1cf92e29384ddcff45a058f7b3cca"><div class="ttname"><a href="../../dd/dca/a04847.html#a16e1cf92e29384ddcff45a058f7b3cca">ParallelCyclotronTracker::visitProbe</a></div><div class="ttdeci">virtual void visitProbe(const Probe &amp;)</div><div class="ttdoc">Apply the algorithm to a probe. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00690">ParallelCyclotronTracker.cpp:690</a></div></div>
<div class="ttc" id="a04847_html_ac6d94305e4418878296c4d64a0501dd8"><div class="ttname"><a href="../../dd/dca/a04847.html#ac6d94305e4418878296c4d64a0501dd8">ParallelCyclotronTracker::referenceZ</a></div><div class="ttdeci">double referenceZ</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00242">ParallelCyclotronTracker.h:242</a></div></div>
<div class="ttc" id="a04735_html_ad1ee6b7f03a3b0613c452a83a5e94641"><div class="ttname"><a href="../../d9/d06/a04735.html#ad1ee6b7f03a3b0613c452a83a5e94641">PartBunchBase::boundp</a></div><div class="ttdeci">virtual void boundp()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l00510">PartBunchBase.hpp:510</a></div></div>
<div class="ttc" id="a05059_html_a9e16c6bb041406486ba4f9afe5774baa"><div class="ttname"><a href="../../d6/de9/a05059.html#a9e16c6bb041406486ba4f9afe5774baa">Cyclotron::initialise</a></div><div class="ttdeci">virtual void initialise(PartBunchBase&lt; double, 3 &gt; *bunch, double &amp;startField, double &amp;endField)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00941">Cyclotron.cpp:941</a></div></div>
<div class="ttc" id="a04539_html_a749503871b5f00aac95bd6fe1071fdd5"><div class="ttname"><a href="../../d0/d3d/a04539.html#a749503871b5f00aac95bd6fe1071fdd5">Units::ns2s</a></div><div class="ttdeci">constexpr double ns2s</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00047">Units.h:47</a></div></div>
<div class="ttc" id="a00857_html"><div class="ttname"><a href="../../d0/d82/a00857.html">VerticalFFAMagnet.h</a></div></div>
<div class="ttc" id="a04847_html_abe24adc3e8075fa31efcc433e82aa498"><div class="ttname"><a href="../../dd/dca/a04847.html#abe24adc3e8075fa31efcc433e82aa498">ParallelCyclotronTracker::itsBeamline</a></div><div class="ttdeci">Beamline * itsBeamline</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00220">ParallelCyclotronTracker.h:220</a></div></div>
<div class="ttc" id="a04847_html_aad5003015f0b295025bcec81dc0304d2"><div class="ttname"><a href="../../dd/dca/a04847.html#aad5003015f0b295025bcec81dc0304d2">ParallelCyclotronTracker::FDext_m</a></div><div class="ttdeci">Vector_t FDext_m[2]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00303">ParallelCyclotronTracker.h:303</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8a5a9b37d8d9e76a99e6f5160c3eff9057"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8a5a9b37d8d9e76a99e6f5160c3eff9057">ElementType::PROBE</a></div></div>
<div class="ttc" id="a04847_html_a321e270f5e0af494699b02963717712a"><div class="ttname"><a href="../../dd/dca/a04847.html#a321e270f5e0af494699b02963717712a">ParallelCyclotronTracker::closeFiles</a></div><div class="ttdeci">void closeFiles()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00308">ParallelCyclotronTracker.cpp:308</a></div></div>
<div class="ttc" id="a05183_html_adec967170bc7dce19c7da8295276c47f"><div class="ttname"><a href="../../d7/d48/a05183.html#adec967170bc7dce19c7da8295276c47f">RFCavity::getCavityType</a></div><div class="ttdeci">CavityType getCavityType() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7e/a00770_source.html#l00415">RFCavity.h:415</a></div></div>
<div class="ttc" id="a05183_html_af90ea0cd7726b5fdb17082c0f702588a"><div class="ttname"><a href="../../d7/d48/a05183.html#af90ea0cd7726b5fdb17082c0f702588a">RFCavity::getRmin</a></div><div class="ttdeci">virtual double getRmin() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00290">RFCavity.cpp:290</a></div></div>
<div class="ttc" id="a07199_html_abcbbb6b928c3eacb3a00ed572b8c17f7"><div class="ttname"><a href="../../d7/d4d/a07199.html#abcbbb6b928c3eacb3a00ed572b8c17f7">DataSink::writeMultiBunchStatistics</a></div><div class="ttdeci">void writeMultiBunchStatistics(PartBunchBase&lt; double, 3 &gt; *beam, MultiBunchHandler *mbhandler)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d48/a03071_source.html#l00197">DataSink.cpp:197</a></div></div>
<div class="ttc" id="a04549_html_ac6f115a7078d40475a6249e5dceb9345"><div class="ttname"><a href="../../d7/d8b/a04549.html#ac6f115a7078d40475a6249e5dceb9345">Options::rebinFreq</a></div><div class="ttdeci">int rebinFreq</div><div class="ttdoc">The frequency to reset energy bin ID for all particles. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00055">Options.cpp:55</a></div></div>
<div class="ttc" id="a05187_html_a9f4c9a04b52030335ecb0806c70b8c8e"><div class="ttname"><a href="../../db/d48/a05187.html#a9f4c9a04b52030335ecb0806c70b8c8e">Ring::clone</a></div><div class="ttdeci">virtual ElementBase * clone() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/a00776_source.html#l00155">Ring.h:155</a></div></div>
<div class="ttc" id="a04847_html_a0f86ab6a46d64fb7771a2529483ed48a"><div class="ttname"><a href="../../dd/dca/a04847.html#a0f86ab6a46d64fb7771a2529483ed48a">ParallelCyclotronTracker::PluginElemTimer_m</a></div><div class="ttdeci">IpplTimings::TimerRef PluginElemTimer_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00336">ParallelCyclotronTracker.h:336</a></div></div>
<div class="ttc" id="a04847_html_abf713a03b8e60b20282878c80e42b45d"><div class="ttname"><a href="../../dd/dca/a04847.html#abf713a03b8e60b20282878c80e42b45d">ParallelCyclotronTracker::spiral_flag</a></div><div class="ttdeci">bool spiral_flag</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00252">ParallelCyclotronTracker.h:252</a></div></div>
<div class="ttc" id="a04549_html_ae1dc7de1cbb27c5535580db7cdf7be6a"><div class="ttname"><a href="../../d7/d8b/a04549.html#ae1dc7de1cbb27c5535580db7cdf7be6a">Options::statDumpFreq</a></div><div class="ttdeci">int statDumpFreq</div><div class="ttdoc">The frequency to dump statistical values, e.e. dump data when stepstatDumpFreq==0. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00041">Options.cpp:41</a></div></div>
<div class="ttc" id="a04735_html_a19aacd7d2904a811460d487ade713b9a"><div class="ttname"><a href="../../d9/d06/a04735.html#a19aacd7d2904a811460d487ade713b9a">PartBunchBase::getChargePerParticle</a></div><div class="ttdeci">double getChargePerParticle() const</div><div class="ttdoc">get the macro particle charge </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01323">PartBunchBase.hpp:1323</a></div></div>
<div class="ttc" id="a00845_html"><div class="ttname"><a href="../../d7/dcf/a00845.html">VariableRFCavity.h</a></div></div>
<div class="ttc" id="a00674_html"><div class="ttname"><a href="../../d8/d73/a00674.html">MultipoleTCurvedVarRadius.h</a></div></div>
<div class="ttc" id="a12163_html_af9d914cab7e60b310cb44c75c8bff228"><div class="ttname"><a href="../../d0/d9c/a12163.html#af9d914cab7e60b310cb44c75c8bff228">IpplTimings::startTimer</a></div><div class="ttdeci">static void startTimer(TimerRef t)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9f/a04013_source.html#l00187">IpplTimings.h:187</a></div></div>
<div class="ttc" id="a04539_html_ab246135577e4a9983d50620a1e89775a"><div class="ttname"><a href="../../d0/d3d/a04539.html#ab246135577e4a9983d50620a1e89775a">Units::GeV2eV</a></div><div class="ttdeci">constexpr double GeV2eV</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dce/a01859_source.html#l00068">Units.h:68</a></div></div>
<div class="ttc" id="a04847_html_a601a0ddf82954fd61f5139586e3389ba"><div class="ttname"><a href="../../dd/dca/a04847.html#a601a0ddf82954fd61f5139586e3389ba">ParallelCyclotronTracker::updateTime</a></div><div class="ttdeci">void updateTime(const double &amp;dt)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03521">ParallelCyclotronTracker.cpp:3521</a></div></div>
<div class="ttc" id="a04549_html_aa51de3749908577e69be3d4cb91cfc60"><div class="ttname"><a href="../../d7/d8b/a04549.html#aa51de3749908577e69be3d4cb91cfc60">Options::scSolveFreq</a></div><div class="ttdeci">int scSolveFreq</div><div class="ttdoc">The frequency to solve space charge fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00057">Options.cpp:57</a></div></div>
<div class="ttc" id="a05031_html_a6a2b188041e68f645cd8e4a3ed11eb68"><div class="ttname"><a href="../../de/ddd/a05031.html#a6a2b188041e68f645cd8e4a3ed11eb68">CCollimator::getZEnd</a></div><div class="ttdeci">double getZEnd()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d3e/a00566_source.html#l00095">CCollimator.h:95</a></div></div>
<div class="ttc" id="a04847_html_afb6c4347a3e62171c21f44fc4dd182ac"><div class="ttname"><a href="../../dd/dca/a04847.html#afb6c4347a3e62171c21f44fc4dd182ac">ParallelCyclotronTracker::referencePt</a></div><div class="ttdeci">double referencePt</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00245">ParallelCyclotronTracker.h:245</a></div></div>
<div class="ttc" id="a04847_html_ac5fccd0ab2edcb6a158da8868103a114"><div class="ttname"><a href="../../dd/dca/a04847.html#ac5fccd0ab2edcb6a158da8868103a114">ParallelCyclotronTracker::checkFileMomentum</a></div><div class="ttdeci">void checkFileMomentum()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02389">ParallelCyclotronTracker.cpp:2389</a></div></div>
<div class="ttc" id="a04847_html_a10e0bca491e7f0692e75f0fc7922da07"><div class="ttname"><a href="../../dd/dca/a04847.html#a10e0bca491e7f0692e75f0fc7922da07">ParallelCyclotronTracker::repartition</a></div><div class="ttdeci">void repartition()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01665">ParallelCyclotronTracker.cpp:1665</a></div></div>
<div class="ttc" id="a04967_html_a673b786efdbf5e7bedaeca06b4876c4a"><div class="ttname"><a href="../../da/d70/a04967.html#a673b786efdbf5e7bedaeca06b4876c4a">DumpEMFields::writeFields</a></div><div class="ttdeci">static void writeFields(Component *field)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5f/a00461_source.html#l00210">DumpEMFields.cpp:210</a></div></div>
<div class="ttc" id="a04735_html_af792389ff15f7f9fe61a13138ff0d6f3"><div class="ttname"><a href="../../d9/d06/a04735.html#af792389ff15f7f9fe61a13138ff0d6f3">PartBunchBase::getT</a></div><div class="ttdeci">double getT() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01043">PartBunchBase.hpp:1043</a></div></div>
<div class="ttc" id="a05059_html_a018390d0b305bc9a9ca47a5e9dda2f5e"><div class="ttname"><a href="../../d6/de9/a05059.html#a018390d0b305bc9a9ca47a5e9dda2f5e">Cyclotron::getEScale</a></div><div class="ttdeci">virtual std::vector&lt; double &gt; getEScale() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00284">Cyclotron.cpp:284</a></div></div>
<div class="ttc" id="a00260_html"><div class="ttname"><a href="../../dd/dd7/a00260.html">Ctunes.h</a></div></div>
<div class="ttc" id="a04572_html_a7eab9239ce282f0848816013973b560ca4e221daf5caa2f0381b6c964b65ffe50"><div class="ttname"><a href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560ca4e221daf5caa2f0381b6c964b65ffe50">Steppers::LF2</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d90/a03056_source.html#l00028">Steppers.h:28</a></div></div>
<div class="ttc" id="a04545_html_a7a0330f10eb09ae36017c24b9f45365b"><div class="ttname"><a href="../../de/d21/a04545.html#a7a0330f10eb09ae36017c24b9f45365b">mslang::iterator</a></div><div class="ttdeci">std::string::iterator iterator</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d26/a02162_source.html#l00016">MSLang.h:16</a></div></div>
<div class="ttc" id="a05119_html"><div class="ttname"><a href="../../d3/d91/a05119.html">MultipoleTCurvedVarRadius</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d73/a00674_source.html#l00085">MultipoleTCurvedVarRadius.h:85</a></div></div>
<div class="ttc" id="a05059_html_a808e3ff40ea53380b27785b65295836ea260dc0178b15bfeec1dd1567deb562eb"><div class="ttname"><a href="../../d6/de9/a05059.html#a808e3ff40ea53380b27785b65295836ea260dc0178b15bfeec1dd1567deb562eb">Cyclotron::BFieldType::BANDRF</a></div></div>
<div class="ttc" id="a04847_html_ac729e8c4e7e902451a45b16399c6084e"><div class="ttname"><a href="../../dd/dca/a04847.html#ac729e8c4e7e902451a45b16399c6084e">ParallelCyclotronTracker::bunchDumpPhaseSpaceData</a></div><div class="ttdeci">void bunchDumpPhaseSpaceData()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02657">ParallelCyclotronTracker.cpp:2657</a></div></div>
<div class="ttc" id="a04735_html_aaed94ffd2ba695bf55c197a56ae45545"><div class="ttname"><a href="../../d9/d06/a04735.html#aaed94ffd2ba695bf55c197a56ae45545">PartBunchBase::setBinCharge</a></div><div class="ttdeci">virtual void setBinCharge(int bin, double q)</div><div class="ttdoc">Set the charge of one bin to the value of q and all other to zero. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l00426">PartBunchBase.hpp:426</a></div></div>
<div class="ttc" id="a03845_html_adece0042b4015b8521d983143b6af21a"><div class="ttname"><a href="../../de/d6b/a03845.html#adece0042b4015b8521d983143b6af21a">atan2</a></div><div class="ttdeci">PETE_TBTree&lt; FnArcTan2, PETE_Scalar&lt; Vektor&lt; T1, Dim &gt; &gt;, typename T2::PETE_Expr_t &gt; atan2(const Vektor&lt; T1, Dim &gt; &amp;l, const PETE_Expr&lt; T2 &gt; &amp;r)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d6b/a03845_source.html#l00244">IpplExpressions.h:244</a></div></div>
<div class="ttc" id="a04847_html_a666d11a4d347fdefa083a03ce36088b4"><div class="ttname"><a href="../../dd/dca/a04847.html#a666d11a4d347fdefa083a03ce36088b4">ParallelCyclotronTracker::borisExternalFields</a></div><div class="ttdeci">void borisExternalFields(double h)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02014">ParallelCyclotronTracker.cpp:2014</a></div></div>
<div class="ttc" id="a04735_html_aca40478a5171d91ec95f336b8f3fcfd2"><div class="ttname"><a href="../../d9/d06/a04735.html#aca40478a5171d91ec95f336b8f3fcfd2">PartBunchBase::Bf</a></div><div class="ttdeci">ParticleAttrib&lt; Vector_t &gt; Bf</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00581">PartBunchBase.h:581</a></div></div>
<div class="ttc" id="a05171_html"><div class="ttname"><a href="../../dc/d66/a05171.html">Probe</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d5c/a00752_source.html#l00028">Probe.h:28</a></div></div>
<div class="ttc" id="a00299_html_a3f0fce822e33cfa8bf2e3fafb2521451"><div class="ttname"><a href="../../df/d95/a00299.html#a3f0fce822e33cfa8bf2e3fafb2521451">c_mmtns</a></div><div class="ttdeci">constexpr double c_mmtns</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00094">ParallelCyclotronTracker.cpp:94</a></div></div>
<div class="ttc" id="a04847_html_a15a0bffb1dc6ad134121709cc90c6f6ea0679273e201afd0bf57af3961f8a23b8"><div class="ttname"><a href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6ea0679273e201afd0bf57af3961f8a23b8">ParallelCyclotronTracker::TrackingMode::SINGLE</a></div></div>
<div class="ttc" id="a05207_html"><div class="ttname"><a href="../../d8/d42/a05207.html">Solenoid</a></div><div class="ttdoc">Interface for solenoids. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/a00806_source.html#l00036">Solenoid.h:36</a></div></div>
<div class="ttc" id="a04847_html_ad2016305c2bf533cd133bd453e57f7f0"><div class="ttname"><a href="../../dd/dca/a04847.html#ad2016305c2bf533cd133bd453e57f7f0">ParallelCyclotronTracker::GenericTracker</a></div><div class="ttdeci">void GenericTracker()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01383">ParallelCyclotronTracker.cpp:1383</a></div></div>
<div class="ttc" id="a05107_html"><div class="ttname"><a href="../../da/d41/a05107.html">MultipoleT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/a00656_source.html#l00089">MultipoleT.h:89</a></div></div>
<div class="ttc" id="a04735_html_a04201304aaa3d56b1f1c50e9c017fc37"><div class="ttname"><a href="../../d9/d06/a04735.html#a04201304aaa3d56b1f1c50e9c017fc37">PartBunchBase::R</a></div><div class="ttdeci">ParticlePos_t &amp; R</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00570">PartBunchBase.h:570</a></div></div>
<div class="ttc" id="a03074_html"><div class="ttname"><a href="../../d1/d44/a03074.html">DataSink.h</a></div></div>
<div class="ttc" id="a04735_html_a02fe0321c9ea6a5dd397b567e24eea57"><div class="ttname"><a href="../../d9/d06/a04735.html#a02fe0321c9ea6a5dd397b567e24eea57">PartBunchBase::get_meanKineticEnergy</a></div><div class="ttdeci">double get_meanKineticEnergy() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01067">PartBunchBase.hpp:1067</a></div></div>
<div class="ttc" id="a07191_html_ab9558a286404d55536ffd717a5b2947b"><div class="ttname"><a href="../../d8/da7/a07191.html#ab9558a286404d55536ffd717a5b2947b">BoundaryGeometry::partInside</a></div><div class="ttdeci">int partInside(const Vector_t &amp;r, const Vector_t &amp;v, const double dt, Vector_t &amp;intecoords, int &amp;triId)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d44/a03065_source.html#l02378">BoundaryGeometry.cpp:2378</a></div></div>
<div class="ttc" id="a01913_html"><div class="ttname"><a href="../../d4/d07/a01913.html">LossDataSink.h</a></div></div>
<div class="ttc" id="a04847_html_a17bb07cf907e147a1c88b736016b3cb8"><div class="ttname"><a href="../../dd/dca/a04847.html#a17bb07cf907e147a1c88b736016b3cb8">ParallelCyclotronTracker::referenceTheta</a></div><div class="ttdeci">double referenceTheta</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00241">ParallelCyclotronTracker.h:241</a></div></div>
<div class="ttc" id="a04847_html_aa1d62a6f0278bdacc6dc77ddec8a2e64"><div class="ttname"><a href="../../dd/dca/a04847.html#aa1d62a6f0278bdacc6dc77ddec8a2e64">ParallelCyclotronTracker::bunchMode_m</a></div><div class="ttdeci">void bunchMode_m(double &amp;t, const double dt, bool &amp;finishedTurn)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03129">ParallelCyclotronTracker.cpp:3129</a></div></div>
<div class="ttc" id="a11315_html"><div class="ttname"><a href="../../d1/de3/a11315.html">OpMaxAssign</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/de6/a03848_source.html#l00619">IpplTypeComputations.h:619</a></div></div>
<div class="ttc" id="a04847_html_a586044342216bb6abc6fe79e5c54f28a"><div class="ttname"><a href="../../dd/dca/a04847.html#a586044342216bb6abc6fe79e5c54f28a">ParallelCyclotronTracker::DelParticleTimer_m</a></div><div class="ttdeci">IpplTimings::TimerRef DelParticleTimer_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00337">ParallelCyclotronTracker.h:337</a></div></div>
<div class="ttc" id="a04839_html_a9584a540808ca5c5dcb70648fba7a27a"><div class="ttname"><a href="../../d4/d10/a04839.html#a9584a540808ca5c5dcb70648fba7a27a">adder::operator()</a></div><div class="ttdeci">void operator()(double x)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01535">ParallelCyclotronTracker.cpp:1535</a></div></div>
<div class="ttc" id="a05323_html_a288371b2ee0c944a69d0b9f6bfef76b1"><div class="ttname"><a href="../../d6/daf/a05323.html#a288371b2ee0c944a69d0b9f6bfef76b1">AbstractTracker::itsReference</a></div><div class="ttdeci">const PartData itsReference</div><div class="ttdoc">The reference information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d92/a00929_source.html#l00054">AbstractTracker.h:54</a></div></div>
<div class="ttc" id="a05071_html_a4c963794b96d83d5d3be0a9fe3c44322"><div class="ttname"><a href="../../db/d78/a05071.html#a4c963794b96d83d5d3be0a9fe3c44322">ElementBase::accept</a></div><div class="ttdeci">virtual void accept(BeamlineVisitor &amp;visitor) const =0</div><div class="ttdoc">Apply visitor. </div></div>
<div class="ttc" id="a04735_html_addc3c351123a7c560c34507b2fa67b5c"><div class="ttname"><a href="../../d9/d06/a04735.html#addc3c351123a7c560c34507b2fa67b5c">PartBunchBase::setT</a></div><div class="ttdeci">void setT(double t)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01031">PartBunchBase.hpp:1031</a></div></div>
<div class="ttc" id="a05167_html_ab06a614073fd7204b808e8c5d7a3d6bf"><div class="ttname"><a href="../../df/daa/a05167.html#ab06a614073fd7204b808e8c5d7a3d6bf">PluginElement::getXEnd</a></div><div class="ttdeci">double getXEnd() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/a00743_source.html#l00182">PluginElement.cpp:182</a></div></div>
<div class="ttc" id="a05187_html_a0200ef30ec10c311cb9525f213d4ef0a"><div class="ttname"><a href="../../db/d48/a05187.html#a0200ef30ec10c311cb9525f213d4ef0a">Ring::getBeamRInit</a></div><div class="ttdeci">double getBeamRInit() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/a00776_source.html#l00235">Ring.h:235</a></div></div>
<div class="ttc" id="a04548_html_ae012eab1467cc6a796881b2e44b4464f"><div class="ttname"><a href="../../dd/d61/a04548.html#ae012eab1467cc6a796881b2e44b4464f">matheval::detail::math::deg</a></div><div class="ttdeci">T deg(T x)</div><div class="ttdoc">Convert radians to degrees. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d77/a02096_source.html#l00074">matheval.hpp:74</a></div></div>
<div class="ttc" id="a04847_html_a68e7cdb19cd27bdaf777e4092158bff0"><div class="ttname"><a href="../../dd/dca/a04847.html#a68e7cdb19cd27bdaf777e4092158bff0">ParallelCyclotronTracker::dumpAngle</a></div><div class="ttdeci">void dumpAngle(const double &amp;theta, double &amp;prevAzimuth, double &amp;azimuth, const short &amp;bunchNr=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00209">ParallelCyclotronTracker.cpp:209</a></div></div>
<div class="ttc" id="a04847_html_affaba51b29f003d124382cc37fb75929"><div class="ttname"><a href="../../dd/dca/a04847.html#affaba51b29f003d124382cc37fb75929">ParallelCyclotronTracker::turnnumber_m</a></div><div class="ttdeci">int turnnumber_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00281">ParallelCyclotronTracker.h:281</a></div></div>
<div class="ttc" id="a04847_html_af2afb9b11e96ae14c0f448d950b31ec1"><div class="ttname"><a href="../../dd/dca/a04847.html#af2afb9b11e96ae14c0f448d950b31ec1">ParallelCyclotronTracker::seoMode_m</a></div><div class="ttdeci">void seoMode_m(double &amp;t, const double dt, bool &amp;finishedTurn, dvector_t &amp;Ttime, dvector_t &amp;Tdeltr, dvector_t &amp;Tdeltz, ivector_t &amp;TturnNumber)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03017">ParallelCyclotronTracker.cpp:3017</a></div></div>
<div class="ttc" id="a00794_html"><div class="ttname"><a href="../../d5/d12/a00794.html">ScalingFFAMagnet.h</a></div></div>
<div class="ttc" id="a05247_html_a5cab72da0ece717746981e431eb4921e"><div class="ttname"><a href="../../d8/da5/a05247.html#a5cab72da0ece717746981e431eb4921e">Vacuum::getPScale</a></div><div class="ttdeci">double getPScale() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/a00836_source.html#l00149">Vacuum.cpp:149</a></div></div>
<div class="ttc" id="a04847_html_a8dcb3538f720a2cf6edb5e86da23b9fd"><div class="ttname"><a href="../../dd/dca/a04847.html#a8dcb3538f720a2cf6edb5e86da23b9fd">ParallelCyclotronTracker::visitDrift</a></div><div class="ttdeci">virtual void visitDrift(const Drift &amp;)</div><div class="ttdoc">Apply the algorithm to a drift space. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00559">ParallelCyclotronTracker.cpp:559</a></div></div>
<div class="ttc" id="a04847_html_a15a0bffb1dc6ad134121709cc90c6f6e"><div class="ttname"><a href="../../dd/dca/a04847.html#a15a0bffb1dc6ad134121709cc90c6f6e">ParallelCyclotronTracker::TrackingMode</a></div><div class="ttdeci">TrackingMode</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00206">ParallelCyclotronTracker.h:206</a></div></div>
<div class="ttc" id="a05059_html_a3ffb79294234b5f9a161c698c0219bf2"><div class="ttname"><a href="../../d6/de9/a05059.html#a3ffb79294234b5f9a161c698c0219bf2">Cyclotron::getPZinit</a></div><div class="ttdeci">virtual double getPZinit() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00159">Cyclotron.cpp:159</a></div></div>
<div class="ttc" id="a04847_html_a248cafbfeef5f7465d79fc5bde4662c6"><div class="ttname"><a href="../../dd/dca/a04847.html#a248cafbfeef5f7465d79fc5bde4662c6">ParallelCyclotronTracker::itsDataSink</a></div><div class="ttdeci">DataSink * itsDataSink</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00224">ParallelCyclotronTracker.h:224</a></div></div>
<div class="ttc" id="a04847_html_a3aa4e3f090e50a22880361f10775fff9"><div class="ttname"><a href="../../dd/dca/a04847.html#a3aa4e3f090e50a22880361f10775fff9">ParallelCyclotronTracker::singleMode_m</a></div><div class="ttdeci">void singleMode_m(double &amp;t, const double dt, bool &amp;finishedTurn, double &amp;oldReferenceTheta)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03065">ParallelCyclotronTracker.cpp:3065</a></div></div>
<div class="ttc" id="a00908_html_a7a49daa94331dcd77650d976f3030012"><div class="ttname"><a href="../../d0/d85/a00908.html#a7a49daa94331dcd77650d976f3030012">euclidean_norm</a></div><div class="ttdeci">T euclidean_norm(const Vector&lt; T &gt; &amp;)</div><div class="ttdoc">Euclidean norm. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d85/a00908_source.html#l00243">Vector.h:243</a></div></div>
<div class="ttc" id="a05187_html_a5141747e3bf9da4ee7b286017b6adfca"><div class="ttname"><a href="../../db/d48/a05187.html#a5141747e3bf9da4ee7b286017b6adfca">Ring::getSymmetry</a></div><div class="ttdeci">double getSymmetry() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd4/a00776_source.html#l00286">Ring.h:286</a></div></div>
<div class="ttc" id="a04847_html_ac66e14b4b0f94b3b11529966874d0ed3"><div class="ttname"><a href="../../dd/dca/a04847.html#ac66e14b4b0f94b3b11529966874d0ed3">ParallelCyclotronTracker::stepper_m</a></div><div class="ttdeci">Steppers::TimeIntegrator stepper_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00471">ParallelCyclotronTracker.h:471</a></div></div>
<div class="ttc" id="a13617_html_ab697fa0a630f074473ff6421693e7f3a"><div class="ttname"><a href="../../de/dc4/a13617.html#ab697fa0a630f074473ff6421693e7f3a">Vector_t</a></div><div class="ttdeci">Vektor&lt; double, 3 &gt; Vector_t</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc4/a13617_source.html#l00006">Vektor.h:6</a></div></div>
<div class="ttc" id="a04847_html_a84f93e4f3383e7e6401bd6672ae7c12c"><div class="ttname"><a href="../../dd/dca/a04847.html#a84f93e4f3383e7e6401bd6672ae7c12c">ParallelCyclotronTracker::initialLocalNum_m</a></div><div class="ttdeci">const size_t initialLocalNum_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00306">ParallelCyclotronTracker.h:306</a></div></div>
<div class="ttc" id="a03845_html_a7633e9416cb6fdd16745f5ba3e3ea7d3"><div class="ttname"><a href="../../de/d6b/a03845.html#a7633e9416cb6fdd16745f5ba3e3ea7d3">abs</a></div><div class="ttdeci">PETE_TUTree&lt; FnAbs, typename T::PETE_Expr_t &gt; abs(const PETE_Expr&lt; T &gt; &amp;l)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d6b/a03845_source.html#l00062">IpplExpressions.h:62</a></div></div>
<div class="ttc" id="a04847_html_a705a3ae603fb70d81bedda510f07c348"><div class="ttname"><a href="../../dd/dca/a04847.html#a705a3ae603fb70d81bedda510f07c348">ParallelCyclotronTracker::yaxis</a></div><div class="ttdeci">static Vector_t const yaxis</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00235">ParallelCyclotronTracker.h:235</a></div></div>
<div class="ttc" id="a05183_html_a6c0772681aaef3784df12ae9bbfd42c3"><div class="ttname"><a href="../../d7/d48/a05183.html#a6c0772681aaef3784df12ae9bbfd42c3">RFCavity::initialise</a></div><div class="ttdeci">virtual void initialise(PartBunchBase&lt; double, 3 &gt; *bunch, double &amp;startField, double &amp;endField) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00167">RFCavity.cpp:167</a></div></div>
<div class="ttc" id="a04735_html_a4951c53df6841fd275a56f41fc76bfdf"><div class="ttname"><a href="../../d9/d06/a04735.html#a4951c53df6841fd275a56f41fc76bfdf">PartBunchBase::getdT</a></div><div class="ttdeci">double getdT() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01025">PartBunchBase.hpp:1025</a></div></div>
<div class="ttc" id="a04847_html_ade672dfc65236c764d564883ff95888e"><div class="ttname"><a href="../../dd/dca/a04847.html#ade672dfc65236c764d564883ff95888e">ParallelCyclotronTracker::visitRFCavity</a></div><div class="ttdeci">virtual void visitRFCavity(const RFCavity &amp;)</div><div class="ttdoc">Apply the algorithm to a RF cavity. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00739">ParallelCyclotronTracker.cpp:739</a></div></div>
<div class="ttc" id="a04739_html_ae42695bd5e1bea11211a45955b49abd3a375ffb668aa90f1c7fcae55e9734a752"><div class="ttname"><a href="../../d5/d13/a04739.html#ae42695bd5e1bea11211a45955b49abd3a375ffb668aa90f1c7fcae55e9734a752">OpalData::OpenMode::APPEND</a></div></div>
<div class="ttc" id="a04847_html_aead185c769e9dd9d311789b7eb986812"><div class="ttname"><a href="../../dd/dca/a04847.html#aead185c769e9dd9d311789b7eb986812">ParallelCyclotronTracker::visitSeptum</a></div><div class="ttdeci">virtual void visitSeptum(const Septum &amp;)</div><div class="ttdoc">Apply the algorithm to a septum. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00916">ParallelCyclotronTracker.cpp:916</a></div></div>
<div class="ttc" id="a04847_html_ac1729b0f0f574e9086dc7da97a196925"><div class="ttname"><a href="../../dd/dca/a04847.html#ac1729b0f0f574e9086dc7da97a196925">ParallelCyclotronTracker::referenceR</a></div><div class="ttdeci">double referenceR</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00240">ParallelCyclotronTracker.h:240</a></div></div>
<div class="ttc" id="a04735_html_a29ca57fb0fea183092d65cc5cd7278a4"><div class="ttname"><a href="../../d9/d06/a04735.html#a29ca57fb0fea183092d65cc5cd7278a4">PartBunchBase::setLocalBinCount</a></div><div class="ttdeci">void setLocalBinCount(size_t num, int bin)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l00331">PartBunchBase.hpp:331</a></div></div>
<div class="ttc" id="a04847_html_a997b77714d998c12a08177fbb36ce8d8"><div class="ttname"><a href="../../dd/dca/a04847.html#a997b77714d998c12a08177fbb36ce8d8">ParallelCyclotronTracker::visitVariableRFCavityFringeField</a></div><div class="ttdeci">virtual void visitVariableRFCavityFringeField(const VariableRFCavityFringeField &amp;cav)</div><div class="ttdoc">Apply the algorithm to a variable RF cavity with Fringe Field. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01081">ParallelCyclotronTracker.cpp:1081</a></div></div>
<div class="ttc" id="a04847_html_a3451f8fb01e84fc30d0525dd8e3becff"><div class="ttname"><a href="../../dd/dca/a04847.html#a3451f8fb01e84fc30d0525dd8e3becff">ParallelCyclotronTracker::rotateAroundZ</a></div><div class="ttdeci">void rotateAroundZ(ParticleAttrib&lt; Vector_t &gt; &amp;particleVectors, double const phi)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01858">ParallelCyclotronTracker.cpp:1858</a></div></div>
<div class="ttc" id="a00851_html"><div class="ttname"><a href="../../df/d4c/a00851.html">VariableRFCavityFringeField.h</a></div></div>
<div class="ttc" id="a05091_html"><div class="ttname"><a href="../../d9/de1/a05091.html">FlexibleCollimator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2a/a00632_source.html#l00031">FlexibleCollimator.h:31</a></div></div>
<div class="ttc" id="a04549_html_ab08b0e5cb95b53c6e80d36c884babd3a"><div class="ttname"><a href="../../d7/d8b/a04549.html#ab08b0e5cb95b53c6e80d36c884babd3a">Options::repartFreq</a></div><div class="ttdeci">int repartFreq</div><div class="ttdoc">The frequency to do particles repartition for better load balance between nodes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00049">Options.cpp:49</a></div></div>
<div class="ttc" id="a04847_html_aa7a5400ff034ec9af176814a96661eb7"><div class="ttname"><a href="../../dd/dca/a04847.html#aa7a5400ff034ec9af176814a96661eb7">ParallelCyclotronTracker::myElements</a></div><div class="ttdeci">std::list&lt; Component * &gt; myElements</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00219">ParallelCyclotronTracker.h:219</a></div></div>
<div class="ttc" id="a02234_html_add802868496e19113f6924d041d7d9abaa689fe8f0fbe6f20034cbd7de3bc8b69"><div class="ttname"><a href="../../d8/d6f/a02234.html#add802868496e19113f6924d041d7d9abaa689fe8f0fbe6f20034cbd7de3bc8b69">DistributionType::FROMFILE</a></div></div>
<div class="ttc" id="a04549_html_a3c0b76e671a3771342d4f52b5e0d380d"><div class="ttname"><a href="../../d7/d8b/a04549.html#a3c0b76e671a3771342d4f52b5e0d380d">Options::asciidump</a></div><div class="ttdeci">bool asciidump</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00085">Options.cpp:85</a></div></div>
<div class="ttc" id="a05639_html"><div class="ttname"><a href="../../d7/d9a/a05639.html">TBeamline</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d34/a01298_source.html#l00033">TBeamline.h:33</a></div></div>
<div class="ttc" id="a04847_html_a7cc5ddca11d4cd71b4d89552202b1fe9"><div class="ttname"><a href="../../dd/dca/a04847.html#a7cc5ddca11d4cd71b4d89552202b1fe9">ParallelCyclotronTracker::sinRefTheta_m</a></div><div class="ttdeci">double sinRefTheta_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00258">ParallelCyclotronTracker.h:258</a></div></div>
<div class="ttc" id="a04847_html_a9e4710ef7f2847551ec7257cdea4d11a"><div class="ttname"><a href="../../dd/dca/a04847.html#a9e4710ef7f2847551ec7257cdea4d11a">ParallelCyclotronTracker::visitMarker</a></div><div class="ttdeci">virtual void visitMarker(const Marker &amp;)</div><div class="ttdoc">Apply the algorithm to a marker. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00594">ParallelCyclotronTracker.cpp:594</a></div></div>
<div class="ttc" id="a05391_html"><div class="ttname"><a href="../../d2/dc7/a05391.html">Quaternion</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d59/a01013_source.html#l00010">Quaternion.h:10</a></div></div>
<div class="ttc" id="a04847_html_a00991ee8b1feb2e195fe423a67eae1d9"><div class="ttname"><a href="../../dd/dca/a04847.html#a00991ee8b1feb2e195fe423a67eae1d9">ParallelCyclotronTracker::computePathLengthUpdate</a></div><div class="ttdeci">void computePathLengthUpdate(std::vector&lt; double &gt; &amp;dl, const double &amp;dt)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00238">ParallelCyclotronTracker.cpp:238</a></div></div>
<div class="ttc" id="a04847_html_a42b090454954eacc9124dd0564ff6c4a"><div class="ttname"><a href="../../dd/dca/a04847.html#a42b090454954eacc9124dd0564ff6c4a">ParallelCyclotronTracker::outfTheta_m</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; std::ofstream &gt; &gt; outfTheta_m</div><div class="ttdoc">output coordinates at different azimuthal angles and one after every turn </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00310">ParallelCyclotronTracker.h:310</a></div></div>
<div class="ttc" id="a05191_html"><div class="ttname"><a href="../../de/d61/a05191.html">SBend</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d96/a00782_source.html#l00068">SBend.h:68</a></div></div>
<div class="ttc" id="a04847_html_a9cf653e8be3eb7677e701046bc036bee"><div class="ttname"><a href="../../dd/dca/a04847.html#a9cf653e8be3eb7677e701046bc036bee">ParallelCyclotronTracker::visitSBend</a></div><div class="ttdeci">virtual void visitSBend(const SBend &amp;)</div><div class="ttdoc">Apply the algorithm to a sector bend. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00885">ParallelCyclotronTracker.cpp:885</a></div></div>
<div class="ttc" id="a04847_html_a7b7de46cb5ba096d06787417babe02ac"><div class="ttname"><a href="../../dd/dca/a04847.html#a7b7de46cb5ba096d06787417babe02ac">ParallelCyclotronTracker::BinRepartTimer_m</a></div><div class="ttdeci">IpplTimings::TimerRef BinRepartTimer_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00335">ParallelCyclotronTracker.h:335</a></div></div>
<div class="ttc" id="a04549_html_ae0db5a93a78dae4428c4f1aab6dce62f"><div class="ttname"><a href="../../d7/d8b/a04549.html#ae0db5a93a78dae4428c4f1aab6dce62f">Options::psDumpFrame</a></div><div class="ttdeci">DumpFrame psDumpFrame</div><div class="ttdoc">flag to decide in which coordinate frame the phase space will be dumped for OPAL-cycl ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00045">Options.cpp:45</a></div></div>
<div class="ttc" id="a05227_html"><div class="ttname"><a href="../../d3/d6e/a05227.html">Stripper</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8b/a00821_source.html#l00031">Stripper.h:31</a></div></div>
<div class="ttc" id="a04847_html_a66c3d1957609f79519739182446fc8ba"><div class="ttname"><a href="../../dd/dca/a04847.html#a66c3d1957609f79519739182446fc8ba">ParallelCyclotronTracker::bega</a></div><div class="ttdeci">double bega</div><div class="ttdoc">The reference variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00239">ParallelCyclotronTracker.h:239</a></div></div>
<div class="ttc" id="a04847_html_a97ee5107df5a7ef4f507c2ab55f728b4"><div class="ttname"><a href="../../dd/dca/a04847.html#a97ee5107df5a7ef4f507c2ab55f728b4">ParallelCyclotronTracker::referencePz</a></div><div class="ttdeci">double referencePz</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00246">ParallelCyclotronTracker.h:246</a></div></div>
<div class="ttc" id="a12131_html_aebcb82f8a013adbf9812642262edfc38"><div class="ttname"><a href="../../df/da4/a12131.html#aebcb82f8a013adbf9812642262edfc38">IpplInfo::Comm</a></div><div class="ttdeci">static Communicate * Comm</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d27/a03989_source.html#l00084">IpplInfo.h:84</a></div></div>
<div class="ttc" id="a05183_html_af3d5bda1a532c40cc7f527926f679cfb"><div class="ttname"><a href="../../d7/d48/a05183.html#af3d5bda1a532c40cc7f527926f679cfb">RFCavity::getPhi0</a></div><div class="ttdeci">virtual double getPhi0() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00318">RFCavity.cpp:318</a></div></div>
<div class="ttc" id="a04847_html_a9ff9d61613dbb3f45737a245cb32a82a"><div class="ttname"><a href="../../dd/dca/a04847.html#a9ff9d61613dbb3f45737a245cb32a82a">ParallelCyclotronTracker::dumpThetaEachTurn_m</a></div><div class="ttdeci">void dumpThetaEachTurn_m(const double &amp;t, const Vector_t &amp;R, const Vector_t &amp;P, const double &amp;temp_meanTheta, bool &amp;finishedTurn)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03296">ParallelCyclotronTracker.cpp:3296</a></div></div>
<div class="ttc" id="a03971_html_a4f2ddb1680d4f912183950ea45ac1504"><div class="ttname"><a href="../../d0/dce/a03971.html#a4f2ddb1680d4f912183950ea45ac1504">level4</a></div><div class="ttdeci">Inform &amp; level4(Inform &amp;inf)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dce/a03971_source.html#l00048">Inform.cpp:48</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8ad4a12d5c2d08bdb4c5bcd2f8e022848b"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ad4a12d5c2d08bdb4c5bcd2f8e022848b">ElementType::STRIPPER</a></div></div>
<div class="ttc" id="a05059_html_ad58ddc82494a30a8e8c693cf123315c7"><div class="ttname"><a href="../../d6/de9/a05059.html#ad58ddc82494a30a8e8c693cf123315c7">Cyclotron::getSuperpose</a></div><div class="ttdeci">virtual std::vector&lt; bool &gt; getSuperpose() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00239">Cyclotron.cpp:239</a></div></div>
<div class="ttc" id="a04739_html_a3539361fbd2937b2b70723d6470ba8a6"><div class="ttname"><a href="../../d5/d13/a04739.html#a3539361fbd2937b2b70723d6470ba8a6">OpalData::getInputBasename</a></div><div class="ttdeci">std::string getInputBasename()</div><div class="ttdoc">get input file name without extension </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dc1/a00212_source.html#l00669">OpalData.cpp:669</a></div></div>
<div class="ttc" id="a05059_html_a156c84ef5b4abf775a91d0a78c531f41"><div class="ttname"><a href="../../d6/de9/a05059.html#a156c84ef5b4abf775a91d0a78c531f41">Cyclotron::getSpiralFlag</a></div><div class="ttdeci">virtual bool getSpiralFlag() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00175">Cyclotron.cpp:175</a></div></div>
<div class="ttc" id="a04847_html_ac3eb901a612fc16285ae165132ead491"><div class="ttname"><a href="../../dd/dca/a04847.html#ac3eb901a612fc16285ae165132ead491">ParallelCyclotronTracker::visitSolenoid</a></div><div class="ttdeci">virtual void visitSolenoid(const Solenoid &amp;)</div><div class="ttdoc">Apply the algorithm to a solenoid. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00958">ParallelCyclotronTracker.cpp:958</a></div></div>
<div class="ttc" id="a00602_html_a1d3efb4a54c06179c8699d81435593c8ac04b3cc5b1a13dc2463b809070bbb67e"><div class="ttname"><a href="../../d5/d0a/a00602.html#a1d3efb4a54c06179c8699d81435593c8ac04b3cc5b1a13dc2463b809070bbb67e">ElementType::RFCAVITY</a></div></div>
<div class="ttc" id="a05115_html"><div class="ttname"><a href="../../df/d84/a05115.html">MultipoleTCurvedConstRadius</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d5c/a00668_source.html#l00083">MultipoleTCurvedConstRadius.h:83</a></div></div>
<div class="ttc" id="a00302_html"><div class="ttname"><a href="../../d0/d61/a00302.html">ParallelCyclotronTracker.h</a></div></div>
<div class="ttc" id="a01289_html"><div class="ttname"><a href="../../d9/dda/a01289.html">FlaggedBeamline.h</a></div></div>
<div class="ttc" id="a05059_html_a7b789e2c8e8dafd47e2acfcd9c97d0da"><div class="ttname"><a href="../../d6/de9/a05059.html#a7b789e2c8e8dafd47e2acfcd9c97d0da">Cyclotron::getPHIinit</a></div><div class="ttdeci">virtual double getPHIinit() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00143">Cyclotron.cpp:143</a></div></div>
<div class="ttc" id="a05183_html_a0f2f53e846d80e68b785b63801787fb2"><div class="ttname"><a href="../../d7/d48/a05183.html#a0f2f53e846d80e68b785b63801787fb2">RFCavity::getAzimuth</a></div><div class="ttdeci">virtual double getAzimuth() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dae/a00767_source.html#l00298">RFCavity.cpp:298</a></div></div>
<div class="ttc" id="a04537_html_ad5ee779aee8511a18dfbb209e80efc64"><div class="ttname"><a href="../../d4/dd0/a04537.html#ad5ee779aee8511a18dfbb209e80efc64">Physics::e</a></div><div class="ttdeci">constexpr double e</div><div class="ttdoc">The value of . </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6b/a01853_source.html#l00039">Physics.h:39</a></div></div>
<div class="ttc" id="a04847_html_aefe99013af8d2932f81efeb3097a7082"><div class="ttname"><a href="../../dd/dca/a04847.html#aefe99013af8d2932f81efeb3097a7082">ParallelCyclotronTracker::visitMultipoleTCurvedConstRadius</a></div><div class="ttdeci">virtual void visitMultipoleTCurvedConstRadius(const MultipoleTCurvedConstRadius &amp;)</div><div class="ttdoc">Apply the algorithm to an arbitrary curved multipole of constant radius. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l00658">ParallelCyclotronTracker.cpp:658</a></div></div>
<div class="ttc" id="a04847_html_af904f7566da33371647e4302af1b8c83"><div class="ttname"><a href="../../dd/dca/a04847.html#af904f7566da33371647e4302af1b8c83">ParallelCyclotronTracker::initDistInGlobalFrame</a></div><div class="ttdeci">void initDistInGlobalFrame()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02226">ParallelCyclotronTracker.cpp:2226</a></div></div>
<div class="ttc" id="a04735_html_a454432f563c82b70dd9799e8e42efcbc"><div class="ttname"><a href="../../d9/d06/a04735.html#a454432f563c82b70dd9799e8e42efcbc">PartBunchBase::P</a></div><div class="ttdeci">ParticleAttrib&lt; Vector_t &gt; P</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00574">PartBunchBase.h:574</a></div></div>
<div class="ttc" id="a04572_html_a7eab9239ce282f0848816013973b560c"><div class="ttname"><a href="../../d5/d6f/a04572.html#a7eab9239ce282f0848816013973b560c">Steppers::TimeIntegrator</a></div><div class="ttdeci">TimeIntegrator</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d90/a03056_source.html#l00025">Steppers.h:25</a></div></div>
<div class="ttc" id="a04847_html_a6ebda3b639c81ba350e7b6171948c1a4"><div class="ttname"><a href="../../dd/dca/a04847.html#a6ebda3b639c81ba350e7b6171948c1a4">ParallelCyclotronTracker::bunchDumpStatData</a></div><div class="ttdeci">void bunchDumpStatData()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l02546">ParallelCyclotronTracker.cpp:2546</a></div></div>
<div class="ttc" id="a04735_html_a8fc8a2726ce302ccf893c2bf638d6572"><div class="ttname"><a href="../../d9/d06/a04735.html#a8fc8a2726ce302ccf893c2bf638d6572">PartBunchBase::setGlobalMeanR</a></div><div class="ttdeci">void setGlobalMeanR(Vector_t globalMeanR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01481">PartBunchBase.hpp:1481</a></div></div>
<div class="ttc" id="a05187_html_ad250951f169d59aeee3671b74f5e45ec"><div class="ttname"><a href="../../db/d48/a05187.html#ad250951f169d59aeee3671b74f5e45ec">Ring::lockRing</a></div><div class="ttdeci">void lockRing()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dba/a00773_source.html#l00289">Ring.cpp:289</a></div></div>
<div class="ttc" id="a05203_html"><div class="ttname"><a href="../../de/d1b/a05203.html">Septum</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0e/a00800_source.html#l00023">Septum.h:23</a></div></div>
<div class="ttc" id="a05059_html_aecca8fc5b33b4aae7e36e6f18643a36e"><div class="ttname"><a href="../../d6/de9/a05059.html#aecca8fc5b33b4aae7e36e6f18643a36e">Cyclotron::getCyclotronType</a></div><div class="ttdeci">const std::string &amp; getCyclotronType() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dc8/a00581_source.html#l00260">Cyclotron.cpp:260</a></div></div>
<div class="ttc" id="a05103_html"><div class="ttname"><a href="../../d8/d5e/a05103.html">Multipole</a></div><div class="ttdoc">Interface for general multipole. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d36/a00650_source.html#l00047">Multipole.h:47</a></div></div>
<div class="ttc" id="a07147_html"><div class="ttname"><a href="../../df/d78/a07147.html">BorisPusher</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d23/a03038_source.html#l00030">BorisPusher.h:30</a></div></div>
<div class="ttc" id="a04735_html_a55b7d442caf5f6a0b76d5b59d15947d8"><div class="ttname"><a href="../../d9/d06/a04735.html#a55b7d442caf5f6a0b76d5b59d15947d8">PartBunchBase::computeSelfFields_cycl</a></div><div class="ttdeci">virtual void computeSelfFields_cycl(double gamma)=0</div></div>
<div class="ttc" id="a00893_html_aff5fe19fcdf8761618dbaf37b209a9c6"><div class="ttname"><a href="../../dc/d2c/a00893.html#aff5fe19fcdf8761618dbaf37b209a9c6">sqrt</a></div><div class="ttdeci">Tps&lt; T &gt; sqrt(const Tps&lt; T &gt; &amp;x)</div><div class="ttdoc">Square root. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2c/a00893_source.html#l00091">TpsMath.h:91</a></div></div>
<div class="ttc" id="a04847_html_a9a8843522ab0b1e76f7f19411df5b790"><div class="ttname"><a href="../../dd/dca/a04847.html#a9a8843522ab0b1e76f7f19411df5b790">ParallelCyclotronTracker::getQuaternionTwoVectors</a></div><div class="ttdeci">void getQuaternionTwoVectors(Vector_t u, Vector_t v, Quaternion_t &amp;quaternion)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01903">ParallelCyclotronTracker.cpp:1903</a></div></div>
<div class="ttc" id="a04847_html_a566180cef8406a229e4cd208616de10c"><div class="ttname"><a href="../../dd/dca/a04847.html#a566180cef8406a229e4cd208616de10c">ParallelCyclotronTracker::setTrackingMode</a></div><div class="ttdeci">void setTrackingMode()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l03005">ParallelCyclotronTracker.cpp:3005</a></div></div>
<div class="ttc" id="a04735_html_a5d3f889cb1da052c04f1ce823946467f"><div class="ttname"><a href="../../d9/d06/a04735.html#a5d3f889cb1da052c04f1ce823946467f">PartBunchBase::RefPartR_m</a></div><div class="ttdeci">Vector_t RefPartR_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d95/a00989_source.html#l00590">PartBunchBase.h:590</a></div></div>
<div class="ttc" id="a05167_html_adf03280be6438e40778b65c2b3292c05"><div class="ttname"><a href="../../df/daa/a05167.html#adf03280be6438e40778b65c2b3292c05">PluginElement::getXStart</a></div><div class="ttdeci">double getXStart() const</div><div class="ttdoc">Member variable access. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/a00743_source.html#l00178">PluginElement.cpp:178</a></div></div>
<div class="ttc" id="a04549_html_a3baf2f09d4554903eae71cc1e435da19"><div class="ttname"><a href="../../d7/d8b/a04549.html#a3baf2f09d4554903eae71cc1e435da19">Options::psDumpEachTurn</a></div><div class="ttdeci">bool psDumpEachTurn</div><div class="ttdoc">phase space dump flag for OPAL-cycl </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00043">Options.cpp:43</a></div></div>
<div class="ttc" id="a04847_html_a5c507cc377b28df9b66a7b3831c2ed05"><div class="ttname"><a href="../../dd/dca/a04847.html#a5c507cc377b28df9b66a7b3831c2ed05">ParallelCyclotronTracker::RFkick</a></div><div class="ttdeci">bool RFkick(RFCavity *rfcavity, const double t, const double dt, const int Pindex)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01508">ParallelCyclotronTracker.cpp:1508</a></div></div>
<div class="ttc" id="a05059_html"><div class="ttname"><a href="../../d6/de9/a05059.html">Cyclotron</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d21/a00584_source.html#l00080">Cyclotron.h:80</a></div></div>
<div class="ttc" id="a05399_html_ac5818e7aa3e28d23635ca4f89c486e39"><div class="ttname"><a href="../../dc/daf/a05399.html#ac5818e7aa3e28d23635ca4f89c486e39">Tracker::itsBunch_m</a></div><div class="ttdeci">PartBunchBase&lt; double, 3 &gt; * itsBunch_m</div><div class="ttdoc">The bunch of particles to be tracked. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d23/a01025_source.html#l00151">Tracker.h:151</a></div></div>
<div class="ttc" id="a04847_html_ab66a59fab6e56302c0302b72cffe8fd8"><div class="ttname"><a href="../../dd/dca/a04847.html#ab66a59fab6e56302c0302b72cffe8fd8">ParallelCyclotronTracker::bgf_m</a></div><div class="ttdeci">BoundaryGeometry * bgf_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00226">ParallelCyclotronTracker.h:226</a></div></div>
<div class="ttc" id="a05203_html_ae8acecad5f598176c0a70cfbd4a0660a"><div class="ttname"><a href="../../de/d1b/a05203.html#ae8acecad5f598176c0a70cfbd4a0660a">Septum::getWidth</a></div><div class="ttdeci">double getWidth() const</div><div class="ttdef"><b>Definition:</b> <a href="../../da/db8/a00797_source.html#l00057">Septum.cpp:57</a></div></div>
<div class="ttc" id="a04847_html_ac844967115fc7013d8e942016413db37"><div class="ttname"><a href="../../dd/dca/a04847.html#ac844967115fc7013d8e942016413db37">ParallelCyclotronTracker::TransformTimer_m</a></div><div class="ttdeci">IpplTimings::TimerRef TransformTimer_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00334">ParallelCyclotronTracker.h:334</a></div></div>
<div class="ttc" id="a05259_html"><div class="ttname"><a href="../../d1/d56/a05259.html">VerticalFFAMagnet</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d82/a00857_source.html#l00028">VerticalFFAMagnet.h:28</a></div></div>
<div class="ttc" id="a05159_html"><div class="ttname"><a href="../../d1/d90/a05159.html">MultipoleTStraight</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dc0/a00734_source.html#l00082">MultipoleTStraight.h:82</a></div></div>
<div class="ttc" id="a04735_html_a1f81217882e2f010b529837e0abc8889"><div class="ttname"><a href="../../d9/d06/a04735.html#a1f81217882e2f010b529837e0abc8889">PartBunchBase::getLocalNum</a></div><div class="ttdeci">size_t getLocalNum() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d76/a00992_source.html#l01905">PartBunchBase.hpp:1905</a></div></div>
<div class="ttc" id="a12131_html_ace7b103c3bf58266544e165c6b5a69d4"><div class="ttname"><a href="../../df/da4/a12131.html#ace7b103c3bf58266544e165c6b5a69d4">IpplInfo::getNodes</a></div><div class="ttdeci">static int getNodes()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df2/a03986_source.html#l00670">IpplInfo.cpp:670</a></div></div>
<div class="ttc" id="a04847_html_acf68ac4efd8953d5cda0641a510e6bd4"><div class="ttname"><a href="../../dd/dca/a04847.html#acf68ac4efd8953d5cda0641a510e6bd4">ParallelCyclotronTracker::calcMeanR</a></div><div class="ttdeci">Vector_t calcMeanR(short bunchNr=-1) const</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01629">ParallelCyclotronTracker.cpp:1629</a></div></div>
<div class="ttc" id="a04847_html_a15da20b251e91cb0f98cc68ef596ca3a"><div class="ttname"><a href="../../dd/dca/a04847.html#a15da20b251e91cb0f98cc68ef596ca3a">ParallelCyclotronTracker::calcMeanP</a></div><div class="ttdeci">Vector_t calcMeanP() const</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d95/a00299_source.html#l01652">ParallelCyclotronTracker.cpp:1652</a></div></div>
<div class="ttc" id="a04847_html_a0c857908400bfd328bf60bc21b1da30b"><div class="ttname"><a href="../../dd/dca/a04847.html#a0c857908400bfd328bf60bc21b1da30b">ParallelCyclotronTracker::IntegrationTimer_m</a></div><div class="ttdeci">IpplTimings::TimerRef IntegrationTimer_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a00302_source.html#l00332">ParallelCyclotronTracker.h:332</a></div></div>
<div class="ttc" id="a07323_html"><div class="ttname"><a href="../../dd/d99/a07323.html">OpalException</a></div><div class="ttdoc">The base class for all OPAL exceptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dc1/a03263_source.html#l00028">OpalException.h:28</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 29 2026 15:01:30 for OPAL (Object Oriented Parallel Accelerator Library) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
